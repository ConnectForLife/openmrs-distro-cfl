"use strict";(self.webpackChunk_openmrs_esm_patient_immunizations_app=self.webpackChunk_openmrs_esm_patient_immunizations_app||[]).push([[355],{2996:(e,t,n)=>{n.d(t,{Z:()=>u});var i=n(9601),r=n.n(i),a=n(2609),o=n.n(a)()(r());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-immunizations__immunizations-form__immunizationSequenceSelect___MlJNX{margin:1rem 2rem 1rem}.-esm-patient-immunizations__immunizations-form__form___K6IzX{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.-esm-patient-immunizations__immunizations-form__button___L8zJi{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-immunizations__immunizations-form__tablet___zycFW{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-immunizations__immunizations-form__desktop___c6k1T{padding:0rem}",""]),o.locals={immunizationSequenceSelect:"-esm-patient-immunizations__immunizations-form__immunizationSequenceSelect___MlJNX",form:"-esm-patient-immunizations__immunizations-form__form___K6IzX",button:"-esm-patient-immunizations__immunizations-form__button___L8zJi",tablet:"-esm-patient-immunizations__immunizations-form__tablet___zycFW",desktop:"-esm-patient-immunizations__immunizations-form__desktop___c6k1T"};const u=o},1756:(e,t,n)=>{n.d(t,{V:()=>d,j:()=>v});var i=n(906),r=n(2449),a=n(772),o=n(468),u=n(4402),c=n(3012),l=n(3939),s=function(e){var t,n,r=null==e?void 0:e.resource,a=null==r?void 0:r.id,o=null==r||null===(t=r.manufacturer)||void 0===t?void 0:t.display,u=null==r?void 0:r.lotNumber,c=(null==r||null===(n=r.protocolApplied)||void 0===n?void 0:n.length)>0&&(null==r?void 0:r.protocolApplied[0]);return{immunizationObsUuid:a,manufacturer:o,lotNumber:u,sequenceLabel:null==c?void 0:c.series,sequenceNumber:null==c?void 0:c.doseNumberPositiveInt,occurrenceDateTime:(0,i.formatDate)(new Date(null==r?void 0:r.occurrenceDateTime)),expirationDate:(0,i.formatDate)(new Date(null==r?void 0:r.expirationDate))}},m=function(e){var t;return(0,r.Z)(null==e||null===(t=e.vaccineCode)||void 0===t?void 0:t.coding,(function(e){return(0,u.Z)(e.system)}))},d=function(e){var t=(0,o.Z)(e.entry,(function(e){var t;return null===(t=m(e.resource))||void 0===t?void 0:t.code}));return(0,c.Z)(t,(function(e){var t,n=(0,c.Z)(e,s),i=m(null===(t=e[0])||void 0===t?void 0:t.resource);return{vaccineName:null==i?void 0:i.display,vaccineUuid:null==i?void 0:i.code,existingDoses:(0,l.Z)(n,[function(e){return(0,a.Z)(e,"occurrenceDateTime")}],["desc"])}}))};function f(e,t){return{type:e,reference:"".concat(e,"/").concat(t)}}var v=function(e,t,n,r){return{resourceType:"Immunization",status:"completed",id:e.immunizationObsUuid,vaccineCode:{coding:[{code:e.vaccineUuid,display:e.vaccineName}]},patient:f("Patient",e.patientUuid),encounter:f("Encounter",t),occurrenceDateTime:(0,i.parseDate)(e.vaccinationDate),expirationDate:(0,i.parseDate)(e.expirationDate),location:f("Location",n),performer:[{actor:f("Practitioner",r)}],manufacturer:{display:e.manufacturer},lotNumber:e.lotNumber,protocolApplied:[{doseNumberPositiveInt:e.currentDose.sequenceNumber,series:e.currentDose.sequenceLabel}]}}},2458:(e,t,n)=>{n.d(t,{s:()=>i});var i=new(n(2444).BehaviorSubject)(null)},5355:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var i=n(268),r=n.n(i),a=n(4924),o=n(4732),u=n(906),c=n(8108),l=n(1756),s=n(2458),m=n(6062),d=n.n(m),f=n(4036),v=n.n(f),p=n(6793),b=n.n(p),y=n(7892),_=n.n(y),g=n(1173),h=n.n(g),S=n(2464),z=n.n(S),D=n(2996),N={};N.styleTagTransform=z(),N.setAttributes=_(),N.insert=b().bind(null,"head"),N.domAPI=v(),N.insertStyleElement=h(),d()(D.Z,N);const O=D.Z&&D.Z.locals?D.Z.locals:void 0;function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){x(e,t,n[t])}))}return e}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){u=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(u)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const j=function(e){var t,n,m=e.patientUuid,d=e.closeWorkspace,f=q((0,i.useState)({vaccineName:"",vaccineUuid:"",immunizationObsUuid:"",vaccinationDate:null,sequences:[],currentDose:{},expirationDate:null,lotNumber:"",manufacturer:"",formChanged:!1}),2),v=f[0],p=f[1],b=function(e,t){return p((function(n){return i=w({},n),r=null!=(r=x({},e,t))?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(r)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})),i;var i,r}))},y=(0,a.useTranslation)().t,_=(0,u.useSession)(),g=(0,u.useVisit)(m).currentVisit,h="tablet"===(0,u.useLayoutType)(),S=!!v.immunizationObsUuid,z=!S&&!!v.vaccinationDate,D=S&&v.formChanged;(0,i.useEffect)((function(){var e=s.s.subscribe((function(e){return e&&p(e)}));return function(){return e.unsubscribe()}}),[]);var N,E=r().useCallback((function(e){var t,n;e.preventDefault();var i=null==g?void 0:g.uuid,r=null==_||null===(t=_.sessionLocation)||void 0===t?void 0:t.uuid,a=null==_||null===(n=_.currentProvider)||void 0===n?void 0:n.uuid,o=w({patientUuid:m},v),s=new AbortController;return(0,c.eu)((0,l.j)(o,i,r,a),m,v.immunizationObsUuid,s).then((function(e){201===e.status&&d(),(0,u.showToast)({kind:"success",description:y("vaccinationSaved","Vaccination saved successfully")})}),(function(e){(0,u.showNotification)({title:y("errorSaving","Error saving vaccination"),kind:"error",critical:!0,description:null==e?void 0:e.message})})),function(){return s.abort()}}),[null==_||null===(t=_.sessionLocation)||void 0===t?void 0:t.uuid,d,v,m,null==_||null===(n=_.currentProvider)||void 0===n?void 0:n.uuid,null==g?void 0:g.uuid,y]);return r().createElement(o.l09,{className:O.form,onSubmit:E,"data-testid":"immunization-form"},r().createElement("div",null,r().createElement("h4",{className:O.immunizationSequenceSelect},"".concat(y("vaccine","Vaccine")," : ").concat(null==v?void 0:v.vaccineName)," "),(N=v.sequences)&&(null==N?void 0:N.length)>0&&r().createElement("div",{className:O.immunizationSequenceSelect},r().createElement(o.PhF,{id:"sequence",name:"sequence",value:v.currentDose.sequenceNumber,onChange:function(e){var t=v.sequences.find((function(t){return n=e.target.value,!isNaN(n)&&t.sequenceNumber===parseInt(e.target.value);var n}))||{};b("currentDose",t)},className:"immunizationSequenceSelect",labelText:y("sequence","Sequence")},r().createElement(o.QlF,{text:y("pleaseSelect","Please select"),value:"DEFAULT"},y("pleaseSelect","Please select")),v.sequences.map((function(e){return r().createElement(o.QlF,{key:e.sequenceNumber,text:e.sequenceLabel,value:e.sequenceNumber},y(e.sequenceLabel,e.sequenceLabel))})))),r().createElement("div",{className:O.immunizationSequenceSelect},r().createElement(o.Mtg,{id:"vaccinationDate",className:"vaccinationDate",maxDate:(new Date).toISOString(),dateFormat:"d/m/Y",datePickerType:"single",value:v.vaccinationDate,onChange:function(e){var t=q(e,1)[0];return b("vaccinationDate",t.toISOString())}},r().createElement(o.aj6,{id:"date-picker-calendar-id",placeholder:"dd/mm/yyyy",labelText:y("vaccinationDate","Vaccination Date"),type:"text"}))),r().createElement("div",{className:O.immunizationSequenceSelect},r().createElement(o.Mtg,{id:"vaccinationExpiration",className:"vaccinationExpiration",minDate:(new Date).toISOString(),dateFormat:"d/m/Y",datePickerType:"single",value:v.expirationDate,onChange:function(e){var t=q(e,1)[0];return b("expirationDate",t.toISOString())}},r().createElement(o.aj6,{id:"date-picker-calendar-id",placeholder:"dd/mm/yyyy",labelText:y("expirationDate","Expiration Date"),type:"text"}))),r().createElement("div",{className:O.immunizationSequenceSelect},r().createElement(o.oil,{type:"text",id:"lotNumber",labelText:y("lotNumber","Lot Number"),value:v.lotNumber,onChange:function(e){return b("lotNumber",e.target.value)}})),r().createElement("div",{className:O.immunizationSequenceSelect},r().createElement(o.oil,{type:"text",id:"manufacturer",labelText:y("manufacturer","Manufacturer"),value:v.manufacturer,onChange:function(e){return b("manufacturer",e.target.value)}}))),r().createElement(o.uVA,{className:h?O.tablet:O.desktop},r().createElement(o.zxk,{className:O.button,kind:"secondary",onClick:function(){return d()}},y("cancel","Cancel")),r().createElement(o.zxk,{className:O.button,kind:"primary",disabled:S?!D:!z},y("save","Save"))))}},8108:(e,t,n)=>{n.d(t,{dv:()=>l,eu:()=>s,iX:()=>c}),n(5047);var i=n(9857),r=n(906),a=n(9867),o=n(1756);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(){var e,t,n,o=(0,r.useConfig)().immunizationsConfig,c=null==o?void 0:o.vaccinesConceptSet,l=(t=c.split(":"),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(e){u=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(u)throw r}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=l[0],m=l[1],d="/ws/rest/v1/concept?source=".concat(s,"&code=").concat(m,"&v=full"),f="/ws/rest/v1/concept/".concat(c,"?v=full"),v=(0,i.ZP)((e=c,(0,a.Z)(e,":")?d:f),r.openmrsFetch),p=v.data,b=v.error;return{data:p?p.data.results[0]:null,isError:b,isLoading:!p&&!b}}function l(e){var t="".concat(r.fhirBaseUrl,"/Immunization?patient=").concat(e),n=(0,i.ZP)(t,r.openmrsFetch),a=n.data,u=n.error,c=n.isValidating,l=a?(0,o.V)(a.data):null;return{data:a?l:null,isError:u,isLoading:!a&&!u,isValidating:c}}function s(e,t,n,i){var a="".concat(r.fhirBaseUrl,"/Immunization");return n&&(a="".concat(a,"/").concat(n)),(0,r.openmrsFetch)(a,{headers:{"Content-Type":"application/json"},method:"POST",body:e,signal:i.signal})}}}]);