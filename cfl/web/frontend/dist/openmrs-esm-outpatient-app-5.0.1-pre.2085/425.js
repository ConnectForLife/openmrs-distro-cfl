"use strict";(globalThis.webpackChunk_openmrs_esm_outpatient_app=globalThis.webpackChunk_openmrs_esm_outpatient_app||[]).push([[425],{9992:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(272),a=n.n(i),r=n(2609),o=n.n(r)()(a());o.push([e.id,".-esm-outpatient__transition-queue-entry-dialog__modalBody___C0CJU{padding-bottom:.5rem;margin-bottom:0rem}.-esm-outpatient__transition-queue-entry-dialog__p___mzejr{margin-bottom:.25rem;font-size:var(--cds-body-01-font-size, 0.875rem);font-weight:var(--cds-body-01-font-weight, 400);line-height:var(--cds-body-01-line-height, 1.42857);letter-spacing:var(--cds-body-01-letter-spacing, 0.16px)}","",{version:3,sources:["webpack://./src/transition-queue-entry/transition-queue-entry-dialog.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss"],names:[],mappings:"AAGA,mEACE,oBCiBW,CDhBX,kBAAA,CAGF,2DACE,oBCOW,CC0zBT,gDAAA,CAAA,+CAAA,CAAA,mDAAA,CAAA,wDAAA",sourceRoot:""}]),o.locals={modalBody:"-esm-outpatient__transition-queue-entry-dialog__modalBody___C0CJU",p:"-esm-outpatient__transition-queue-entry-dialog__p___mzejr"};const s=o},8179:(e,t,n)=>{n.d(t,{EQ:()=>u,J$:()=>o,JB:()=>r,b7:()=>s});var i=n(8879),a=n.n(i),r=(window.getOpenmrsSpaBase,"".concat(window.spaBase,"/home")),o="YYYY-MM-DDTHH:mm:ss.SSSZZ",s=a()((new Date).setUTCHours(0,0,0,0)).format(o),u=Intl.DateTimeFormat().resolvedOptions().timeZone},5326:(e,t,n)=>{n.d(t,{DO:()=>r,IF:()=>o,Ts:()=>i,Yn:()=>a,ns:()=>u,wP:()=>s});var i=function(e){switch(e){case"Emergency":return"red";case"Not Urgent":return"green";default:return"gray"}},a=function(e,t){return e&&t?"waiting"===e?"".concat(e," for ").concat(t):"in service"===e?"Attending ".concat(t):"finished service"===e?"Finished ".concat(t):void 0:""},r=function(e,t){var n=parseInt(e)/60,i=Math.floor(n),a=60*(n-i),r=Math.round(a);return i>0?i+" "+"".concat(t("hoursAnd","hours and "))+r+" "+"".concat(t("minutes","minutes")):r+" "+"".concat(t("minutes","minutes"))},o=function(e,t){switch(e){case"M":return t("male","Male");case"F":return t("female","Female");case"O":return t("other","Other");case"U":return t("unknown","Unknown");default:return e}};function s(e,t){var n=!0,i=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0)return r.value.obs.filter((function(e){return t.includes(e.concept.uuid)}))}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}}function u(e,t){return Math.round((e.getTime()-t.getTime())/864e5)}},5865:(e,t,n)=>{n.d(t,{L:()=>u,N:()=>s});var i=n(3255),a=n(2870),r=n(8879),o=n.n(r);function s(e){var t,n,r,s="/ws/rest/v1/visit?patient=".concat(e,"&v=").concat("custom:(uuid,encounters:(uuid,form:(uuid,display),encounterDatetime,orders:full,obs:(uuid,concept:(uuid,display,conceptClass:(uuid,display)),display,groupMembers:(uuid,concept:(uuid,display),value:(uuid,display)),value),encounterType:(uuid,display),encounterProviders:(uuid,display,encounterRole:(uuid,display),provider:(uuid,person:(uuid,display)))),visitType:(uuid,name,display),startDatetime,stopDatetime,patient"),u=(0,i.ZP)(e?s:null,a.openmrsFetch),l=u.data,c=u.error,d=u.isLoading,p=u.isValidating,m=null===(r=null==l||null===(t=l.data)||void 0===t||null===(n=t.results)||void 0===n?void 0:n.filter((function(e){return o()(e.startDatetime).isBefore(o()().startOf("day"))})))||void 0===r?void 0:r.shift();return{visits:l?m:null,isError:c,isLoading:d,isValidating:p}}function u(e,t){if(!e||!t)return"";var n=e.search(/\D/),i=parseInt(e.substring(0,n)),a=e.search(/\//),r=e.substring(n);if(a>=0){r=e.substring(n,a);var o=e.substring(a+1).search(/\D/),s=parseInt(e.substr(a+1,o)),u=e.substring(a+1+o);return"".concat(t," ").concat(r," (").concat(t/i*s," ").concat(u,")")}return"".concat(i*t," ").concat(r)}},3069:(e,t,n)=>{n.d(t,{Wi:()=>l,zt:()=>u});var i=n(3255),a=n(2870),r=n(8179),o=n(8879),s=n.n(o);function u(){var e="/ws/rest/v1/appointment/all?forDate=".concat(r.b7),t=(0,i.ZP)(e,a.openmrsFetch),n=t.data,o=t.error,s=t.isLoading,u=t.isValidating;return{appointmentQueueEntries:n?null==n?void 0:n.data:[],isLoading:s,isError:o,isValidating:u}}function l(e,t){var n,r,o,u=new AbortController,l="/ws/rest/v1/appointments/search",c=(0,i.ZP)(l,(function(){return(0,a.openmrsFetch)(l,{method:"POST",signal:u.signal,headers:{"Content-Type":"application/json"},body:{patientUuid:e,startDate:t}})})),d=c.data,p=c.error,m=c.isLoading,v=c.isValidating,g=(null==d||null===(n=d.data)||void 0===n?void 0:n.length)?d.data:[],f=null===(o=null===(r=null==g?void 0:g.sort((function(e,t){return e.startDateTime>t.startDateTime?1:-1})))||void 0===r?void 0:r.filter((function(e){return"Cancelled"!==e.status})))||void 0===o?void 0:o.filter((function(e){var t=e.startDateTime;return s()(new Date(t).toISOString()).isAfter(new Date)}));return{upcomingAppointment:f?null==f?void 0:f[0]:null,isError:p,isLoading:m,isValidating:v}}},6425:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var i=n(5206),a=n.n(i),r=n(8879),o=n.n(r),s=n(4924),u=n(2155),l=n(2870),c=n(8053),d=n(5326),p=n(5865),m=n(3069),v=n(1354),g=n.n(v),f=n(1583),y=n.n(f),h=n(7378),b=n.n(h),A=n(5993),_=n.n(A),E=n(4154),w=n.n(E),D=n(8141),C=n.n(D),T=n(9992),U={};U.styleTagTransform=C(),U.setAttributes=_(),U.insert=b().bind(null,"head"),U.domAPI=y(),U.insertStyleElement=w(),g()(T.Z,U);const S=T.Z&&T.Z.locals?T.Z.locals:void 0;var q;!function(e){e.REQUEUED="Requeued"}(q||(q={}));const k=function(e){var t=e.queueEntry,n=e.closeModal,r=(0,s.useTranslation)().t,v=(0,l.useConfig)(),g=v.concepts.defaultTransitionStatus,f=null==t?void 0:t.identifiers.filter((function(e){var t;return v.defaultIdentifierTypes.includes(null==e||null===(t=e.identifierType)||void 0===t?void 0:t.uuid)})),y=o()((new Date).toISOString()).subtract(6,"month").toISOString(),h=(0,m.Wi)(null==t?void 0:t.patientUuid,y),b=h.upcomingAppointment,A=h.isLoading,_=(0,p.N)(null==t?void 0:t.patientUuid),E=_.visits,w=_.isLoading,D=!w&&E?(0,d.wP)(null==E?void 0:E.encounters,v.concepts.historicalObsConceptUuid):[],C=(0,c.P4)("","").mutate,T=(0,i.useCallback)((function(){var e=(0,l.toDateObjectStrict)((0,l.toOmrsIsoString)(new Date));(0,c.zI)(null==t?void 0:t.visitUuid,null==t?void 0:t.queueUuid,null==t?void 0:t.queueUuid,null==t?void 0:t.queueEntryUuid,null==t?void 0:t.patientUuid,null==t?void 0:t.priorityUuid,g,e,null==t?void 0:t.sortWeight).then((function(e){201===e.status&&(0,c.Ny)(null==t?void 0:t.service,null==t?void 0:t.visitQueueNumber,"serving").then((function(e){200===e.status&&((0,l.showToast)({critical:!0,title:r("success","Success"),kind:"success",description:r("patientAttendingService","Patient attending service")}),n(),C(),(0,l.navigate)({to:"${openmrsSpaBase}/patient/".concat(null==t?void 0:t.patientUuid,"/chart")}))}))}),(function(e){(0,l.showNotification)({title:r("queueEntryUpdateFailed","Error updating queue entry"),kind:"error",critical:!0,description:null==e?void 0:e.message})}))}),[t]),U=(0,i.useCallback)((function(){(function(e,t,n){var i=new AbortController;return(0,l.openmrsFetch)("/ws/rest/v1/queue/".concat(t,"/entry/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},signal:i.signal,body:{priorityComment:e}})})(q.REQUEUED,null==t?void 0:t.queueUuid,null==t?void 0:t.queueEntryUuid).then((function(e){200===e.status&&((0,l.showToast)({critical:!0,title:r("success","Success"),kind:"success",description:r("patientRequeued","Patient has been requeued")}),n(),C())}),(function(e){(0,l.showNotification)({title:r("queueEntryUpdateFailed","Error updating queue entry"),kind:"error",critical:!0,description:null==e?void 0:e.message})}))}),[]);return a().createElement("div",null,a().createElement(u.xBx,{closeModal:n,title:r("servePatient","Serve patient")}),a().createElement(u.fef,{className:S.modalBody},a().createElement("div",null,a().createElement("section",{className:S.modalBody},a().createElement("p",{className:S.p},r("patientName","Patient name")," :   ",null==t?void 0:t.name),(null==f?void 0:f.length)?f.map((function(e){var t;return a().createElement("p",{className:S.p},null==e||null===(t=e.identifierType)||void 0===t?void 0:t.display," :   ",null==e?void 0:e.identifier)})):"",a().createElement("p",{className:S.p},r("lastClinicalVisit","Last clinical visit")," :   ",w&&r("loading","Loading..."),!w&&!E&&r("none","None"),E&&(0,l.formatDatetime)((0,l.parseDate)(null==E?void 0:E.startDatetime))),(null==D?void 0:D.length)?D.map((function(e){return a().createElement("p",{className:S.p},e.concept.display," :   ",e.value.display)})):"",a().createElement("p",{className:S.p},r("tcaDate","Tca date")," :   ",A&&r("loading","Loading..."),!A&&!b&&r("none","None"),b&&(0,l.formatDatetime)((0,l.parseDate)(null==b?void 0:b.startDateTime)))),a().createElement(l.ExtensionSlot,{className:S.visitSummaryContainer,name:"previous-visit-summary-slot",state:{patientUuid:null==t?void 0:t.patientUuid}}))),a().createElement(u.mzw,null,a().createElement(u.zxk,{kind:"secondary",onClick:function(){return U()}},r("requeue","Requeue")),a().createElement(u.zxk,{onClick:function(){return T()}},r("serve","Serve"))))}}}]);