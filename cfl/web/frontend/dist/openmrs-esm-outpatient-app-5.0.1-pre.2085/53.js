"use strict";(globalThis.webpackChunk_openmrs_esm_outpatient_app=globalThis.webpackChunk_openmrs_esm_outpatient_app||[]).push([[53],{8053:(t,e,n)=>{n.d(e,{$z:()=>g,AX:()=>S,Di:()=>L,KW:()=>E,Ny:()=>D,P4:()=>b,Su:()=>m,TW:()=>C,U8:()=>F,W_:()=>q,zI:()=>w});var i=n(8879),u=n.n(i),r=n(7279),o=n(2228),a=n(3255),s=n(2303),l=n(4924),d=n(2870),c=n(1995),v=n(6824),p=n.n(v);function y(t,e,n,i,u,r,o){try{var a=t[r](o),s=a.value}catch(t){return void n(t)}a.done?e(s):Promise.resolve(s).then(i,u)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(i,u){var r=t.apply(e,n);function o(t){y(r,i,u,o,a,"next",t)}function a(t){y(r,i,u,o,a,"throw",t)}o(void 0)}))}}var h=function(t,e){var n,i,u,r,o={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(u=2&r[0]?i.return:r[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,r[1])).done)return u;switch(i=0,u&&(r=[2&r[0],u.value]),r[0]){case 0:case 1:u=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((u=(u=o.trys).length>0&&u[u.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!u||r[1]>u[0]&&r[1]<u[3])){o.label=r[1];break}if(6===r[0]&&o.label<u[1]){o.label=u[1],u=r;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(r);break}u[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],i=0}finally{n=u=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};function m(t){var e,n="/ws/rest/v1/queue?location=".concat(t),i=(0,s.Z)(t?n:null,d.openmrsFetch).data;return{services:i?null==i||null===(e=i.data)||void 0===e?void 0:e.results:[]}}function g(){var t,e=(0,d.useConfig)().concepts.statusConceptSetUuid,n="/ws/rest/v1/concept/".concat(e),i=(0,s.Z)(n,d.openmrsFetch),u=i.data,r=(i.error,i.isLoading);return{statuses:u?null==u||null===(t=u.data)||void 0===t?void 0:t.setMembers:[],isLoading:r}}function q(){var t,e=(0,d.useConfig)().concepts.priorityConceptSetUuid,n="/ws/rest/v1/concept/".concat(e),i=(0,s.Z)(n,d.openmrsFetch),u=i.data,r=i.error,o=i.isLoading;return{priorities:u?null==u||null===(t=u.data)||void 0===t?void 0:t.setMembers:[],isLoading:o,isError:r}}function b(t,e){var n,i,r,o,s,v,p=(0,c.J)().queueLocations,y=e||(null===(n=p[0])||void 0===n?void 0:n.id),f=(0,d.useConfig)().concepts.visitQueueNumberAttributeUuid,h="/ws/rest/v1/visit-queue-entry?location=".concat(y,"&v=full"),m=(0,l.useTranslation)().t,g=(0,a.ZP)(h,d.openmrsFetch),q=g.data,b=g.error,E=g.isLoading,w=g.isValidating,T=g.mutate,C=function(t){var e,n,i;return{diagnoses:t.diagnoses,encounterDatetime:t.encounterDatetime,encounterType:t.encounterType.display,obs:t.obs,provider:null===(e=t.encounterProviders[0])||void 0===e||null===(n=e.provider)||void 0===n||null===(i=n.person)||void 0===i?void 0:i.display,uuid:t.uuid,voided:t.voided}},A=function(t){var e,n,i,r,o,a,s,l,c,v,p,y,h,m,g,q,b,E,w,T,A,L,F;return{id:t.queueEntry.uuid,encounters:null===(e=t.visit)||void 0===e||null===(n=e.encounters)||void 0===n?void 0:n.map(C),name:t.queueEntry.display,patientUuid:t.queueEntry.patient.uuid,patientAge:null===(i=t.queueEntry.patient.person)||void 0===i?void 0:i.age,patientSex:"M"===(null===(r=t.queueEntry.patient.person)||void 0===r?void 0:r.gender)?"MALE":"FEMALE",patientDob:(null==t||null===(o=t.queueEntry)||void 0===o||null===(a=o.patient)||void 0===a||null===(s=a.person)||void 0===s?void 0:s.birthdate)?(0,d.formatDate)((0,d.parseDate)(t.queueEntry.patient.person.birthdate),{time:!1}):"--",priority:"Urgent"===t.queueEntry.priority.display?"Priority":t.queueEntry.priority.display,priorityComment:t.queueEntry.priorityComment,priorityUuid:t.queueEntry.priority.uuid,service:null==t?void 0:t.queueEntry.queue.name,status:t.queueEntry.status.display,statusUuid:t.queueEntry.status.uuid,waitTime:t.queueEntry.startedAt?"".concat(u()().diff(u()(t.queueEntry.startedAt),"minutes")):"--",visitStartDateTime:t.queueEntry.startedAt,visitType:null===(l=t.visit)||void 0===l||null===(c=l.visitType)||void 0===c?void 0:c.display,visitLocation:null===(v=t.visit)||void 0===v||null===(p=v.location)||void 0===p?void 0:p.uuid,queueLocation:null===(y=t.queueEntry)||void 0===y||null===(h=y.queue)||void 0===h||null===(m=h.location)||void 0===m?void 0:m.uuid,visitTypeUuid:null===(g=t.visit)||void 0===g||null===(q=g.visitType)||void 0===q?void 0:q.uuid,visitUuid:null===(b=t.visit)||void 0===b?void 0:b.uuid,queueUuid:t.queueEntry.queue.uuid,queueEntryUuid:t.queueEntry.uuid,sortWeight:t.queueEntry.sortWeight,visitQueueNumber:null===(T=null==t||null===(E=t.visit)||void 0===E||null===(w=E.attributes)||void 0===w?void 0:w.find((function(t){return t.attributeType.uuid===f})))||void 0===T?void 0:T.value,identifiers:null===(A=t.queueEntry.patient)||void 0===A?void 0:A.identifiers,locationComingFrom:null===(L=t.queueEntry)||void 0===L||null===(F=L.locationComingFrom)||void 0===F?void 0:F.name}};return{visitQueueEntries:(i=t&&t!=m("all","All")?null==q||null===(r=q.data)||void 0===r||null===(o=r.results)||void 0===o?void 0:o.map(A).filter((function(e){return e.service==t})):null==q||null===(s=q.data)||void 0===s||null===(v=s.results)||void 0===v?void 0:v.map(A))||[],visitQueueEntriesCount:i?i.length:0,isLoading:E,isError:b,isValidating:w,mutate:T}}u().extend(p());var E=function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("/");return(0,o.Z)(t)};function w(t,e,n,i,u,r,o,a,s){return T.apply(this,arguments)}function T(){return(T=f((function(t,e,n,i,u,o,a,s,l){var c,v;return h(this,(function(p){switch(p.label){case 0:return c=new AbortController,v=(0,r.Z)(n)?e:n,[4,Promise.all([C(e,i,s)])];case 1:return p.sent(),[2,(0,d.openmrsFetch)("/ws/rest/v1/visit-queue-entry",{method:"POST",headers:{"Content-Type":"application/json"},signal:c.signal,body:{visit:{uuid:t},queueEntry:{status:{uuid:a},priority:{uuid:o},queue:{uuid:v},patient:{uuid:u},startedAt:(0,d.toDateObjectStrict)((0,d.toOmrsIsoString)(new Date)),sortWeight:l,locationComingFrom:e}}})]}}))}))).apply(this,arguments)}function C(t,e,n){return A.apply(this,arguments)}function A(){return(A=f((function(t,e,n){var i;return h(this,(function(u){switch(u.label){case 0:return i=new AbortController,[4,(0,d.openmrsFetch)("/ws/rest/v1/queue/".concat(t,"/entry/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},signal:i.signal,body:{endedAt:n}})];case 1:return u.sent(),[2]}}))}))).apply(this,arguments)}function L(t,e){var n,i,u="/ws/rest/v1/visit-queue-entry?status=waiting&service=".concat(t,"&location=").concat(e,"&v=full"),r=(0,a.ZP)(t&&e?u:null,d.openmrsFetch),o=r.data,s=r.error,l=r.isLoading,c=r.isValidating,v=null==o||null===(n=o.data)||void 0===n||null===(i=n.results)||void 0===i?void 0:i.map((function(t){var e,n,i,u,r,o,a,s,l;return{id:t.queueEntry.uuid,name:t.queueEntry.display,age:t.queueEntry.patient?null==t||null===(e=t.queueEntry)||void 0===e||null===(n=e.patient)||void 0===n||null===(i=n.person)||void 0===i?void 0:i.age:"--",returnDate:t.queueEntry.startedAt,visitType:null===(u=t.visit)||void 0===u||null===(r=u.visitType)||void 0===r?void 0:r.display,phoneNumber:t.patient?null===(o=t.patient)||void 0===o?void 0:o.phoneNumber:"--",gender:t.queueEntry.patient?null==t||null===(a=t.queueEntry)||void 0===a||null===(s=a.patient)||void 0===s||null===(l=s.person)||void 0===l?void 0:l.gender:"--",patientUuid:t.queueEntry?null==t?void 0:t.queueEntry.uuid:"--"}}));return{serviceQueueEntries:v||[],isLoading:l,isError:s,isValidating:c}}function F(t,e,n,i,u,r,o,a){return P.apply(this,arguments)}function P(){return(P=f((function(t,e,n,i,u,r,o,a){var s;return h(this,(function(l){switch(l.label){case 0:return s=new AbortController,[4,Promise.all([S(o,t,e,a)])];case 1:return l.sent(),[2,(0,d.openmrsFetch)("/ws/rest/v1/visit-queue-entry",{method:"POST",headers:{"Content-Type":"application/json"},signal:s.signal,body:{visit:{uuid:t},queueEntry:{status:{uuid:u},priority:{uuid:i},queue:{uuid:e},patient:{uuid:n},startedAt:(0,d.toDateObjectStrict)((0,d.toOmrsIsoString)(new Date)),sortWeight:r}}})]}}))}))).apply(this,arguments)}function S(t,e,n,i){return U.apply(this,arguments)}function U(){return(U=f((function(t,e,n,i){var u;return h(this,(function(r){switch(r.label){case 0:return u=new AbortController,[4,(0,d.openmrsFetch)("/ws/rest/v1/queue-entry-number?location=".concat(t,"&queue=").concat(n,"&visit=").concat(e,"&visitAttributeType=").concat(i),{method:"GET",headers:{"Content-Type":"application/json"},signal:u.signal})];case 1:return r.sent(),[2]}}))}))).apply(this,arguments)}function D(t,e,n){var i=new AbortController;return(0,d.openmrsFetch)("/ws/rest/v1/queueutil/assignticket",{method:"POST",headers:{"Content-Type":"application/json"},signal:i.signal,body:{servicePointName:t,ticketNumber:e,status:n}})}},1995:(t,e,n)=>{n.d(e,{J:()=>o});var i=n(3255),u=n(2870),r=n(5206);function o(){var t,e,n="".concat(u.fhirBaseUrl,"/Location?_summary=data&_tag=queue location"),o=(0,i.ZP)(n,u.openmrsFetch),a=o.data,s=o.error,l=o.isLoading,d=(0,r.useMemo)((function(){var t,n;return null!==(e=null==a||null===(t=a.data)||void 0===t||null===(n=t.entry)||void 0===n?void 0:n.map((function(t){return t.resource})))&&void 0!==e?e:[]}),[null==a||null===(t=a.data)||void 0===t?void 0:t.entry]);return{queueLocations:d||[],isLoading:l,error:s}}}}]);