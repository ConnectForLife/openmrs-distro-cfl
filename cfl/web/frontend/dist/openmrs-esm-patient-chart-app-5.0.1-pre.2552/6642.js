"use strict";(globalThis.webpackChunk_openmrs_esm_patient_chart_app=globalThis.webpackChunk_openmrs_esm_patient_chart_app||[]).push([[6642],{7453:(t,e,n)=>{n.d(e,{Z:()=>s});var i=n(272),r=n.n(i),o=n(2609),a=n.n(o)()(r());a.push([t.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-chart__end-visit-dialog__bodyShort02___VnI_l{font-size:var(--cds-body-compact-02-font-size, 1rem);font-weight:var(--cds-body-compact-02-font-weight, 400);line-height:var(--cds-body-compact-02-line-height, 1.375);letter-spacing:var(--cds-body-compact-02-letter-spacing, 0);color:#161616}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/visit/visit-prompt/end-visit-dialog.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCpDF,2DCu0BI,oDAAA,CAAA,uDAAA,CAAA,yDAAA,CAAA,2DAAA,CDr0BF,aDDM",sourceRoot:""}]),a.locals={bodyShort02:"-esm-patient-chart__end-visit-dialog__bodyShort02___VnI_l"};const s=a},2609:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,r,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(i)for(var s=0;s<this.length;s++){var u=this[s][0];null!=u&&(a[u]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);i&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),e.push(l))}},e}},272:t=>{t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(r," */"),a=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(a).concat([o]).join("\n")}return[e].join("\n")}},1354:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var o={},a=[],s=0;s<t.length;s++){var u=t[s],c=i.base?u[0]+i.base:u[0],l=o[c]||0,d="".concat(c," ").concat(l);o[c]=l+1;var p=n(d),v={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==p)e[p].references++,e[p].updater(v);else{var f=r(v,i);i.byIndex=s,e.splice(s,0,{identifier:d,updater:f,references:1})}a.push(d)}return a}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var o=i(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var s=n(o[a]);e[s].references--}for(var u=i(t,r),c=0;c<o.length;c++){var l=n(o[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}o=u}}},7378:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},4154:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},5993:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},1583:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},8141:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},4100:(t,e,n)=>{n.d(e,{Aq:()=>s,Ls:()=>d});var i=n(2870);function r(t,e,n,i,r,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(i,r)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,u,"next",t)}function u(t){r(a,i,o,s,u,"throw",t)}s(void 0)}))}}function a(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function s(t,e,n,i,r,o,a,s,c){return u.apply(this,arguments)}function u(){return(u=o((function(t,e,n,r,o,s,u,l,d){return a(this,(function(a){switch(a.label){case 0:return[4,Promise.all([c(l,t,e,u,d)])];case 1:return a.sent(),[2,(0,i.openmrsFetch)("/ws/rest/v1/visit-queue-entry",{method:"POST",headers:{"Content-Type":"application/json"},signal:u.signal,body:{visit:{uuid:t},queueEntry:{status:{uuid:o},priority:{uuid:r},queue:{uuid:e},patient:{uuid:n},startedAt:(0,i.toDateObjectStrict)((0,i.toOmrsIsoString)(new Date)),sortWeight:s}}})]}}))}))).apply(this,arguments)}function c(t,e,n,i,r){return l.apply(this,arguments)}function l(){return(l=o((function(t,e,n,r,o){return a(this,(function(a){switch(a.label){case 0:return[4,(0,i.openmrsFetch)("/ws/rest/v1/queue-entry-number?location=".concat(t,"&queue=").concat(n,"&visit=").concat(e,"&visitAttributeType=").concat(o),{method:"GET",headers:{"Content-Type":"application/json"},signal:r.signal})];case 1:return a.sent(),[2]}}))}))).apply(this,arguments)}function d(t,e,n){return(0,i.openmrsFetch)("/ws/rest/v1/queue/".concat(t,"/entry/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:{endedAt:(0,i.toDateObjectStrict)((0,i.toOmrsIsoString)(new Date))},signal:n.signal})}},4994:(t,e,n)=>{n.d(e,{t:()=>o});var i=n(3255),r=n(2870);function o(t,e){var n,o,a,s="/ws/rest/v1/visit-queue-entry?patient=".concat(t),u=(0,i.ZP)(s,r.openmrsFetch),c=u.data,l=u.error,d=u.isLoading,p=u.isValidating;return{queueEntry:null!==(a=null==c||null===(o=c.data)||void 0===o||null===(n=o.results)||void 0===n?void 0:n.map((function(t){var e,n,i,r;return{id:t.uuid,name:t.queueEntry.queue.display,patientUuid:t.queueEntry.patient.uuid,priority:"Urgent"===t.queueEntry.priority.display?"Priority":t.queueEntry.priority.display,priorityUuid:t.queueEntry.priority.uuid,service:null===(e=t.queueEntry.queue)||void 0===e?void 0:e.display,status:t.queueEntry.status.display,statusUuid:t.queueEntry.status.uuid,visitUuid:null===(n=t.visit)||void 0===n?void 0:n.uuid,visitType:null===(r=t.visit)||void 0===r||null===(i=r.visitType)||void 0===i?void 0:i.display,queueUuid:t.queueEntry.queue.uuid,queueEntryUuid:t.queueEntry.uuid}})).filter((function(t){return void 0!==e&&e===t.visitUuid})).shift())&&void 0!==a?a:null,isLoading:d,isError:l,isValidating:p}}n(268)},6642:(t,e,n)=>{n.r(e),n.d(e,{default:()=>T});var i=n(268),r=n.n(i),o=n(4924),a=n(4350),s=n(2870),u=n(9457),c=n(1354),l=n.n(c),d=n(1583),p=n.n(d),v=n(7378),f=n.n(v),y=n(5993),h=n.n(y),m=n(4154),b=n.n(m),g=n(8141),A=n.n(g),E=n(7453),w={};w.styleTagTransform=A(),w.setAttributes=h(),w.insert=f().bind(null,"head"),w.domAPI=p(),w.insertStyleElement=b(),l()(E.Z,w);const C=E.Z&&E.Z.locals?E.Z.locals:void 0;var _=n(4994),q=n(4100);const T=function(t){var e=t.patientUuid,n=t.closeModal,i=(0,o.useTranslation)().t,c=(0,s.useVisit)(e),l=c.currentVisit,d=c.currentVisitIsRetrospective,p=c.mutate,v=(0,_.t)(e,null==l?void 0:l.uuid).queueEntry;return r().createElement("div",null,r().createElement(a.ModalHeader,{closeModal:n,label:i("visit","Visit"),title:i("endActiveVisit","End active visit")}),r().createElement(a.ModalBody,null,r().createElement("p",{className:C.bodyShort02},i("endVisitWarningMessage","Ending this visit will not allow you to fill another encounter form for this patient"),".")),r().createElement(a.ModalFooter,null,r().createElement(a.Button,{kind:"secondary",onClick:n},i("cancel","Cancel")),r().createElement(a.Button,{kind:"danger",onClick:function(){if(d)(0,s.setCurrentVisit)(null,null),n();else{var t={location:l.location.uuid,startDatetime:(0,s.parseDate)(l.startDatetime),visitType:l.visitType.uuid,stopDatetime:new Date},e=new AbortController;(0,s.updateVisit)(l.uuid,t,e).pipe((0,u.P)()).subscribe((function(t){var r,o;200===t.status&&(v&&(0,q.Ls)(v.queueUuid,v.queueEntryUuid,e),p(),n(),(0,s.showToast)({critical:!0,kind:"success",description:i("visitEndSuccessfully","".concat(null==t||null===(o=t.data)||void 0===o||null===(r=o.visitType)||void 0===r?void 0:r.display," ended successfully")),title:i("visitEnded","Visit ended")}))}),(function(t){(0,s.showNotification)({title:i("endVisitError","Error ending active visit"),kind:"error",critical:!0,description:null==t?void 0:t.message})}))}}},i("endVisit_title","End Visit"))))}}}]);