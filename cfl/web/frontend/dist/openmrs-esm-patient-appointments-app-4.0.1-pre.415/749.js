"use strict";(self.webpackChunk_openmrs_esm_patient_appointments_app=self.webpackChunk_openmrs_esm_patient_appointments_app||[]).push([[749],{1405:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(9601),o=n.n(a),i=n(2609),r=n.n(i)()(o());r.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-appointments__appointments-form__productiveHeading02___a53cj,.-esm-patient-appointments__appointments-form__formGroup___akpOS span{color:#525252;font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0)}.-esm-patient-appointments__appointments-form__formWrapper____zaJ7{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formWrapper____zaJ7{background-color:#ededed}.omrs-breakpoint-gt-tablet .-esm-patient-appointments__appointments-form__formWrapper____zaJ7{background-color:#fff}.-esm-patient-appointments__appointments-form__formGroup___akpOS{display:flex;margin-bottom:.25rem;padding:1rem}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formGroup___akpOS>span{flex:1}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formGroup___akpOS>div{flex:3}.-esm-patient-appointments__appointments-form__formGroup___akpOS span{margin-bottom:.5rem}.-esm-patient-appointments__appointments-form__datePickerControl___eaKhw{display:flex}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formGroup___akpOS{flex-direction:row}.omrs-breakpoint-gt-tablet .-esm-patient-appointments__appointments-form__formGroup___akpOS{flex-direction:column}.-esm-patient-appointments__appointments-form__button___R956U{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-appointments__appointments-form__loader___AYJ68{display:flex;background-color:#ededed;justify-content:center;min-height:3rem;height:100vh}.-esm-patient-appointments__appointments-form__tablet___UWY5_{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-appointments__appointments-form__desktop___LXXIJ{padding:0rem}",""]),r.locals={productiveHeading02:"-esm-patient-appointments__appointments-form__productiveHeading02___a53cj",formGroup:"-esm-patient-appointments__appointments-form__formGroup___akpOS",formWrapper:"-esm-patient-appointments__appointments-form__formWrapper____zaJ7",datePickerControl:"-esm-patient-appointments__appointments-form__datePickerControl___eaKhw",button:"-esm-patient-appointments__appointments-form__button___R956U",loader:"-esm-patient-appointments__appointments-form__loader___AYJ68",tablet:"-esm-patient-appointments__appointments-form__tablet___UWY5_",desktop:"-esm-patient-appointments__appointments-form__desktop___LXXIJ"};const l=r},2749:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var a=n(7900),o=n.n(a),i=n(4924),r=n(9857),l=n(3565),p=n.n(l),m=n(6517),s=n(6217),c=n(906),u=n(9318),d=n(6062),_=n.n(d),f=n(4036),v=n.n(f),h=n(6793),g=n.n(h),y=n(7892),b=n.n(y),k=n(1173),E=n.n(k),T=n(2464),x=n.n(T),S=n(1405),w={};w.styleTagTransform=x(),w.setAttributes=b(),w.insert=g().bind(null,"head"),w.domAPI=v(),w.insertStyleElement=E(),_()(S.Z,w);const C=S.Z&&S.Z.locals?S.Z.locals:void 0;function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,o,i=[],r=!0,l=!1;try{for(n=n.call(e);!(r=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){l=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var F=[{name:"Scheduled"},{name:"WalkIn"}];const L=function(e){var t,n,l=e.patientUuid,d=e.closeWorkspace,_=(0,i.useTranslation)().t,f="tablet"===(0,c.useLayoutType)(),v=(0,r.kY)().mutate,h=(0,c.useLocations)(),g=(0,c.useSession)(),y=P((0,a.useState)(""),2),b=y[0],k=y[1],E=P((0,a.useState)(""),2),T=E[0],x=E[1],S=P((0,a.useState)(""),2),w=S[0],A=S[1],L=P((0,a.useState)(""),2),N=L[0],D=L[1],G=P((0,a.useState)(new Date),2),M=G[0],Q=G[1],I=P((0,a.useState)(p()(new Date).format("hh:mm")),2),j=I[0],O=I[1],W=P((0,a.useState)((new Date).getHours()>=12?"PM":"AM"),2),U=W[0],z=W[1],J=P((0,a.useState)(""),2),R=J[0],Z=J[1];!R&&(null==g||null===(t=g.sessionLocation)||void 0===t?void 0:t.uuid)&&Z(null==g||null===(n=g.sessionLocation)||void 0===n?void 0:n.uuid);var q,Y,K=(0,u.l9)(),H=K.data,V=K.isLoading;return(null==H?void 0:H.length)&&(Y=P(H,1),q=Y[0].serviceTypes),V?o().createElement(m.lSo,{className:C.loader,description:"".concat(_("loading","Loading")," ..."),role:"progressbar"}):o().createElement(m.l09,{className:C.formWrapper},o().createElement(m.Kqy,{gap:4},o().createElement("section",{className:C.formGroup},o().createElement("span",null,_("location","Location")),f?o().createElement(m.mh4,null,o().createElement(m.PhF,{id:"location",invalidText:"Required",labelText:_("selectLocation","Select a location"),onChange:function(e){return Z(e.target.value)},value:R},R?null:o().createElement(m.QlF,{text:_("chooseLocation","Choose a location"),value:""}),(null==h?void 0:h.length)>0&&h.map((function(e){return o().createElement(m.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))):o().createElement(m.PhF,{id:"location",invalidText:"Required",labelText:_("selectLocation","Select a location"),onChange:function(e){return Z(e.target.value)},value:R},R?null:o().createElement(m.QlF,{text:_("chooseLocation","Choose a location"),value:""}),(null==h?void 0:h.length)>0&&h.map((function(e){return o().createElement(m.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))),o().createElement("section",{className:C.formGroup},o().createElement("span",null,_("dateTime","Date & Time")),o().createElement("div",{className:C.datePickerControl},o().createElement(m.Mtg,{datePickerType:"single",dateFormat:"d/m/Y",light:f,value:M,onChange:function(e){var t=P(e,1)[0];return Q(t)}},o().createElement(m.aj6,{id:"datePickerInput",labelText:_("date","Date"),style:{width:"100%"},placeholder:"dd/mm/yyyy"})),f?o().createElement(m.mh4,null,o().createElement(m.jII,{pattern:"([\\d]+:[\\d]{2})",onChange:function(e){return O(e.target.value)},value:j,style:{marginLeft:"0.125rem",flex:"none"},labelText:_("time","Time"),id:"time-picker"},o().createElement(m.M6n,{id:"time-picker-select-1",onChange:function(e){return z(e.target.value)},value:U,labelText:_("time","Time"),"aria-label":_("time","Time")},o().createElement(m.QlF,{value:"AM",text:"AM"}),o().createElement(m.QlF,{value:"PM",text:"PM"})))):o().createElement(m.jII,{pattern:"([\\d]+:[\\d]{2})",onChange:function(e){return O(e.target.value)},value:j,style:{marginLeft:"0.125rem",flex:"none"},labelText:_("time","Time"),id:"time-picker"},o().createElement(m.M6n,{id:"time-picker-select-1",onChange:function(e){return z(e.target.value)},value:U,labelText:_("time","Time"),"aria-label":_("time","Time")},o().createElement(m.QlF,{value:"AM",text:"AM"}),o().createElement(m.QlF,{value:"PM",text:"PM"}))))),o().createElement("section",{className:C.formGroup},o().createElement("span",null,_("service","Service")),o().createElement(m.PhF,{id:"service",invalidText:"Required",labelText:_("selectService","Select a service"),light:f,onChange:function(e){return A(e.target.value)},value:N},w?null:o().createElement(m.QlF,{text:_("chooseService","Select service"),value:""}),(null==H?void 0:H.length)>0&&H.map((function(e){return o().createElement(m.QlF,{key:e.uuid,text:e.name,value:e.name},e.name)})))),o().createElement("section",{className:C.formGroup},o().createElement("span",null,_("serviceType","Service Type")),o().createElement(m.PhF,{id:"serviceType",invalidText:"Required",labelText:"Select the type of service",light:f,onChange:function(e){return D(e.target.value)},value:N},N?null:o().createElement(m.QlF,{text:_("chooseService","Select service type"),value:""}),(null==q?void 0:q.length)>0&&q.map((function(e){return o().createElement(m.QlF,{key:e.uuid,text:e.name,value:e.name},e.name)})))),o().createElement("section",{className:C.formGroup},o().createElement("span",null,_("appointmentType","Appointment Type")),o().createElement(m.PhF,{disabled:!(null==F?void 0:F.length),id:"appointmentType",invalidText:"Required",labelText:_("selectAppointmentType","Select the type of appointment"),light:f,onChange:function(e){return x(e.target.value)},value:T},T?null:o().createElement(m.QlF,{text:_("chooseAppointmentType","Choose appointment type"),value:""}),(null==F?void 0:F.length)>0&&F.map((function(e,t){return o().createElement(m.QlF,{key:t,text:e.name,value:e.name},e.name)})))),o().createElement("section",{className:C.formGroup},o().createElement("span",null,_("note","Note")),o().createElement(m.Kx8,{id:"appointmentNote",light:f,labelText:_("appointmentNoteLabel","Write an additional note"),placeholder:_("appointmentNotePlaceholder","Write any additional points here"),onChange:function(e){return k(e.target.value)}}))),o().createElement(m.uVA,{className:f?C.tablet:C.desktop},o().createElement(m.zxk,{className:C.button,onClick:d,kind:"secondary"},_("discard","Discard")),o().createElement(m.zxk,{className:C.button,disabled:!w,onClick:function(){q.find((function(e){return e.name===N}));var e,t,n,a=null===(e=H.find((function(e){return e.name===w})))||void 0===e?void 0:e.uuid,o=null===(t=H.find((function(e){return e.name===w})))||void 0===t?void 0:t.durationMins,i=P((0,s.convertTime12to24)(j,U),2),r=i[0],m=i[1],f=new Date(p()(M).year(),p()(M).month(),p()(M).date(),r,m),h=p()(new Date(p()(M).year(),p()(M).month(),p()(M).date(),r,m)).add(o,"minutes").toDate(),y={appointmentKind:T,serviceUuid:a,startDateTime:p()(f).format(),endDateTime:p()(h).format(),providerUuid:null==g||null===(n=g.currentProvider)||void 0===n?void 0:n.uuid,providers:[{uuid:g.currentProvider.uuid,comments:b}],locationUuid:R,patientUuid:l},k=new AbortController;(0,u.Pc)(y,k).then((function(e){200===e.status&&(d(),(0,c.showToast)({critical:!0,kind:"success",description:_("appointmentNowVisible","It is now visible on the Appointments page"),title:_("appointmentScheduled","Appointment scheduled")})),v("".concat(u.ep))}),(function(e){(0,c.showNotification)({title:_("appointmentFormError","Error scheduling appointment"),kind:"error",critical:!0,description:null==e?void 0:e.message})}))}},_("saveAndClose","Save and close"))))}},9318:(e,t,n)=>{n.d(t,{Pc:()=>s,ep:()=>l,l9:()=>m,zt:()=>p});var a=n(3565),o=n.n(a),i=n(9857),r=n(906),l="/ws/rest/v1/appointments/search";function p(e,t,n){var a,p=(0,i.ZP)(l,(function(){return(0,r.openmrsFetch)(l,{method:"POST",signal:n.signal,headers:{"Content-Type":"application/json"},body:{patientUuid:e,startDate:t}})})),m=p.data,s=p.error,c=p.isValidating,u=(null==m||null===(a=m.data)||void 0===a?void 0:a.length)?m.data.sort((function(e,t){return t.startDateTime>e.startDateTime?1:-1})):null,d=null==u?void 0:u.filter((function(e){return o()(e.startDateTime/1e3*1e3).isBefore(o()())})),_=null==u?void 0:u.filter((function(e){return o()(e.startDateTime/1e3*1e3).isAfter(o()())}));return{data:m?{pastAppointments:d,upcomingAppointments:_}:null,isError:s,isLoading:!m&&!s,isValidating:c}}function m(){var e=(0,i.ZP)("/ws/rest/v1/appointmentService/all/full",r.openmrsFetch),t=e.data,n=e.error;return{data:t?t.data:null,isError:n,isLoading:!t&&!n}}function s(e,t){return(0,r.openmrsFetch)("/ws/rest/v1/appointment",{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json"},body:e})}}}]);