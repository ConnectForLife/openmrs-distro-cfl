(self.webpackChunk_openmrs_esm_patient_registration_app=self.webpackChunk_openmrs_esm_patient_registration_app||[]).push([[686],{225:(e,t,n)=>{"use strict";n.d(t,{X8:()=>s,bT:()=>u,bs:()=>o});var r=n(906);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=[{id:"demographics",name:"Basic Info",fields:["name","gender","dob","id"]},{id:"contact",name:"Contact Details",fields:["address","phone & email"]},{id:"death",name:"Death Info",fields:[]},{id:"relationships",name:"Relationships",fields:[]}],s=["name","gender","dob","address","id","phone & email"],u={sections:{_type:r.Type.Array,_default:["demographics","contact","relationships"],_description:"An array of strings which are the keys from 'sectionDefinitions' or any of the following built-in sections: '".concat(o.map((function(e){return e.id})).join("', '"),"'."),_elements:{_type:r.Type.String}},sectionDefinitions:{_type:r.Type.Array,_elements:{id:{_type:r.Type.String,_description:"How this section will be referred to in the `sections` configuration. To override a built-in section, use that section's id. The built in section ids are '".concat(o.map((function(e){return e.id})).join("', '"),"'.")},name:{_type:r.Type.String,_description:"The title to display at the top of the section."},fields:{_type:r.Type.Array,_default:[],_description:"The parts to include in the section. Can be any of the following built-in fields: ".concat(s.join(", "),". Can also be an id from an object in the `fieldDefinitions` array, which you can use to define custom fields."),_elements:{_type:r.Type.String}}},_default:[]},fieldDefinitions:{_type:r.Type.Array,_elements:{id:{_type:r.Type.String,_description:"How this field will be referred to in the `fields` element of the `sectionDefinitions` configuration."},type:{_type:r.Type.String,_description:"How this field's data will be storedâ€”a person attribute or an obs."},uuid:{_type:r.Type.UUID,_description:"Person attribute type UUID that this field's data should be saved to."},label:{_type:r.Type.String,_default:null,_description:"The label of the input. By default, uses the metadata `display` attribute."},placeholder:{_type:r.Type.String,_default:"",_description:"Placeholder that will appear in the input."},validation:{required:{_type:r.Type.Boolean,_default:!1},matches:{_type:r.Type.String,_default:null,_description:"Optional RegEx for testing the validity of the input."}},answerConceptSetUuid:{_type:r.Type.ConceptUuid,_default:null,_description:"For coded questions only. A concept which has the possible responses either as answers or as set members."},customConceptAnswers:{_type:r.Type.Array,_elements:{uuid:{_type:r.Type.UUID,_description:"Answer concept UUID"},label:{_type:r.Type.String,_default:null,_description:"The custom label for the answer concept."}},_default:[],_description:"For coded questions only. Provide ability to add custom concept answers."}},_default:[],_description:"Definitions for custom fields that can be used in sectionDefinitions. Can also be used to override built-in fields."},fieldConfigurations:{name:{displayMiddleName:{_type:r.Type.Boolean,_default:!0},unidentifiedPatient:{_type:r.Type.Boolean,_default:!0,_description:"Whether to allow patients to be registered without names."},defaultUnknownGivenName:{_type:r.Type.String,_default:"UNKNOWN",_description:"The given/first name to record for unidentified patients."},defaultUnknownFamilyName:{_type:r.Type.String,_default:"UNKNOWN",_description:"The family/last name to record for unidentified patients."}},gender:{_type:r.Type.Array,_elements:{value:{_type:r.Type.String,_description:"The value for sex option"},label:{_type:r.Type.String,_default:null,_description:"The label displayed for sex option."},id:{_type:r.Type.String,_default:null,_description:"The id for sex option."}},_default:[{id:"male",value:"Male",label:"Male"},{id:"female",value:"Female",label:"Female"},{id:"other",value:"Other",label:"Other"},{id:"unknown",value:"Unknown",label:"Unknown"}],_description:"Provide ability to configure sex options."},address:{useAddressHierarchy:{enabled:{_type:r.Type.Boolean,_description:"Whether to use the Address heirarchy in the registration form or not",_default:!0},useQuickSearch:{_type:r.Type.Boolean,_description:"Whether to use the quick searching through the address saved in the database pre-fill the form.",_default:!0},searchAddressByLevel:{_type:r.Type.Boolean,_description:"Whether to fill the addresses by levels, i.e. County => subCounty, the current field is dependent on it's previous field.",_default:!0}}}},links:{submitButton:{_type:r.Type.String,_default:"${openmrsSpaBase}/patient/${patientUuid}/chart",_validators:[r.validators.isUrlWithTemplateParameters(["patientUuid"])]}},concepts:{patientPhotoUuid:{_type:r.Type.ConceptUuid,_default:"736e8771-e501-4615-bfa7-570c03f4bef5"}},defaultPatientIdentifierTypes:{_type:r.Type.Array,_elements:{_type:r.Type.PatientIdentifierTypeUuid},_default:[]},registrationObs:{encounterTypeUuid:{_type:r.Type.UUID,_default:null,_description:"Obs created during registration will be associated with an encounter of this type. This must be set in order to use fields of type `obs`."},encounterProviderRoleUuid:{_type:r.Type.UUID,_default:"a0b03050-c99b-11e0-9572-0800200c9a66",_description:"The provider role to use for the registration encounter. Default is 'Unkown'."},registrationFormUuid:{_type:r.Type.UUID,_default:null,_description:"The form UUID to associate with the registration encounter. By default no form will be associated."}},_validators:[(0,r.validator)((function(e){return!e.fieldDefinitions.some((function(e){return"obs"==e.type}))||null!=e.registrationObs.encounterTypeUuid}),"If fieldDefinitions contains any fields of type 'obs', `registrationObs.encounterTypeUuid` must be specified."),(0,r.validator)((function(e){return e.sections.every((function(t){return a(o).concat(a(e.sectionDefinitions)).map((function(e){return e.id})).includes(t)}))}),(function(e){var t=a(o).concat(a(e.sectionDefinitions)).map((function(e){return e.id})),n=e.sections.find((function(e){return!t.includes(e)}));return"'".concat(n,"' is not a valid section ID. Valid section IDs include the built-in sections ").concat(c(o))+(e.sectionDefinitions.length?"; and the defined sections ".concat(c(e.sectionDefinitions),"."):".")})),(0,r.validator)((function(e){return e.sectionDefinitions.every((function(t){return t.fields.every((function(t){return a(s).concat(a(e.fieldDefinitions.map((function(e){return e.id})))).includes(t)}))}))}),(function(e){var t=a(s).concat(a(e.fieldDefinitions.map((function(e){return e.id})))),n=e.sectionDefinitions.find((function(e){return e.fields.some((function(e){return!t.includes(e)}))})),r=n.fields.find((function(e){return!t.includes(e)}));return"The section definition '".concat(n.id,"' contains an invalid field '").concat(r,"'. 'fields' can only contain the built-in fields '").concat(s.join("', '"),"'")+(e.fieldDefinitions.length?"; or the defined fields ".concat(c(e.fieldDefinitions),"."):".")}))]};function c(e){return"'".concat(e.map((function(e){return e.id})).join("', '"),"'")}},8179:(e,t,n)=>{"use strict";n.d(t,{Kt:()=>c,QT:()=>l,UO:()=>s,e1:()=>u});var r,i,a,o=n(906),s="custom:(display,uuid,personA:(age,display,birthdate,uuid),personB:(age,display,birthdate,uuid),relationshipType:(uuid,display,description,aIsToB,bIsToA))",u="@openmrs/esm-patient-registration-app",c="patient-registration",l=(r={},a="network-first",(i=o.omrsOfflineCachingStrategyHttpHeaderName)in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,r)},1686:(e,t,n)=>{"use strict";n.r(t),n.d(t,{backendDependencies:()=>g,importTranslation:()=>b,setupOpenMRS:()=>w,version:()=>v});var r=n(906),i=n(3076),a=n(225),o=n(8179),s=n(5047),u=n.n(s),c=n(6279);function l(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){l(a,r,i,o,s,"next",e)}function s(e){l(a,r,i,o,s,"throw",e)}o(void 0)}))}}function p(e){return["/ws/fhir2/R4/Patient/".concat(e),"/ws/rest/v1/relationship?v=".concat(o.UO,"&person=").concat(e),"/ws/rest/v1/person/".concat(e,"/attribute"),"/ws/rest/v1/patient/".concat(e,"/identifier?v=custom:(uuid,identifier,identifierType:(uuid,required,name),preferred)")].map((function(e){return window.origin+(0,r.makeUrl)(e)}))}function f(){return h.apply(this,arguments)}function h(){return(h=d(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,c.X1)(),(0,c.Te)(),(0,c.mt)(),(0,c.St)()]);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return m.apply(this,arguments)}function m(){return(m=d(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.y.savePatientFormOnline(t._patientRegistrationData.isNewPatient,t._patientRegistrationData.formValues,t._patientRegistrationData.patientUuidMap,t._patientRegistrationData.initialAddressFieldValues,t._patientRegistrationData.capturePhotoProps,t._patientRegistrationData.currentLocation,t._patientRegistrationData.initialIdentifierValues,t._patientRegistrationData.currentUser,t._patientRegistrationData.config,t._patientRegistrationData.savePatientTransactionManager,n.abort);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v="4.0.2-pre.682",b=n(3979),g={"webservices.rest":"^2.24.0"};function w(){var e={featureName:"Patient Registration",moduleName:o.e1};return(0,r.defineConfigSchema)(o.e1,a.bT),(0,r.registerBreadcrumbs)([{path:"".concat(window.spaBase,"/").concat(o.Kt),title:"Patient Registration",parent:"".concat(window.spaBase,"/home")}]),(0,r.setupOfflineSync)(o.Kt,[],y,{onBeginEditSyncItem:function(e){(0,r.navigate)({to:"${openmrsSpaBase}/patient/".concat(e.content.fhirPatient.id,"/edit")})}}),(0,r.subscribePrecacheStaticDependencies)(f),(0,r.setupDynamicOfflineDataHandler)({id:"esm-patient-registration-app:patient",type:"patient",displayName:"Patient registration",isSynced:function(e){return d(u().mark((function t(){var n,r,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=p(e),t.next=3,caches.open("omrs-spa-cache-v1");case 3:return r=t.sent,t.next=6,r.keys();case 6:return i=t.sent.map((function(e){return e.url})),t.abrupt("return",n.every((function(e){return i.includes(e)})));case 8:case"end":return t.stop()}}),t)})))()},sync:function(e){return d(u().mark((function t(){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=p(e),t.next=3,Promise.allSettled(n.map(function(){var e=d(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.messageOmrsServiceWorker)({type:"registerDynamicRoute",url:t});case 2:return e.next=4,fetch(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return t.stop()}}),t)})))()}}),{pages:[{load:(0,r.getAsyncLifecycle)((function(){return Promise.all([n.e(767),n.e(613),n.e(924),n.e(658)]).then(n.bind(n,7658))}),e),route:"patient-registration",online:{savePatientForm:i.y.savePatientFormOnline,isOffline:!1},offline:{savePatientForm:i.y.savePatientFormOffline,isOffline:!0}}],extensions:[{id:"add-patient-action",slot:"top-nav-actions-slot",load:(0,r.getAsyncLifecycle)((function(){return Promise.all([n.e(767),n.e(206)]).then(n.bind(n,8206))}),e),online:!0,offline:!0},{id:"cancel-patient-edit-modal",load:(0,r.getAsyncLifecycle)((function(){return Promise.all([n.e(767),n.e(924),n.e(735)]).then(n.bind(n,5735))}),e),online:!0,offline:!0},{id:"patient-photo-widget",slot:"patient-photo-slot",load:(0,r.getAsyncLifecycle)((function(){return Promise.all([n.e(854),n.e(975)]).then(n.bind(n,9975))}),e),online:!0,offline:!0},{id:"edit-patient-details-button",slot:"patient-search-actions-slot",load:(0,r.getAsyncLifecycle)((function(){return Promise.all([n.e(924),n.e(635)]).then(n.bind(n,2635))}),e),online:!0,offline:!0},{id:"delete-identifier-confirmation-modal",load:(0,r.getAsyncLifecycle)((function(){return Promise.all([n.e(767),n.e(924),n.e(242)]).then(n.bind(n,5242))}),e),online:!0,offline:!0}]}}},6279:(e,t,n)=>{"use strict";n.d(t,{Cg:()=>g,St:()=>D,Te:()=>_,X1:()=>w,mt:()=>O});var r=n(5047),i=n.n(r),a=n(268),o=n.n(a),s=n(3662),u=n(2777),c=n(8407),l=n(906),d=n(8179);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){f(a,r,i,o,s,"next",e)}function s(e){f(a,r,i,o,s,"throw",e)}o(void 0)}))}}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){y(e,t,n[t])}))}return e}function v(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var g=o().createContext(null);function w(e){return T.apply(this,arguments)}function T(){return(T=h(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/ws/rest/v1/session",t);case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return P.apply(this,arguments)}function P(){return(P=h(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/ws/rest/v1/systemsetting?q=layout.address.format&v=custom:(value)",t);case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return x.apply(this,arguments)}function x(){return(x=h(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/ws/rest/v1/relationshiptype?v=default",t);case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return U.apply(this,arguments)}function U(){return(U=h(i().mark((function e(t){var n,r,a,o,u,c,l,d,p,f,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t);case 2:n=e.sent,r=n.filter(Boolean),a=!0,o=!1,u=void 0,e.prev=5,c=r[Symbol.iterator]();case 7:if(a=(l=c.next()).done){e.next=20;break}return d=l.value,e.t0=b,e.next=12,Promise.all([j(d.uuid,t),N(t)]);case 12:e.t1=e.sent,p=(0,e.t0)(e.t1,2),f=p[0],h=p[1],d.identifierSources=f.data.results.map((function(e){var t=(0,s.Z)(h.data.results,{source:{uuid:e.uuid}});return e.autoGenerationOption=t,e}));case 17:a=!0,e.next=7;break;case 20:e.next=26;break;case 22:e.prev=22,e.t2=e.catch(5),o=!0,u=e.t2;case 26:e.prev=26,e.prev=27,a||null==c.return||c.return();case 29:if(e.prev=29,!o){e.next=32;break}throw u;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return e.abrupt("return",r);case 35:case"end":return e.stop()}}),e,null,[[5,22,26,34],[27,,29,33]])})))).apply(this,arguments)}function k(e){return S.apply(this,arguments)}function S(){return(S=h(i().mark((function e(t){var n,r,a,o,s,c,l,d,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/ws/rest/v1/patientidentifiertype?v=full",t);case 2:return n=e.sent,e.next=5,C("/ws/rest/v1/metadatamapping/termmapping?v=full&code=emr.primaryIdentifierType",t);case 5:if(r=e.sent,!n.ok){e.next=13;break}return l=null==n||null===(a=n.data)||void 0===a?void 0:a.results,d=null==r||null===(o=r.data)||void 0===o||null===(s=o.results)||void 0===s||null===(c=s[0])||void 0===c?void 0:c.metadataUuid,p=(null==r?void 0:r.ok)?[E(null==l?void 0:l.find((function(e){return e.uuid===d})),!0)]:[],l.forEach((function(e){e.uuid!==d&&p.push(E(e,!1))})),e.abrupt("return",p.map((function(e){return v(m({},e),{fieldName:(0,u.Z)(e.name)})})));case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return A.apply(this,arguments)}function A(){return(A=h(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/ws/rest/v1/idgen/identifiersource?v=default&identifierType=".concat(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return I.apply(this,arguments)}function I(){return(I=h(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/ws/rest/v1/idgen/autogenerationoption?v=full",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){return F.apply(this,arguments)}function F(){return(F=h(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.messageOmrsServiceWorker)({type:"registerDynamicRoute",pattern:(0,c.Z)(t)});case 2:return e.next=4,(0,l.openmrsFetch)(t,{headers:d.QT,signal:null==n?void 0:n.signal});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){return{name:e.display,fieldName:(0,u.Z)(e.display),required:e.required,uuid:e.uuid,format:e.format,isPrimary:t,uniquenessBehavior:e.uniquenessBehavior}}},3076:(e,t,n)=>{"use strict";n.d(t,{I:()=>v,y:()=>m});var r=n(5047),i=n.n(r),a=n(906),o=n(8179),s=n(7117);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){c(a,r,i,o,s,"next",e)}function s(e){c(a,r,i,o,s,"throw",e)}o(void 0)}))}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y,m=function(){function e(){d(this,e)}return e.saveRelationships=function(e,t,n){return l(i().mark((function r(){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.all(e.filter((function(e){return e.relationshipType})).filter((function(e){return!!e.action})).map((function(e){var r=e.relatedPersonUuid,i=e.relationshipType,a=e.uuid,o=e.action,u=h(i.split("/"),2),c=u[0],l=u[1],d=t.data.uuid,p="aIsToB"===l,f={personA:p?r:d,personB:p?d:r,relationshipType:c};switch(o){case"ADD":return(0,s.bL)(n,f);case"UPDATE":return(0,s.r6)(n,a,f);case"DELETE":return(0,s.kE)(n,a)}}))));case 1:case"end":return r.stop()}}),r)})))()},e.saveObservations=function(e,t,n,r,a,o){return l(i().mark((function u(){var c;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e&&Object.keys(e).length>0)){i.next=7;break}if(a.registrationObs.encounterTypeUuid){i.next=5;break}console.error("The registration form has been configured to have obs fields, but no registration encounter type has been configured. Obs field values will not be saved."),i.next=7;break;case 5:return c={encounterDatetime:new Date,patient:t.data.uuid,encounterType:a.registrationObs.encounterTypeUuid,location:n,encounterProviders:[{provider:r.currentProvider.uuid,encounterRole:a.registrationObs.encounterProviderRoleUuid}],form:a.registrationObs.registrationFormUuid,obs:Object.keys(e).map((function(t){return{concept:t,value:e[t]}}))},i.abrupt("return",(0,s.M1)(o,c));case 7:case"end":return i.stop()}}),u)})))()},e.savePatientIdentifiers=function(e,t,n,r,a,o){return l(i().mark((function u(){var c;return i().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return c=Object.values(n).map(function(){var n=l(i().mark((function n(r){var u,c,l,d,p,f,h,y,m;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u=r.identifierTypeUuid,c=r.identifierValue,l=r.identifierUuid,d=r.selectedSource,p=r.preferred,f=r.autoGeneration,h=r.initialValue,!(c||f&&d)){n.next=23;break}if(f){n.next=6;break}n.t0=c,n.next=11;break;case 6:return n.next=8,(0,s.fX)(r.selectedSource.uuid,o);case 8:return n.next=10,n.sent.data.identifier;case 10:n.t0=n.sent;case 11:if(y=n.t0,m={uuid:l,identifier:y,identifierType:u,location:a,preferred:p},e){n.next=22;break}if(h){n.next=19;break}return n.next=17,(0,s.eb)(t,m,o);case 17:n.next=22;break;case 19:if(h===y){n.next=22;break}return n.next=22,(0,s.nI)(t,l,m.identifier,o);case 22:return n.abrupt("return",m);case 23:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),t&&Object.keys(r).filter((function(e){return!n[e]})).forEach(function(){var e=l(i().mark((function e(n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.ZB)(t,r[n].identifierUuid,o);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u.abrupt("return",Promise.all(c));case 3:case"end":return u.stop()}}),u)})))()},e.getDeletedNames=function(e,t){return(null==t?void 0:t.additionalNameUuid)?[{nameUuid:t.additionalNameUuid,personUuid:e}]:[]},e.getPatientToCreate=function(t,n,r,i){var a,o,s;return o=t.birthdate,a=(null!=(s=Date)&&"undefined"!=typeof Symbol&&s[Symbol.hasInstance]?s[Symbol.hasInstance](o):o instanceof s)?[t.birthdate.getFullYear(),t.birthdate.getMonth()+1,t.birthdate.getDate()].join("-"):t.birthdate,{uuid:t.patientUuid,person:f({uuid:t.patientUuid,names:e.getNames(t,n),gender:t.gender.charAt(0),birthdate:a,birthdateEstimated:t.birthdateEstimated,attributes:e.getPatientAttributes(t),addresses:[t.address]},e.getPatientDeathInfo(t)),identifiers:i}},e.getNames=function(e,t){var n=[{uuid:t.preferredNameUuid,preferred:!0,givenName:e.givenName,middleName:e.middleName,familyName:e.familyName}];return e.addNameInLocalLanguage&&n.push({uuid:t.additionalNameUuid,preferred:!1,givenName:e.additionalGivenName,middleName:e.additionalMiddleName,familyName:e.additionalFamilyName}),n},e.getPatientAttributes=function(e){var t=[];if(e.attributes){var n=!0,r=!1,i=void 0;try{for(var a,o=Object.entries(e.attributes)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=h(a.value,2),u=s[0],c=s[1];t.push({attributeType:u,value:c})}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}return e.unidentifiedPatient&&t.push({attributeType:"8b56eac7-5c76-4b9c-8c6f-1deab8d3fc47",value:"true"}),t},e.getPatientDeathInfo=function(e){var t=e.isDead,n=e.deathDate,r=e.deathCause;return{dead:t,deathDate:t?n:void 0,causeOfDeath:t?r:void 0}},e.mapPatientToFhirPatient=function(e){var t,n,r,i,a,o;return{id:e.uuid,gender:{M:"male",F:"female",O:"other",U:"unknown"}[null===(t=e.person)||void 0===t?void 0:t.gender],birthDate:null===(n=e.person)||void 0===n?void 0:n.birthdate,deceasedBoolean:e.person.dead,deceasedDateTime:e.person.deathDate,name:null===(r=e.person)||void 0===r||null===(i=r.names)||void 0===i?void 0:i.map((function(e){return{given:[e.givenName,e.middleName].filter(Boolean),family:e.familyName}})),address:null===(a=e.person)||void 0===a?void 0:a.addresses.map((function(e){return{city:e.cityVillage,country:e.country,postalCode:e.postalCode,state:e.stateProvince,use:"home"}})),telecom:null===(o=e.person.attributes)||void 0===o?void 0:o.filter((function(e){return"Telephone Number"===e.attributeType}))}},e}();m.savePatientFormOffline=(y=l(i().mark((function e(t,n,r,s,u,c,l,d,p){var f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f={fhirPatient:m.mapPatientToFhirPatient(m.getPatientToCreate(n,r,s,[])),_patientRegistrationData:{isNewPatient:t,formValues:n,patientUuidMap:r,initialAddressFieldValues:s,capturePhotoProps:u,currentLocation:c,initialIdentifierValues:l,currentUser:d,config:p,savePatientTransactionManager:new v}},e.next=3,(0,a.queueSynchronizationItem)(o.Kt,f,{id:n.patientUuid,displayName:"Patient registration",patientUuid:f.fhirPatient.id,dependencies:[]});case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)}))),function(e,t,n,r,i,a,o,s,u){return y.apply(this,arguments)}),m.savePatientFormOnline=function(){var e=l(i().mark((function e(t,n,r,a,o,u,c,d,p,f,h){var y,v,b;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.savePatientIdentifiers(t,n.patientUuid,n.identifiers,c,u,h);case 2:return y=e.sent,v=m.getPatientToCreate(n,r,a,y),m.getDeletedNames(n.patientUuid,r).forEach(function(){var e=l(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.uO)(t.nameUuid,t.personUuid,h);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,(0,s.co)(h,v,t&&!f.patientSaved?void 0:n.patientUuid);case 7:if(!(b=e.sent).ok){e.next=17;break}return f.patientSaved=!0,e.next=12,m.saveRelationships(n.relationships,b,h);case 12:return e.next=14,m.saveObservations(n.obs,b,u,d,p,h);case 14:if(!p.concepts.patientPhotoUuid||!(null==o?void 0:o.imageData)){e.next=17;break}return e.next=17,(0,s.oV)(b.data.uuid,o.imageData,"/ws/rest/v1/obs",o.dateTime||(new Date).toISOString(),p.concepts.patientPhotoUuid,h);case 17:return e.abrupt("return",b.data.uuid);case 18:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,o,s,u,c,l,d){return e.apply(this,arguments)}}();var v=function e(){d(this,e),this.patientSaved=!1}},7117:(e,t,n)=>{"use strict";n.d(t,{M1:()=>f,M8:()=>_,Uu:()=>T,ZB:()=>k,bL:()=>m,co:()=>p,eb:()=>O,f$:()=>j,fX:()=>h,kE:()=>b,nI:()=>D,oV:()=>g,r6:()=>v,uO:()=>y});var r=n(5047),i=n.n(r),a=n(9857),o=n(2303),s=n(906),u=n(268);function c(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){c(a,r,i,o,s,"next",e)}function s(e){c(a,r,i,o,s,"throw",e)}o(void 0)}))}}function d(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);var a=new Blob([r],{type:n});return new File([a],"patient-photo.png")}function p(e,t,n){return(0,s.openmrsFetch)("/ws/rest/v1/patient/".concat(n||""),{headers:{"Content-Type":"application/json"},method:"POST",body:t,signal:e.signal})}function f(e,t){return(0,s.openmrsFetch)("/ws/rest/v1/encounter",{headers:{"Content-Type":"application/json"},method:"POST",body:t,signal:e.signal})}function h(e,t){return(0,s.openmrsFetch)("/ws/rest/v1/idgen/identifiersource/".concat(e,"/identifier"),{headers:{"Content-Type":"application/json"},method:"POST",body:{},signal:t.signal})}function y(e,t,n){return(0,s.openmrsFetch)("/ws/rest/v1/person/".concat(t,"/name/").concat(e),{method:"DELETE",signal:n.signal})}function m(e,t){return(0,s.openmrsFetch)("/ws/rest/v1/relationship",{headers:{"Content-Type":"application/json"},method:"POST",body:t,signal:e.signal})}function v(e,t,n){return(0,s.openmrsFetch)("/ws/rest/v1/relationship/".concat(t),{headers:{"Content-Type":"application/json"},method:"POST",body:{relationshipType:n.relationshipType},signal:e.signal})}function b(e,t){return(0,s.openmrsFetch)("/ws/rest/v1/relationship/".concat(t),{headers:{"Content-Type":"application/json"},method:"DELETE",signal:e.signal})}function g(e,t,n,r,i,a){return w.apply(this,arguments)}function w(){return(w=l(i().mark((function e(t,n,r,a,o,u){var c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(c=new FormData).append("patient",t),c.append("file",d(n)),c.append("json",JSON.stringify({person:t,concept:o,groupMembers:[],obsDatetime:a})),e.abrupt("return",(0,s.openmrsFetch)(r,{method:"POST",signal:u.signal,body:c}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){var t,n,r,i=(0,s.useConfig)().concepts.patientPhotoUuid,o="/ws/rest/v1/obs?patient=".concat(e,"&concept=").concat(i,"&v=full"),u=(0,a.ZP)(e?o:null,s.openmrsFetch),c=u.data,l=u.error,d=null==c||null===(t=c.data)||void 0===t?void 0:t.results[0];return{data:d?{dateTime:null==d?void 0:d.obsDatetime,imageSrc:null==d||null===(n=d.value)||void 0===n||null===(r=n.links)||void 0===r?void 0:r.uri}:null,isError:l,isLoading:!c&&!l}}function _(e,t){return P.apply(this,arguments)}function P(){return(P=l(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.openmrsFetch)("/ws/rest/v1/person?q=".concat(t),{signal:n.signal}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t,n){return x.apply(this,arguments)}function x(){return(x=l(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.openmrsFetch)("/ws/rest/v1/patient/".concat(t,"/identifier/"),{method:"POST",headers:{"Content-Type":"application/json"},signal:r.signal,body:n}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,n,r){return U.apply(this,arguments)}function U(){return(U=l(i().mark((function e(t,n,r,a){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.openmrsFetch)("/ws/rest/v1/patient/".concat(t,"/identifier/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},signal:a.signal,body:{identifier:r}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,n){return S.apply(this,arguments)}function S(){return(S=l(i().mark((function e(t,n,r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,s.openmrsFetch)("/ws/rest/v1/patient/".concat(t,"/identifier/").concat(n,"?purge"),{method:"DELETE",headers:{"Content-Type":"application/json"},signal:r.signal}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){var t,n=(0,o.Z)(e?"/module/addresshierarchy/ajax/getPossibleFullAddresses.form?separator=%2C%20&searchString=".concat(e):null,s.openmrsFetch),r=n.data,i=n.error,a=(0,u.useMemo)((function(){var e;return{addresses:null!==(t=null==r||null===(e=r.data)||void 0===e?void 0:e.map((function(e){return e.address})))&&void 0!==t?t:[],error:i,isLoading:!r&&!i}}),[r,i]);return a}},3979:(e,t,n)=>{var r={"./en.json":[3574,574]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n(i)))}i.keys=()=>Object.keys(r),i.id=3979,e.exports=i}}]);