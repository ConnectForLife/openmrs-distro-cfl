"use strict";(self.webpackChunk_openmrs_esm_patient_attachments_app=self.webpackChunk_openmrs_esm_patient_attachments_app||[]).push([[25],{652:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(9601),r=a.n(n),i=a(2609),o=a.n(i)()(r());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-attachments__camera-upload__productiveHeading03___P9fZJ{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0}.-esm-patient-attachments__camera-upload__productiveHeading02___x4v5K{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0}.-esm-patient-attachments__camera-upload__bodyLong01___pLZ8V{font-size:.875rem;font-weight:400;line-height:1.43;letter-spacing:.16px}.-esm-patient-attachments__camera-upload__muted___XfnFg{color:#525252}.-esm-patient-attachments__camera-upload__paddedProductiveHeading03___o9Us_{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0;padding:1rem}.-esm-patient-attachments__camera-upload__bodyShort01___xrEJV{font-size:.875rem;font-weight:400;line-height:1.29;letter-spacing:.16px}.-esm-patient-attachments__camera-upload__text02___ZeQif{color:#525252}.-esm-patient-attachments__camera-upload__cameraSection___wNE0f{width:inherit;background-color:#fff}.react-html5-camera-photo>img,.react-html5-camera-photo>video{width:100% !important}.-esm-patient-attachments__camera-upload__uploadFile___Cz_Hl{color:#fff}.-esm-patient-attachments__camera-upload__uploadFile___Cz_Hl label{max-width:unset}.-esm-patient-attachments__camera-upload__uploadFile___Cz_Hl label>div{height:25rem;justify-content:center;align-items:center}.-esm-patient-attachments__camera-upload__tabs___Acq6I .-esm-patient-attachments__camera-upload__bx--tab-content___lnwwC{display:none}.-esm-patient-attachments__camera-upload__tabContent___ck1jT{padding:1rem}@media(max-width: 1200px){.-esm-patient-attachments__camera-upload__frameContent___BauzO{width:65%}}.-esm-patient-attachments__camera-upload__uploadingFilesSection___Zc3ll{display:flex;flex-direction:column;justify-content:center;align-items:center;margin:1rem;height:25rem;overflow-y:auto;border:1px dashed #8d8d8d}.-esm-patient-attachments__camera-upload__buttonSet___fMt5v{width:100%;display:grid;grid-template-columns:1fr 1fr}.-esm-patient-attachments__camera-upload__buttonSet___fMt5v button{max-width:unset !important}",""]),o.locals={productiveHeading03:"-esm-patient-attachments__camera-upload__productiveHeading03___P9fZJ",productiveHeading02:"-esm-patient-attachments__camera-upload__productiveHeading02___x4v5K",bodyLong01:"-esm-patient-attachments__camera-upload__bodyLong01___pLZ8V",muted:"-esm-patient-attachments__camera-upload__muted___XfnFg",paddedProductiveHeading03:"-esm-patient-attachments__camera-upload__paddedProductiveHeading03___o9Us_",bodyShort01:"-esm-patient-attachments__camera-upload__bodyShort01___xrEJV",text02:"-esm-patient-attachments__camera-upload__text02___ZeQif",cameraSection:"-esm-patient-attachments__camera-upload__cameraSection___wNE0f",uploadFile:"-esm-patient-attachments__camera-upload__uploadFile___Cz_Hl",tabs:"-esm-patient-attachments__camera-upload__tabs___Acq6I","bx--tab-content":"-esm-patient-attachments__camera-upload__bx--tab-content___lnwwC",tabContent:"-esm-patient-attachments__camera-upload__tabContent___ck1jT",frameContent:"-esm-patient-attachments__camera-upload__frameContent___BauzO",uploadingFilesSection:"-esm-patient-attachments__camera-upload__uploadingFilesSection___Zc3ll",buttonSet:"-esm-patient-attachments__camera-upload__buttonSet___fMt5v"};const c=o},2415:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(9601),r=a.n(n),i=a(2609),o=a.n(i)()(r());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-attachments__image-preview__productiveHeading03___L2gGr{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0}.-esm-patient-attachments__image-preview__productiveHeading02___wyg0O{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0}.-esm-patient-attachments__image-preview__bodyLong01___g5vwz{font-size:.875rem;font-weight:400;line-height:1.43;letter-spacing:.16px}.-esm-patient-attachments__image-preview__muted___GnR9A{color:#525252}.-esm-patient-attachments__image-preview__paddedProductiveHeading03___fDA6h{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0;padding:1rem}.-esm-patient-attachments__image-preview__bodyShort01___l1vEV{font-size:.875rem;font-weight:400;line-height:1.29;letter-spacing:.16px}.-esm-patient-attachments__image-preview__text02___ZMuFL{color:#525252}.-esm-patient-attachments__image-preview__filePreviewContainer___XnW9P{background-color:#fff}.-esm-patient-attachments__image-preview__overview___tjFAA{padding:1rem;display:grid;grid-template-columns:1fr 1fr}.-esm-patient-attachments__image-preview__overview___tjFAA img{width:100%;max-height:200px;display:block}.-esm-patient-attachments__image-preview__overview___tjFAA .-esm-patient-attachments__image-preview__imageDetails___YcQDC{margin-left:1rem}.-esm-patient-attachments__image-preview__buttonSetOverrides___bFFTf{margin:1rem auto 0;display:grid;grid-template-columns:1fr 1fr}.-esm-patient-attachments__image-preview__buttonSetOverrides___bFFTf>button{max-width:unset}.-esm-patient-attachments__image-preview__captionFrame___zn9Zu{margin-bottom:.3rem}",""]),o.locals={productiveHeading03:"-esm-patient-attachments__image-preview__productiveHeading03___L2gGr",productiveHeading02:"-esm-patient-attachments__image-preview__productiveHeading02___wyg0O",bodyLong01:"-esm-patient-attachments__image-preview__bodyLong01___g5vwz",muted:"-esm-patient-attachments__image-preview__muted___GnR9A",paddedProductiveHeading03:"-esm-patient-attachments__image-preview__paddedProductiveHeading03___fDA6h",bodyShort01:"-esm-patient-attachments__image-preview__bodyShort01___l1vEV",text02:"-esm-patient-attachments__image-preview__text02___ZMuFL",filePreviewContainer:"-esm-patient-attachments__image-preview__filePreviewContainer___XnW9P",overview:"-esm-patient-attachments__image-preview__overview___tjFAA",imageDetails:"-esm-patient-attachments__image-preview__imageDetails___YcQDC",buttonSetOverrides:"-esm-patient-attachments__image-preview__buttonSetOverrides___bFFTf",captionFrame:"-esm-patient-attachments__image-preview__captionFrame___zn9Zu"};const c=o},5959:(e,t,a)=>{a.d(t,{OE:()=>l,Rs:()=>c,eK:()=>o,ky:()=>s});var n=a(3066),r=a(9902),i=a(9857),o="/ws/rest/v1/attachment";function c(e,t){var a,c=(0,i.ZP)("".concat(o,"?patient=").concat(e,"&includeEncounterless=").concat(t),n.openmrsFetch),l=c.data,s=c.error,m=c.mutate,_=c.isValidating;return(0,r.useMemo)((function(){return{isLoading:!l&&!s,data:null!==(a=null==l?void 0:l.data.results)&&void 0!==a?a:[],error:s,mutate:m,isValidating:_}}),[_,l,s,m])}function l(e,t){var a=new FormData,r=new File([""],t.fileName);return a.append("fileCaption",t.fileName),a.append("patient",e),a.append("file",r),a.append("base64Content",t.fileContent),(0,n.openmrsFetch)("".concat(o),{method:"POST",body:a})}function s(e,t){return(0,n.openmrsFetch)("".concat(o,"/").concat(e),{method:"DELETE",signal:t.signal})}},4025:(e,t,a)=>{a.r(t),a.d(t,{FileUploadingComponent:()=>I,default:()=>z});var n=a(9902),r=a.n(n),i=a(1876),o=a(321),c=a.n(o),l=a(1195),s=a.n(l),m=a(3275),_=a.n(m),u=a(7162),d=a.n(u),p=a(2094),f=a.n(p),h=a(757),g=a.n(h),v=a(652),b={};b.styleTagTransform=g(),b.setAttributes=d(),b.insert=_().bind(null,"head"),b.domAPI=s(),b.insertStyleElement=f(),c()(v.Z,b);const y=v.Z&&v.Z.locals?v.Z.locals:void 0;var w=a(1569),C=a.n(w),E=a(3066),S=a(4924),O=a(3660),F=(a(3493),a(3950)),A=a(7513),P=a(2446),j=a(7307),k=a(6549),T=a(7030);function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,r,i=[],o=!0,c=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){c=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(c)throw r}}return i}}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"==typeof e)return Z(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Z(e,t):void 0}}var H=function(e){var t=e.handleTakePhoto,a=e.setError,i=(0,n.useRef)();(0,n.useEffect)((function(){return function(){var e;null===(e=i.current)||void 0===e||e.getTracks().forEach((function(e){return e.stop()}))}}),[i]);var o=(0,n.useCallback)((function(e){i.current=e}),[]);return r().createElement(C(),{onTakePhoto:t,onCameraStart:o,onCameraError:a})};const z=function(e){var t=e.saveFile,a=e.closeModal,o=e.onCompletion,c=D((0,n.useState)(void 0),2),l=c[0],s=c[1],m=D((0,n.useState)([]),2),_=m[0],u=m[1],d=D((0,n.useState)(!1),2),p=d[0],f=d[1],h=(0,S.useTranslation)().t,g=(0,n.useCallback)((function(){u([]),f(!1),s(void 0)}),[u,f]),v=(0,n.useCallback)((function(e){u([{fileContent:e,fileName:"Image taken from camera",fileType:"image",fileDescription:"",status:"uploading"}])}),[]),b=(0,n.useCallback)((function(e){e.forEach((function(e){return(0,O.Z)(e).then((function(t){u((function(a){return(n=a,function(e){if(Array.isArray(e))return Z(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||N(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([{fileContent:t,fileName:e.name,fileType:"application/pdf"===e.type?"pdf":"image",fileDescription:"",status:"uploading"}]);var n}))}))}))}),[u]);(0,n.useEffect)((function(){l&&(0,E.showToast)({description:l.message,kind:"error",title:h("cameraError","Camera Error")})}),[l,h]);var w=(0,n.useCallback)((function(e){u(e),f(!0)}),[]);return p?r().createElement(I,{uploadedFiles:_,saveFile:t,setUploadedFiles:u,clearCamera:g,closeModal:a,onCompletion:o}):_.length?r().createElement(i.default,{onCancelCapture:function(){g()},onSaveFile:function(e){w(e)},uploadedFiles:_}):r().createElement("div",{className:y.cameraSection},r().createElement("h3",{className:y.paddedProductiveHeading03},h("addAttachment","Add Attachment")),r().createElement(F.ZP,{className:y.tabs},r().createElement(A.Z,{label:h("uploadMedia","Upload media")},r().createElement("div",{className:"cds--file__container"},r().createElement("p",{className:"cds--label-description"},h("fileUploadTypes","Only images and pdf files. 500kb max file size")),r().createElement("div",{className:y.uploadFile},r().createElement(P.Z,{accept:["image/*","application/pdf"],labelText:h("fileUploadInstructions","Drag and drop files here or click to upload"),tabIndex:0,multiple:!0,onAddFiles:function(e,t){var a=t.addedFiles;b(a)}})))),r().createElement(A.Z,{label:h("webcam","Webcam")},r().createElement(H,{handleTakePhoto:v,setError:s}))))};var I=function(e){var t=e.uploadedFiles,a=e.saveFile,i=e.setUploadedFiles,o=e.closeModal,c=e.clearCamera,l=e.onCompletion,s=(0,S.useTranslation)().t,m=D((0,n.useState)(!1),2),_=m[0],u=m[1];return(0,n.useEffect)((function(){Promise.all(t.map((function(e,t){return a(e).then((function(){(0,E.showToast)({title:s("uploadComplete","Upload complete"),description:"".concat(e.fileName," ").concat(s("uploadedSuccessfully","uploaded successfully")),kind:"success"}),i((function(e){return e.map((function(e,a){return a===t?(n=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){x(e,t,a[t])}))}return e}({},e),r=null!=(r={status:"complete"})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})),n):e;var n,r}))}))}))}))).then((function(){u(!0),null==l||l()}))}),[l,a,i,s,t]),r().createElement("div",{className:y.cameraSection},r().createElement("h3",{className:y.paddedProductiveHeading03},s("addAttachment","Add Attachment")),r().createElement("div",{className:y.uploadingFilesSection},t.map((function(e){return r().createElement(j.Z,{name:e.fileName,status:e.status})}))),_&&r().createElement(k.Z,{className:y.buttonSet},r().createElement(T.Z,{size:"lg",kind:"secondary",onClick:c},s("addMoreAttachments","Add more attachments")),r().createElement(T.Z,{size:"lg",kind:"primary",onClick:o},s("closeModal","Close"))))}},1876:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var n=a(9902),r=a.n(n),i=a(4924),o=a(3066),c=a(1918),l=a(3172),s=a(6549),m=a(7030),_=a(321),u=a.n(_),d=a(1195),p=a.n(d),f=a(3275),h=a.n(f),g=a(7162),v=a.n(g),b=a(2094),y=a.n(b),w=a(757),C=a.n(w),E=a(2415),S={};S.styleTagTransform=C(),S.setAttributes=v(),S.insert=h().bind(null,"head"),S.domAPI=p(),S.insertStyleElement=y(),u()(E.Z,S);const O=E.Z&&E.Z.locals?E.Z.locals:void 0;var F=a(7128);function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,r,i=[],o=!0,c=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){c=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(c)throw r}}return i}}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return A(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?A(e,t):void 0}}var Z=function(e){var t=e.uploadedFile,a=e.collectDescription,_=e.onSaveFile,u=e.onCancelCapture,d=j((0,n.useState)(""),2),p=d[0],f=d[1],h=j((0,n.useState)(""),2),g=h[0],v=h[1],b=(0,i.useTranslation)().t,y=j((0,n.useState)(!1),2),w=y[0],C=y[1];(0,n.useEffect)((function(){f(t.fileName),v(t.fileDescription)}),[t]);var E=(0,n.useCallback)((function(e){var a,n;e.preventDefault(),null==_||_((a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){P(e,t,a[t])}))}return e}({},t),n=null!=(n={fileName:p,fileDescription:g})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(n)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(n,e))})),a))}),[_,p,g,t]),S=(0,n.useCallback)((function(e){e.preventDefault(),null==u||u()}),[u]),A=(0,n.useCallback)((function(e){e.preventDefault(),""===e.target.value?C(!0):w&&C(!1),f(e.target.value)}),[C,f,w]),k=(0,n.useCallback)((function(e){e.preventDefault(),v(e.target.value)}),[v]);return r().createElement("form",{onSubmit:E},r().createElement("div",{className:O.overview},r().createElement("img",{src:"image"===t.fileType?t.fileContent:F,alt:"placeholder"}),r().createElement("div",{className:O.imageDetails},r().createElement("div",{className:O.captionFrame},r().createElement(c.Z,{id:"caption",autoFocus:!0,labelText:b("imageName","Image name"),autoComplete:"off",placeholder:b("attachmentCaptionInstruction","Enter caption"),onChange:A,required:!0,value:p,invalid:w,invalidText:w&&b("fieldRequired","This field is required")})),a&&r().createElement(l.Z,{id:"description",labelText:b("imageDescription","Image description"),autoComplete:"off",placeholder:b("attachmentCaptionInstruction","Enter caption"),value:g,onChange:k}))),r().createElement(o.UserHasAccess,{privilege:"Create Attachment"},r().createElement(s.Z,{className:O.buttonSetOverrides},r().createElement(m.Z,{kind:"secondary",size:"lg",onClick:S},b("cancel","Cancel")),r().createElement(m.Z,{type:"submit",size:"lg",onClick:E,disabled:w},b("addAttachment","Add attachment")))))};const x=function(e){var t=e.uploadedFiles,a=e.onSaveFile,o=e.onCancelCapture,c=(0,i.useTranslation)().t,l=j((0,n.useState)(1),2),s=l[0],m=l[1],_=j((0,n.useState)([]),2),u=_[0],d=_[1],p=(0,n.useCallback)((function(){s<t.length&&m(s+1)}),[m,s,t]),f=(0,n.useCallback)((function(e){s===t.length?a(k(u).concat([e])):(d((function(t){return k(t).concat([e])})),p())}),[p,d,t,u,s,a]);return r().createElement("div",{className:O.filePreviewContainer},r().createElement("h3",{className:O.paddedProductiveHeading03},c("addAttachment","Add Attachment")," ",t.length>1&&"(".concat(s," of ").concat(t.length,")")),r().createElement(Z,{uploadedFile:t[s-1],onCancelCapture:o,onSaveFile:f,moveToNextFile:p,collectDescription:"image"===t[s-1].fileType}))}},3660:(e,t,a)=>{a.d(t,{H:()=>o,Z:()=>i});var n=a(5959),r=a(3066);function i(e){return new Promise((function(t){if(e){var a=new FileReader;a.addEventListener("load",(function(){"string"==typeof a.result?t(a.result):t("")})),a.addEventListener("error",(function(){t("")})),a.readAsDataURL(e)}else t("")}))}function o(e){return{id:e.uuid,src:"".concat(window.openmrsBase).concat(n.eK,"/").concat(e.uuid,"/bytes"),title:e.comment,dateTime:(0,r.formatDate)(new Date(e.dateTime),{mode:"wide"}),bytesMimeType:e.bytesMimeType,bytesContentFamily:e.bytesContentFamily}}},7128:(e,t,a)=>{e.exports=a.p+"1caaa464bd9603a4341c.svg"}}]);