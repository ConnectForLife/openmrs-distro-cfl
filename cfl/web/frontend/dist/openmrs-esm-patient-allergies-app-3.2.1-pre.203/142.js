"use strict";(self.webpackChunk_openmrs_esm_patient_allergies_app=self.webpackChunk_openmrs_esm_patient_allergies_app||[]).push([[142],{8137:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(9601),a=r.n(n),l=r(2609),i=r.n(l)()(a());i.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{padding:0;border:0;margin:0;font:inherit;font-size:100%;vertical-align:baseline}button,select,input,textarea{border-radius:0;font-family:inherit}input[type=text]::-ms-clear{display:none}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}body{line-height:1}sup{vertical-align:super}sub{vertical-align:sub}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote::before,blockquote::after,q::before,q::after{content:\"\"}table{border-collapse:collapse;border-spacing:0}*{box-sizing:border-box}button{margin:0}html{font-size:100%}body{font-weight:400;font-family:'IBM Plex Sans', 'Helvetica Neue', Arial, sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}code{font-family:'IBM Plex Mono', 'Menlo', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Courier, monospace}strong{font-weight:600}@media screen and (-ms-high-contrast: active){svg{fill:ButtonText}}h1{font-size:2.625rem;font-weight:300;line-height:1.199;letter-spacing:0}h2{font-size:2rem;font-weight:400;line-height:1.25;letter-spacing:0}h3{font-size:1.75rem;font-weight:400;line-height:1.29;letter-spacing:0}h4{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0}h5{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0}h6{font-size:.875rem;font-weight:600;line-height:1.29;letter-spacing:.16px}p{font-size:1rem;font-weight:400;line-height:1.5;letter-spacing:0}a{color:#0f62fe}em{font-style:italic}@keyframes -esm-patient-allergies__allergy-form__skeleton___pZOuW{0%{opacity:.3;transform:scaleX(0);transform-origin:left}20%{opacity:1;transform:scaleX(1);transform-origin:left}28%{transform:scaleX(1);transform-origin:right}51%{transform:scaleX(0);transform-origin:right}58%{transform:scaleX(0);transform-origin:right}82%{transform:scaleX(1);transform-origin:right}83%{transform:scaleX(1);transform-origin:left}96%{transform:scaleX(0);transform-origin:left}100%{opacity:.3;transform:scaleX(0);transform-origin:left}}.-esm-patient-allergies__allergy-form__productiveHeading01___cnygp{font-size:.875rem;font-weight:600;line-height:1.29;letter-spacing:.16px}.-esm-patient-allergies__allergy-form__productiveHeading02____87Cx{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0}.-esm-patient-allergies__allergy-form__productiveHeading03___vAEzx{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0}.-esm-patient-allergies__allergy-form__productiveHeading04___uhiCO{font-size:1.75rem;font-weight:400;line-height:1.29;letter-spacing:0}.-esm-patient-allergies__allergy-form__productiveHeading05___s0IqJ{font-size:2rem;font-weight:400;line-height:1.25;letter-spacing:0}.-esm-patient-allergies__allergy-form__productiveHeading06___Rd6wb{font-size:2.625rem;font-weight:300;line-height:1.199;letter-spacing:0}.-esm-patient-allergies__allergy-form__bodyShort01___YUIJk{font-size:.875rem;font-weight:400;line-height:1.29;letter-spacing:.16px}.-esm-patient-allergies__allergy-form__bodyShort02___OVGny{font-size:1rem;font-weight:400;line-height:1.375;letter-spacing:0}.-esm-patient-allergies__allergy-form__bodyLong01___stSAh{font-size:.875rem;font-weight:400;line-height:1.43;letter-spacing:.16px}.-esm-patient-allergies__allergy-form__bodyLong02___WTHbc{font-size:1rem;font-weight:400;line-height:1.5;letter-spacing:0}.-esm-patient-allergies__allergy-form__label01___Ts6py{font-size:.75rem;font-weight:400;line-height:1.34;letter-spacing:.32px}.-esm-patient-allergies__allergy-form__header___PaLU9{border-bottom:.0625rem solid #e0e0e0;margin:0}.-esm-patient-allergies__allergy-form__content___gKWGr{display:grid;grid-template-columns:50% 10% 1fr;margin:.5rem 1rem;width:100%}.-esm-patient-allergies__allergy-form__container___aJnBu{border:solid 1px #e0e0e0;margin:0rem 1rem 1rem}.-esm-patient-allergies__allergy-form__container___aJnBu:first-of-type{margin-bottom:2rem}.-esm-patient-allergies__allergy-form__container___aJnBu:last-of-type{margin-top:2.5rem}.-esm-patient-allergies__allergy-form__heading___GK3_W{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0;color:#161616;margin:1rem 1rem .5rem}.-esm-patient-allergies__allergy-form__section___UwqDM:not(:first-of-type){margin-bottom:2rem}.-esm-patient-allergies__allergy-form__section___UwqDM:last-of-type{margin-top:2rem}.-esm-patient-allergies__allergy-form__wrapperContainer___k0eio fieldset{display:grid;grid-template-columns:1fr 1fr;width:100%}.-esm-patient-allergies__allergy-form__wrapperContainer___k0eio .bx--radio-button__label{justify-content:flex-start}.-esm-patient-allergies__allergy-form__sectionHeading___jz4a_{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0;color:#161616;margin:1rem 1rem .5rem}.-esm-patient-allergies__allergy-form__radio___mAjDb{margin:1rem 0rem}.-esm-patient-allergies__allergy-form__radio___mAjDb label{justify-content:flex-start}.-esm-patient-allergies__allergy-form__checkbox___xV_2V:not(:first-child){margin:.5625rem 0rem}.-esm-patient-allergies__allergy-form__input___pRlYH{margin:0rem 1rem 1rem}.-esm-patient-allergies__allergy-form__checkboxContainer___bHHzf{display:grid;grid-template-columns:1fr 1fr}.-esm-patient-allergies__allergy-form__wrapper___SI3Ui{margin:1rem}.-esm-patient-allergies__allergy-form__wrapper___SI3Ui:last-of-type{margin-top:1.5rem}.-esm-patient-allergies__allergy-form__textbox___UssI9{width:26.375rem}.-esm-patient-allergies__allergy-form__button___ZloYx{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-allergies__allergy-form__tablet___mdaEI{padding:0rem}.-esm-patient-allergies__allergy-form__desktopButtons___RTWUZ{margin-top:2rem}.-esm-patient-allergies__allergy-form__tabletButtons___pySwH{margin-top:2rem;padding:1.5rem 1rem;background-color:#fff}.-esm-patient-allergies__allergy-form__desktop___LT0BC{padding:0rem}.-esm-patient-allergies__allergy-form__form___Xlnsa{display:flex;flex-direction:column;justify-content:space-between}.-esm-patient-allergies__allergy-form__desktopContainer___T4O7M{background-color:#f4f4f4}.-esm-patient-allergies__allergy-form__tabletContainer___R83py{background-color:#fff}.omrs-breakpoint-gt-tablet .-esm-patient-allergies__allergy-form__form___Xlnsa{height:calc(100vh - 6rem)}.omrs-breakpoint-lt-desktop .-esm-patient-allergies__allergy-form__form___Xlnsa{height:calc(100vh - 9rem)}",""]),i.locals={productiveHeading01:"-esm-patient-allergies__allergy-form__productiveHeading01___cnygp",productiveHeading02:"-esm-patient-allergies__allergy-form__productiveHeading02____87Cx",productiveHeading03:"-esm-patient-allergies__allergy-form__productiveHeading03___vAEzx",productiveHeading04:"-esm-patient-allergies__allergy-form__productiveHeading04___uhiCO",productiveHeading05:"-esm-patient-allergies__allergy-form__productiveHeading05___s0IqJ",productiveHeading06:"-esm-patient-allergies__allergy-form__productiveHeading06___Rd6wb",bodyShort01:"-esm-patient-allergies__allergy-form__bodyShort01___YUIJk",bodyShort02:"-esm-patient-allergies__allergy-form__bodyShort02___OVGny",bodyLong01:"-esm-patient-allergies__allergy-form__bodyLong01___stSAh",bodyLong02:"-esm-patient-allergies__allergy-form__bodyLong02___WTHbc",label01:"-esm-patient-allergies__allergy-form__label01___Ts6py",header:"-esm-patient-allergies__allergy-form__header___PaLU9",content:"-esm-patient-allergies__allergy-form__content___gKWGr",container:"-esm-patient-allergies__allergy-form__container___aJnBu",heading:"-esm-patient-allergies__allergy-form__heading___GK3_W",section:"-esm-patient-allergies__allergy-form__section___UwqDM",wrapperContainer:"-esm-patient-allergies__allergy-form__wrapperContainer___k0eio",sectionHeading:"-esm-patient-allergies__allergy-form__sectionHeading___jz4a_",radio:"-esm-patient-allergies__allergy-form__radio___mAjDb",checkbox:"-esm-patient-allergies__allergy-form__checkbox___xV_2V",input:"-esm-patient-allergies__allergy-form__input___pRlYH",checkboxContainer:"-esm-patient-allergies__allergy-form__checkboxContainer___bHHzf",wrapper:"-esm-patient-allergies__allergy-form__wrapper___SI3Ui",textbox:"-esm-patient-allergies__allergy-form__textbox___UssI9",button:"-esm-patient-allergies__allergy-form__button___ZloYx",tablet:"-esm-patient-allergies__allergy-form__tablet___mdaEI",desktopButtons:"-esm-patient-allergies__allergy-form__desktopButtons___RTWUZ",tabletButtons:"-esm-patient-allergies__allergy-form__tabletButtons___pySwH",desktop:"-esm-patient-allergies__allergy-form__desktop___LT0BC",form:"-esm-patient-allergies__allergy-form__form___Xlnsa",desktopContainer:"-esm-patient-allergies__allergy-form__desktopContainer___T4O7M",tabletContainer:"-esm-patient-allergies__allergy-form__tabletContainer___R83py",skeleton:"-esm-patient-allergies__allergy-form__skeleton___pZOuW"};const o=i},3142:(e,t,r)=>{r.r(t),r.d(t,{default:()=>P});var n=r(9902),a=r.n(n),l=r(7898),i=r(707),o=r(2228),s=r(3950),_=r(7513),m=r(8769),c=r(6086),g=r(7367),d=r(4868),f=r(6642),p=r(182),u=r(3172),y=r(6549),h=r(7030),b=r(4924),v=r(3484),w=r(9857),k=r(3066),C=r(2444),E=r(2188);function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var x=r(321),A=r.n(x),N=r(1195),T=r.n(N),H=r(3275),U=r.n(H),z=r(7162),I=r.n(z),O=r(2094),R=r.n(O),Z=r(757),D=r.n(Z),B=r(8137),M={};M.styleTagTransform=D(),M.setAttributes=I(),M.insert=U().bind(null,"head"),M.domAPI=T(),M.insertStyleElement=R(),A()(B.Z,M);const j=B.Z&&B.Z.locals?B.Z.locals:void 0;function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,l=[],i=!0,o=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(o)throw a}}return l}}(e,t)||W(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){if(e){if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(e,t):void 0}}var X;!function(e){e.FOOD="FOOD",e.DRUG="DRUG",e.ENVIRONMENT="ENVIRONMENT"}(X||(X={}));const P=function(e){var t,r=e.closeWorkspace,x=e.promptBeforeClosing,A=e.patientUuid,N=(0,b.useTranslation)().t,T="tablet"===(0,k.useLayoutType)(),H=(0,k.useConfig)().concepts,U=(0,n.useMemo)((function(){return H}),[H]),z=U.drugAllergenUuid,I=U.foodAllergenUuid,O=U.environmentalAllergenUuid,R=U.allergyReactionUuid,Z=U.mildReactionUuid,D=U.severeReactionUuid,B=U.moderateReactionUuid,M=U.otherConceptUuid,P=(0,n.useMemo)((function(){return{patientUuid:A}}),[A]),V=(0,w.kY)().mutate,F=q((0,n.useState)(null),2),G=F[0],J=F[1],Y=q((0,n.useState)([]),2),K=Y[0],$=Y[1],Q=q((0,n.useState)(""),2),ee=Q[0],te=Q[1],re=q((0,n.useState)(null),2),ne=re[0],ae=re[1],le=q((0,n.useState)(""),2),ie=le[0],oe=le[1],se=q((0,n.useState)(""),2),_e=se[0],me=se[1],ce=q((0,n.useState)(null),2),ge=ce[0],de=ce[1],fe=q((0,n.useState)(""),2),pe=fe[0],ue=fe[1],ye=q((0,n.useState)(X.DRUG),2),he=ye[0],be=ye[1],ve=q((0,n.useState)(""),2),we=ve[0],ke=ve[1],Ce=[N("drug","Drug"),N("food","Food"),N("environmental","Environmental")],Ee=[N("mild","Mild"),N("moderate","Moderate"),N("severe","Severe")];(0,n.useEffect)((function(){x((function(){return Boolean(ie||_e||ge||pe||we)}))}),[x,ie,_e,ge,pe,he,we]),(0,n.useEffect)((function(){(function(e){var t,r=e.map((function(e){return(0,k.openmrsObservableFetch)("/ws/rest/v1/concept/".concat(e,"?v=full")).pipe((0,E.U)((function(e){return e.data.setMembers.map((function(e){return{uuid:e.uuid,display:e.display}}))})))}));return(0,C.forkJoin)((t=r,function(e){if(Array.isArray(e))return S(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).pipe((0,E.U)((function(e){return{drugAllergens:e[0],foodAllergens:e[1],environmentalAllergens:e[2],allergicReactions:e[3]}})))})([z,I,O,R]).pipe((0,v.P)()).subscribe(J,ae)}),[R,z,O,I]);var Se=(0,n.useCallback)((function(e,t){$(e?function(e){return(r=e,function(e){if(Array.isArray(e))return L(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||W(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([t]);var r}:function(e){return e.filter((function(e){return e!==t}))})}),[]),xe=(0,n.useCallback)((function(e){e.preventDefault();var t={allergen:pe===M?{allergenType:he,codedAllergen:{uuid:pe},nonCodedAllergen:ie}:{allergenType:he,codedAllergen:{uuid:pe}},severity:{uuid:we},comment:ee,reactions:null==K?void 0:K.map((function(e){return e===M?{reaction:{uuid:e},reactionNonCoded:_e}:{reaction:{uuid:e}}}))},n=new AbortController;(function(e,t,r){return(0,k.openmrsFetch)("/ws/rest/v1/patient/".concat(t,"/allergy"),{headers:{"Content-Type":"application/json"},method:"POST",body:e,signal:r.signal})})(t,A,n).then((function(e){201===e.status&&(r(),(0,k.showToast)({critical:!0,kind:"success",title:N("allergySaved","Allergy saved"),description:N("allergyNowVisible","It is now visible on the Allergies page")}),V("".concat(k.fhirBaseUrl,"/AllergyIntolerance?patient=").concat(A)))}),(function(e){(0,k.showNotification)({title:N("allergySaveError","Error saving allergy"),kind:"error",critical:!0,description:null==e?void 0:e.message})})).finally((function(){return n.abort()}))}),[pe,M,he,ie,we,ee,K,A,_e,r,N,V]);return a().createElement(l.Z,null,T?a().createElement(i.Z,{className:j.header},a().createElement(k.ExtensionSlot,{className:j.content,extensionSlotName:"patient-details-header-slot",state:P})):null,a().createElement("div",{className:"".concat(j.form," ").concat(T?j.tablet:j.desktop)},a().createElement("h1",{className:j.heading},N("allergensAndReactions","Allergens and reactions")),ne?a().createElement(o.K0,{style:{margin:"0rem",minWidth:"100%"},kind:"error",lowContrast:!0,title:N("errorFetchingData","Error fetching allergens and reactions"),subtitle:N("tryReopeningTheForm","Please try launching the form again")}):null,a().createElement("div",{className:"".concat(j.container," ").concat(T?j.tabletContainer:j.desktopContainer)},a().createElement("section",{className:j.section},a().createElement("h2",{className:j.sectionHeading},N("selectAllergens","Select the allergens")),a().createElement(s.ZP,{onSelectionChange:function(e){switch(e){case 0:be(X.DRUG);break;case 1:be(X.FOOD);break;case 2:be(X.ENVIRONMENT)}}},Ce.map((function(e,t){var r,n=e.toLowerCase()+"Allergens";return a().createElement(_.Z,{id:"tab-".concat(t+1),key:t,label:e},a().createElement("div",{className:T?j.wrapperContainer:void 0},a().createElement(m.Z,{name:"allergen-type-".concat(t+1),orientation:"vertical",onChange:function(e){return ue(e.toString())},valueSelected:pe},null==G||null===(r=G[n])||void 0===r?void 0:r.map((function(e){return a().createElement(c.Z,{className:j.radio,id:e.display,key:e.uuid,labelText:e.display,value:e.uuid})})))))}))),pe===M?a().createElement("div",{className:j.input},a().createElement(g.Z,{light:T,id:"nonCodedAllergenType",labelText:N("otherNonCodedAllergen","Other non-coded allergen"),onChange:function(e){return oe(e.target.value)},placeholder:N("typeAllergenName","Please type in the name of the allergen")})):null),a().createElement("section",{className:j.section},a().createElement("h2",{className:j.sectionHeading},N("selectReactions","Select the reactions")),a().createElement("div",{className:T?j.checkboxContainer:void 0,style:{margin:"1rem"}},null==G||null===(t=G.allergicReactions)||void 0===t?void 0:t.map((function(e,t){return a().createElement(d.Z,{className:j.checkbox,key:t,labelText:e.display,id:e.uuid,onChange:Se,value:e.display})}))),K.includes(M)?a().createElement("div",{className:j.input},a().createElement(g.Z,{light:T,id:"nonCodedAllergicReaction",labelText:N("otherNonCodedAllergicReaction","Other non-coded allergic reaction"),onChange:function(e){return me(e.target.value)},placeholder:N("typeAllergicReactionName","Please type in the name of the allergic reaction")})):null)),a().createElement("h1",{className:j.heading},N("severityAndOnsetDate","Severity and date of onset")),a().createElement("div",{className:"".concat(j.container," ").concat(T?j.tabletContainer:j.desktopContainer)},a().createElement("section",{className:j.section},a().createElement("h2",{className:j.sectionHeading},N("severityOfWorstReaction","Severity of worst reaction")),a().createElement("div",{className:j.wrapper},a().createElement(m.Z,{name:"severity-of-worst-reaction",onChange:function(e){return ke(e.toString())},valueSelected:we},Ee.map((function(e,t){return a().createElement(c.Z,{id:e.toLowerCase()+"Severity",key:t,labelText:e,value:function(){switch(e.toLowerCase()){case"mild":return Z;case"moderate":return B;case"severe":return D;default:return""}}()})}))))),a().createElement("section",{className:j.section},a().createElement("h2",{className:j.sectionHeading},N("dateAndComments","Date and comments")),a().createElement("div",{className:j.wrapper},a().createElement(f.Z,{id:"onsetDate",dateFormat:"d/m/Y",datePickerType:"single",light:!T,maxDate:(new Date).toISOString(),onChange:function(e){var t=q(e,1)[0];return de(t)},value:ge},a().createElement(p.Z,{id:"onsetDateInput",placeholder:"dd/mm/yyyy",labelText:N("dateOfFirstOnset","Date of first onset")}))),a().createElement("div",{className:j.wrapper},a().createElement(u.Z,{className:j.textbox,cols:20,light:!T,id:"comments",invalidText:N("invalidComment","Invalid comment, try again"),labelText:N("comments","Comments"),onChange:function(e){return te(e.target.value)},placeholder:N("typeAdditionalComments","Type any additional comments here"),rows:4})))),a().createElement(y.Z,{className:T?j.tabletButtons:j.desktopButtons},a().createElement(h.Z,{className:j.button,onClick:r,kind:"secondary"},N("discard","Discard")),a().createElement(h.Z,{className:j.button,disabled:!pe||pe===M&&!ie,onClick:xe,kind:"primary"},N("saveAndClose","Save and close")))))}}}]);