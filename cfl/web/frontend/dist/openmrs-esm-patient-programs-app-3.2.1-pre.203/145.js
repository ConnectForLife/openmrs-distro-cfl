"use strict";(self.webpackChunk_openmrs_esm_patient_programs_app=self.webpackChunk_openmrs_esm_patient_programs_app||[]).push([[145],{1951:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(9601),o=r.n(n),a=r(2609),i=r.n(a)()(o());i.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{padding:0;border:0;margin:0;font:inherit;font-size:100%;vertical-align:baseline}button,select,input,textarea{border-radius:0;font-family:inherit}input[type=text]::-ms-clear{display:none}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}body{line-height:1}sup{vertical-align:super}sub{vertical-align:sub}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote::before,blockquote::after,q::before,q::after{content:\"\"}table{border-collapse:collapse;border-spacing:0}*{box-sizing:border-box}button{margin:0}html{font-size:100%}body{font-weight:400;font-family:'IBM Plex Sans', 'Helvetica Neue', Arial, sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}code{font-family:'IBM Plex Mono', 'Menlo', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Courier, monospace}strong{font-weight:600}@media screen and (-ms-high-contrast: active){svg{fill:ButtonText}}h1{font-size:2.625rem;font-weight:300;line-height:1.199;letter-spacing:0}h2{font-size:2rem;font-weight:400;line-height:1.25;letter-spacing:0}h3{font-size:1.75rem;font-weight:400;line-height:1.29;letter-spacing:0}h4{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0}h5{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0}h6{font-size:.875rem;font-weight:600;line-height:1.29;letter-spacing:.16px}p{font-size:1rem;font-weight:400;line-height:1.5;letter-spacing:0}a{color:#0f62fe}em{font-style:italic}@keyframes -esm-patient-programs__programs-form__skeleton____oCAx{0%{opacity:.3;transform:scaleX(0);transform-origin:left}20%{opacity:1;transform:scaleX(1);transform-origin:left}28%{transform:scaleX(1);transform-origin:right}51%{transform:scaleX(0);transform-origin:right}58%{transform:scaleX(0);transform-origin:right}82%{transform:scaleX(1);transform-origin:right}83%{transform:scaleX(1);transform-origin:left}96%{transform:scaleX(0);transform-origin:left}100%{opacity:.3;transform:scaleX(0);transform-origin:left}}.-esm-patient-programs__programs-form__selectContainer___SCnNW{display:flex;align-items:center}.-esm-patient-programs__programs-form__loading___KGmNP{margin-left:1rem;width:2rem;min-height:2.5rem}.-esm-patient-programs__programs-form__button___KPSt9{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-programs__programs-form__tablet___yw5Wr{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-programs__programs-form__desktop___RnK8C{padding:0rem}.-esm-patient-programs__programs-form__formContainer___lqbdm{margin:1rem}.-esm-patient-programs__programs-form__form___BLqPA{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}",""]),i.locals={selectContainer:"-esm-patient-programs__programs-form__selectContainer___SCnNW",loading:"-esm-patient-programs__programs-form__loading___KGmNP",button:"-esm-patient-programs__programs-form__button___KPSt9",tablet:"-esm-patient-programs__programs-form__tablet___yw5Wr",desktop:"-esm-patient-programs__programs-form__desktop___RnK8C",formContainer:"-esm-patient-programs__programs-form__formContainer___lqbdm",form:"-esm-patient-programs__programs-form__form___BLqPA",skeleton:"-esm-patient-programs__programs-form__skeleton____oCAx"};const l=i},8145:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var n=r(9902),o=r.n(n),a=r(3565),i=r.n(a),l=r(3863),s=r(8827),m=r(819),c=r(9857),u=r(4924),d=r(3066),p=r(7898),g=r(786),f=r(2810),b=r(5067),_=r(6642),h=r(182),v=r(6549),y=r(7030),w=r(4076),E=r(321),C=r.n(E),P=r(1195),k=r.n(P),O=r(3275),S=r.n(O),x=r(7162),Z=r.n(x),j=r(2094),T=r.n(j),D=r(757),q=r.n(D),L=r(1951),A={};A.styleTagTransform=q(),A.setAttributes=Z(),A.insert=S().bind(null,"head"),A.domAPI=k(),A.insertStyleElement=T(),C()(L.Z,A);const I=L.Z&&L.Z.locals?L.Z.locals:void 0;function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return N(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const B=function(e){var t,r,n,a,E=e.closeWorkspace,C=e.patientUuid,P=e.programEnrollmentId,k=(0,u.useTranslation)().t,O="tablet"===(0,d.useLayoutType)(),S=(0,d.useSession)(),x=(0,d.useLocations)(),Z=(0,c.kY)().mutate,j=(0,w.oI)().data,T=(0,w.Bw)(C).data,D=P&&T.filter((function(e){return e.uuid==P}))[0],q=D?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){z(e,t,r[t])}))}return e}({display:D.program.name},D.program):null,L=q?[q]:(0,l.Z)(j,(function(e){return!(0,s.Z)((0,m.Z)(T,"program.uuid"),e.uuid)})),A=X(o().useState((null==D?void 0:D.dateCompleted)?(0,d.parseDate)(D.dateCompleted):null),2),N=A[0],B=A[1],V=X(o().useState((null==D?void 0:D.dateEnrolled)?(0,d.parseDate)(D.dateEnrolled):new Date),2),F=V[0],M=V[1],K=X(o().useState(null!==(r=null==D?void 0:D.program.uuid)&&void 0!==r?r:""),2),U=K[0],W=K[1],Y=X(o().useState(null!==(n=null==D?void 0:D.location.uuid)&&void 0!==n?n:""),2),R=Y[0],H=Y[1];!R&&(null==S||null===(t=S.sessionLocation)||void 0===t?void 0:t.uuid)&&H(null==S||null===(a=S.sessionLocation)||void 0===a?void 0:a.uuid);var G=o().useCallback((function(e){if(e.preventDefault(),U){var t={patient:C,program:U,dateEnrolled:F?i()(F).format():null,dateCompleted:N?i()(N).format():null,location:R},r=new AbortController,n=D?(0,w.YX)(D.uuid,t,r).subscribe((function(e){200===e.status&&(E(),(0,d.showToast)({critical:!0,kind:"success",description:k("enrollmentUpdatesNowVisible","Changes to the program are now visible in the Programs table"),title:k("enrollmentUpdated","Program enrollment updated")}),Z("/ws/rest/v1/programenrollment?patient=".concat(C,"&v=").concat(w.o9)))}),(function(e){(0,d.createErrorHandler)(),(0,d.showNotification)({title:k("programEnrollmentSaveError","Error saving program enrollment"),kind:"error",critical:!0,description:null==e?void 0:e.message})})):(0,w.df)(t,r).subscribe((function(e){201===e.status&&(E(),(0,d.showToast)({critical:!0,kind:"success",description:k("enrollmentNowVisible","It is now visible in the Programs table"),title:k("enrollmentSaved","Program enrollment saved")}),Z("/ws/rest/v1/programenrollment?patient=".concat(C,"&v=").concat(w.o9)))}),(function(e){(0,d.createErrorHandler)(),(0,d.showNotification)({title:k("programEnrollmentSaveError","Error saving program enrollment"),kind:"error",critical:!0,description:null==e?void 0:e.message})}));return function(){n.unsubscribe()}}}),[E,N,F,Z,C,U,k,R,D]);return o().createElement(p.Z,{className:I.form,onSubmit:G},o().createElement("div",{className:I.formContainer},o().createElement(g.Z,{style:{width:"50%"},legendText:k("program","Program")},o().createElement("div",{className:I.selectContainer},o().createElement(f.Z,{id:"program",invalidText:k("required","Required"),labelText:"",light:O,onChange:function(e){return W(e.target.value)}},U?null:o().createElement(b.Z,{text:k("chooseProgram","Choose a program"),value:""}),(null==L?void 0:L.length)>0&&L.map((function(e){return o().createElement(b.Z,{key:e.uuid,text:e.display,value:e.uuid},e.display)}))))),o().createElement(g.Z,{legendText:k("dateEnrolled","Date enrolled")},o().createElement(_.Z,{id:"enrollmentDate",datePickerType:"single",dateFormat:"d/m/Y",light:O,maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=X(e,1)[0];return M(t)},value:F},o().createElement(h.Z,{id:"enrollmentDateInput",labelText:""}))),o().createElement(g.Z,{legendText:k("dateCompleted","Date completed")},o().createElement(_.Z,{id:"completionDate",datePickerType:"single",dateFormat:"d/m/Y",light:O,minDate:new Date(F).toISOString(),maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=X(e,1)[0];return B(t)},value:N},o().createElement(h.Z,{id:"completionDateInput",labelText:""}))),o().createElement(g.Z,{style:{width:"50%"},legendText:k("enrollmentLocation","Enrollment location")},o().createElement(f.Z,{id:"location",invalidText:"Required",labelText:"",light:O,onChange:function(e){return H(e.target.value)},value:R},R?null:o().createElement(b.Z,{text:k("chooseLocation","Choose a location"),value:""}),(null==x?void 0:x.length)>0&&x.map((function(e){return o().createElement(b.Z,{key:e.uuid,text:e.display,value:e.uuid},e.display)}))))),o().createElement(v.Z,{className:O?I.tablet:I.desktop},o().createElement(y.Z,{className:I.button,kind:"secondary",onClick:function(){return E()}},k("cancel","Cancel")),o().createElement(y.Z,{className:I.button,kind:"primary",disabled:!U,type:"submit"},k("saveAndClose","Save and close"))))}},4076:(e,t,r)=>{r.d(t,{Bw:()=>u,YX:()=>g,b$:()=>f,df:()=>p,o9:()=>c,oI:()=>d});var n=r(9857),o=r(3066),a=r(4200),i=r(3863),l=r(8827),s=r(819);function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c="custom:(uuid,display,program,dateEnrolled,dateCompleted,location:(uuid,display))";function u(e){var t,r=(0,n.ZP)("/ws/rest/v1/programenrollment?patient=".concat(e,"&v=").concat(c),o.openmrsFetch),i=r.data,l=r.error,s=r.isValidating,m=(null==i||null===(t=i.data)||void 0===t?void 0:t.results.length)>0?null==i?void 0:i.data.results.sort((function(e,t){return t.dateEnrolled>e.dateEnrolled?1:-1})):null,u=null==m?void 0:m.filter((function(e){return!e.dateCompleted}));return{data:i?(0,a.Z)(m,(function(e){var t;return null==e||null===(t=e.program)||void 0===t?void 0:t.uuid})):null,isError:l,isLoading:!i&&!l,isValidating:s,activeEnrollments:u}}function d(e){var t,r,a=(0,n.ZP)("/ws/rest/v1/program?v=custom:(uuid,display,allWorkflows,concept:(uuid,display))",o.openmrsFetch),m=a.data,c=a.error,u=null!==(r=null==m||null===(t=m.data)||void 0===t?void 0:t.results)&&void 0!==r?r:null;return{data:u,isError:c,isLoading:!m&&!c,eligiblePrograms:(0,i.Z)(u,(function(t){return!(0,l.Z)((0,s.Z)(e,"program.uuid"),t.uuid)}))}}function p(e,t){if(!e)return null;var r=e.program,n=e.patient,a=e.dateEnrolled,i=e.dateCompleted,l=e.location;return(0,o.openmrsObservableFetch)("/ws/rest/v1/programenrollment",{method:"POST",headers:{"Content-Type":"application/json"},body:{program:r,patient:n,dateEnrolled:a,dateCompleted:i,location:l},signal:t.signal})}function g(e,t,r){if(!t&&!t.program)return null;t.program;var n=t.dateEnrolled,a=t.dateCompleted,i=t.location;return(0,o.openmrsObservableFetch)("/ws/rest/v1/programenrollment/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:{dateEnrolled:n,dateCompleted:a,location:i},signal:r.signal})}var f=function(e){var t,r,a=(0,o.useConfig)().customUrl,i=u(e),l=i.data,s=i.isError,c=i.isLoading,p=i.isValidating,g=i.activeEnrollments,f=d(l),b=f.data,_=f.eligiblePrograms,h=function(e){var t,r=(0,o.useConfig)().customUrl,a=(0,n.ZP)(r?"".concat(r).concat(e):null,o.openmrsFetch),i=a.data,l=a.error;return{configurablePrograms:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:[],isLoading:!i&&!l,error:l}}(e),v=h.configurablePrograms,y=h.isLoading,w=h.error;return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){m(e,t,r[t])}))}return e}({enrollments:l},a?{isLoading:y,isError:w}:{isLoading:c,isError:s}),r=null!=(r={isValidating:p,activeEnrollments:g,availablePrograms:b,eligiblePrograms:_,configurablePrograms:v})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t}}}]);