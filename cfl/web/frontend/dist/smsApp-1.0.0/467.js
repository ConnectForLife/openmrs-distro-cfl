"use strict";(globalThis.webpackChunksmsApp=globalThis.webpackChunksmsApp||[]).push([[467],{5435:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(2001),o=r.n(n),s=r(935),i=r.n(s)()(o());i.push([e.id,".smsApp__provider-config-test-form__heading___IemLu{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0);margin-bottom:.5rem}.smsApp__provider-config-test-form__columnLabel___s_9FT{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0);color:#525252}.smsApp__provider-config-test-form__radioButtonGroup___q_84c .cds--radio-button-group--vertical{gap:1rem}.smsApp__provider-config-test-form__button___brx4u{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.smsApp__provider-config-test-form__spinner___C8raH{min-height:1rem}.smsApp__provider-config-test-form__tablet___map16{padding:1.5rem 1rem;background-color:#fff}.smsApp__provider-config-test-form__desktop___jZCzZ{padding:0}.smsApp__provider-config-test-form__formContainer___vWt5z{margin:2.5rem 1rem}.smsApp__provider-config-test-form__form___CpyKz{display:flex;flex-direction:column;justify-content:space-between;height:var(--desktop-workspace-window-height)}.smsApp__provider-config-test-form__grid___JbWNI{margin:0;padding:0}.smsApp__provider-config-test-form__row___qVWPE{margin:.5rem 0 2.5rem}.smsApp__provider-config-test-form__errorMessage___BmD3W{font-size:var(--cds-label-02-font-size, 0.875rem);font-weight:var(--cds-label-02-font-weight, 400);line-height:var(--cds-label-02-line-height, 1.28572);letter-spacing:var(--cds-label-02-letter-spacing, 0.16px);color:#da1e28}.omrs-breakpoint-lt-desktop .smsApp__provider-config-test-form__form___CpyKz{height:var(--tablet-workspace-window-height)}.omrs-breakpoint-lt-desktop .smsApp__provider-config-test-form__row___qVWPE{display:flex;gap:4rem}.omrs-breakpoint-lt-desktop .smsApp__provider-config-test-form__row___qVWPE .cds--col-sm-1{flex-basis:30%;min-width:8rem;text-align:left}.omrs-breakpoint-lt-desktop .smsApp__provider-config-test-form__row___qVWPE .cds--col-sm-3{flex-basis:70%}.omrs-breakpoint-lt-desktop .smsApp__provider-config-test-form__skeleton___kREB5{height:2.5rem}.smsApp__provider-config-test-form__errorNotification___LldDJ{margin-top:.25rem}.omrs-breakpoint-gt-tablet .smsApp__provider-config-test-form__row___qVWPE{display:flex;flex-direction:column;gap:1rem}","",{version:3,sources:["webpack://./src/providers/test-form/provider-config-test-form.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss","webpack://./../../node_modules/@carbon/colors/index.scss"],names:[],mappings:"AAIA,oDC81BI,kDAAA,CAAA,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CD51BF,mBAAA,CAGF,wDCy1BI,uDAAA,CAAA,0DAAA,CAAA,4DAAA,CAAA,8DAAA,CDv1BF,aEqCQ,CFjCR,gGACE,QAAA,CAKJ,mDACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,oDACE,eAAA,CAGF,mDACE,mBAAA,CACA,qBAAA,CAGF,oDACE,SAAA,CAIF,0DACE,kBAAA,CAGF,iDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,6CAAA,CAGF,iDACE,QAAA,CACA,SAAA,CAGF,gDACE,qBAAA,CAGF,yDCmyBI,iDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CDjyBF,aEgCO,CF5BP,6EACE,4CAAA,CAGF,4EACE,YAAA,CACA,QAAA,CAEA,2FACE,cAAA,CACA,cAAA,CACA,eAAA,CAGF,2FACE,cAAA,CAIJ,iFACE,aAAA,CAIJ,8DACE,iBAAA,CAIA,2EACE,YAAA,CACA,qBAAA,CACA,QAAA",sourceRoot:""}]),i.locals={heading:"smsApp__provider-config-test-form__heading___IemLu",columnLabel:"smsApp__provider-config-test-form__columnLabel___s_9FT",radioButtonGroup:"smsApp__provider-config-test-form__radioButtonGroup___q_84c",button:"smsApp__provider-config-test-form__button___brx4u",spinner:"smsApp__provider-config-test-form__spinner___C8raH",tablet:"smsApp__provider-config-test-form__tablet___map16",desktop:"smsApp__provider-config-test-form__desktop___jZCzZ",formContainer:"smsApp__provider-config-test-form__formContainer___vWt5z",form:"smsApp__provider-config-test-form__form___CpyKz",grid:"smsApp__provider-config-test-form__grid___JbWNI",row:"smsApp__provider-config-test-form__row___qVWPE",errorMessage:"smsApp__provider-config-test-form__errorMessage___BmD3W",skeleton:"smsApp__provider-config-test-form__skeleton___kREB5",errorNotification:"smsApp__provider-config-test-form__errorNotification___LldDJ"};const a=i},2025:(e,t,r)=>{r.d(t,{Ki:()=>m,ql:()=>c,yD:()=>f,yh:()=>d});var n=r(1083);function o(e,t,r,n,o,s,i){try{var a=e[s](i),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,o)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){o(i,n,s,a,l,"next",e)}function l(e){o(i,n,s,a,l,"throw",e)}a(void 0)}))}}function i(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function a(e){return l.apply(this,arguments)}function l(){return l=s((function(e){var t,r,o=arguments;return i(this,(function(s){switch(s.label){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:new AbortController,[4,(0,n.openmrsFetch)(e,{signal:r.signal,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:return[2,s.sent().data]}}))})),l.apply(this,arguments)}function c(e){return u.apply(this,arguments)}function u(){return(u=s((function(e){return i(this,(function(t){switch(t.label){case 0:return[4,a("/ws/sms/configs",{configs:e})];case 1:return[2,t.sent()]}}))}))).apply(this,arguments)}function m(e){return p.apply(this,arguments)}function p(){return(p=s((function(e){var t,r;return i(this,(function(o){switch(o.label){case 0:return t=new AbortController,(r=new FormData).append("file",e),[4,(0,n.openmrsFetch)("/ws/sms/templates/import",{signal:t.signal,method:"POST",headers:{},body:r})];case 1:return[2,o.sent()]}}))}))).apply(this,arguments)}function f(e){return A.apply(this,arguments)}function A(){return(A=s((function(e){return i(this,(function(t){switch(t.label){case 0:return[4,a("/ws/sms/send",e)];case 1:return[2,t.sent()]}}))}))).apply(this,arguments)}function d(e){return _.apply(this,arguments)}function _(){return(_=s((function(e){return i(this,(function(t){switch(t.label){case 0:return[4,a("/ws/sms/configs",e)];case 1:return[2,t.sent()]}}))}))).apply(this,arguments)}},2765:(e,t,r)=>{r.d(t,{P:()=>a});var n=r(8394),o=r.n(n),s=r(1083);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r,n,a=(0,s.useConfig)().configurationPageSize,l=void 0===a?10:a,c=o()((function(e,t){return t&&!t.rows.length?null:"/ws/sms/log?page=".concat(e+1,"&rows=").concat(l,"&sortColumn=id&sortDirection=desc")}),s.openmrsFetch),u=c.data,m=c.error,p=(c.size,c.setSize),f=c.isValidating,A=c.isLoading,d=c.mutate;return{smsLogs:u?(e=[]).concat.apply(e,(n=u.map((function(e){return e.data.rows})),function(e){if(Array.isArray(e))return i(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())):[],isLoadingLogs:A,isValidatingLogs:f,mutateLogs:d,isReachingEnd:u&&(null===(r=u[u.length-1])||void 0===r||null===(t=r.data)||void 0===t?void 0:t.rows.length)<l,setSize:p,error:m}}},2116:(e,t,r)=>{r.d(t,{L9:()=>c,_5:()=>l,e:()=>u});var n=r(1083),o=r(380);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i={isOverlayOpen:!1,component:Function,header:""},a=function(){return(0,n.getGlobalStore)("providers-store",i)},l=function(e,t){c(),a().setState({isOverlayOpen:!0,component:t,header:e})},c=function(){a().setState({component:null,isOverlayOpen:!1})},u=function(){var e,t,r=(e=(0,o.useState)(),t=2,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,s=[],i=!0,a=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(s.push(n.value),!t||s.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=r[0],i=r[1];return(0,o.useEffect)((function(){var e=function(e){i(e)};e(a().getState()),a().subscribe(e)}),[]),{isOverlayOpen:null==n?void 0:n.isOverlayOpen,component:null==n?void 0:n.component,header:null==n?void 0:n.header}}},3467:(e,t,r)=>{r.r(t),r.d(t,{default:()=>z});var n=r(3373),o=r.n(n),s=r(380),i=r.n(s),a=r(7131),l=r(1083),c=r(3150),u=r(2591),m=r.n(u),p=r(1740),f=r.n(p),A=r(8128),d=r.n(A),_=r(855),g=r.n(_),v=r(3051),h=r.n(v),b=r(3656),y=r.n(b),C=r(5435),w={};w.styleTagTransform=y(),w.setAttributes=g(),w.insert=d().bind(null,"head"),w.domAPI=f(),w.insertStyleElement=h(),m()(C.A,w);const E=C.A&&C.A.locals?C.A.locals:void 0;var k=r(6195),S=r(824),P=r(1160),D=r(2025),O=r(2116),x=r(2765);function T(e,t,r,n,o,s,i){try{var a=e[s](i),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,o)}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){I(e,t,r[t])}))}return e}function B(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var F=k.z.object({deliveryTime:k.z.number(),recipients:k.z.string().refine((function(e){return!e.includes("+")}),{message:'Phone numbers should not contain the "+" sign.'}).refine((function(e){return e.split(",").every((function(e){return e.trim().length>=10}))}),{message:"Each phone number must have at least 10 digits."}).refine((function(e){return e.split(",").every((function(e){return e.trim().length<=15}))}),{message:"Each phone number must have no more than 15 digits."}).refine((function(e){return e.split(",").every((function(e){return/^[0-9\s\-()]+$/.test(e.trim())}))}),{message:"Phone numbers can only contain digits, spaces, hyphens, and parentheses."}),message:k.z.string(),customParams:k.z.string().optional()});const z=function(e){var t,r,n,u=e.providerName,m=(0,c.useTranslation)().t,p=(0,x.P)().mutateLogs,f="tablet"===(0,l.useLayoutType)(),A=(0,S.mN)({mode:"all",resolver:(0,P.u)(F)}),d=A.handleSubmit,_=A.control,g=A.formState.isSubmitting,v=[{key:"immediately",labelText:"Immediately",value:0},{key:"after10secs",labelText:"10s",value:1e4},{key:"after1min",labelText:"1m",value:6e4},{key:"afterOneHour",labelText:"30s",value:36e5}],h=(0,s.useCallback)((t=function(e){var t,r,n,o,s,i,a;return function(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(c){switch(c.label){case 0:return t=e.deliveryTime,r=e.recipients,n=e.message,o=e.customParams,f=t,A=new Date,s=new Date(A.getTime()+f).toISOString(),i=r.split(",").map((function(e){return e.trim()})),a={config:u,deliveryTime:s,recipients:i,message:n,customParams:o},[4,(0,D.yD)(a).then((function(){p(),(0,l.showSnackbar)({title:m("testMessageSent","Message sent"),kind:"success",autoClose:!0})})).catch((function(e){return(0,l.showSnackbar)({title:m("errorSendingMessage","Message not sent"),subtitle:null==e?void 0:e.message,kind:"error"})}))];case 1:return c.sent(),[2]}var f,A}))},r=function(){var e=this,r=arguments;return new Promise((function(n,o){var s=t.apply(e,r);function i(e){T(s,n,o,i,a,"next",e)}function a(e){T(s,n,o,i,a,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)}),[u,p,m]);return i().createElement(a.lVW,{className:E.form,onSubmit:d(h)},i().createElement(a.BJc,{gap:2,className:E.formContainer},i().createElement(a.fI1,{className:E.row},i().createElement(a.VPZ,{sm:1},i().createElement("span",{className:E.columnLabel},m("deliveryTime","Delivery Time"))),i().createElement(a.VPZ,{sm:3},i().createElement(S.xI,{name:"deliveryTime",control:_,render:function(e){var t=e.field,r=e.fieldState.error;return i().createElement(a.zWQ,B(j({},t),{invalid:!!(null==r?void 0:r.message),invalidText:null==r?void 0:r.message,className:E.radioButtonGroup,orientation:"vertical"}),v.map((function(e){return i().createElement(a.aaP,{key:e.key,labelText:e.labelText,value:e.value,id:e.key})})))}}))),i().createElement(a.fI1,{className:E.row},i().createElement(a.VPZ,{sm:1},i().createElement("span",{className:E.columnLabel},m("recipients","Recipient(s)"))),i().createElement(a.VPZ,{sm:3},i().createElement(l.ResponsiveWrapper,null,i().createElement(S.xI,{name:"recipients",control:_,render:function(e){var t=e.field,r=e.fieldState.error;return i().createElement(a.ksK,B(j({},t),{invalid:!!(null==r?void 0:r.message),invalidText:null==r?void 0:r.message,labelText:m("multipleRecipientsNotice","Separate multiple numbers with comma"),placeholder:m("placeHolder","Enter phone +123455690, +09348...")}))}})))),i().createElement(a.fI1,{className:E.row},i().createElement(a.VPZ,{sm:1},i().createElement("span",{className:E.columnLabel},m("message","Message"))),i().createElement(a.VPZ,{sm:3},i().createElement(l.ResponsiveWrapper,null,i().createElement(S.xI,{name:"message",control:_,render:function(e){var t=e.field,r=e.fieldState.error;return i().createElement(a.fs1,B(j({},t),{invalid:!!(null==r?void 0:r.message),invalidText:null==r?void 0:r.message,labelText:m("writeTestMessage","Write your test message"),placeholder:m("writeTestMessage","Write your test message")}))}})))),i().createElement(a.fI1,{className:E.row},i().createElement(l.ResponsiveWrapper,null,i().createElement(a.nD3,null,i().createElement(a.AsP,{title:m("advanced","Advanced")},i().createElement(a.VPZ,{sm:1},i().createElement("span",{className:E.columnLabel},m("customParameters","Custom params (optional)"))),i().createElement(a.VPZ,{sm:3},i().createElement(l.ResponsiveWrapper,null,i().createElement(S.xI,{name:"customParams",control:_,render:function(e){var t=e.field;return i().createElement(a.fs1,B(j({},t),{labelText:m("mapCustomParams","Map custom params in key:value format"),placeholder:m("enterCustomParams","Enter custom parameters. Use new line as separator")}))}})))))))),i().createElement(a.Te$,{className:o()((n={},I(n,E.tablet,f),I(n,E.desktop,!f),n))},i().createElement(a.$nd,{className:E.button,kind:"secondary",onClick:O.L9},m("discard","Discard")),i().createElement(a.$nd,{className:E.button,kind:"primary",type:"submit",disabled:g},g?i().createElement(a.OuH,{description:m("sending","Sending")+"..."}):i().createElement("span",null,m("sendAndClose","Send and close")))))}}}]);