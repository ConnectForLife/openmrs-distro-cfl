"use strict";(globalThis.webpackChunk_openmrs_esm_patient_notes_app=globalThis.webpackChunk_openmrs_esm_patient_notes_app||[]).push([[743],{4431:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(272),r=n.n(a),o=n(2609),i=n.n(o)()(r());i.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-notes__visit-notes-form__heading___wghwA{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0);margin-bottom:.5rem}.-esm-patient-notes__visit-notes-form__columnLabel___TmHhv{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0);color:#525252}.-esm-patient-notes__visit-notes-form__diagnosis___czR8d{padding:1rem .75rem}.-esm-patient-notes__visit-notes-form__diagnosisList___FQwH4{margin-top:.25rem;background-color:#fff;max-height:14rem;overflow-y:auto;border:1px solid #e0e0e0}.-esm-patient-notes__visit-notes-form__diagnosisList___FQwH4 li:hover{background-color:#e0e0e0}.-esm-patient-notes__visit-notes-form__diagnosesText___BCPMx{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px);color:#525252}.-esm-patient-notes__visit-notes-form__emptyResults___FZkoC{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px);margin-top:.25rem;color:#525252;min-height:1rem}.-esm-patient-notes__visit-notes-form__imgUploadHelperText___Kpw1u{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px);color:#525252}.-esm-patient-notes__visit-notes-form__button___IfUcE{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-notes__visit-notes-form__tablet___AGKXz{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-notes__visit-notes-form__desktop___XjbxY{padding:0rem}.-esm-patient-notes__visit-notes-form__headerGridRow___JT9ZC{border-bottom:.0625rem solid #e0e0e0;margin:0}.-esm-patient-notes__visit-notes-form__dataGridRow___ZmeiS{display:grid;grid-template-columns:50% 10% 1fr;margin:.5rem 1rem}.-esm-patient-notes__visit-notes-form__formContainer___J7UTF{margin:1rem}.-esm-patient-notes__visit-notes-form__form___p3e80{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.-esm-patient-notes__visit-notes-form__grid___eScqB{margin:0rem;padding:0rem}.-esm-patient-notes__visit-notes-form__row___wi4CQ{margin:.5rem 0rem 2.75rem}.-esm-patient-notes__visit-notes-form__skeleton___Ia9Qj{margin-top:.25rem;height:2.5rem}.-esm-patient-notes__visit-notes-form__errorMessage___j785L{color:#da1e28}.-esm-patient-notes__visit-notes-form__diagnosisErrorOutline___rEgVA .cds--search-input:focus{outline:2.5px solid #da1e28}.-esm-patient-notes__visit-notes-form__diagnosisErrorOutline___rEgVA .cds--search-magnifier svg{fill:#da1e28}.-esm-patient-notes__visit-notes-form__errorMessage___j785L{font-size:var(--cds-label-02-font-size, 0.875rem);font-weight:var(--cds-label-02-font-weight, 400);line-height:var(--cds-label-02-line-height, 1.28572);letter-spacing:var(--cds-label-02-letter-spacing, 0.16px);color:#da1e28;margin-top:.5rem}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__row___wi4CQ{display:flex;gap:4rem}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__row___wi4CQ .cds--col-sm-1{flex-basis:30%;min-width:8rem;text-align:left}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__row___wi4CQ .cds--col-sm-3{flex-basis:70%}.omrs-breakpoint-gt-tablet .-esm-patient-notes__visit-notes-form__diagnosis___czR8d{padding:.75rem}.omrs-breakpoint-gt-tablet .-esm-patient-notes__visit-notes-form__skeleton___Ia9Qj{margin-top:.25rem;height:2rem}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/notes/visit-notes-form.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCnDF,uDCs0BI,kDAAA,CAAA,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CDp0BF,mBAAA,CAGF,2DCi0BI,uDAAA,CAAA,0DAAA,CAAA,4DAAA,CAAA,8DAAA,CD/zBF,aDNQ,CCSV,yDACE,mBAAA,CAGF,6DACE,iBAAA,CACA,qBDnBM,CCoBN,gBAAA,CACA,eAAA,CACA,wBAAA,CAGF,sEACE,wBDzBM,CC4BR,6DC4yBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CD1yBF,aD3BQ,CC8BV,4DCuyBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CDryBF,iBAAA,CACA,aDjCQ,CCkCR,eAAA,CAGF,mECgyBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CD9xBF,aDvCQ,CC0CV,sDACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,sDACE,mBAAA,CACA,qBDxDM,CC2DR,uDACE,YAAA,CAGF,6DACE,oCAAA,CACA,QAAA,CAGF,2DACE,YAAA,CACA,iCAAA,CACA,iBAAA,CAGF,6DACE,WAAA,CAGF,oDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA,CAGF,oDACE,WAAA,CACA,YAAA,CAGF,mDACE,yBAAA,CAGF,wDACE,iBAAA,CACA,aAAA,CAGF,4DACE,aDjFO,CCqFP,8FACE,2BAAA,CAIA,gGACE,YD3FG,CCgGT,4DCstBI,iDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CDptBF,aDlGO,CCmGP,gBAAA,CAIA,+EACE,YAAA,CACA,QAAA,CAEA,8FACE,cAAA,CACA,cAAA,CACA,eAAA,CAGF,8FACE,cAAA,CAMJ,oFACE,cAAA,CAGF,mFACE,iBAAA,CACA,WAAA",sourceRoot:""}]),i.locals={heading:"-esm-patient-notes__visit-notes-form__heading___wghwA",columnLabel:"-esm-patient-notes__visit-notes-form__columnLabel___TmHhv",diagnosis:"-esm-patient-notes__visit-notes-form__diagnosis___czR8d",diagnosisList:"-esm-patient-notes__visit-notes-form__diagnosisList___FQwH4",diagnosesText:"-esm-patient-notes__visit-notes-form__diagnosesText___BCPMx",emptyResults:"-esm-patient-notes__visit-notes-form__emptyResults___FZkoC",imgUploadHelperText:"-esm-patient-notes__visit-notes-form__imgUploadHelperText___Kpw1u",button:"-esm-patient-notes__visit-notes-form__button___IfUcE",tablet:"-esm-patient-notes__visit-notes-form__tablet___AGKXz",desktop:"-esm-patient-notes__visit-notes-form__desktop___XjbxY",headerGridRow:"-esm-patient-notes__visit-notes-form__headerGridRow___JT9ZC",dataGridRow:"-esm-patient-notes__visit-notes-form__dataGridRow___ZmeiS",formContainer:"-esm-patient-notes__visit-notes-form__formContainer___J7UTF",form:"-esm-patient-notes__visit-notes-form__form___p3e80",grid:"-esm-patient-notes__visit-notes-form__grid___eScqB",row:"-esm-patient-notes__visit-notes-form__row___wi4CQ",skeleton:"-esm-patient-notes__visit-notes-form__skeleton___Ia9Qj",errorMessage:"-esm-patient-notes__visit-notes-form__errorMessage___j785L",diagnosisErrorOutline:"-esm-patient-notes__visit-notes-form__diagnosisErrorOutline___rEgVA"};const s=i},5743:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var a=n(268),r=n.n(a),o=n(3565),i=n.n(o),s=n(4924),l=n(6520),c=n(195),m=n(8883),d=n(3955),u=n(752),A=n(6759),_=n(781),g=n(2870),p=n(3236),f=n(1354),C=n.n(f),h=n(1583),v=n.n(h),y=n(7378),E=n.n(y),b=n(5993),D=n.n(b),w=n(4154),N=n.n(w),S=n(8141),k=n.n(S),B=n(4431),T={};T.styleTagTransform=k(),T.setAttributes=D(),T.insert=E().bind(null,"head"),T.domAPI=v(),T.insertStyleElement=N(),C()(B.Z,T);const F=B.Z&&B.Z.locals?B.Z.locals:void 0;function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);i=!0);}catch(e){s=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,t)||j(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||j(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}var z=c.z.object({noteDate:c.z.date(),primaryDiagnosisSearch:c.z.string({required_error:"Choose at least one primary diagnosis"}),secondaryDiagnosisSearch:c.z.string().optional(),clinicalNote:c.z.string().optional()});const P=function(e){var t,n,o,c=e.closeWorkspace,_=e.patientUuid,f=(0,s.useTranslation)().t,C="tablet"===(0,g.useLayoutType)(),h=(0,g.useSession)(),v=(0,g.useConfig)(),y=(0,a.useMemo)((function(){return{patientUuid:_}}),[_]),E=v.visitNoteConfig,b=E.clinicianEncounterRole,D=E.encounterNoteTextConceptUuid,w=E.encounterTypeUuid,N=E.formConceptUuid,S=I((0,a.useState)(!1),2),k=S[0],B=S[1],T=I((0,a.useState)(!1),2),x=T[0],j=T[1],P=I((0,a.useState)(!1),2),V=P[0],H=P[1],M=I((0,a.useState)([]),2),Q=M[0],U=M[1],Z=I((0,a.useState)([]),2),q=Z[0],X=Z[1],Y=I((0,a.useState)([]),2),W=Y[0],K=Y[1],J=I((0,a.useState)([]),2),$=J[0],ee=J[1],te=I((0,a.useState)([]),2),ne=te[0],ae=te[1],re=I((0,a.useState)(),2),oe=re[0],ie=re[1],se=(0,d.cI)({mode:"onSubmit",resolver:(0,m.F)(z),defaultValues:{noteDate:new Date}}),le=se.control,ce=se.handleSubmit,me=se.watch,de=se.getValues,ue=se.setValue,Ae=se.formState,_e=(0,p.q6)(_).mutateVisitNotes,ge=null==h||null===(t=h.sessionLocation)||void 0===t?void 0:t.uuid,pe=null==h||null===(n=h.currentProvider)||void 0===n?void 0:n.uuid,fe=function(e){var t=me(e);t&&Ce(t,e)},Ce=(0,a.useMemo)((function(){return(0,l.Z)((function(e,t){if(e){"primaryDiagnosisSearch"===t?j(!0):"secondaryDiagnosisSearch"===t&&H(!0);var n=(0,p.Ti)(e).subscribe((function(e){"primaryDiagnosisSearch"==t?(K(e),j(!1)):"secondaryDiagnosisSearch"==t&&(ee(e),H(!1))}),(function(){return(0,g.createErrorHandler)()}));return function(){n.unsubscribe()}}}),500)}),[]),he=function(e,t){var n=ye(e);"primaryDiagnosisSearch"==t?(n.rank=1,ue("primaryDiagnosisSearch",""),K([]),U((function(e){return R(e).concat([n])}))):"secondaryDiagnosisSearch"==t&&(ue("secondaryDiagnosisSearch",""),ee([]),X((function(e){return R(e).concat([n])}))),ae((function(e){return R(e).concat([n])}))},ve=function(e,t){"primaryInputSearch"==t?U(Q.filter((function(t){return t.diagnosis.coded!==e.diagnosis.coded}))):"secondaryInputSearch"==t&&X(q.filter((function(t){return t.diagnosis.coded!==e.diagnosis.coded}))),ae(ne.filter((function(t){return t.diagnosis.coded!==e.diagnosis.coded})))},ye=function(e){return{patient:_,diagnosis:{coded:e.uuid},rank:2,certainty:"PROVISIONAL",display:e.display}},Ee=(0,a.useCallback)((function(e,t){var n=e.noteDate,a=e.clinicalNote;if(B(!0),Q.length){var r={encounterDatetime:i()(n).format(),form:N,patient:_,location:ge,encounterProviders:[{encounterRole:b,provider:pe}],encounterType:w,obs:a?[{concept:{uuid:D,display:""},value:a}]:[]},o=new AbortController;(0,p.aH)(o,r).then((function(e){if(201===e.status)return Promise.all(ne.map((function(t,n){var a={encounter:e.data.uuid,patient:_,condition:null,diagnosis:{coded:t.diagnosis.coded},certainty:t.certainty,rank:t.rank};return(0,p.BH)(o,a)})))})).then((function(){_e(),c(),(0,g.showToast)({critical:!0,description:f("visitNoteNowVisible","It is now visible on the Encounters page"),kind:"success",title:f("visitNoteSaved","Visit note saved")})})).catch((function(e){(0,g.createErrorHandler)(),(0,g.showNotification)({title:f("visitNoteSaveError","Error saving visit note"),kind:"error",critical:!0,description:null==e?void 0:e.message})})).finally((function(){B(!1),o.abort()}))}else B(!1)}),[Q.length,N,_,ge,b,pe,w,D,ne,_e,c,f]);return r().createElement(u.l09,{className:F.form,onSubmit:ce(Ee,(function(e){return console.error(e)}))},C&&r().createElement(u.X2j,{className:F.headerGridRow},r().createElement(g.ExtensionSlot,{name:"visit-form-header-slot",className:F.dataGridRow,state:y})),r().createElement(u.Kqy,{className:F.formContainer,gap:2},C?r().createElement("h2",{className:F.heading},f("addVisitNote","Add a visit note")):null,r().createElement(u.X2j,{className:F.row},r().createElement(u.sgG,{sm:1},r().createElement("span",{className:F.columnLabel},f("date","Date"))),r().createElement(u.sgG,{sm:3},r().createElement(d.Qr,{name:"noteDate",control:le,render:function(e){var t=e.field,n=t.onChange,a=t.value;return r().createElement(O,{isTablet:C},r().createElement(u.Mtg,{dateFormat:"d/m/Y",datePickerType:"single",maxDate:(new Date).toISOString(),value:a,onChange:function(e){var t=I(e,1)[0];return n(t)}},r().createElement(u.aj6,{id:"visitDateTimePicker",labelText:f("visitDate","Visit date"),placeholder:"dd/mm/yyyy"})))}}))),r().createElement(u.X2j,{className:F.row},r().createElement(u.sgG,{sm:1},r().createElement("span",{className:F.columnLabel},f("primaryDiagnosis","Primary diagnosis"))),r().createElement(u.sgG,{sm:3},r().createElement("div",{className:F.diagnosesText,style:{marginBottom:"1.188rem"}},Q&&Q.length?r().createElement(r().Fragment,null,Q.map((function(e,t){return r().createElement(u.Vp9,{filter:!0,key:t,onClose:function(){return ve(e,"primaryInputSearch")},style:{marginRight:"0.5rem"},type:"red"},e.display)}))):r().createElement(r().Fragment,null),q&&q.length?r().createElement(r().Fragment,null,q.map((function(e,t){return r().createElement(u.Vp9,{filter:!0,key:t,onClose:function(){return ve(e,"secondaryInputSearch")},style:{marginRight:"0.5rem"},type:"blue"},e.display)}))):r().createElement(r().Fragment,null),Q&&!Q.length&&q&&!q.length&&r().createElement("span",null,f("emptyDiagnosisText","No diagnosis selected — Enter a diagnosis below"))),r().createElement(u.cwH,{legendText:f("searchForPrimaryDiagnosis","Search for a primary diagnosis")},r().createElement(L,{name:"primaryDiagnosisSearch",control:le,labelText:f("enterPrimaryDiagnoses","Enter Primary diagnoses"),placeholder:f("primaryDiagnosisInputPlaceholder","Choose a primary diagnosis"),handleSearch:fe,error:null==Ae||null===(o=Ae.errors)||void 0===o?void 0:o.primaryDiagnosisSearch}),r().createElement("div",null,de("primaryDiagnosisSearch")?x?r().createElement(r().Fragment,null,r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton})):!x&&W&&W.length>0?r().createElement("ul",{className:F.diagnosisList},W.map((function(e,t){return r().createElement("li",{role:"menuitem",className:F.diagnosis,key:t,onClick:function(){return he(e,"primaryDiagnosisSearch")}},e.display)}))):r().createElement(r().Fragment,null,C?r().createElement(u.mh4,null,r().createElement(u.n9L,{className:F.emptyResults},r().createElement("span",null,f("noMatchingDiagnoses","No diagnoses found matching")," ",r().createElement("strong",null,'"',me("primaryDiagnosisSearch"),'"')))):r().createElement(u.n9L,{className:F.emptyResults},r().createElement("span",null,f("noMatchingDiagnoses","No diagnoses found matching")," ",r().createElement("strong",null,'"',me("primaryDiagnosisSearch"),'"')))):null)))),r().createElement(u.X2j,{className:F.row},r().createElement(u.sgG,{sm:1},r().createElement("span",{className:F.columnLabel},f("secondaryDiagnosis","Secondary diagnosis"))),r().createElement(u.sgG,{sm:3},r().createElement(u.cwH,{legendText:f("searchForSecondaryDiagnosis","Search for a secondary diagnosis")},r().createElement(L,{name:"secondaryDiagnosisSearch",control:le,labelText:f("enterSecondaryDiagnoses","Enter Secondary diagnoses"),placeholder:f("secondaryDiagnosisInputPlaceholder","Choose a secondary diagnosis"),handleSearch:fe}),r().createElement("div",null,de("secondaryDiagnosisSearch")?V?r().createElement(r().Fragment,null,r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton}),r().createElement(u.N2B,{className:F.skeleton})):!V&&$&&$.length>0?r().createElement("ul",{className:F.diagnosisList},$.map((function(e,t){return r().createElement("li",{role:"menuitem",className:F.diagnosis,key:t,onClick:function(){return he(e,"secondaryDiagnosisSearch")}},e.display)}))):r().createElement(O,{isTablet:C},r().createElement(u.n9L,{className:F.emptyResults},r().createElement("span",null,f("noMatchingDiagnoses","No diagnoses found matching")," ",r().createElement("strong",null,'"',me("secondaryDiagnosisSearch"),'"')))):null)))),r().createElement(u.X2j,{className:F.row},r().createElement(u.sgG,{sm:1},r().createElement("span",{className:F.columnLabel},f("note","Note"))),r().createElement(u.sgG,{sm:3},r().createElement(d.Qr,{name:"clinicalNote",control:le,render:function(e){var t=e.field,n=t.onChange,a=t.onBlur,o=t.value;return r().createElement(O,{isTablet:C},r().createElement(u.Kx8,{id:"additionalNote",rows:oe,labelText:f("clinicalNoteLabel","Write your notes"),placeholder:f("clinicalNotePlaceholder","Write any notes here"),value:o,onBlur:a,onChange:function(e){n(e);var t=Math.ceil(e.target.scrollHeight/24);ie(t)}}))}}))),r().createElement(u.X2j,{className:F.row},r().createElement(u.sgG,{sm:1},r().createElement("span",{className:F.columnLabel},f("image","Image"))),r().createElement(u.sgG,{sm:3},r().createElement(u.cwH,{legendText:f("addImageToVisit","Add an image to this visit")},r().createElement("p",{className:F.imgUploadHelperText},f("imageUploadHelperText","Upload an image or use this device's camera to capture an image")),r().createElement(u.zxk,{style:{marginTop:"1rem"},kind:C?"ghost":"tertiary",onClick:function(){},renderIcon:function(e){return r().createElement(A.mm,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){G(e,t,n[t])}))}return e}({size:16},e))}},f("addImage","Add image")))))),r().createElement(u.uVA,{className:C?F.tablet:F.desktop},r().createElement(u.zxk,{className:F.button,kind:"secondary",onClick:function(){return c()}},f("discard","Discard")),r().createElement(u.zxk,{className:F.button,kind:"primary",onClick:ce,disabled:k,type:"submit"},f("saveAndClose","Save and close"))))};function L(e){var t=e.name,n=e.control,o=e.labelText,i=e.placeholder,s=e.handleSearch,l=e.error,c="tablet"===(0,g.useLayoutType)(),m=(0,a.useRef)(null);return(0,a.useEffect)((function(){l&&m.current.focus()}),[l]),r().createElement(d.Qr,{name:t,control:n,render:function(e){var n,a=e.field,d=a.value,A=a.onChange,g=a.onBlur,p=e.fieldState;return r().createElement(r().Fragment,null,r().createElement(O,{isTablet:c},r().createElement(u.olm,{ref:m,size:c?"lg":"md",id:t,labelText:o,className:l&&F.diagnosisErrorOutline,placeholder:i,renderIcon:l&&r().createElement(_.Rr,{fill:"red"}),onChange:function(e){A(e),s(t)},value:d,onBlur:g})),r().createElement("p",{className:F.errorMessage},null==p||null===(n=p.error)||void 0===n?void 0:n.message))}})}function O(e){var t=e.children;return e.isTablet?r().createElement(u.mh4,null,t," "):r().createElement(r().Fragment,null,t)}},3236:(e,t,n)=>{n.d(t,{BH:()=>c,Ti:()=>s,aH:()=>l,q6:()=>i});var a=n(3255),r=n(4623),o=n(2870);function i(e){var t,n,r,i=(0,o.useConfig)().visitNoteConfig,s=i.encounterNoteTextConceptUuid,l=i.visitDiagnosesConceptUuid,c="/ws/rest/v1/encounter?patient=".concat(e,"&obs=").concat(l,"&v=").concat("custom:(uuid,display,encounterDatetime,patient,obs,encounterProviders:(uuid,display,encounterRole:(uuid,display),provider:(uuid,person:(uuid,display))),diagnoses"),m=(0,a.ZP)(c,o.openmrsFetch),d=m.data,u=m.error,A=m.isLoading,_=m.isValidating,g=m.mutate,p=null==d||null===(r=d.data)||void 0===r||null===(n=r.results)||void 0===n||null===(t=n.map((function(e,t){var n,a,r,o,i,l,c;return{id:"".concat(t),diagnoses:e.diagnoses.map((function(e){return e.display})).filter((function(e){return e})).join(", "),encounterDate:e.encounterDatetime,encounterNote:null===(n=e.obs.find((function(e){return e.concept.uuid===s})))||void 0===n?void 0:n.value,encounterNoteRecordedAt:null===(a=e.obs.find((function(e){return e.concept.uuid===s})))||void 0===a?void 0:a.obsDatetime,encounterProvider:null==e||null===(i=e.encounterProviders[0])||void 0===i||null===(o=i.provider)||void 0===o||null===(r=o.person)||void 0===r?void 0:r.display,encounterProviderRole:null==e||null===(c=e.encounterProviders[0])||void 0===c||null===(l=c.encounterRole)||void 0===l?void 0:l.display}})))||void 0===t?void 0:t.sort((function(e,t){return new Date(t.encounterDate).getTime()-new Date(e.encounterDate).getTime()}));return{visitNotes:d?p:null,isError:u,isLoading:A,isValidating:_,mutateVisitNotes:g}}function s(e){return(0,o.openmrsObservableFetch)("/ws/rest/v1/concept?q=".concat(e,"&searchType=fuzzy&class=8d4918b0-c2cc-11de-8d13-0010c6dffd0f&q=&v=custom:(uuid,display)")).pipe((0,r.U)((function(e){return e.data.results})))}function l(e,t){return(0,o.openmrsFetch)("/ws/rest/v1/encounter",{headers:{"Content-Type":"application/json"},method:"POST",body:t,signal:e.signal})}function c(e,t){return(0,o.openmrsFetch)("/ws/rest/v1/patientdiagnoses",{headers:{"Content-Type":"application/json"},method:"POST",body:t})}}}]);