"use strict";(globalThis.webpackChunkmessagesApp=globalThis.webpackChunkmessagesApp||[]).push([[977],{7306:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(2001),n=s.n(a),r=s(935),o=s.n(r)()(n());o.push([e.id,':root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79;--bottom-nav-height: 4rem;--workspace-header-height: 3rem;--tablet-workspace-window-height: calc(100vh - var(--omrs-navbar-height));--desktop-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--workspace-header-height))}.messagesApp__messages-settings-dashboard__heading___tiGsD{font-size:var(--cds-productive-heading-02-font-size, 1rem);font-weight:var(--cds-productive-heading-02-font-weight, 600);line-height:var(--cds-productive-heading-02-line-height, 1.375);letter-spacing:var(--cds-productive-heading-02-letter-spacing, 0);color:#525252;margin-bottom:1rem}.messagesApp__messages-settings-dashboard__heading___tiGsD:after{content:"";display:block;width:2rem;padding-top:.188rem;border-bottom:.375rem solid var(--brand-03)}.messagesApp__messages-settings-dashboard__mainContainer___xJYX1{background:#f4f4f4;display:flex;justify-content:center;padding-top:4rem}.messagesApp__messages-settings-dashboard__title___io935{padding:1rem;font-size:2rem}.messagesApp__messages-settings-dashboard__desktopContainer___wcQVP{width:80%}.messagesApp__messages-settings-dashboard__tabletContainer___cEu3i{width:90%}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--tab-content{width:60%;padding:50px}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--inline-loading__text{color:#fff}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--tab--list{flex-direction:column;margin:1rem}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--tabs{width:auto;max-height:100%}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--tabs .cds--tabs__nav-link{border-bottom:0;border-left:3px solid #e0e0e0;min-height:50px}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--tabs .cds--tabs__nav-item--selected{border-left:3px solid var(--brand-03);border-bottom:0;font-weight:600}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--number{width:68%}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--tabs__nav-link:active,.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--tabs__nav-link:focus{outline:0 !important;outline-offset:0 !important}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--multi-select__wrapper .cds--list-box__wrapper{width:90% !important}.messagesApp__messages-settings-dashboard__messagesContent___oWdW3 .cds--col{padding-left:0;width:100%}.messagesApp__messages-settings-dashboard__tabletTab___BneuR{width:25%}.messagesApp__messages-settings-dashboard__desktopTab___Sy3Up{width:20%}.messagesApp__messages-settings-dashboard__tab___vgnoM{display:flex}.messagesApp__messages-settings-dashboard__tabContainer___hL0q5{background:#fff;padding-left:1.5rem;padding-right:1rem;padding-top:1rem;margin-bottom:1rem}.messagesApp__messages-settings-dashboard__optionCell___uhSRk{padding:0 !important}.messagesApp__messages-settings-dashboard__optionHeader___Xz1a8{width:1.5rem !important}.messagesApp__messages-settings-dashboard__text___H3V2o{font-size:.9rem;padding:.5rem}',"",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/messages/messages-settings-dashboard.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CACA,yBAAA,CACA,+BAAA,CACA,yEAAA,CACA,2GAAA,CCqBF,2DCkxBI,0DAAA,CAAA,6DAAA,CAAA,+DAAA,CAAA,iEAAA,CDhxBF,aD7EQ,CC8ER,kBEpDW,CFuDb,iEACE,UAAA,CACA,aAAA,CACA,UAAA,CACA,mBAAA,CACA,2CAAA,CAGF,iEACE,kBD/FM,CCgGN,YAAA,CACA,sBAAA,CACA,gBAAA,CAGF,yDACE,YAAA,CACA,cAAA,CAGF,oEACE,SAAA,CAGF,mEACE,SAAA,CAIA,qFACE,SAAA,CACA,YAAA,CAGF,8FACE,UAAA,CAGF,mFACE,qBAAA,CACA,WAAA,CAGF,8EACE,UAAA,CACA,eAAA,CAGF,mGACE,eAAA,CACA,6BAAA,CACA,eAAA,CAGF,6GACE,qCAAA,CACA,eAAA,CACA,eAAA,CAGF,gFACE,SAAA,CAIA,6LACE,oBAAA,CACA,2BAAA,CAIJ,uHACE,oBAAA,CAGF,6EACE,cAAA,CACA,UAAA,CAIJ,6DACE,SAAA,CAGF,8DACE,SAAA,CAGF,uDACE,YAAA,CAGF,gEACE,eAAA,CACA,mBAAA,CACA,kBAAA,CACA,gBAAA,CACA,kBAAA,CAGF,8DACE,oBAAA,CAGF,gEACE,uBAAA,CAGF,wDACC,eAAA,CACA,aAAA",sourceRoot:""}]),o.locals={heading:"messagesApp__messages-settings-dashboard__heading___tiGsD",mainContainer:"messagesApp__messages-settings-dashboard__mainContainer___xJYX1",title:"messagesApp__messages-settings-dashboard__title___io935",desktopContainer:"messagesApp__messages-settings-dashboard__desktopContainer___wcQVP",tabletContainer:"messagesApp__messages-settings-dashboard__tabletContainer___cEu3i",messagesContent:"messagesApp__messages-settings-dashboard__messagesContent___oWdW3",tabletTab:"messagesApp__messages-settings-dashboard__tabletTab___BneuR",desktopTab:"messagesApp__messages-settings-dashboard__desktopTab___Sy3Up",tab:"messagesApp__messages-settings-dashboard__tab___vgnoM",tabContainer:"messagesApp__messages-settings-dashboard__tabContainer___hL0q5",optionCell:"messagesApp__messages-settings-dashboard__optionCell___uhSRk",optionHeader:"messagesApp__messages-settings-dashboard__optionHeader___Xz1a8",text:"messagesApp__messages-settings-dashboard__text___H3V2o"};const i=o},2311:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(2001),n=s.n(a),r=s(935),o=s.n(r)()(n());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79;--bottom-nav-height: 4rem;--workspace-header-height: 3rem;--tablet-workspace-window-height: calc(100vh - var(--omrs-navbar-height));--desktop-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--workspace-header-height))}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CACA,yBAAA,CACA,+BAAA,CACA,yEAAA,CACA,2GAAA",sourceRoot:""}]),o.locals={};const i=o},8398:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(2001),n=s.n(a),r=s(935),o=s.n(r)()(n());o.push([e.id,".messagesApp__template-field__row___qNDiv{margin:.5rem 0 2.5rem}","",{version:3,sources:["webpack://./src/messages/template-field/template-field.scss"],names:[],mappings:"AAAA,0CACE,qBAAA",sourceRoot:""}]),o.locals={row:"messagesApp__template-field__row___qNDiv"};const i=o},9050:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Z});var a=s(380),n=s.n(a),r=s(2814),o=s(3373),i=s.n(o),l=s(3150),d=s(2591),A=s.n(d),c=s(1740),m=s.n(c),u=s(8128),p=s.n(u),_=s(855),g=s.n(_),b=s(3051),f=s.n(b),h=s(3656),C=s.n(h),y=s(7306),v={};v.styleTagTransform=C(),v.setAttributes=g(),v.insert=p().bind(null,"head"),v.domAPI=m(),v.insertStyleElement=f(),A()(y.A,v);const E=y.A&&y.A.locals?y.A.locals:void 0;var w=s(1123),k=s(1083),T=s(824),S=[{id:"MONDAY",label:"Monday",labelCode:"monday",order:0},{id:"TUESDAY",label:"Tuesday",labelCode:"tuesday",order:1},{id:"WEDNESDAY",label:"Wednesday",labelCode:"wednesday",order:2},{id:"THURSDAY",label:"Thursday",labelCode:"thursday",order:3},{id:"FRIDAY",label:"Friday",labelCode:"friday",order:4},{id:"SATURDAY",label:"Saturday",labelCode:"saturday",order:5},{id:"SUNDAY",label:"Sunday",labelCode:"sunday",order:6}],O=s(8398),F={};F.styleTagTransform=C(),F.setAttributes=g(),F.insert=p().bind(null,"head"),F.domAPI=m(),F.insertStyleElement=f(),A()(O.A,F);const D=O.A&&O.A.locals?O.A.locals:void 0;function P(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function x(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},a=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(s).filter((function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})))),a.forEach((function(t){P(e,t,s[t])}))}return e}function j(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s.push.apply(s,a)}return s}(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})),e}const W=function(e){var t=e.field,s=e.templateUuid,a=(0,l.useTranslation)().t,o=(k.useConfig,(0,T.xW)()),i=o.control,d=o.getValues,A=t.name,c=(t.mandatory,t.defaultValue),m=t.possibleValues,u=t.type;return n().createElement("div",null,n().createElement(r.fI1,{className:D.row},n().createElement(r.VPZ,null,n().createElement(T.xI,{name:"dynamicFields.".concat(s,".fields.").concat(u),control:i,defaultValue:c,render:function(e){return function(e){var t,o=[{key:"after-7-times",value:"AFTER_TIMES|7",label:a("afterSevenTimes","After 7 times")}];switch(u){case"END_OF_MESSAGES":return n().createElement(r.l6P,j(x({},e),{labelText:a("selectTemplate","Choose when to end message")}),n().createElement(r.ebT,{value:"NO_DATE|EMPTY",text:a("noRepeat","Not specified")}),o.map((function(e){return n().createElement(r.ebT,{key:e.key,value:e.value,text:e.label})})));case"number":return n().createElement(r.Q7x,j(x({},e),{id:A,labelText:A}));case"DAY_OF_WEEK":return n().createElement(r.KFt,{label:a("selectDayOfWeek","Select days of message delivery"),id:"daysOfWeek",titleText:A,items:S,itemToString:function(e){return e?a(e.labelCode,e.label):""},selectionFeedback:"top-after-reopen",sortItems:function(e){return e.sort((function(e,t){return e.order>t.order}))},initialSelectedItems:(t=d("dynamicFields.".concat(s,".fields.").concat(u)).split(","),S.filter((function(e){return t&&t.includes(e.label)}))),onChange:function(t){var s=t.selectedItems.map((function(e){return e.label})).join(",");e.onChange(s)}});case"SERVICE_TYPE":return n().createElement(r.zWQ,x({legendText:A,defaultSelected:d("dynamicFields.".concat(s,".fields.").concat(u)),onChange:function(t){return e.onChange(t)}},e),m.map((function(e){return n().createElement(r.aaP,{key:e,labelText:e,value:e})})));default:a("noFieldsSet","No fields set yet")}}(e.field)}}))))};var B=s(2311),G={};G.styleTagTransform=C(),G.setAttributes=g(),G.insert=p().bind(null,"head"),G.domAPI=m(),G.insertStyleElement=f(),A()(B.A,G);const N=B.A&&B.A.locals?B.A.locals:void 0,Y=function(e){var t=e.template,s=(0,l.useTranslation)().t,a=t.templateFields,r=t.uuid;return a&&0!==a.length?n().createElement("div",{className:N.layer},a.map((function(e){return n().createElement(W,{key:e.uuid,field:e,templateUuid:r})}))):n().createElement("div",null,s("noFieldsSet","No fields set yet"))};var I=s(1160),U=s(6195);function V(e,t,s,a,n,r,o){try{var i=e[r](o),l=i.value}catch(e){return void s(e)}i.done?t(l):Promise.resolve(l).then(a,n)}function R(e){return function(){var t=this,s=arguments;return new Promise((function(a,n){var r=e.apply(t,s);function o(e){V(r,a,n,o,i,"next",e)}function i(e){V(r,a,n,o,i,"throw",e)}o(void 0)}))}}function M(e,t){var s,a,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(r){return function(i){return function(r){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{s=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,i])}}}function q(e){return z.apply(this,arguments)}function z(){return z=R((function(e){var t,s,a=arguments;return M(this,(function(n){switch(n.label){case 0:return t=a.length>1&&void 0!==a[1]?a[1]:{},s=a.length>2&&void 0!==a[2]?a[2]:new AbortController,[4,(0,k.openmrsFetch)(e,{signal:s.signal,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:return[2,n.sent().data]}}))})),z.apply(this,arguments)}function H(e){return L.apply(this,arguments)}function L(){return(L=R((function(e){return M(this,(function(t){switch(t.label){case 0:return[4,q("/ws/rest/v1/messages/templates",e)];case 1:return[2,t.sent()]}}))}))).apply(this,arguments)}function J(e,t,s,a,n,r,o){try{var i=e[r](o),l=i.value}catch(e){return void s(e)}i.done?t(l):Promise.resolve(l).then(a,n)}function K(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Q(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},a=Object.keys(s);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(s).filter((function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})))),a.forEach((function(t){K(e,t,s[t])}))}return e}function X(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s.push.apply(s,a)}return s}(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})),e}var $=U.Ik({dynamicFields:U.g1(U.Yj(),U.Ik({fields:U.g1(U.Yj(),U.KC([U.Yj(),U.ai(),U.YO(U.Yj())]))}))});const Z=function(){var e,t,s,o=(0,l.useTranslation)().t,d="tablet"===(0,k.useLayoutType)(),A=(0,T.mN)({resolver:(0,I.u)($)}),c=A.setValue,m=A.handleSubmit,u=function(){var e,t,s=(0,w.Ay)("/ws/messages/templates",k.openmrsFetch),a=s.data,n=s.isLoading,r=s.isValidating,o=s.mutate,i=s.error;return{messagesTemplates:null!==(t=null==a||null===(e=a.data)||void 0===e?void 0:e.content)&&void 0!==t?t:[],isLoadingTemplates:n,isValidatingTemplates:r,mutateTemplates:o,error:i}}(),p=(u.mutateTemplates,u.messagesTemplates),_=u.isLoadingTemplates,g=u.error,b=(e=function(e){return function(e,t){var s,a,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(r){return function(i){return function(r){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{s=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,i])}}}(this,(function(t){switch(t.label){case 0:return[4,H({templates:p.map((function(t){if(e.dynamicFields[t.uuid]){var s=t.templateFields.map((function(s){return X(Q({},s),{defaultValue:e.dynamicFields[t.uuid].fields[s.type]||s.defaultValue})}));return X(Q({},t),{templateFields:s})}return t}))}).then((function(){return(0,k.showSnackbar)({title:o("templatesUpdated","Default setting updated"),kind:"success"})})).catch((function(){return(0,k.showSnackbar)({title:o("templatesNotUpdated","Error updating templates"),kind:"error"})}))];case 1:return[2,t.sent()]}}))},t=function(){var t=this,s=arguments;return new Promise((function(a,n){var r=e.apply(t,s);function o(e){J(r,a,n,o,i,"next",e)}function i(e){J(r,a,n,o,i,"throw",e)}o(void 0)}))},function(e){return t.apply(this,arguments)});return(0,a.useEffect)((function(){p.length>0&&p.forEach((function(e){e.templateFields.forEach((function(t){c("dynamicFields.".concat(e.uuid,".fields.").concat(t.type),t.defaultValue)}))}))}),[p,c]),n().createElement(T.Op,A,n().createElement("form",{onSubmit:m(b,(function(e){return console.error(e)}))},n().createElement("div",{className:i()("omrs-main-content",E.mainContainer,E.messagesContent)},n().createElement("div",{className:i()(d?E.tabletContainer:E.desktopContainer)},n().createElement("p",{className:E.title},o("messagesSettings","Messages Settings")),n().createElement("div",{className:E.tabContainer},n().createElement("p",{className:E.heading},o("defaultPatientMessagesSettings","Default Patient messages settings")),n().createElement("div",{className:E.tab},_?n().createElement("div",{style:{maxWidth:"100%"}},n().createElement(r.ciU,null)):n().createElement(r.tUM,{className:i()(E.verticalTabs,(s={},K(s,E.tabletTab,d),K(s,E.desktopTab,!d),s))},n().createElement(r.wbY,null,p.map((function(e){return n().createElement(r.ozo,{id:e.uuid,key:e.uuid},e.name)}))),n().createElement(r.T2N,null,p.map((function(e){return n().createElement(r.KpK,{key:e.uuid},n().createElement(Y,{template:e}))})))),g&&n().createElement(k.ErrorState,{headerTitle:"Error",error:g}))),n().createElement(r.Te$,null,n().createElement(r.$nd,{kind:"secondary"},o("cancel","Cancel")),n().createElement(r.$nd,{kind:"primary",type:"submit"},o("save","Save")))))))}}}]);