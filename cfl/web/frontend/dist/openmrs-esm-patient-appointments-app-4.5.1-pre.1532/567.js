(globalThis.webpackChunk_openmrs_esm_patient_appointments_app=globalThis.webpackChunk_openmrs_esm_patient_appointments_app||[]).push([[567],{91:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var a=n(272),o=n.n(a),r=n(2609),i=n.n(r)()(o());i.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-appointments__appointments-form__productiveHeading02___S5ObD,.-esm-patient-appointments__appointments-form__formGroup____z34z span{color:#525252;font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0)}.-esm-patient-appointments__appointments-form__formWrapper___B5Ml8{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formWrapper___B5Ml8{background-color:#ededed}.omrs-breakpoint-gt-tablet .-esm-patient-appointments__appointments-form__formWrapper___B5Ml8{background-color:#fff}.-esm-patient-appointments__appointments-form__formGroup____z34z{display:flex;margin-bottom:.25rem;padding:1rem}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formGroup____z34z>span{flex:1}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formGroup____z34z>div{flex:3}.-esm-patient-appointments__appointments-form__formGroup____z34z span{margin-bottom:.5rem}.-esm-patient-appointments__appointments-form__datePickerControl___KSGnN{display:flex}.omrs-breakpoint-lt-desktop .-esm-patient-appointments__appointments-form__formGroup____z34z{flex-direction:row}.omrs-breakpoint-gt-tablet .-esm-patient-appointments__appointments-form__formGroup____z34z{flex-direction:column}.-esm-patient-appointments__appointments-form__button___ctdIv{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-appointments__appointments-form__loader___jpjQj{display:flex;background-color:#ededed;justify-content:center;min-height:3rem;height:100vh}.-esm-patient-appointments__appointments-form__tablet____bsp1{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-appointments__appointments-form__desktop___gPUA_{padding:0rem}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/appointments/appointments-form.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCnDF,iJACE,aDIc,CEi0BZ,uDAAA,CAAA,0DAAA,CAAA,4DAAA,CAAA,8DAAA,CD/zBJ,mEACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA,CAGF,+FACE,wBAVwB,CAa1B,8FACE,qBDtBM,CCyBR,iEACE,YAAA,CACA,oBEZW,CFaX,YEEW,CFCb,kGACE,MAAA,CAGF,iGACE,MAAA,CAGF,sEAEE,mBErBW,CFwBb,yEACE,YAAA,CAGF,6FACE,kBAAA,CAGF,4FACE,qBAAA,CAGF,8DACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,8DACE,YAAA,CACA,wBA1DwB,CA2DxB,sBAAA,CACA,eElBW,CFmBX,YAAA,CAGF,8DACE,mBAAA,CACA,qBD1EM,CC6ER,+DACE,YAAA",sourceRoot:""}]),i.locals={productiveHeading02:"-esm-patient-appointments__appointments-form__productiveHeading02___S5ObD",formGroup:"-esm-patient-appointments__appointments-form__formGroup____z34z",formWrapper:"-esm-patient-appointments__appointments-form__formWrapper___B5Ml8",datePickerControl:"-esm-patient-appointments__appointments-form__datePickerControl___KSGnN",button:"-esm-patient-appointments__appointments-form__button___ctdIv",loader:"-esm-patient-appointments__appointments-form__loader___jpjQj",tablet:"-esm-patient-appointments__appointments-form__tablet____bsp1",desktop:"-esm-patient-appointments__appointments-form__desktop___gPUA_"};const s=i},2609:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var p=0;p<e.length;p++){var c=[].concat(e[p]);a&&i[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},272:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),r="/*# ".concat(o," */"),i=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(i).concat([r]).join("\n")}return[t].join("\n")}},6824:function(e){e.exports=function(){"use strict";return function(e,t,n){t.prototype.isToday=function(){var e="YYYY-MM-DD",t=n();return this.format(e)===t.format(e)}}}()},1354:e=>{"use strict";var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var r={},i=[],s=0;s<e.length;s++){var l=e[s],p=a.base?l[0]+a.base:l[0],c=r[p]||0,u="".concat(p," ").concat(c);r[p]=c+1;var m=n(u),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(d);else{var f=o(d,a);a.byIndex=s,t.splice(s,0,{identifier:u,updater:f,references:1})}i.push(u)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=a(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var s=n(r[i]);t[s].references--}for(var l=a(e,o),p=0;p<r.length;p++){var c=n(r[p]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}r=l}}},7378:e=>{"use strict";var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},4154:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5993:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},1583:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,o&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},8141:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},9567:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var a=n(7900),o=n.n(a),r=n(4924),i=n(3565),s=n.n(i),l=n(4577),p=n(6217),c=n(906),u=n(1748),m=n(1354),d=n.n(m),f=n(1583),_=n.n(f),v=n(7378),A=n.n(v),h=n(5993),g=n.n(h),C=n(4154),y=n.n(C),b=n(8141),E=n.n(b),T=n(91),D={};D.styleTagTransform=E(),D.setAttributes=g(),D.insert=A().bind(null,"head"),D.domAPI=_(),D.insertStyleElement=y(),d()(T.Z,D);const w=T.Z&&T.Z.locals?T.Z.locals:void 0;function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,o,r=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var k=[{name:"Scheduled"},{name:"WalkIn"}];function B(e){var t=e.children;return e.isTablet?o().createElement(l.mh4,null,t):o().createElement("div",null,t)}const F=function(e){var t,n,i,m,d=e.patientUuid,f=e.closeWorkspace,_=e.appointment,v=e.context,A=new Date(null==_?void 0:_.startDateTime).getHours()>=12?"PM":"AM",h=(null==_?void 0:_.startDateTime)?A:(new Date).getHours()>=12?"PM":"AM",g=(0,r.useTranslation)().t,C="tablet"===(0,c.useLayoutType)(),y=(0,c.useLocations)(),b=(0,c.useSession)(),E=x((0,a.useState)((null==_?void 0:_.comments)||""),2),T=E[0],D=E[1],S=x((0,a.useState)((null==_?void 0:_.appointmentKind)||""),2),F=S[0],M=S[1],G=x((0,a.useState)((null==_||null===(t=_.service)||void 0===t?void 0:t.name)||""),2),P=G[0],N=G[1],z=x((0,a.useState)((null==_?void 0:_.startDateTime)?new Date(null==_?void 0:_.startDateTime):new Date),2),I=z[0],j=z[1],L=x((0,a.useState)((null==_?void 0:_.startDateTime)?s()(new Date(null==_?void 0:_.startDateTime)).format("hh:mm"):s()(new Date).format("hh:mm")),2),Y=L[0],U=L[1],W=x((0,a.useState)(h),2),O=W[0],Z=W[1],R=x((0,a.useState)((null==_||null===(n=_.location)||void 0===n?void 0:n.uuid)||""),2),H=R[0],Q=R[1],q=x((0,a.useState)(!1),2),K=q[0],V=q[1],J=(0,u.zt)(d,(new Date).toUTCString(),new AbortController).mutate;!H&&(null==b||null===(i=b.sessionLocation)||void 0===i?void 0:i.uuid)&&Q(null==b||null===(m=b.sessionLocation)||void 0===m?void 0:m.uuid);var X=(0,u.l9)(),$=X.data;return X.isLoading?o().createElement(l.lSo,{className:w.loader,description:"".concat(g("loading","Loading")," ..."),role:"progressbar"}):o().createElement(l.l09,{className:w.formWrapper},o().createElement(l.Kqy,{gap:4},o().createElement("section",{className:w.formGroup},o().createElement("span",null,g("location","Location")),o().createElement("div",{className:w.selectContainer},o().createElement(B,{isTablet:C},o().createElement(l.PhF,{id:"location",invalidText:"Required",labelText:g("selectLocation","Select a location"),onChange:function(e){return Q(e.target.value)},value:H},H?null:o().createElement(l.QlF,{text:g("chooseLocation","Choose a location"),value:""}),(null==y?void 0:y.length)>0&&y.map((function(e){return o().createElement(l.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))))),o().createElement("section",{className:w.formGroup},o().createElement("span",null,g("dateTime","Date & Time")),o().createElement("div",{className:w.datePickerControl},o().createElement(l.Mtg,{datePickerType:"single",dateFormat:"d/m/Y",light:C,value:I,onChange:function(e){var t=x(e,1)[0];return j(t)}},o().createElement(l.aj6,{id:"datePickerInput",labelText:g("date","Date"),style:{width:"100%"},placeholder:"dd/mm/yyyy"})),o().createElement(B,{isTablet:C},o().createElement(l.jII,{pattern:"([\\d]+:[\\d]{2})",onChange:function(e){return U(e.target.value)},value:Y,style:{marginLeft:"0.125rem",flex:"none"},labelText:g("time","Time"),id:"time-picker"},o().createElement(l.M6n,{id:"time-picker-select-1",onChange:function(e){return Z(e.target.value)},value:O,"aria-label":g("time","Time")},o().createElement(l.QlF,{value:"AM",text:"AM"}),o().createElement(l.QlF,{value:"PM",text:"PM"})))))),o().createElement("section",{className:w.formGroup},o().createElement("span",null,g("service","Service")),o().createElement(B,{isTablet:C},o().createElement(l.PhF,{id:"service",invalidText:"Required",labelText:g("selectService","Select a service"),onChange:function(e){return N(e.target.value)},value:P},P?null:o().createElement(l.QlF,{text:g("chooseService","Select service"),value:""}),(null==$?void 0:$.length)>0&&$.map((function(e){return o().createElement(l.QlF,{key:e.uuid,text:e.name,value:e.name},e.name)}))))),o().createElement("section",{className:w.formGroup},o().createElement("span",null,g("appointmentType_title","Appointment Type")),o().createElement(B,{isTablet:C},o().createElement(l.PhF,{disabled:!(null==k?void 0:k.length),id:"appointmentType",invalidText:"Required",labelText:g("selectAppointmentType","Select the type of appointment"),onChange:function(e){return M(e.target.value)},value:F},F?null:o().createElement(l.QlF,{text:g("chooseAppointmentType","Choose appointment type"),value:""}),(null==k?void 0:k.length)>0&&k.map((function(e,t){return o().createElement(l.QlF,{key:t,text:e.name,value:e.name},e.name)}))))),o().createElement("section",{className:w.formGroup},o().createElement("span",null,g("note","Note")),o().createElement(l.Kx8,{id:"appointmentNote",light:C,value:T,labelText:g("appointmentNoteLabel","Write an additional note"),placeholder:g("appointmentNotePlaceholder","Write any additional points here"),onChange:function(e){return D(e.target.value)}}))),o().createElement(l.uVA,{className:C?w.tablet:w.desktop},o().createElement(l.zxk,{className:w.button,onClick:f,kind:"secondary"},g("discard","Discard")),o().createElement(l.zxk,{className:w.button,disabled:!P||K,onClick:function(){var e,t,n;V(!0);var a=null===(e=null==$?void 0:$.find((function(e){return e.name===P})))||void 0===e?void 0:e.uuid,o=null===(t=null==$?void 0:$.find((function(e){return e.name===P})))||void 0===t?void 0:t.durationMins,r=x((0,p.convertTime12to24)(Y,O),2),i=r[0],l=r[1],m=new Date(s()(I).year(),s()(I).month(),s()(I).date(),i,l),A=s()(new Date(s()(I).year(),s()(I).month(),s()(I).date(),i,l)).add(o,"minutes").toDate(),h={appointmentKind:F,serviceUuid:a,startDateTime:s()(m).format(),endDateTime:s()(A).format(),providerUuid:null==b||null===(n=b.currentProvider)||void 0===n?void 0:n.uuid,providers:[{uuid:b.currentProvider.uuid}],locationUuid:H,patientUuid:d,comments:T,uuid:"editing"===v?_.uuid:void 0},C=new AbortController;(0,u.GB)(h,C).then((function(e){200===e.status&&(V(!1),f(),J(),(0,c.showToast)({critical:!0,kind:"success",description:g("appointmentNowVisible","It is now visible on the Appointments page"),title:"editing"===v?g("appointmentEdited","Appointment edited"):g("appointmentScheduled","Appointment scheduled")}))}),(function(e){V(!1),(0,c.showNotification)({title:"editing"===v?g("appointmentEditError","Error editing appointment"):g("appointmentFormError","Error scheduling appointment"),kind:"error",critical:!0,description:null==e?void 0:e.message})}))}},g("saveAndClose","Save and close"))))}},1748:(e,t,n)=>{"use strict";n.d(t,{GB:()=>_,l9:()=>f,v1:()=>h,zt:()=>d});var a=n(5047),o=n.n(a),r=n(3565),i=n.n(r),s=n(3255),l=n(906),p=n(6824),c=n.n(p);function u(e,t,n,a,o,r,i){try{var s=e[r](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,o)}i().extend(c());var m="/ws/rest/v1/appointments/search";function d(e,t,n){var a,o,r,p,c,u,d,f=(0,s.ZP)(m,(function(){return(0,l.openmrsFetch)(m,{method:"POST",signal:n.signal,headers:{"Content-Type":"application/json"},body:{patientUuid:e,startDate:t}})})),_=f.data,v=f.error,A=f.isLoading,h=f.isValidating,g=f.mutate,C=(null==_||null===(a=_.data)||void 0===a?void 0:a.length)?_.data:null,y=null===(r=null===(o=null==C?void 0:C.sort((function(e,t){return t.startDateTime>e.startDateTime?1:-1})))||void 0===o?void 0:o.filter((function(e){return"Cancelled"!==e.status})))||void 0===r?void 0:r.filter((function(e){var t=e.startDateTime;return i()(new Date(t).toISOString()).isBefore((new Date).setHours(0,0,0,0))})),b=null===(c=null===(p=null==C?void 0:C.sort((function(e,t){return e.startDateTime>t.startDateTime?1:-1})))||void 0===p?void 0:p.filter((function(e){return"Cancelled"!==e.status})))||void 0===c?void 0:c.filter((function(e){var t=e.startDateTime;return i()(new Date(t).toISOString()).isAfter(new Date)})),E=null===(d=null===(u=null==C?void 0:C.sort((function(e,t){return e.startDateTime>t.startDateTime?1:-1})))||void 0===u?void 0:u.filter((function(e){return"Cancelled"!==e.status})))||void 0===d?void 0:d.filter((function(e){var t=e.startDateTime;return i()(new Date(t).toISOString()).isToday()}));return{data:_?{pastAppointments:y,upcomingAppointments:b,todaysAppointments:E}:null,isError:v,isLoading:A,isValidating:h,mutate:g}}function f(){var e=(0,s.ZP)("/ws/rest/v1/appointmentService/all/full",l.openmrsFetch),t=e.data,n=e.error,a=e.isLoading;return{data:t?t.data:null,isError:n,isLoading:a}}function _(e,t){return(0,l.openmrsFetch)("/ws/rest/v1/appointment",{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json"},body:e})}var v,A,h=(v=o().mark((function e(t,n,a){var r,s,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Intl.DateTimeFormat().resolvedOptions().timeZone,s=i()(new Date).format("YYYY-MM-DDTHH:mm:ss.SSSZZ"),p="/ws/rest/v1/appointments/".concat(n,"/status-change"),e.next=6,(0,l.openmrsFetch)(p,{body:{toStatus:t,onDate:s,timeZone:r},method:"POST",headers:{"Content-Type":"application/json"}});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})),A=function(){var e=this,t=arguments;return new Promise((function(n,a){var o=v.apply(e,t);function r(e){u(o,n,a,r,i,"next",e)}function i(e){u(o,n,a,r,i,"throw",e)}r(void 0)}))},function(e,t,n){return A.apply(this,arguments)})}}]);