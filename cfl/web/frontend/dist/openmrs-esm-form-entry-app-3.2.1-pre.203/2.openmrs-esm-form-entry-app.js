(window["webpackJsonpopenmrs-esm-form-entry"]=window["webpackJsonpopenmrs-esm-form-entry"]||[]).push([[2],{qIrM:function(e,t,n){"use strict";n.r(t),n.d(t,"bootstrap",function(){return fe}),n.d(t,"mount",function(){return me}),n.d(t,"unmount",function(){return ve});var r=n("e4iD"),o=n("EM62"),i=n("Jxrt"),s=n("axyU"),c=n("5lCh"),a=n("Vgaj");const u=new a.ReplaySubject(1);var l=n("2kYt"),d=n("D57K"),p=n("J+dc"),g=n("YtkY"),h=n("cJ9h"),f=n("4e/d"),m=n("NAh8"),v=n("rgMP");const b="patient-form";let P=(()=>{class e{constructor(){}getCurrentUser(){return Object(v.getCurrentUser)()}openmrsFetch(e){return Object(v.openmrsObservableFetch)(e)}getCurrentUserLocation(){return this.openmrsFetch("/ws/rest/v1/session").pipe(Object(g.a)(e=>e.data))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var O=n("vobO"),C=n("lSOl");let S=(()=>{class e{constructor(e,t){this.http=e,this.windoRef=t,this.v="custom:(uuid,encounterDatetime,patient:(uuid,uuid),form:(uuid,name),visit:(uuid,display,auditInfo,startDatetime,stopDatetime,location:(uuid,display),visitType:(uuid,name)),location:ref,encounterType:ref,encounterProviders:(uuid,display,provider:(uuid,display)))"}getUrl(){return this.windoRef.openmrsRestBase}getEncountersByPatientUuid(e,t=!1,n=null){if(!e)return null;const r=this.getUrl()+"encounter";let o=(new O.d).set("patient",e).set("v",this.v);return this.http.get(r,{params:o}).pipe(Object(h.a)(e=>e.results.length>=500?(o=o.set("startIndex","500"),this.http.get(r,{params:o}).pipe(Object(g.a)(t=>e.results.concat(t.results)))):Object(a.of)(e.results)))}getEncounterByUuid(e){if(!e)return null;const t=(new O.d).set("v","custom:(uuid,encounterDatetime,patient:(uuid,uuid,person,identifiers:full),form:(uuid,name),visit:(uuid,visitType,display,startDatetime,stopDatetime),location:ref,encounterType:ref,encounterProviders:(uuid,display,provider:(uuid,display)),orders:full,obs:(uuid,obsDatetime,concept:(uuid,uuid,name:(display)),value:ref,groupMembers))"),n=this.getUrl()+"encounter/"+e;return this.http.get(n,{params:t})}getEncounterTypes(e){if(!e)return null;const t=this.getUrl()+"encountertype";return this.http.get(t).pipe(Object(g.a)(e=>e.results))}saveEncounter(e){if(!e)return null;const t=this.getUrl()+"encounter",n=new O.c({"Content-Type":"application/json"});return this.http.post(t,JSON.stringify(e),{headers:n})}updateEncounter(e,t){if(!t||!e)return null;const n=this.getUrl()+"encounter/"+e,r=new O.c({"Content-Type":"application/json"});return this.http.post(n,JSON.stringify(t),{headers:r})}voidEncounter(e){if(!e)return null;const t=this.getUrl()+"encounter/"+e+"?!purge",n=new O.c({"Content-Type":"application/json"});return this.http.delete(t,{headers:n})}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var y=n("hqLi"),M=n("9RHM"),_=n("PkBB");function w(e){j(e);for(const t of["obs.concept"])U(e,t);return e}function j(e){if("object"==typeof e)for(const[t,n]of Object.entries(e))"uuid"!==t&&"string"==typeof n&&Object(_.a)(n)?x(e,t):"object"==typeof n&&j(n);else if(Array.isArray(e))for(const t of e)j(t);return e}function U(e,t){const[n,...r]=t.split(".");if(0===r.length)return void x(e,n);const o=null==e?void 0:e[n];if(Array.isArray(o))for(const i of o)U(i,r.join("."));else"object"==typeof o&&U(o,r.join("."))}function x(e,t){return"object"==typeof e&&"string"==typeof e[t]&&(e[t]={uuid:e[t]}),e}var E=n("IVkz"),I=n("GyFI");let B=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t,this.v="full"}getUrl(){return this.windowRef.openmrsRestBase+"person"}getPersonByUuid(e,t=null){let n=this.getUrl();n+="/"+e;const r=(new O.d).set("v",t&&t.length>0?t:this.v);return this.http.get(n,{params:r})}saveUpdatePerson(e,t){if(!t||!e)return null;const n=`${this.getUrl()}/${e}`,r=new O.c({"Content-Type":"application/json"});return this.http.post(n,JSON.stringify(t),{headers:r}).pipe(Object(g.a)(e=>e.person))}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var D=n("8j5Y");let R=(()=>{class e{constructor(e,t,n){this.http=e,this.windowRef=t,this.personService=n}searchProvider(e){return this.getAllProviders().pipe(Object(g.a)(t=>t.filter(t=>t.display.toLowerCase().includes(e.toLowerCase()))))}getProviderByUuid(t){return this.http.get(this.windowRef.openmrsRestBase+"provider/"+t+"?v="+e.v).pipe(Object(f.a)(()=>this.getProviderByUuidFallback(t)))}getProviderByUuidFallback(e){return this.getAllProviders().pipe(Object(g.a)(t=>t.find(t=>t.uuid===e)))}getAllProviders(){return this.http.get(this.windowRef.openmrsRestBase+"provider?q=&v="+e.v).pipe(Object(g.a)(e=>e.results))}getUrl(t){return t?this.windowRef.openmrsRestBase+"provider/"+t+"?v="+e.v:this.windowRef.openmrsRestBase+"provider?q=&v="+e.v}}return e.v="custom:(uuid,display,person:(uuid))",e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a),o["\u0275\u0275inject"](B))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),k=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t}getLocationByUuid(e){const t=this.getUrl(e);return this.http.get(t).pipe(Object(f.a)(()=>this.getLocationByUuidFallback(e)))}getLocationByUuidFallback(e){return this.getAllLocations().pipe(Object(g.a)(t=>t.find(t=>t.uuid===e)))}searchLocation(e){return this.getAllLocations().pipe(Object(g.a)(t=>t.filter(t=>t.display.toLowerCase().includes(e.toLowerCase()))))}getAllLocations(){const e=this.getUrl();return this.http.get(e).pipe(Object(g.a)(e=>e.results))}getUrl(t){return t?this.windowRef.openmrsRestBase+"location/"+t+"?v="+e.v:this.windowRef.openmrsRestBase+"location?q=&v="+e.v}}return e.v="custom:(uuid,display)",e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),T=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t,this.v="custom:(uuid,name,conceptClass,setMembers)"}getUrl(){return this.windowRef.openmrsRestBase+"concept"}searchConcept(e,t=!1,n=null){const r=this.getUrl(),o=(new O.d).set("q",e).set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:o}).pipe(Object(g.a)(e=>e.results))}getConceptByUuid(e,t=!1,n=this.v){let r=this.getUrl();r+="/"+e;const o=(new O.d).set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:o})}getConceptByConceptClassesUuid(e,t){let n=[];return this.searchConcept(e).pipe(Object(p.a)(1)).subscribe(e=>{n=this.filterResultsByConceptClassesUuid(e,t)},e=>{}),n}filterResultsByConceptClassesUuid(e,t){return e.filter(e=>t.find(t=>e.conceptClass.uuid===t))}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var F=n("Ip0r");let L=(()=>{class e{constructor(e,t,n,r){this.providerResourceService=e,this.locationResourceService=t,this.conceptResourceService=n,this.localStorageService=r}getDataSources(){return{location:{resolveSelectedValue:this.getLocationByUuid.bind(this),searchOptions:this.findLocation.bind(this)},provider:{resolveSelectedValue:this.getProviderByUuid.bind(this),searchOptions:this.findProvider.bind(this)},drug:{resolveSelectedValue:this.resolveConcept.bind(this),searchOptions:this.findDrug.bind(this)},problem:{resolveSelectedValue:this.resolveConcept.bind(this),searchOptions:this.findProblem.bind(this)},conceptAnswers:this.getWhoStagingCriteriaDataSource()}}getWhoStagingCriteriaDataSource(){const e=new a.Subject,t={cachedOptions:[],dataSourceOptions:{concept:void 0},resolveSelectedValue:void 0,searchOptions:void 0,dataFromSourceChanged:e.asObservable(),changeConcept:void 0},n=e=>{if(t.cachedOptions.length>0)return a.Observable.create(e=>{e.next(t.cachedOptions)});const n=this.getConceptSetMembers(t.dataSourceOptions.concept);return n.subscribe(e=>{t.cachedOptions=e}),n};return t.resolveSelectedValue=e=>this.resolveConcept(e),t.searchOptions=n,t.changeConcept=r=>{t.dataSourceOptions.concept=r,t.cachedOptions=[],e.next([]),n().subscribe(t=>{e.next(t)})},t}findProvider(e){return this.providerResourceService.searchProvider(e).pipe(Object(g.a)(e=>e.filter(e=>!!e.person).map(this.mapProvider)),Object(D.a)(e=>this.setCachedProviderSearchResults(e)))}getProviderByUuid(e){return this.providerResourceService.getProviderByUuid(e).pipe(Object(g.a)(this.mapProvider))}mapProvider(e){return e&&{label:e.display,value:e.uuid,providerUuid:e.uuid}}findLocation(e){return this.locationResourceService.searchLocation(e).pipe(Object(g.a)(e=>e.map(this.mapLocation)),Object(p.a)(10))}getLocationByUuid(e){return this.locationResourceService.getLocationByUuid(e).pipe(Object(g.a)(this.mapLocation))}mapLocation(e){return e&&{label:e.display,value:e.uuid}}resolveConcept(e){return this.conceptResourceService.getConceptByUuid(e).pipe(Object(g.a)(this.mapConcept))}getConceptAnswers(e){return this.conceptResourceService.getConceptByUuid(e).pipe(Object(g.a)(e=>e.answers.map(this.mapConcept)))}getConceptSetMembers(e){return this.conceptResourceService.getConceptByUuid(e).pipe(Object(g.a)(e=>e.setMembers.map(this.mapConcept).sort((e,t)=>e.label>t.label?1:0)))}findDrug(e){return this.conceptResourceService.searchConcept(e).pipe(Object(g.a)(e=>e.filter(e=>e.conceptClass&&"8d490dfc-c2cc-11de-8d13-0010c6dffd0f"===e.conceptClass.uuid).map(this.mapConcept)))}findProblem(e){const t=["8d4918b0-c2cc-11de-8d13-0010c6dffd0f","8d492b2a-c2cc-11de-8d13-0010c6dffd0f","8d492954-c2cc-11de-8d13-0010c6dffd0f","8d491a9a-c2cc-11de-8d13-0010c6dffd0f"];return this.conceptResourceService.searchConcept(e).pipe(Object(g.a)(e=>e.filter(e=>e.conceptClass&&t.includes(e.conceptClass.uuid)).map(this.mapConcept)))}mapConcept(e){return e&&{value:e.uuid,label:e.name.display}}getCachedProviderSearchResults(){return this.localStorageService.getObject("cachedproviders")}setCachedProviderSearchResults(e){this.localStorageService.setObject("cachedproviders",e)}getPatientObject(e){const t={};return t.sex="male"===(null==e?void 0:e.gender)?"M":"F",t.birthdate=new Date(null==e?void 0:e.birthDate),t.age=this.calculateAge(null==e?void 0:e.birthDate),"female"===(null==e?void 0:e.gender)&&(t.gendercreatconstant=.85),"male"===(null==e?void 0:e.gender)&&(t.gendercreatconstant=1),t}calculateAge(e){const t=Date.now()-new Date(e).getTime(),n=new Date(t);return Math.abs(n.getUTCFullYear()-1970)}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](R),o["\u0275\u0275inject"](k),o["\u0275\u0275inject"](T),o["\u0275\u0275inject"](F.a))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),A=(()=>{class e{constructor(){this.lastProps=void 0,this.lastPropsSubscription=u.subscribe(e=>this.lastProps=e)}ngOnDestroy(){var e;null===(e=this.lastPropsSubscription)||void 0===e||e.unsubscribe()}getPropOrThrow(e){const t=this.getProp(e);if(void 0===t){const t=new Error(`The module is missing the required Single SPA property "${e}". This is a development error likely caused by another microfrontend module. See the associated console log for details.`);throw console.error(t,this.lastProps),t}return t}getProp(e,t){var n,r;return null!==(r=null===(n=this.lastProps)||void 0===n?void 0:n[e])&&void 0!==r?r:t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),N=(()=>{class e{constructor(e,t,n,r,o,i){this.encounterAdapter=e,this.personAttributeAdapter=t,this.encounterResourceService=n,this.personResourceService=r,this.formDataSourceService=o,this.singleSpaPropsService=i}submitPayload(e){const t=this.singleSpaPropsService.getProp("isOffline",!1),n=this.singleSpaPropsService.getProp("encounterUuid");return Object(a.from)(function(e){return Object(d.a)(this,void 0,void 0,function*(){return(yield Object(v.getFullSynchronizationItems)(b)).find(t=>t.content._id===e)})}(n)).pipe(Object(h.b)(n=>{const r=t||!!n;r&&this.deepClearInitialNodeValues(e.rootNode);const o=this.buildEncounterPayload(e),i=this.buildPersonUpdatePayload(e);return r?this.submitPayloadOffline(e,o,i,null==n?void 0:n.content._id):this.submitPayloadOnline(o,i)}))}deepClearInitialNodeValues(e){if(e.initialValue=void 0,e.children&&"object"==typeof e.children)for(const t of Object.values(e.children))this.deepClearInitialNodeValues(t)}submitPayloadOffline(e,t,n,r){const o=w(Object(M.a)(t)),i={encounter:o},s={_id:null!=r?r:Object(E.a)(),formSchemaUuid:e.schema.uuid,encounter:o,_payloads:{encounterCreate:t,personUpdate:n}};return Object(a.from)(function(e){var t,n;return Object(d.a)(this,void 0,void 0,function*(){yield Object(v.queueSynchronizationItem)(b,e,{id:e._id,displayName:"Patient form",patientUuid:null===(t=e._payloads.encounterCreate)||void 0===t?void 0:t.patient,dependencies:[{type:"visit",id:null===(n=e._payloads.encounterCreate)||void 0===n?void 0:n.visit}]})})}(s).then(()=>i))}submitPayloadOnline(e,t){return Object(a.forkJoin)({encounter:this.submitEncounter(e),person:this.submitPersonUpdate(t)})}submitEncounter(e){return e?e.uuid?this.encounterResourceService.updateEncounter(e.uuid,e).pipe(Object(f.a)(e=>this.throwUserFriendlyError(e))):this.encounterResourceService.saveEncounter(e).pipe(Object(f.a)(e=>this.throwUserFriendlyError(e))):Object(a.of)(void 0)}submitPersonUpdate(e){return e?this.personResourceService.saveUpdatePerson(e.uuid,e).pipe(Object(f.a)(e=>this.throwUserFriendlyError(e))):Object(a.of)(void 0)}buildEncounterPayload(e){const t=this.formDataSourceService.getCachedProviderSearchResults();if((null==t?void 0:t.length)&&!e.valueProcessingInfo.providerUuid){const n=this.findProviderUuidFormForm(t,e);e.valueProcessingInfo.providerUuid=n}const n=this.encounterAdapter.generateFormPayload(e);return Object(y.a)(n)?void 0:n}findProviderUuidFormForm(e,t){var n,r;const o=null===(n=t.searchNodeByQuestionId("provider")[0])||void 0===n?void 0:n.control.value,i=null===(r=e.find(e=>e.id===o))||void 0===r?void 0:r.providerUuid;return null!=i?i:o}buildPersonUpdatePayload(e){if(!e.valueProcessingInfo.personUuid)throw new Error("The form is missing a required value for submitting person updates: form.valueProcessingInfo.personUuid");const t=this.personAttributeAdapter.generateFormPayload(e);if(!Object(y.a)(t))return{uuid:e.valueProcessingInfo.personUuid,attributes:t}}throwUserFriendlyError(e){var t,n,r;if("object"==typeof e){const o=Object.values(null!==(r=null===(n=null===(t=e.error)||void 0===t?void 0:t.error)||void 0===n?void 0:n.fieldErrors)&&void 0!==r?r:{}).flatMap(e=>e).map(e=>e.message),i=o.length>0?o.join(" "):e.message;throw new Error(i)}throw"string"==typeof e?new Error(e):new Error(`An unknown error occured: ${e}.`)}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](I.b),o["\u0275\u0275inject"](I.f),o["\u0275\u0275inject"](S),o["\u0275\u0275inject"](B),o["\u0275\u0275inject"](L),o["\u0275\u0275inject"](A))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var V=n("nsO7");let z=(()=>{class e{constructor(e){this.encounterResource=e}getPreviousEncounter(e,t){return new Promise((n,r)=>{this.encounterResource.getEncountersByPatientUuid(t).subscribe(t=>{if(t){const o=t.sort((e,t)=>new Date(t.encounterDatetime).getTime()-new Date(e.encounterDatetime).getTime()),i=V.find(o,t=>t.encounterType.uuid===e);i?this.encounterResource.getEncounterByUuid(i.uuid).pipe(Object(p.a)(1)).subscribe(e=>{n(e)},e=>{r(e)}):n(Object.create({}))}},e=>{console.error("Previous encounter",e)})})}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](S))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var q=n("wgY5");let $=(()=>{class e{getConfig(){var e;let t=null===(e=Object(v.getConfigStore)("@openmrs/esm-form-entry-app").getState())||void 0===e?void 0:e.config;return Object(v.getConfigStore)("@openmrs/esm-form-entry-app").subscribe(e=>{e.loaded&&e&&(t=e.config)}),t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),J=(()=>{class e{constructor(e,t,n){this.http=e,this.windowRef=t,this.configResource=n}getMonthlySchedule(e){const t=`${this.configResource.getConfig().appointmentsResourceUrl}?startDate=${e.startDate}&endDate=${e.endDate}&locationUuids=${e.locationUuids}&limit=${e.limit}&programType=${e.programType}&groupBy=groupByPerson,groupByAttendedDate,groupByRtcDate`;return this.http.get(`${this.windowRef.nativeWindow.openmrsBase}${t}`)}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a),o["\u0275\u0275inject"]($))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),W=(()=>{class e{constructor(e,t,n,r,o,i,s){this.formFactory=e,this.dataSources=t,this.formDataSourceService=n,this.monthlyScheduleResourceService=r,this.encounterAdapter=o,this.configResourceService=i,this.singleSpaPropsService=s}initAndCreateForm(e){const{formSchema:t,encounter:n}=e;this.wireDataSources(e);const r=this.formFactory.createForm(t,this.dataSources.dataSources);if(this.setUpWHOCascading(r),n){const t=n.uuid;this.populateEncounterForEditing(r,e),r.valueProcessingInfo.encounterUuid=t}else{const t=this.singleSpaPropsService.getPropOrThrow("patientUuid");this.setDefaultValues(r,e),r.valueProcessingInfo.patientUuid=t}return this.setUpPayloadProcessingInformation(r,e),r}wireDataSources(e){const t=this.singleSpaPropsService.getPropOrThrow("visitTypeUuid"),n=this.singleSpaPropsService.getPropOrThrow("patient");for(const r of Object.keys(this.dataSources.dataSources))this.dataSources.clearDataSource(r);this.dataSources.registerDataSource("location",this.formDataSourceService.getDataSources().location),this.dataSources.registerDataSource("provider",this.formDataSourceService.getDataSources().provider),this.dataSources.registerDataSource("drug",this.formDataSourceService.getDataSources().drug),this.dataSources.registerDataSource("problem",this.formDataSourceService.getDataSources().problem),this.dataSources.registerDataSource("personAttribute",this.formDataSourceService.getDataSources().location),this.dataSources.registerDataSource("conceptAnswers",this.formDataSourceService.getDataSources().conceptAnswers),this.dataSources.registerDataSource("patient",{visitTypeUuid:t},!0),this.dataSources.registerDataSource("patient",this.formDataSourceService.getPatientObject(n),!0),this.dataSources.registerDataSource("rawPrevEnc",e.previousEncounter,!1),this.dataSources.registerDataSource("userLocation",e.user.sessionLocation),this.configResourceService.getConfig().dataSources.monthlySchedule&&this.dataSources.registerDataSource("monthlyScheduleResourceService",this.monthlyScheduleResourceService)}setUpWHOCascading(e){try{let t=e.searchNodeByQuestionId("adultWhoStage");0===t.length&&(t=e.searchNodeByQuestionId("pedWhoStage"));const n=t[0];null==n||n.control.valueChanges.subscribe(t=>{var n;if(t){const r=e.dataSourcesContainer.dataSources.conceptAnswers;null===(n=r.changeConcept)||void 0===n||n.call(r,t)}})}catch(t){console.error(`Error setting up WHO Staging Cascading. Error: ${JSON.stringify(t)}.`)}}setDefaultValues(e,t){const{user:n}=t,r=q().format(),o=e.searchNodeByQuestionId("encDate");o.length>0&&o[0].control.setValue(r);const i=e.searchNodeByQuestionId("location","encounterLocation");i.length>0&&(null==n?void 0:n.sessionLocation)&&i[0].control.setValue(n.sessionLocation.uuid);const s=e.searchNodeByQuestionId("provider","encounterProvider");s.length>0&&(null==n?void 0:n.currentProvider)&&s[0].control.setValue(n.currentProvider.uuid)}setUpPayloadProcessingInformation(e,t){var n;const{user:r,formSchema:o,encounter:i}=t,s=this.singleSpaPropsService.getPropOrThrow("patientUuid"),c=this.singleSpaPropsService.getPropOrThrow("visitUuid");try{if(r){if(e.valueProcessingInfo.personUuid=s,e.valueProcessingInfo.patientUuid=s,e.valueProcessingInfo.formUuid=o.uuid,e.valueProcessingInfo.providerUuid=null===(n=r.currentProvider)||void 0===n?void 0:n.uuid,!o.encounterType)throw new Error("Please associate the form with an encounter type.");e.valueProcessingInfo.encounterTypeUuid=o.encounterType.uuid,i&&(e.valueProcessingInfo.encounterUuid=i.uuid),i||(e.valueProcessingInfo.visitUuid=c)}}catch(a){console.error(a)}}populateEncounterForEditing(e,t){const{encounter:n}=t;n&&this.encounterAdapter.populateForm(e,n)}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](I.d),o["\u0275\u0275inject"](I.a),o["\u0275\u0275inject"](L),o["\u0275\u0275inject"](J),o["\u0275\u0275inject"](I.b),o["\u0275\u0275inject"]($),o["\u0275\u0275inject"](A))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),X=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t,this.headers=new O.c({accept:"application/json"})}getUrl(){return this.windowRef.openmrsRestBase+"concept"}searchConceptByUUID(e,t){return this.http.get(this.getUrl()+`/${e}?v=full&lang=${t}`,{headers:this.headers})}searchBulkConceptByUUID(e,t){return this.http.get(this.getUrl()+"?references="+e.join(","),{headers:this.headers}).pipe(Object(g.a)(e=>e.results))}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var H=n("nIj0");let G=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o["\u0275\u0275defineComponent"]({type:e,selectors:[["loader"]],inputs:{loadingMessage:"loadingMessage"},decls:12,vars:1,consts:[["aria-live","assertive",1,"bx--inline-loading",2,"width","fit-content"],[1,"bx--inline-loading__animation"],["aria-atomic","true","aria-labelledby","loading-id-5","aria-live","assertive",1,"bx--loading","bx--loading--small"],["id","loading-id-5",1,"bx--visually-hidden"],["viewBox","0 0 100 100",1,"bx--loading__svg"],["cx","50%","cy","50%","r","44",1,"bx--loading__background"],["cx","50%","cy","50%","r","44",1,"bx--loading__stroke"],[1,"bx--inline-loading__text"]],template:function(e,t){1&e&&(o["\u0275\u0275elementStart"](0,"div",0),o["\u0275\u0275elementStart"](1,"div",1),o["\u0275\u0275elementStart"](2,"div",2),o["\u0275\u0275elementStart"](3,"label",3),o["\u0275\u0275text"](4,"Active loading indicator"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275namespaceSVG"](),o["\u0275\u0275elementStart"](5,"svg",4),o["\u0275\u0275elementStart"](6,"title"),o["\u0275\u0275text"](7,"Active loading indicator"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275element"](8,"circle",5),o["\u0275\u0275element"](9,"circle",6),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275namespaceHTML"](),o["\u0275\u0275elementStart"](10,"div",7),o["\u0275\u0275text"](11),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e&&(o["\u0275\u0275advance"](11),o["\u0275\u0275textInterpolate"](t.loadingMessage))},encapsulation:2}),e})();function Q(e,t){if(1&e){const e=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"div",3),o["\u0275\u0275elementStart"](1,"div",4),o["\u0275\u0275elementStart"](2,"h4",5),o["\u0275\u0275text"](3,"There was an error with this form"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](4,"p",6),o["\u0275\u0275text"](5," Try opening another form "),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](6,"p",7),o["\u0275\u0275text"](7,"or"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](8,"button",8),o["\u0275\u0275listener"]("click",function(){return o["\u0275\u0275restoreView"](e),o["\u0275\u0275nextContext"]().closeForm()}),o["\u0275\u0275text"](9," Close this panel "),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}}function Y(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"form",13),o["\u0275\u0275element"](1,"form-renderer",14),o["\u0275\u0275elementEnd"]()),2&e){const e=o["\u0275\u0275nextContext"](3);o["\u0275\u0275property"]("formGroup",e.form.rootNode.control),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("labelMap",e.labelMap)("node",e.form.rootNode)}}function Z(e,t){1&e&&(o["\u0275\u0275elementStart"](0,"span"),o["\u0275\u0275text"](1,"Save and close"),o["\u0275\u0275elementEnd"]())}function K(e,t){1&e&&o["\u0275\u0275element"](0,"loader",20)}function ee(e,t){if(1&e){const e=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"div",15),o["\u0275\u0275elementStart"](1,"button",16),o["\u0275\u0275listener"]("click",function(){return o["\u0275\u0275restoreView"](e),o["\u0275\u0275nextContext"](3).closeForm()}),o["\u0275\u0275text"](2,"Discard"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](3,"button",17),o["\u0275\u0275listener"]("click",function(){return o["\u0275\u0275restoreView"](e),o["\u0275\u0275nextContext"](3).onSubmit()}),o["\u0275\u0275template"](4,Z,2,0,"span",18),o["\u0275\u0275template"](5,K,1,0,"loader",19),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){const e=o["\u0275\u0275nextContext"](3);o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("disabled","submitting"===e.formState),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf","submitting"!==e.formState),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf","submitting"===e.formState)}}function te(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",3),o["\u0275\u0275elementStart"](1,"div"),o["\u0275\u0275template"](2,Y,2,3,"form",11),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](3,ee,6,3,"div",12),o["\u0275\u0275elementEnd"]()),2&e){const e=o["\u0275\u0275nextContext"](2);o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngIf",e.form),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf",e.showDiscardSubmitButtons)}}const ne=function(e){return{error:e}};function re(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",9),o["\u0275\u0275elementStart"](1,"div",10),o["\u0275\u0275template"](2,te,4,2,"div",0),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){const e=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("ngClass",o["\u0275\u0275pureFunction1"](2,ne,"readyWithValidationErrors"===e.formState)),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngIf","ready"===e.formState||"readyWithValidationErrors"===e.formState||"submitting"===e.formState||"submissionError"===e.formState)}}function oe(e,t){1&e&&(o["\u0275\u0275elementStart"](0,"div",21),o["\u0275\u0275element"](1,"loader",22),o["\u0275\u0275elementEnd"]())}const ie=Object(v.createGlobalStore)("ampath-form-state",{});let se=(()=>{class e{constructor(e,t,n,r,o,i,s,c){this.openmrsApi=e,this.formSchemaService=t,this.encounterResourceService=n,this.formSubmissionService=r,this.patientPreviousEncounter=o,this.formCreationService=i,this.singleSpaPropsService=s,this.conceptService=c,this.labelMap={},this.formState="initial",this.showDiscardSubmitButtons=!0,this.language=window.i18next.language.substring(0,2).toLowerCase(),this.changeState=e=>{const t=this.singleSpaPropsService.getPropOrThrow("formUuid");this.formState=e,ie.setState({[t]:e})}}ngOnInit(){this.changeState("initial"),this.launchForm()}ngOnDestroy(){var e;null===(e=this.launchFormSubscription)||void 0===e||e.unsubscribe()}launchForm(){var e,t;this.changeState("loading"),this.showDiscardSubmitButtons=null===(e=this.singleSpaPropsService.getProp("showDiscardSubmitButtons"))||void 0===e||e,null===(t=this.launchFormSubscription)||void 0===t||t.unsubscribe(),this.launchFormSubscription=this.loadAllFormDependencies().pipe(Object(p.a)(1),Object(g.a)(e=>this.formCreationService.initAndCreateForm(e)),Object(h.b)(e=>{const t=m.a.getUnlabeledConceptIdentifiersFromSchema(e.schema);return this.conceptService.searchBulkConceptByUUID(t,this.language).pipe(Object(g.a)(t=>({form:e,concepts:t})))})).subscribe(({form:e,concepts:t})=>{this.changeState("ready"),this.form=e,this.labelMap=t.reduce((e,t)=>(e[t.uuid]=t.display,e),{})},e=>{this.loadingError="Error loading form",this.changeState("loadingError"),console.error("Error rendering form",e)})}loadAllFormDependencies(){const e=this.singleSpaPropsService.getPropOrThrow("formUuid"),t=this.singleSpaPropsService.getPropOrThrow("encounterUuid");return Object(a.forkJoin)({formSchema:this.fetchCompiledFormSchema(e).pipe(Object(p.a)(1)),user:this.openmrsApi.getCurrentUserLocation().pipe(Object(p.a)(1)),encounter:t?this.getEncounterToEdit(t).pipe(Object(p.a)(1)):Object(a.of)(null)}).pipe(Object(h.b)(e=>this.loadPatientPreviousEncounters(e.formSchema).pipe(Object(g.a)(t=>Object.assign(Object.assign({},e),{previousEncounter:t})))),Object(f.a)(e=>Object(a.throwError)(new Error("There was an error fetching form data. Details: "+JSON.stringify(e)))))}fetchCompiledFormSchema(e){return this.formSchemaService.getFormSchemaByUuid(e,!0).pipe(Object(p.a)(1))}getEncounterToEdit(e){return this.singleSpaPropsService.getProp("isOffline",!1)?Object(a.from)(this.getOfflineEncounterToEdit(e)):this.encounterResourceService.getEncounterByUuid(e).pipe(Object(f.a)(()=>Object(a.from)(this.getOfflineEncounterToEdit(e))))}getOfflineEncounterToEdit(e){return Object(d.a)(this,void 0,void 0,function*(){return(yield Object(v.getSynchronizationItems)(b)).find(t=>t._id===e).encounter})}loadPatientPreviousEncounters(e){var t;const n=this.singleSpaPropsService.getProp("patientUuid");return this.singleSpaPropsService.getProp("isOffline",!1)?Object(a.of)(void 0):Object(a.from)(this.patientPreviousEncounter.getPreviousEncounter(null===(t=e.encounterType)||void 0===t?void 0:t.uuid,n))}onSubmit(){this.validateForm()&&(this.changeState("submitting"),this.formSubmissionService.submitPayload(this.form).subscribe(({encounter:e})=>{this.onPostResponse(e);const t=this.singleSpaPropsService.getProp("isOffline",!1);this.changeState("submitted"),!t&&(null==e?void 0:e.uuid)&&this.encounterResourceService.getEncounterByUuid(e.uuid).pipe(Object(p.a)(1)).subscribe(e=>{if(Array.isArray(null==e?void 0:e.orders)){const t=e.orders.filter(({auditInfo:e})=>!e.dateVoided);this.showLabOrdersNotification(t)}}),Object(v.showToast)({critical:!0,kind:"success",description:"The form has been submitted successfully.",title:this.form.schema.name}),this.closeForm()},e=>{this.changeState("submissionError"),Object(v.showToast)({critical:!0,kind:"error",description:`An error has occurred while submitting the form. Error: ${JSON.stringify(null==e?void 0:e.message,null,2)}.`,title:this.form.schema.name})}))}validateForm(){return this.form.valid||(this.form.markInvalidControls(this.form.rootNode),this.form.showErrors=!0,this.changeState("readyWithValidationErrors")),this.form.valid}showLabOrdersNotification(e=[]){var t;const n=null!==(t=e.map((e,t)=>` ${t+1} : ${e.display} : ${e.orderNumber}`).join())&&void 0!==t?t:"";n.length&&Object(v.showNotification)({title:"Lab order(s) generated",kind:"success",critical:!0,description:n})}closeForm(){this.singleSpaPropsService.getPropOrThrow("closeWorkspace")()}onPostResponse(e){const t=this.singleSpaPropsService.getProp("handlePostResponse");t&&"function"==typeof t&&t(e)}onFormAction(e){var t,n;const r=this.singleSpaPropsService.getPropOrThrow("formUuid");(null===(t=e.detail)||void 0===t?void 0:t.formUuid)===r&&"onSubmit"===(null===(n=e.detail)||void 0===n?void 0:n.action)&&this.onSubmit()}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275directiveInject"](P),o["\u0275\u0275directiveInject"](m.a),o["\u0275\u0275directiveInject"](S),o["\u0275\u0275directiveInject"](N),o["\u0275\u0275directiveInject"](z),o["\u0275\u0275directiveInject"](W),o["\u0275\u0275directiveInject"](A),o["\u0275\u0275directiveInject"](X))},e.\u0275cmp=o["\u0275\u0275defineComponent"]({type:e,selectors:[["my-app-fe-wrapper"]],hostBindings:function(e,t){1&e&&o["\u0275\u0275listener"]("ampath-form-action",function(e){return t.onFormAction(e)},!1,o["\u0275\u0275resolveWindow"])},decls:3,vars:3,consts:[["class","form-container",4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","loader-container",4,"ngIf"],[1,"form-container"],[1,"bx--tile","error-tile"],[1,"heading"],[1,"helperText"],[1,"separator"],[1,"bx--btn","bx--btn--sm","bx--btn--ghost",3,"click"],[3,"ngClass"],[1,"content"],["class","bx--form no-padding",3,"formGroup",4,"ngIf"],["class","bx-btn--set button-set",4,"ngIf"],[1,"bx--form","no-padding",3,"formGroup"],[3,"labelMap","node"],[1,"bx-btn--set","button-set"],["type","button",1,"bx--btn","bx--btn--secondary",3,"click"],["type","submit",1,"bx--btn","bx--btn--primary",3,"disabled","click"],[4,"ngIf"],["loadingMessage","Submitting",4,"ngIf"],["loadingMessage","Submitting"],[1,"loader-container"],["loadingMessage","Loading...",1,"loader"]],template:function(e,t){1&e&&(o["\u0275\u0275template"](0,Q,10,0,"div",0),o["\u0275\u0275template"](1,re,3,4,"div",1),o["\u0275\u0275template"](2,oe,2,0,"div",2)),2&e&&(o["\u0275\u0275property"]("ngIf",t.loadingError),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf","submitted"!==t.formState),o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("ngIf","loading"===t.formState))},directives:[l.i,l.g,H.s,H.m,H.h,I.g,G],styles:['[_ngcontent-%COMP%]:root{--brand-01:#005d5d;--brand-02:#004144;--brand-03:#007d79}a[_ngcontent-%COMP%], abbr[_ngcontent-%COMP%], acronym[_ngcontent-%COMP%], address[_ngcontent-%COMP%], applet[_ngcontent-%COMP%], article[_ngcontent-%COMP%], aside[_ngcontent-%COMP%], audio[_ngcontent-%COMP%], b[_ngcontent-%COMP%], big[_ngcontent-%COMP%], blockquote[_ngcontent-%COMP%], body[_ngcontent-%COMP%], canvas[_ngcontent-%COMP%], caption[_ngcontent-%COMP%], center[_ngcontent-%COMP%], cite[_ngcontent-%COMP%], code[_ngcontent-%COMP%], dd[_ngcontent-%COMP%], del[_ngcontent-%COMP%], details[_ngcontent-%COMP%], dfn[_ngcontent-%COMP%], div[_ngcontent-%COMP%], dl[_ngcontent-%COMP%], dt[_ngcontent-%COMP%], em[_ngcontent-%COMP%], embed[_ngcontent-%COMP%], fieldset[_ngcontent-%COMP%], figcaption[_ngcontent-%COMP%], figure[_ngcontent-%COMP%], footer[_ngcontent-%COMP%], form[_ngcontent-%COMP%], h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%], header[_ngcontent-%COMP%], hgroup[_ngcontent-%COMP%], html[_ngcontent-%COMP%], i[_ngcontent-%COMP%], iframe[_ngcontent-%COMP%], img[_ngcontent-%COMP%], ins[_ngcontent-%COMP%], kbd[_ngcontent-%COMP%], label[_ngcontent-%COMP%], legend[_ngcontent-%COMP%], li[_ngcontent-%COMP%], mark[_ngcontent-%COMP%], menu[_ngcontent-%COMP%], nav[_ngcontent-%COMP%], object[_ngcontent-%COMP%], ol[_ngcontent-%COMP%], output[_ngcontent-%COMP%], p[_ngcontent-%COMP%], pre[_ngcontent-%COMP%], q[_ngcontent-%COMP%], ruby[_ngcontent-%COMP%], s[_ngcontent-%COMP%], samp[_ngcontent-%COMP%], section[_ngcontent-%COMP%], small[_ngcontent-%COMP%], span[_ngcontent-%COMP%], strike[_ngcontent-%COMP%], strong[_ngcontent-%COMP%], sub[_ngcontent-%COMP%], summary[_ngcontent-%COMP%], sup[_ngcontent-%COMP%], table[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%], td[_ngcontent-%COMP%], tfoot[_ngcontent-%COMP%], th[_ngcontent-%COMP%], thead[_ngcontent-%COMP%], time[_ngcontent-%COMP%], tr[_ngcontent-%COMP%], tt[_ngcontent-%COMP%], u[_ngcontent-%COMP%], ul[_ngcontent-%COMP%], var[_ngcontent-%COMP%], video[_ngcontent-%COMP%]{padding:0;border:0;margin:0;font:inherit;font-size:100%;vertical-align:baseline}button[_ngcontent-%COMP%], input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{border-radius:0;font-family:inherit}input[type=text][_ngcontent-%COMP%]::-ms-clear{display:none}article[_ngcontent-%COMP%], aside[_ngcontent-%COMP%], details[_ngcontent-%COMP%], figcaption[_ngcontent-%COMP%], figure[_ngcontent-%COMP%], footer[_ngcontent-%COMP%], header[_ngcontent-%COMP%], hgroup[_ngcontent-%COMP%], main[_ngcontent-%COMP%], menu[_ngcontent-%COMP%], nav[_ngcontent-%COMP%], section[_ngcontent-%COMP%]{display:block}body[_ngcontent-%COMP%]{line-height:1}sup[_ngcontent-%COMP%]{vertical-align:super}sub[_ngcontent-%COMP%]{vertical-align:sub}ol[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{list-style:none}blockquote[_ngcontent-%COMP%], q[_ngcontent-%COMP%]{quotes:none}blockquote[_ngcontent-%COMP%]:after, blockquote[_ngcontent-%COMP%]:before, q[_ngcontent-%COMP%]:after, q[_ngcontent-%COMP%]:before{content:""}table[_ngcontent-%COMP%]{border-collapse:collapse;border-spacing:0}*[_ngcontent-%COMP%]{box-sizing:border-box}button[_ngcontent-%COMP%]{margin:0}html[_ngcontent-%COMP%]{font-size:100%}body[_ngcontent-%COMP%]{font-weight:400;font-family:IBM Plex Sans,Helvetica Neue,Arial,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}code[_ngcontent-%COMP%]{font-family:IBM Plex Mono,Menlo,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier,monospace}strong[_ngcontent-%COMP%]{font-weight:600}@media screen and (-ms-high-contrast:active){svg[_ngcontent-%COMP%]{fill:ButtonText}}h1[_ngcontent-%COMP%]{font-size:2.625rem;font-weight:300;line-height:1.199;letter-spacing:0}h2[_ngcontent-%COMP%]{font-size:2rem;line-height:1.25}h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{font-weight:400;letter-spacing:0}h3[_ngcontent-%COMP%]{font-size:1.75rem;line-height:1.29}h4[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:400;line-height:1.4}h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%]{letter-spacing:0}h5[_ngcontent-%COMP%]{font-size:1rem;line-height:1.375}h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{font-weight:600}h6[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.29;letter-spacing:.16px}p[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;line-height:1.5;letter-spacing:0}a[_ngcontent-%COMP%]{color:#0f62fe}em[_ngcontent-%COMP%]{font-style:italic}@keyframes skeleton{0%{opacity:.3;transform:scaleX(0);transform-origin:left}20%{opacity:1;transform:scaleX(1);transform-origin:left}28%{transform:scaleX(1);transform-origin:right}51%{transform:scaleX(0);transform-origin:right}58%{transform:scaleX(0);transform-origin:right}82%{transform:scaleX(1);transform-origin:right}83%{transform:scaleX(1);transform-origin:left}96%{transform:scaleX(0);transform-origin:left}to{opacity:.3;transform:scaleX(0);transform-origin:left}}.error-tile[_ngcontent-%COMP%]{width:60%;margin:1.25rem auto;display:flex;flex-flow:column wrap;align-items:center;justify-content:center;padding:1.5rem 0 1.75rem}.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .error-tile[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .error-tile[_ngcontent-%COMP%]{background-color:#fff}.heading[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0;color:#161616}.helperText[_ngcontent-%COMP%]{margin-top:.5rem;line-height:1.43}.helperText[_ngcontent-%COMP%], .separator[_ngcontent-%COMP%]{font-size:.875rem;font-weight:400;letter-spacing:.16px;color:#525252}.separator[_ngcontent-%COMP%]{line-height:1.29;width:12rem;margin:1.375rem auto;overflow:hidden;text-align:center}.separator[_ngcontent-%COMP%]:after, .separator[_ngcontent-%COMP%]:before{background-color:#a8a8a8;content:"";display:inline-block;height:1px;position:relative;vertical-align:middle;width:50%}.separator[_ngcontent-%COMP%]:before{right:1rem;margin-left:-50%}.separator[_ngcontent-%COMP%]:after{left:1rem;margin-right:-50%}.title-icon-size[_ngcontent-%COMP%]{height:.8rem;width:.8rem}.no-errors[_ngcontent-%COMP%]{display:none}.sidebar[_ngcontent-%COMP%]   .open[_ngcontent-%COMP%]{margin-top:-1px;width:55%;height:80%;padding:4px;overflow-y:scroll;overflow-x:hidden}.sidebar[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%]{height:80px;width:28px;margin-top:-1px}.error-content[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%]{display:none}.error-content[_ngcontent-%COMP%]{border-top:1px solid #d3d3d3;margin:-4px;padding:4px}.error-title[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%]{transform:rotate(90deg);margin-top:14px}.no-padding[_ngcontent-%COMP%]{margin-left:-2rem;margin-right:-2rem}.center[_ngcontent-%COMP%]{align-items:center;height:100vh}.center[_ngcontent-%COMP%], .form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%]{font-size:40px!important;justify-content:space-between}.button-set[_ngcontent-%COMP%]{margin:0 -2rem}.button-set[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:4rem;align-items:baseline;min-width:50%}.omrs-breakpoint-gt-tablet[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%], .omrs-breakpoint-gt-tablet   [_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]{height:calc(100vh - 6rem);margin:0 2rem}.omrs-breakpoint-gt-tablet[_nghost-%COMP%]   .button-set[_ngcontent-%COMP%], .omrs-breakpoint-gt-tablet   [_nghost-%COMP%]   .button-set[_ngcontent-%COMP%]{padding:0}.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .form-container[_ngcontent-%COMP%]{height:calc(100vh - 6rem);margin:0 2rem}.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .button-set[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .button-set[_ngcontent-%COMP%]{padding:1.5rem 1rem;background-color:#fff}.loader-container[_ngcontent-%COMP%]{height:100vh}.loader[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:50%}.encounterHeader[_ngcontent-%COMP%]{font-family:IBM Plex Sans,sans-serif;font-size:14px;line-height:22px;font-weight:600;letter-spacing:.16px;border-bottom:1px solid var(--brand-03);padding:.625rem}']}),e})();function ce(e,t){1&e&&o["\u0275\u0275element"](0,"my-app-fe-wrapper")}let ae=(()=>{class e{constructor(){this.title="ampath-esm-angular-form-entry"}ngOnInit(){this.sub=u.subscribe(e=>{this.view=e.view},e=>{})}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o["\u0275\u0275defineComponent"]({type:e,selectors:[["my-app-root"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&o["\u0275\u0275template"](0,ce,1,0,"my-app-fe-wrapper",0),2&e&&o["\u0275\u0275property"]("ngIf","form"===t.view)},directives:[l.i,se],styles:[""]}),e})();var ue=n("ISRS");let le=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t,this.v="custom:(uuid,display,identifiers:(identifier,uuid,preferred,location:(uuid,name),identifierType:(uuid,name,format,formatDescription,validator)),person:(uuid,display,gender,birthdate,dead,age,deathDate,birthdateEstimated,causeOfDeath,preferredName:(uuid,preferred,givenName,middleName,familyName),attributes:(uuid,display,value,attributeType,dateCreated,dateChanged),preferredAddress:(uuid,preferred,address1,address2,cityVillage,longitude,stateProvince,latitude,country,postalCode,countyDistrict,address3,address4,address5,address6,address7)))"}getUrl(){return this.windowRef.openmrsRestBase+"patient"}searchPatient(e,t=!1,n=null){const r=this.getUrl(),o=(new O.d).set("q",e).set("includeDead","true").set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:o}).pipe(Object(g.a)(e=>e.results))}getPatientByUuid(e,t=!1,n=null){let r=this.getUrl();r+="/"+e;const o=(new O.d).set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:o})}saveUpdatePatientIdentifier(e,t,n){if(!n||!e)return null;const r=this.getUrl()+"/"+e+"/identifier/"+t,o=new O.c({"Content-Type":"application/json"});return this.http.post(r,JSON.stringify(n),{headers:o}).pipe(Object(g.a)(e=>e.patient))}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](O.a),o["\u0275\u0275inject"](C.a))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),de=(()=>{class e{constructor(e,t){this.patientResourceService=e,this.encounterResource=t,this.currentlyLoadedPatient=new a.BehaviorSubject(null),this.currentlyLoadedPatientUuid=new a.BehaviorSubject(null),this.isBusy=new a.BehaviorSubject(!1)}setCurrentlyLoadedPatientByUuid(e){return null!==this.currentlyLoadedPatient.value?this.currentlyLoadedPatient.value.uuid!==e&&this.fetchPatientByUuid(e):this.fetchPatientByUuid(e),this.currentlyLoadedPatient}fetchPatientByUuid(e){return this.currentlyLoadedPatient.next(null),this.currentlyLoadedPatientUuid.next(null),this.isBusy.next(!0),Object(a.forkJoin)(this.patientResourceService.getPatientByUuid(e,!1),this.encounterResource.getEncountersByPatientUuid(e)).subscribe(t=>{const n=t[0];n.encounters=t[1],this.currentlyLoadedPatient.next(n),this.currentlyLoadedPatientUuid.next(e),this.isBusy.next(!1)},e=>{console.error(e),this.isBusy.next(!1)})}reloadCurrentPatient(){null!==this.currentlyLoadedPatient.value&&this.fetchPatientByUuid(this.currentlyLoadedPatient.value.uuid)}resetPatientService(){this.currentlyLoadedPatient=new a.BehaviorSubject(null),this.currentlyLoadedPatientUuid=new a.BehaviorSubject(null),this.isBusy=new a.BehaviorSubject(!1)}}return e.\u0275fac=function(t){return new(t||e)(o["\u0275\u0275inject"](le),o["\u0275\u0275inject"](S))},e.\u0275prov=o["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),pe=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=o["\u0275\u0275defineInjector"]({providers:[ue.a,P,B,R,k,T,S,de,le,z,X],imports:[[l.b,O.b]]}),e})(),ge=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o["\u0275\u0275defineNgModule"]({type:e,bootstrap:[ae]}),e.\u0275inj=o["\u0275\u0275defineInjector"]({providers:[m.a,F.a,L,N,W,J,$,A],imports:[[r.a,I.c,H.q,c.a,pe]]}),e})();Object(o.enableProdMode)();const he=Object(s.b)({bootstrapFunction:e=>(u.next(e),r.c(Object(s.a)()).bootstrapModule(ge)),template:"<my-app-root />",NgZone:o.NgZone,AnimationEngine:i.b}),fe=he.bootstrap,me=he.mount,ve=he.unmount}}]);