"use strict";(self.webpackChunk_openmrs_esm_patient_notes_app=self.webpackChunk_openmrs_esm_patient_notes_app||[]).push([[788],{4123:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(9601),i=n.n(o),r=n(2609),a=n.n(r)()(i());a.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{padding:0;border:0;margin:0;font:inherit;font-size:100%;vertical-align:baseline}button,select,input,textarea{border-radius:0;font-family:inherit}input[type=text]::-ms-clear{display:none}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}body{line-height:1}sup{vertical-align:super}sub{vertical-align:sub}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote::before,blockquote::after,q::before,q::after{content:\"\"}table{border-collapse:collapse;border-spacing:0}*{box-sizing:border-box}button{margin:0}html{font-size:100%}body{font-weight:400;font-family:'IBM Plex Sans', 'Helvetica Neue', Arial, sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}code{font-family:'IBM Plex Mono', 'Menlo', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Courier, monospace}strong{font-weight:600}@media screen and (-ms-high-contrast: active){svg{fill:ButtonText}}h1{font-size:2.625rem;font-weight:300;line-height:1.199;letter-spacing:0}h2{font-size:2rem;font-weight:400;line-height:1.25;letter-spacing:0}h3{font-size:1.75rem;font-weight:400;line-height:1.29;letter-spacing:0}h4{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0}h5{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0}h6{font-size:.875rem;font-weight:600;line-height:1.29;letter-spacing:.16px}p{font-size:1rem;font-weight:400;line-height:1.5;letter-spacing:0}a{color:#0f62fe}em{font-style:italic}@keyframes -esm-patient-notes__visit-notes-form__skeleton___HUbzm{0%{opacity:.3;transform:scaleX(0);transform-origin:left}20%{opacity:1;transform:scaleX(1);transform-origin:left}28%{transform:scaleX(1);transform-origin:right}51%{transform:scaleX(0);transform-origin:right}58%{transform:scaleX(0);transform-origin:right}82%{transform:scaleX(1);transform-origin:right}83%{transform:scaleX(1);transform-origin:left}96%{transform:scaleX(0);transform-origin:left}100%{opacity:.3;transform:scaleX(0);transform-origin:left}}.-esm-patient-notes__visit-notes-form__heading___l9FHY{font-size:1.25rem;font-weight:400;line-height:1.4;letter-spacing:0;color:#161616;margin:1rem}.-esm-patient-notes__visit-notes-form__columnLabel___mX9v7{font-size:1rem;font-weight:600;line-height:1.375;letter-spacing:0;color:#525252}.-esm-patient-notes__visit-notes-form__diagnosis___sGurw{padding:1rem .75rem}.-esm-patient-notes__visit-notes-form__diagnosisList___BEv9y{margin-top:.25rem;background-color:#fff;max-height:14rem;overflow-y:auto;border:1px solid #e0e0e0}.-esm-patient-notes__visit-notes-form__diagnosisList___BEv9y li:hover{background-color:#e0e0e0}.-esm-patient-notes__visit-notes-form__diagnosesText___WoHFD{font-size:.875rem;font-weight:400;line-height:1.29;letter-spacing:.16px;color:#525252}.-esm-patient-notes__visit-notes-form__emptyResults___dkTzw{font-size:.875rem;font-weight:400;line-height:1.29;letter-spacing:.16px;color:#525252;min-height:1rem}.-esm-patient-notes__visit-notes-form__imgUploadHelperText___JUvQl{font-size:.875rem;font-weight:400;line-height:1.29;letter-spacing:.16px;color:#525252}.-esm-patient-notes__visit-notes-form__button___dQikV{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-notes__visit-notes-form__tablet___VHTiC{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-notes__visit-notes-form__desktop___z3TPX{padding:0rem}.-esm-patient-notes__visit-notes-form__form___fhgxR{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.-esm-patient-notes__visit-notes-form__grid___Pjcno{margin:0rem;padding:0rem}.-esm-patient-notes__visit-notes-form__row___zoD2m{margin:.5rem 0rem 2.75rem}",""]),a.locals={heading:"-esm-patient-notes__visit-notes-form__heading___l9FHY",columnLabel:"-esm-patient-notes__visit-notes-form__columnLabel___mX9v7",diagnosis:"-esm-patient-notes__visit-notes-form__diagnosis___sGurw",diagnosisList:"-esm-patient-notes__visit-notes-form__diagnosisList___BEv9y",diagnosesText:"-esm-patient-notes__visit-notes-form__diagnosesText___WoHFD",emptyResults:"-esm-patient-notes__visit-notes-form__emptyResults___dkTzw",imgUploadHelperText:"-esm-patient-notes__visit-notes-form__imgUploadHelperText___JUvQl",button:"-esm-patient-notes__visit-notes-form__button___dQikV",tablet:"-esm-patient-notes__visit-notes-form__tablet___VHTiC",desktop:"-esm-patient-notes__visit-notes-form__desktop___z3TPX",form:"-esm-patient-notes__visit-notes-form__form___fhgxR",grid:"-esm-patient-notes__visit-notes-form__grid___Pjcno",row:"-esm-patient-notes__visit-notes-form__row___zoD2m",skeleton:"-esm-patient-notes__visit-notes-form__skeleton___HUbzm"};const s=a},788:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ee});var o=n(9902),i=n.n(o),r=n(3565),a=n.n(r),s=n(9857),l=n(4924),c=n(3914),u=n(7898),m=n(6140),d=n(707),A=n(7161),p=n(6642),f=n(350),_=n(9408),g=n(786),v=n(4750),h=n(9513),b=n(5343),y=n(3172),E=n(7030),w=n(6549),k=n(8011),T=n(3066),N="159947AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",x="159394AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",C="159946AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",Z="159392AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",S="159393AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",z="159943AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",D="159944AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",P="1284AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",U=n(3236),H=n(321),L=n.n(H),I=n(1195),R=n.n(I),M=n(3275),j=n.n(M),V=n(7162),X=n.n(V),F=n(2094),q=n.n(F),B=n(757),O=n.n(B),W=n(4123),Q={};Q.styleTagTransform=O(),Q.setAttributes=X(),Q.insert=j().bind(null,"head"),Q.domAPI=R(),Q.insertStyleElement=q(),L()(W.Z,Q);const Y=W.Z&&W.Z.locals?W.Z.locals:void 0;function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,r=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return r}}(e,t)||K(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e){return function(e){if(Array.isArray(e))return G(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||K(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}const ee=function(e){var t=e.closeWorkspace,n=e.patientUuid,o=(0,l.useTranslation)().t,r="tablet"===(0,T.useLayoutType)(),H=(0,T.useSession)(),L=(0,s.kY)().mutate,I=(0,T.useConfig)().visitNoteConfig,R=I.clinicianEncounterRole,M=I.encounterNoteTextConceptUuid,j=I.encounterTypeUuid,V=I.formConceptUuid,X=J(i().useState(""),2),F=X[0],q=X[1],B=J(i().useState(""),2),O=B[0],W=B[1],Q=J(i().useState(""),2),G=Q[0],K=Q[1],ee=J(i().useState(!1),2),te=ee[0],ne=ee[1],oe=J(i().useState(null),2),ie=oe[0],re=oe[1],ae=J(i().useState(null),2),se=ae[0],le=ae[1],ce=J(i().useState(""),2),ue=ce[0],me=ce[1],de=J(i().useState([]),2),Ae=de[0],pe=de[1],fe=J(i().useState(null),2),_e=fe[0],ge=fe[1],ve=J(i().useState(new Date),2),he=ve[0],be=ve[1];i().useEffect((function(){var e,t;!H||G||O||(K(null==H||null===(e=H.sessionLocation)||void 0===e?void 0:e.uuid),W(null==H||null===(t=H.currentProvider)||void 0===t?void 0:t.uuid))}),[G,O,H]),i().useEffect((function(){var e=new AbortController;O&&(0,U.lu)(e,O).then((function(e){var t=e.data;le(t.uuid)})),G&&(0,U.jm)(e,G).then((function(e){var t=e.data;return re(t.uuid)}))}),[G,O]);var ye=i().useMemo((function(){return(0,c.Z)((function(e){if(e){var t=(0,U.NC)(e).subscribe((function(e){ge(e),ne(!1)}),(function(){return(0,T.createErrorHandler)()}));return function(){t.unsubscribe()}}}),500)}),[]),Ee=i().useCallback((function(e){if(e.preventDefault(),Ae.length){Ae.length&&(Ae[0].primary=!0);var i=Ae.map((function(e){return!0===e.confirmed&&!0===e.primary?{concept:N,groupMembers:[{concept:x,value:Z},{concept:C,value:z},{concept:P,value:e.concept.uuid}]}:!0===e.confirmed&&!1===e.primary?{concept:N,groupMembers:[{concept:x,value:Z},{concept:C,value:D},{concept:P,value:e.concept.uuid}]}:!1===e.confirmed&&!0===e.primary?{concept:N,groupMembers:[{concept:x,value:S},{concept:C,value:z},{concept:P,value:e.concept.uuid}]}:!1===e.confirmed&&!1===e.primary?{concept:N,groupMembers:[{concept:x,value:S},{concept:C,value:D},{concept:P,value:e.concept.uuid}]}:void 0}));F&&(i=[{concept:M,value:F}].concat($(i)));var r={encounterDatetime:a()(he).format(),patient:n,location:ie,encounterProviders:[{encounterRole:R,provider:se}],encounterType:j,form:V,obs:i},s=new AbortController;(0,U.aH)(s,r).then((function(e){201===e.status&&(t(),(0,T.showToast)({critical:!0,description:o("visitNoteNowVisible","It is now visible on the Encounters page"),kind:"success",title:o("visitNoteSaved","Visit note saved")}),L("/ws/rest/v1/encounter?patient=".concat(n,"&v=").concat("custom:(uuid,display,encounterDatetime,location:(uuid,display,name),encounterType:(name,uuid),auditInfo:(creator:(display),changedBy:(display)),encounterProviders:(provider:(person:(display))))")))})).catch((function(e){(0,T.createErrorHandler)(),(0,T.showNotification)({title:o("visitNoteSaveError","Error saving visit note"),kind:"error",critical:!0,description:null==e?void 0:e.message})})).finally((function(){s.abort()}))}}),[F,R,t,M,j,V,ie,L,n,se,Ae,o,he]);return i().createElement(u.Z,{className:Y.form},i().createElement(m.r,{className:Y.grid},r?i().createElement("h2",{className:Y.heading},o("addVisitNote","Add a visit note")):null,i().createElement(d.Z,{className:Y.row},i().createElement(A.Z,{sm:1},i().createElement("span",{className:Y.columnLabel},o("date","Date"))),i().createElement(A.Z,{sm:3},i().createElement(p.Z,{dateFormat:"d/m/Y",datePickerType:"single",light:r,maxDate:(new Date).toISOString(),value:he,onChange:function(e){var t=J(e,1)[0];return be(t)}},i().createElement(f.Z,{id:"visitDateTimePicker",labelText:o("visitDate","Visit date"),placeholder:"dd/mm/yyyy"})))),i().createElement(d.Z,{className:Y.row},i().createElement(A.Z,{sm:1},i().createElement("span",{className:Y.columnLabel},o("diagnosis","Diagnosis"))),i().createElement(A.Z,{sm:3},i().createElement("div",{className:Y.diagnosesText,style:{marginBottom:"1.188rem"}},Ae&&Ae.length?i().createElement(i().Fragment,null,Ae.map((function(e,t){return i().createElement(_.Z,{filter:!0,key:t,onClose:function(){return t=e,void pe(Ae.filter((function(e){return e.concept.id!==t.concept.id})));var t},style:{marginRight:"0.5rem"},type:0===t?"red":"blue"},e.concept.preferredName)}))):i().createElement("span",null,o("emptyDiagnosisText","No diagnosis selected — Enter a diagnosis below"))),i().createElement(g.Z,{legendText:o("searchForDiagnosis","Search for a diagnosis")},i().createElement(v.Z,{light:r,size:"xl",id:"diagnosisSearch",labelText:o("enterDiagnoses","Enter diagnoses"),placeholder:o("diagnosisInputPlaceholder","Choose a primary diagnosis first, then secondary diagnoses"),onChange:function(e){ne(!0);var t=e.target.value;me(t),t&&ye(t)},value:ue||""}),i().createElement("div",null,ue?te?i().createElement(h.Z,null):_e&&_e.length&&!te?i().createElement("ul",{className:Y.diagnosisList},_e.map((function(e,t){return i().createElement("li",{role:"menuitem",className:Y.diagnosis,key:t,onClick:function(){return t=e,me(""),ge(null),void pe((function(e){return $(e).concat([t])}));var t}},e.concept.preferredName)}))):i().createElement(b.n9,{light:r,className:Y.emptyResults},i().createElement("span",null,o("noMatchingDiagnoses","No diagnoses found matching")," ",i().createElement("strong",null,'"',ue,'"'))):null)))),i().createElement(d.Z,{className:Y.row},i().createElement(A.Z,{sm:1},i().createElement("span",{className:Y.columnLabel},o("note","Note"))),i().createElement(A.Z,{sm:3},i().createElement(y.Z,{id:"additionalNote",light:r,labelText:o("clinicalNoteLabel","Write an additional note"),placeholder:o("clinicalNotePlaceholder","Write any additional points here"),onChange:function(e){return q(e.currentTarget.value)}}))),i().createElement(d.Z,{className:Y.row},i().createElement(A.Z,{sm:1},i().createElement("span",{className:Y.columnLabel},o("image","Image"))),i().createElement(A.Z,{sm:3},i().createElement(g.Z,{legendText:o("addImageToVisit","Add an image to this visit")},i().createElement("p",{className:Y.imgUploadHelperText},o("imageUploadHelperText","Upload an image or use this device's camera to capture an image")),i().createElement(E.Z,{style:{marginTop:"1rem"},kind:"tertiary",onClick:function(){},renderIcon:k.Z},o("addImage","Add image")))))),i().createElement(w.Z,{className:r?Y.tablet:Y.desktop},i().createElement(E.Z,{className:Y.button,kind:"secondary",onClick:function(){return t()}},o("discard","Discard")),i().createElement(E.Z,{className:Y.button,kind:"primary",onClick:Ee,disabled:!Ae.length,type:"submit"},o("saveAndClose","Save and close"))))}},3236:(e,t,n)=>{n.d(t,{NC:()=>c,aH:()=>m,jm:()=>s,lu:()=>l,q6:()=>a});var o=n(9857),i=n(2188),r=n(3066);function a(e){var t,n,i=(0,r.useConfig)().visitNoteConfig,a=i.encounterNoteTextConceptUuid,s=i.problemListConceptUuid,l=i.visitDiagnosesConceptUuid,c="/ws/rest/v1/encounter?patient=".concat(e,"&obsConcept=").concat(l,"&v=").concat("custom:(uuid,display,encounterDatetime,patient,obs,encounterProviders:(uuid,display,encounterRole:(uuid,display),provider:(uuid,person:(uuid,display)))"),u=(0,o.ZP)(c,r.openmrsFetch),m=u.data,d=u.error,A=u.isValidating,p=null==m||null===(t=m.data)||void 0===t||null===(n=t.results)||void 0===n?void 0:n.map((function(e,t){var n,o,i,r,l,c,u;return{id:"".concat(t),diagnoses:e.obs.map((function(e){var t,n,o;return null===(n=null===(t=e.groupMembers)||void 0===t?void 0:t.find((function(e){return e.concept.uuid===s})))||void 0===n||null===(o=n.value)||void 0===o?void 0:o.display})).filter((function(e){return e})).join(", "),encounterDate:e.encounterDatetime,encounterNote:null===(n=e.obs.find((function(e){return e.concept.uuid===a})))||void 0===n?void 0:n.value,encounterNoteRecordedAt:null===(o=e.obs.find((function(e){return e.concept.uuid===a})))||void 0===o?void 0:o.obsDatetime,encounterProvider:null===(i=null==e?void 0:e.encounterProviders[0])||void 0===i||null===(r=i.provider)||void 0===r||null===(l=r.person)||void 0===l?void 0:l.display,encounterProviderRole:null===(c=null==e?void 0:e.encounterProviders[0])||void 0===c||null===(u=c.encounterRole)||void 0===u?void 0:u.display}}));return{visitNotes:m?p:null,isError:d,isLoading:!m&&!d,isValidating:A}}function s(e,t){return(0,r.openmrsFetch)("/ws/rest/v1/location/".concat(t),{signal:e.signal})}function l(e,t){return(0,r.openmrsFetch)("/ws/rest/v1/provider/".concat(t),{signal:e.signal})}function c(e){return(0,r.openmrsObservableFetch)("/coreapps/diagnoses/search.action?&term=".concat(e)).pipe((0,i.U)((function(e){return e.data})),(0,i.U)((function(e){return e.map(u)})))}function u(e){return{concept:e.concept,conceptReferenceTermCode:(t=e.concept.conceptMappings,t.find((function(e){return"ICD-10-WHO"===e.conceptReferenceTerm.conceptSource.name}))).conceptReferenceTerm.code,primary:!1,confirmed:!1};var t}function m(e,t){return(0,r.openmrsFetch)("/ws/rest/v1/encounter",{headers:{"Content-Type":"application/json"},method:"POST",body:t,signal:e.signal})}}}]);