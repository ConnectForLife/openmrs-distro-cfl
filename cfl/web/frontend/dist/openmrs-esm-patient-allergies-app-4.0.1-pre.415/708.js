/*! For license information please see 708.js.LICENSE.txt */
"use strict";(self.webpackChunk_openmrs_esm_patient_allergies_app=self.webpackChunk_openmrs_esm_patient_allergies_app||[]).push([[708],{8137:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(9601),r=a.n(n),l=a(2609),i=a.n(l)()(r());i.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}:root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-allergies__allergy-form__productiveHeading01___cnygp{font-size:var(--cds-heading-compact-01-font-size, 0.875rem);font-weight:var(--cds-heading-compact-01-font-weight, 600);line-height:var(--cds-heading-compact-01-line-height, 1.28572);letter-spacing:var(--cds-heading-compact-01-letter-spacing, 0.16px)}.-esm-patient-allergies__allergy-form__productiveHeading02____87Cx{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading03___vAEzx{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading04___uhiCO{font-size:var(--cds-heading-04-font-size, 1.75rem);font-weight:var(--cds-heading-04-font-weight, 400);line-height:var(--cds-heading-04-line-height, 1.28572);letter-spacing:var(--cds-heading-04-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading05___s0IqJ{font-size:var(--cds-heading-05-font-size, 2rem);font-weight:var(--cds-heading-05-font-weight, 400);line-height:var(--cds-heading-05-line-height, 1.25);letter-spacing:var(--cds-heading-05-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading06___Rd6wb{font-size:var(--cds-heading-06-font-size, 2rem);font-weight:var(--cds-heading-06-font-weight, 300);line-height:var(--cds-heading-06-line-height, 1.199);letter-spacing:var(--cds-heading-06-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__bodyShort01___YUIJk{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-allergies__allergy-form__bodyShort02___OVGny{font-size:var(--cds-body-compact-02-font-size, 1rem);font-weight:var(--cds-body-compact-02-font-weight, 400);line-height:var(--cds-body-compact-02-line-height, 1.375);letter-spacing:var(--cds-body-compact-02-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__bodyLong01___stSAh{font-size:var(--cds-body-01-font-size, 0.875rem);font-weight:var(--cds-body-01-font-weight, 400);line-height:var(--cds-body-01-line-height, 1.42857);letter-spacing:var(--cds-body-01-letter-spacing, 0.16px)}.-esm-patient-allergies__allergy-form__bodyLong02___WTHbc{font-size:var(--cds-body-02-font-size, 1rem);font-weight:var(--cds-body-02-font-weight, 400);line-height:var(--cds-body-02-line-height, 1.5);letter-spacing:var(--cds-body-02-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__label01___Ts6py{font-size:var(--cds-label-01-font-size, 0.75rem);font-weight:var(--cds-label-01-font-weight, 400);line-height:var(--cds-label-01-line-height, 1.33333);letter-spacing:var(--cds-label-01-letter-spacing, 0.32px)}.-esm-patient-allergies__allergy-form__header___PaLU9{border-bottom:.0625rem solid #e0e0e0;margin:0}.-esm-patient-allergies__allergy-form__content___gKWGr{display:grid;grid-template-columns:50% 10% 1fr;margin:.5rem 1rem;width:100%}.-esm-patient-allergies__allergy-form__container___aJnBu{border:solid 1px #e0e0e0;margin:0rem 1rem 1rem}.-esm-patient-allergies__allergy-form__container___aJnBu:first-of-type{margin-bottom:2rem}.-esm-patient-allergies__allergy-form__container___aJnBu:last-of-type{margin-top:2.5rem}.-esm-patient-allergies__allergy-form__heading___GK3_W{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0);margin:1rem 1rem .5rem}.-esm-patient-allergies__allergy-form__section___UwqDM:not(:first-of-type){margin-bottom:2rem}.-esm-patient-allergies__allergy-form__wrapperContainer___k0eio fieldset{display:grid;grid-template-columns:1fr 1fr;width:100%}.-esm-patient-allergies__allergy-form__wrapperContainer___k0eio .cds--radio-button__label{justify-content:flex-start}.-esm-patient-allergies__allergy-form__tablist___QGbxL .cds--tab--list{justify-content:center;width:100%}.-esm-patient-allergies__allergy-form__tab___YWoRN{flex-grow:1}.-esm-patient-allergies__allergy-form__sectionHeading___jz4a_{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0);margin:1rem 1rem .5rem}.-esm-patient-allergies__allergy-form__midSectionHeading___z3S3D{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0);margin:0rem 1rem .5rem}.-esm-patient-allergies__allergy-form__radio___mAjDb{margin:1rem 0rem}.-esm-patient-allergies__allergy-form__radio___mAjDb label{justify-content:flex-start}.-esm-patient-allergies__allergy-form__checkbox___xV_2V:not(:first-child){margin:.3rem 0rem}.-esm-patient-allergies__allergy-form__input___pRlYH{margin:0rem 1rem 1rem}.-esm-patient-allergies__allergy-form__checkboxContainer___bHHzf{display:grid;grid-template-columns:1fr 1fr}.-esm-patient-allergies__allergy-form__wrapper___SI3Ui{margin:1rem}.-esm-patient-allergies__allergy-form__wrapper___SI3Ui:last-of-type{margin-top:1.5rem}.-esm-patient-allergies__allergy-form__textbox___UssI9{width:26.375rem}.-esm-patient-allergies__allergy-form__button___ZloYx{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-allergies__allergy-form__tablet___mdaEI{padding:0rem}.-esm-patient-allergies__allergy-form__desktopButtons___RTWUZ{margin-top:2rem}.-esm-patient-allergies__allergy-form__tabletButtons___pySwH{margin-top:2rem;padding:1.5rem 1rem;background-color:#fff}.-esm-patient-allergies__allergy-form__desktop___LT0BC{padding:0rem}.-esm-patient-allergies__allergy-form__form___Xlnsa{display:flex;flex-direction:column;justify-content:space-between}.-esm-patient-allergies__allergy-form__desktopContainer___T4O7M{background-color:#f4f4f4}.-esm-patient-allergies__allergy-form__tabletContainer___R83py{background-color:#fff}.omrs-breakpoint-gt-tablet .-esm-patient-allergies__allergy-form__form___Xlnsa{height:calc(100vh - 6rem)}.omrs-breakpoint-gt-tablet .-esm-patient-allergies__allergy-form__section___UwqDM:last-of-type{margin-top:2rem}.omrs-breakpoint-lt-desktop .-esm-patient-allergies__allergy-form__form___Xlnsa{height:calc(100vh - 9rem)}.omrs-breakpoint-lt-desktop .-esm-patient-allergies__allergy-form__section___UwqDM:last-of-type{margin-top:0rem}",""]),i.locals={productiveHeading01:"-esm-patient-allergies__allergy-form__productiveHeading01___cnygp",productiveHeading02:"-esm-patient-allergies__allergy-form__productiveHeading02____87Cx",productiveHeading03:"-esm-patient-allergies__allergy-form__productiveHeading03___vAEzx",productiveHeading04:"-esm-patient-allergies__allergy-form__productiveHeading04___uhiCO",productiveHeading05:"-esm-patient-allergies__allergy-form__productiveHeading05___s0IqJ",productiveHeading06:"-esm-patient-allergies__allergy-form__productiveHeading06___Rd6wb",bodyShort01:"-esm-patient-allergies__allergy-form__bodyShort01___YUIJk",bodyShort02:"-esm-patient-allergies__allergy-form__bodyShort02___OVGny",bodyLong01:"-esm-patient-allergies__allergy-form__bodyLong01___stSAh",bodyLong02:"-esm-patient-allergies__allergy-form__bodyLong02___WTHbc",label01:"-esm-patient-allergies__allergy-form__label01___Ts6py",header:"-esm-patient-allergies__allergy-form__header___PaLU9",content:"-esm-patient-allergies__allergy-form__content___gKWGr",container:"-esm-patient-allergies__allergy-form__container___aJnBu",heading:"-esm-patient-allergies__allergy-form__heading___GK3_W",section:"-esm-patient-allergies__allergy-form__section___UwqDM",wrapperContainer:"-esm-patient-allergies__allergy-form__wrapperContainer___k0eio",tablist:"-esm-patient-allergies__allergy-form__tablist___QGbxL",tab:"-esm-patient-allergies__allergy-form__tab___YWoRN",sectionHeading:"-esm-patient-allergies__allergy-form__sectionHeading___jz4a_",midSectionHeading:"-esm-patient-allergies__allergy-form__midSectionHeading___z3S3D",radio:"-esm-patient-allergies__allergy-form__radio___mAjDb",checkbox:"-esm-patient-allergies__allergy-form__checkbox___xV_2V",input:"-esm-patient-allergies__allergy-form__input___pRlYH",checkboxContainer:"-esm-patient-allergies__allergy-form__checkboxContainer___bHHzf",wrapper:"-esm-patient-allergies__allergy-form__wrapper___SI3Ui",textbox:"-esm-patient-allergies__allergy-form__textbox___UssI9",button:"-esm-patient-allergies__allergy-form__button___ZloYx",tablet:"-esm-patient-allergies__allergy-form__tablet___mdaEI",desktopButtons:"-esm-patient-allergies__allergy-form__desktopButtons___RTWUZ",tabletButtons:"-esm-patient-allergies__allergy-form__tabletButtons___pySwH",desktop:"-esm-patient-allergies__allergy-form__desktop___LT0BC",form:"-esm-patient-allergies__allergy-form__form___Xlnsa",desktopContainer:"-esm-patient-allergies__allergy-form__desktopContainer___T4O7M",tabletContainer:"-esm-patient-allergies__allergy-form__tabletContainer___R83py"};const o=i},6708:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});var n=a(7900),r=a.n(n),l=a(4924),i=a(9857),o=a(1373),s=a(906),_=a(2303),c=a(6062),g=a.n(c),m=a(4036),d=a.n(m),p=a(6793),f=a.n(p),u=a(7892),h=a.n(u),y=a(1173),v=a.n(y),b=a(2464),w=a.n(b),k=a(8137),E={};E.styleTagTransform=w(),E.setAttributes=h(),E.insert=f().bind(null,"head"),E.domAPI=d(),E.insertStyleElement=v(),g()(k.Z,E);const C=k.Z&&k.Z.locals?k.Z.locals:void 0;function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,r,l=[],i=!0,o=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return l}}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return S(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?S(e,t):void 0}}const N=function(e){var t,a,c,g,m,d,p,f,u,h,y,v,b,w=e.closeWorkspace,k=e.promptBeforeClosing,E=e.patientUuid,N=(0,l.useTranslation)().t,z=(0,s.useConfig)().concepts,H="tablet"===(0,s.useLayoutType)(),T=[N("drug","Drug"),N("food","Food"),N("environmental","Environmental")],U=[N("mild","Mild"),N("moderate","Moderate"),N("severe","Severe")],R=(0,n.useMemo)((function(){return{patientUuid:E}}),[E]),O=(0,i.kY)().mutate,D=(0,n.useMemo)((function(){return z}),[z]),I=D.mildReactionUuid,L=D.severeReactionUuid,j=D.moderateReactionUuid,B=D.otherConceptUuid,Z=(c=(a=(0,s.useConfig)().concepts).drugAllergenUuid,g=a.environmentalAllergenUuid,m=a.foodAllergenUuid,d=a.allergyReactionUuid,p=(0,_.Z)("/ws/rest/v1/concept/".concat(c,"?v=full"),s.openmrsFetch).data,f=(0,_.Z)("/ws/rest/v1/concept/".concat(g,"?v=full"),s.openmrsFetch).data,u=(0,_.Z)("/ws/rest/v1/concept/".concat(m,"?v=full"),s.openmrsFetch).data,h=(0,_.Z)("/ws/rest/v1/concept/".concat(d,"?v=full"),s.openmrsFetch).data,y=function(e){var t,a;return null==e||null===(t=e.data)||void 0===t||null===(a=t.setMembers)||void 0===a?void 0:a.map((function(e){return{uuid:e.uuid,display:e.display}}))},v=y(p),b=y(f),{isLoading:!(p&&f&&u&&h),allergensAndAllergicReactions:{drugAllergens:v,foodAllergens:y(u),environmentalAllergens:b,allergicReactions:y(h)}}),Y=Z.allergensAndAllergicReactions,M=Z.isLoading,W=x((0,n.useState)([]),2),F=W[0],P=W[1],G=x((0,n.useState)(""),2),J=G[0],V=G[1],K=x((0,n.useState)(null),2),q=K[0],X=(K[1],x((0,n.useState)(""),2)),Q=X[0],$=X[1],ee=x((0,n.useState)(""),2),te=ee[0],ae=ee[1],ne=x((0,n.useState)(null),2),re=ne[0],le=ne[1],ie=x((0,n.useState)(""),2),oe=ie[0],se=ie[1],_e=x((0,n.useState)("DRUG"),2),ce=_e[0],ge=_e[1],me=x((0,n.useState)(""),2),de=me[0],pe=me[1];(0,n.useEffect)((function(){k((function(){return Boolean(Q||te||re||oe||de)}))}),[k,Q,te,re,oe,ce,de]);var fe=(0,n.useCallback)((function(e,t){var a=t.checked,n=t.id;P(a?function(e){return(t=e,function(e){if(Array.isArray(e))return S(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||A(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([n]);var t}:function(e){return e.filter((function(e){return e!==n}))})}),[]),ue=(0,n.useCallback)((function(e){e.preventDefault();var t={allergen:oe===B?{allergenType:ce,codedAllergen:{uuid:oe},nonCodedAllergen:Q}:{allergenType:ce,codedAllergen:{uuid:oe}},severity:{uuid:de},comment:J,reactions:null==F?void 0:F.map((function(e){return e===B?{reaction:{uuid:e},reactionNonCoded:te}:{reaction:{uuid:e}}}))},a=new AbortController;(function(e,t,a){return(0,s.openmrsFetch)("/ws/rest/v1/patient/".concat(t,"/allergy"),{headers:{"Content-Type":"application/json"},method:"POST",body:e,signal:a.signal})})(t,E,a).then((function(e){201===e.status&&(w(),(0,s.showToast)({critical:!0,kind:"success",title:N("allergySaved","Allergy saved"),description:N("allergyNowVisible","It is now visible on the Allergies page")}),O("".concat(s.fhirBaseUrl,"/AllergyIntolerance?patient=").concat(E)))}),(function(e){(0,s.showNotification)({title:N("allergySaveError","Error saving allergy"),kind:"error",critical:!0,description:null==e?void 0:e.message})})).finally((function(){return a.abort()}))}),[oe,B,ce,Q,de,J,F,E,te,w,N,O]);return r().createElement(o.l09,null,H?r().createElement(o.X2j,{className:C.header},r().createElement(s.ExtensionSlot,{className:C.content,extensionSlotName:"patient-details-header-slot",state:R})):null,r().createElement("div",{className:"".concat(C.form," ").concat(H?C.tablet:C.desktop)},r().createElement("div",null,r().createElement("h1",{className:C.heading},N("allergensAndReactions","Allergens and reactions")),q?r().createElement(o.K0D,{style:{margin:"0rem",minWidth:"100%"},kind:"error",lowContrast:!0,title:N("errorFetchingData","Error fetching allergens and reactions"),subtitle:N("tryReopeningTheForm","Please try launching the form again")}):null,r().createElement("div",{className:"".concat(C.container," ").concat(H?C.tabletContainer:C.desktopContainer)},r().createElement("section",{className:C.section},r().createElement("h2",{className:C.sectionHeading},N("selectAllergens","Select the allergens")),r().createElement(o.mQc,{onSelectionChange:function(e){switch(e){case 0:ge("DRUG");break;case 1:ge("FOOD");break;case 2:ge("ENVIRONMENT")}}},r().createElement(o.tdY,{"aria-label":"Allergen tabs",className:C.tablist},T.map((function(e,t){return r().createElement(o.OK9,{className:C.tab,id:"tab-".concat(t+1),key:"allergen-tab-".concat(t)},e)}))),r().createElement(o.nPR,null,M?r().createElement(o.lSo,{style:{margin:"1rem"},description:N("loading","Loading...")}):T.map((function(e,t){var a,n=e.toLowerCase()+"Allergens";return r().createElement(o.x45,{key:"allergen-tab-panel-".concat(t)},r().createElement("div",{className:H?C.wrapperContainer:void 0},r().createElement(o.SYO,{name:"allergen-type-".concat(t+1),key:n,orientation:"vertical",onChange:function(e){return se(e.toString())},valueSelected:oe},null==Y||null===(a=Y[n])||void 0===a?void 0:a.map((function(e,t){return r().createElement(o.EUY,{key:"allergen-".concat(t),className:C.radio,id:e.display,labelText:e.display,value:e.uuid})})))))})))),oe===B?r().createElement("div",{className:C.input},r().createElement(o.oil,{light:H,id:"nonCodedAllergenType",labelText:N("otherNonCodedAllergen","Other non-coded allergen"),onChange:function(e){return $(e.target.value)},placeholder:N("typeAllergenName","Please type in the name of the allergen")})):null),r().createElement("section",{className:C.section},r().createElement("h2",{className:C.midSectionHeading},N("selectReactions","Select the reactions")),r().createElement("div",{className:H?C.checkboxContainer:void 0,style:{margin:"1rem"}},M?r().createElement(o.lSo,{description:N("loading","Loading...")}):null==Y||null===(t=Y.allergicReactions)||void 0===t?void 0:t.map((function(e,t){return r().createElement(o.XZJ,{className:C.checkbox,key:t,labelText:e.display,id:e.uuid,onChange:fe,value:e.display})}))),F.includes(B)?r().createElement("div",{className:C.input},r().createElement(o.oil,{light:H,id:"nonCodedAllergicReaction",labelText:N("otherNonCodedAllergicReaction","Other non-coded allergic reaction"),onChange:function(e){return ae(e.target.value)},placeholder:N("typeAllergicReactionName","Please type in the name of the allergic reaction")})):null)),r().createElement("h1",{className:C.heading},N("severityAndOnsetDate","Severity and date of onset")),r().createElement("div",{className:"".concat(C.container," ").concat(H?C.tabletContainer:C.desktopContainer)},r().createElement("section",{className:C.section},r().createElement("h2",{className:C.sectionHeading},N("severityOfWorstReaction","Severity of worst reaction")),r().createElement("div",{className:C.wrapper},r().createElement(o.SYO,{name:"severity-of-worst-reaction",onChange:function(e){return pe(e.toString())},valueSelected:de},U.map((function(e,t){return r().createElement(o.EUY,{id:e.toLowerCase()+"Severity",key:"severity-".concat(t),labelText:e,value:function(){switch(e.toLowerCase()){case"mild":return I;case"moderate":return j;case"severe":return L;default:return""}}()})}))))),r().createElement("section",{className:C.section},r().createElement("h2",{className:C.sectionHeading},N("dateAndComments","Date and comments")),r().createElement("div",{className:C.wrapper},r().createElement(o.Mtg,{id:"onsetDate",dateFormat:"d/m/Y",datePickerType:"single",light:!H,maxDate:(new Date).toISOString(),onChange:function(e){var t=x(e,1)[0];return le(t)},value:re},r().createElement(o.aj6,{id:"onsetDateInput",placeholder:"dd/mm/yyyy",labelText:N("dateOfFirstOnset","Date of first onset")}))),r().createElement("div",{className:C.wrapper},r().createElement(o.Kx8,{className:C.textbox,cols:20,light:!H,id:"comments",invalidText:N("invalidComment","Invalid comment, try again"),labelText:N("comments","Comments"),onChange:function(e){return V(e.target.value)},placeholder:N("typeAdditionalComments","Type any additional comments here"),rows:4}))))),r().createElement(o.uVA,{className:H?C.tabletButtons:C.desktopButtons},r().createElement(o.zxk,{className:C.button,onClick:w,kind:"secondary"},N("discard","Discard")),r().createElement(o.zxk,{className:C.button,disabled:!oe||oe===B&&!Q,onClick:ue,kind:"primary"},N("saveAndClose","Save and close")))))}},2303:(e,t,a)=>{a.d(t,{Z:()=>s});var n,r,l=a(9857),i=function(){return i=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},o=function(e){return"function"==typeof e[1]?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}]},s=(n=l.ZP,r=function(e){return function(t,a,n){return n.revalidateOnFocus=!1,n.revalidateIfStale=!1,n.revalidateOnReconnect=!1,e(t,a,n)}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a=o(e),l=a[0],s=a[1],_=a[2],c=(_.use||[]).concat(r);return n(l,s,i(i({},_),{use:c}))})}}]);