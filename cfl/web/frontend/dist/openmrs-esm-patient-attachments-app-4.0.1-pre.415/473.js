"use strict";(self.webpackChunk_openmrs_esm_patient_attachments_app=self.webpackChunk_openmrs_esm_patient_attachments_app||[]).push([[473],{5088:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(9601),i=a.n(n),r=a(2609),o=a.n(r)()(i());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}:root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-attachments__camera-media-uploader__productiveHeading03___cK2Tc{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0)}.-esm-patient-attachments__camera-media-uploader__productiveHeading02___onTYY{font-size:var(--cds-productive-heading-02-font-size, 1rem);font-weight:var(--cds-productive-heading-02-font-weight, 600);line-height:var(--cds-productive-heading-02-line-height, 1.375);letter-spacing:var(--cds-productive-heading-02-letter-spacing, 0)}.-esm-patient-attachments__camera-media-uploader__productiveHeading03___cK2Tc{font-size:var(--cds-productive-heading-03-font-size, 1.25rem);font-weight:var(--cds-productive-heading-03-font-weight, 400);line-height:var(--cds-productive-heading-03-line-height, 1.4);letter-spacing:var(--cds-productive-heading-03-letter-spacing, 0)}.-esm-patient-attachments__camera-media-uploader__bodyLong01___koc1E{font-size:var(--cds-body-long-01-font-size, 0.875rem);font-weight:var(--cds-body-long-01-font-weight, 400);line-height:var(--cds-body-long-01-line-height, 1.42857);letter-spacing:var(--cds-body-long-01-letter-spacing, 0.16px)}.-esm-patient-attachments__camera-media-uploader__muted___Hdosm{color:#525252}.-esm-patient-attachments__camera-media-uploader__bodyShort01___U_uBw{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-attachments__camera-media-uploader__text02___S7o14{color:#525252}.-esm-patient-attachments__camera-media-uploader__cameraSection___r2K23{width:inherit;background-color:#fff}.-esm-patient-attachments__camera-media-uploader__cameraSection___r2K23 .react-html5-camera-photo>img,.-esm-patient-attachments__camera-media-uploader__cameraSection___r2K23 .react-html5-camera-photo>video{max-width:100%;max-height:100%}.-esm-patient-attachments__camera-media-uploader__uploadFile___gQ4CJ{color:#fff}.-esm-patient-attachments__camera-media-uploader__uploadFile___gQ4CJ label{max-width:unset}.-esm-patient-attachments__camera-media-uploader__uploadFile___gQ4CJ label>div{height:25rem;justify-content:center;align-items:center}.-esm-patient-attachments__camera-media-uploader__modalBody___koSK5{padding:0;margin:0}@media(max-width: 1023px){.-esm-patient-attachments__camera-media-uploader__frameContent___Jzn_Z{width:65%}}",""]),o.locals={productiveHeading03:"-esm-patient-attachments__camera-media-uploader__productiveHeading03___cK2Tc",productiveHeading02:"-esm-patient-attachments__camera-media-uploader__productiveHeading02___onTYY",bodyLong01:"-esm-patient-attachments__camera-media-uploader__bodyLong01___koc1E",muted:"-esm-patient-attachments__camera-media-uploader__muted___Hdosm",bodyShort01:"-esm-patient-attachments__camera-media-uploader__bodyShort01___U_uBw",text02:"-esm-patient-attachments__camera-media-uploader__text02___S7o14",cameraSection:"-esm-patient-attachments__camera-media-uploader__cameraSection___r2K23",uploadFile:"-esm-patient-attachments__camera-media-uploader__uploadFile___gQ4CJ",modalBody:"-esm-patient-attachments__camera-media-uploader__modalBody___koSK5",frameContent:"-esm-patient-attachments__camera-media-uploader__frameContent___Jzn_Z"};const c=o},8265:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(9601),i=a.n(n),r=a(2609),o=a.n(r)()(i());o.push([e.id,':root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-attachments__file-review__productiveHeading03___NrGXN{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0)}.-esm-patient-attachments__file-review__productiveHeading02___x0WfH{font-size:var(--cds-productive-heading-02-font-size, 1rem);font-weight:var(--cds-productive-heading-02-font-weight, 600);line-height:var(--cds-productive-heading-02-line-height, 1.375);letter-spacing:var(--cds-productive-heading-02-letter-spacing, 0)}.-esm-patient-attachments__file-review__productiveHeading03___NrGXN{font-size:var(--cds-productive-heading-03-font-size, 1.25rem);font-weight:var(--cds-productive-heading-03-font-weight, 400);line-height:var(--cds-productive-heading-03-line-height, 1.4);letter-spacing:var(--cds-productive-heading-03-letter-spacing, 0)}.-esm-patient-attachments__file-review__bodyLong01___wyVHf{font-size:var(--cds-body-long-01-font-size, 0.875rem);font-weight:var(--cds-body-long-01-font-weight, 400);line-height:var(--cds-body-long-01-line-height, 1.42857);letter-spacing:var(--cds-body-long-01-letter-spacing, 0.16px)}.-esm-patient-attachments__file-review__muted___gXt_L{color:#525252}.-esm-patient-attachments__file-review__bodyShort01___IOBTV{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-attachments__file-review__text02___wzp9k{color:#525252}.-esm-patient-attachments__file-review__filePreviewContainer___WBlkz{background-color:#fff}.-esm-patient-attachments__file-review__overview___FnEr8{display:grid;grid-template-columns:1fr 1fr}.-esm-patient-attachments__file-review__overview___FnEr8 img{max-width:100%;max-height:20rem;display:block;align-self:center;justify-self:center}.-esm-patient-attachments__file-review__overview___FnEr8 .-esm-patient-attachments__file-review__imageDetails___govcy{margin-left:1rem}.-esm-patient-attachments__file-review__captionFrame___fukoC{margin-bottom:.3rem}.-esm-patient-attachments__file-review__buttonSetOverrides___YlgMP{margin:1rem auto 0;display:grid;grid-template-columns:1fr 1fr}.-esm-patient-attachments__file-review__buttonSetOverrides___YlgMP>button{max-width:unset}.-esm-patient-attachments__file-review__filePlaceholder___RAZFT{background-color:#c6c6c6;display:flex;justify-content:center;align-items:center;width:50%;margin:0 auto}.-esm-patient-attachments__file-review__filePlaceholder___RAZFT::after{content:"";display:block;padding-bottom:100%}',""]),o.locals={productiveHeading03:"-esm-patient-attachments__file-review__productiveHeading03___NrGXN",productiveHeading02:"-esm-patient-attachments__file-review__productiveHeading02___x0WfH",bodyLong01:"-esm-patient-attachments__file-review__bodyLong01___wyVHf",muted:"-esm-patient-attachments__file-review__muted___gXt_L",bodyShort01:"-esm-patient-attachments__file-review__bodyShort01___IOBTV",text02:"-esm-patient-attachments__file-review__text02___wzp9k",filePreviewContainer:"-esm-patient-attachments__file-review__filePreviewContainer___WBlkz",overview:"-esm-patient-attachments__file-review__overview___FnEr8",imageDetails:"-esm-patient-attachments__file-review__imageDetails___govcy",captionFrame:"-esm-patient-attachments__file-review__captionFrame___fukoC",buttonSetOverrides:"-esm-patient-attachments__file-review__buttonSetOverrides___YlgMP",filePlaceholder:"-esm-patient-attachments__file-review__filePlaceholder___RAZFT"};const c=o},6591:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(9601),i=a.n(n),r=a(2609),o=a.n(r)()(i());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-attachments__media-uploader__productiveHeading03___bEWSH{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0)}.-esm-patient-attachments__media-uploader__productiveHeading02___RxdlP{font-size:var(--cds-productive-heading-02-font-size, 1rem);font-weight:var(--cds-productive-heading-02-font-weight, 600);line-height:var(--cds-productive-heading-02-line-height, 1.375);letter-spacing:var(--cds-productive-heading-02-letter-spacing, 0)}.-esm-patient-attachments__media-uploader__productiveHeading03___bEWSH{font-size:var(--cds-productive-heading-03-font-size, 1.25rem);font-weight:var(--cds-productive-heading-03-font-weight, 400);line-height:var(--cds-productive-heading-03-line-height, 1.4);letter-spacing:var(--cds-productive-heading-03-letter-spacing, 0)}.-esm-patient-attachments__media-uploader__bodyLong01___AUif9{font-size:var(--cds-body-long-01-font-size, 0.875rem);font-weight:var(--cds-body-long-01-font-weight, 400);line-height:var(--cds-body-long-01-line-height, 1.42857);letter-spacing:var(--cds-body-long-01-letter-spacing, 0.16px)}.-esm-patient-attachments__media-uploader__muted___FbNl8{color:#525252}.-esm-patient-attachments__media-uploader__bodyShort01___YNdVs{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-attachments__media-uploader__text02___trsO3{color:#525252}.-esm-patient-attachments__media-uploader__uploadFile___kVQpp{color:#fff}.-esm-patient-attachments__media-uploader__uploadFile___kVQpp label{max-width:unset}.-esm-patient-attachments__media-uploader__uploadFile___kVQpp label>div{height:25rem;justify-content:center;align-items:center}",""]),o.locals={productiveHeading03:"-esm-patient-attachments__media-uploader__productiveHeading03___bEWSH",productiveHeading02:"-esm-patient-attachments__media-uploader__productiveHeading02___RxdlP",bodyLong01:"-esm-patient-attachments__media-uploader__bodyLong01___AUif9",muted:"-esm-patient-attachments__media-uploader__muted___FbNl8",bodyShort01:"-esm-patient-attachments__media-uploader__bodyShort01___YNdVs",text02:"-esm-patient-attachments__media-uploader__text02___trsO3",uploadFile:"-esm-patient-attachments__media-uploader__uploadFile___kVQpp"};const c=o},883:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(9601),i=a.n(n),r=a(2609),o=a.n(r)()(i());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-attachments__uploading-status__productiveHeading03___PcPDM{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0)}.-esm-patient-attachments__uploading-status__productiveHeading02___J3SzN{font-size:var(--cds-productive-heading-02-font-size, 1rem);font-weight:var(--cds-productive-heading-02-font-weight, 600);line-height:var(--cds-productive-heading-02-line-height, 1.375);letter-spacing:var(--cds-productive-heading-02-letter-spacing, 0)}.-esm-patient-attachments__uploading-status__productiveHeading03___PcPDM{font-size:var(--cds-productive-heading-03-font-size, 1.25rem);font-weight:var(--cds-productive-heading-03-font-weight, 400);line-height:var(--cds-productive-heading-03-line-height, 1.4);letter-spacing:var(--cds-productive-heading-03-letter-spacing, 0)}.-esm-patient-attachments__uploading-status__bodyLong01___r9DWs{font-size:var(--cds-body-long-01-font-size, 0.875rem);font-weight:var(--cds-body-long-01-font-weight, 400);line-height:var(--cds-body-long-01-line-height, 1.42857);letter-spacing:var(--cds-body-long-01-letter-spacing, 0.16px)}.-esm-patient-attachments__uploading-status__muted____9Ft7{color:#525252}.-esm-patient-attachments__uploading-status__bodyShort01___UBHs8{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-attachments__uploading-status__text02___Jv1Nk{color:#525252}.-esm-patient-attachments__uploading-status__cameraSection___ImhVx{width:inherit;background-color:#fff}.-esm-patient-attachments__uploading-status__uploadingFilesSection___FztkJ{display:flex;flex-direction:column;justify-content:center;align-items:center;height:25rem;overflow-y:auto;border:1px dashed #8d8d8d}.-esm-patient-attachments__uploading-status__buttonSet___ix1we{width:100%;display:grid;grid-template-columns:1fr 1fr}.-esm-patient-attachments__uploading-status__buttonSet___ix1we button{max-width:unset !important}",""]),o.locals={productiveHeading03:"-esm-patient-attachments__uploading-status__productiveHeading03___PcPDM",productiveHeading02:"-esm-patient-attachments__uploading-status__productiveHeading02___J3SzN",bodyLong01:"-esm-patient-attachments__uploading-status__bodyLong01___r9DWs",muted:"-esm-patient-attachments__uploading-status__muted____9Ft7",bodyShort01:"-esm-patient-attachments__uploading-status__bodyShort01___UBHs8",text02:"-esm-patient-attachments__uploading-status__text02___Jv1Nk",cameraSection:"-esm-patient-attachments__uploading-status__cameraSection___ImhVx",uploadingFilesSection:"-esm-patient-attachments__uploading-status__uploadingFilesSection___FztkJ",buttonSet:"-esm-patient-attachments__uploading-status__buttonSet___ix1we"};const c=o},2067:(e,t,a)=>{a.d(t,{OE:()=>m,Rs:()=>_,eK:()=>d,ky:()=>p});var n=a(5047),i=a.n(n),r=a(7900),o=a(9857),c=a(906);function l(e,t,a,n,i,r,o){try{var c=e[r](o),l=c.value}catch(e){return void a(e)}c.done?t(l):Promise.resolve(l).then(n,i)}function s(e){return function(){var t=this,a=arguments;return new Promise((function(n,i){var r=e.apply(t,a);function o(e){l(r,n,i,o,c,"next",e)}function c(e){l(r,n,i,o,c,"throw",e)}o(void 0)}))}}var d="/ws/rest/v1/attachment";function _(e,t){var a,n=(0,o.ZP)("".concat(d,"?patient=").concat(e,"&includeEncounterless=").concat(t),c.openmrsFetch),i=n.data,l=n.error,s=n.mutate,_=n.isValidating;return(0,r.useMemo)((function(){return{isLoading:!i&&!l,data:null!==(a=null==i?void 0:i.data.results)&&void 0!==a?a:[],error:l,mutate:s,isValidating:_}}),[_,i,l,s])}function m(e,t){return u.apply(this,arguments)}function u(){return(u=s(i().mark((function e(t,a){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("fileCaption",a.fileName),n.append("patient",t),a.file?n.append("file",a.file):(n.append("file",new File([""],a.fileName),a.fileName),n.append("base64Content",a.base64Content)),e.abrupt("return",(0,c.openmrsFetch)("".concat(d),{method:"POST",body:n}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return(0,c.openmrsFetch)("".concat(d,"/").concat(e),{method:"DELETE",signal:t.signal})}},3473:(e,t,a)=>{a.r(t),a.d(t,{default:()=>G});var n=a(7900),i=a.n(n),r=a(906);const o=(0,n.createContext)({});var c=a(4924),l=a(1569),s=a.n(l);a(3311);const d=function(e){var t=e.mediaStream,a=e.stopCameraStream,r=(0,n.useContext)(o),c=r.handleTakePhoto,l=r.setError;(0,n.useEffect)((function(){return function(){a()}}),[a]);var d=(0,n.useCallback)((function(e){t.current=e}),[t]);return i().createElement(s(),{onTakePhoto:c,onCameraStart:d,onCameraStop:a,onCameraError:l})};var _=a(6062),m=a.n(_),u=a(4036),p=a.n(u),f=a(6793),h=a.n(f),g=a(7892),v=a.n(g),b=a(1173),y=a.n(b),w=a(2464),S=a.n(w),E=a(5088),x={};x.styleTagTransform=S(),x.setAttributes=v(),x.insert=h().bind(null,"head"),x.domAPI=p(),x.insertStyleElement=y(),m()(E.Z,x);const C=E.Z&&E.Z.locals?E.Z.locals:void 0;var k=a(841),z=a(6591),O={};O.styleTagTransform=S(),O.setAttributes=v(),O.insert=h().bind(null,"head"),O.domAPI=p(),O.insertStyleElement=y(),m()(z.Z,O);const T=z.Z&&z.Z.locals?z.Z.locals:void 0;var F=a(7326);function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}const A=function(){var e=(0,n.useContext)(o),t=e.setFilesToUpload,a=e.allowedExtensions,l=e.multipleFiles,s=(0,c.useTranslation)().t,d=(0,r.useConfig)().fileSize,_=(0,n.useCallback)((function(e){e.forEach((function(e){e.size<=1024*d*1024?(0,F.Z)(e).then((function(a){t((function(t){return(n=t,function(e){if(Array.isArray(e))return P(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?P(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([{base64Content:a,file:e,fileName:e.name,fileType:"image"===e.type.split("/")[0]?"image":"pdf"===e.type.split("/")[1]?"pdf":"other",fileDescription:"",status:"uploading"}]);var n}))})):(0,r.showToast)({title:s("fileSizeLimitExceededText","File size limit exceeded"),description:"".concat(e.name," ").concat(s("fileSizeLimitExceeded","exceeds the file size of")," ").concat(d," MB"),kind:"error"})}))}),[t,d,s]);return i().createElement("div",{className:"cds--file__container"},i().createElement("p",{className:"cds--label-description"},s("fileUploadSizeConstrains","File limit is")," ",d,"MB"),i().createElement("div",{className:T.uploadFile},i().createElement(k.awp,{accept:null!=a?a:"*",labelText:s("fileSizeInstructions","Drag and drop files here or click to upload"),tabIndex:0,multiple:l,onAddFiles:function(e,t){var a=t.addedFiles;_(a)}})))};var j=a(8265),H={};H.styleTagTransform=S(),H.setAttributes=v(),H.insert=h().bind(null,"head"),H.domAPI=p(),H.insertStyleElement=y(),m()(j.Z,H);const N=j.Z&&j.Z.locals?j.Z.locals:void 0;var D=a(2525);function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Z(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,c=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(r.push(n.value),!t||r.length!==t);o=!0);}catch(e){c=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(c)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var L=function(e){var t=e.uploadedFile,a=e.collectDescription,o=e.onSaveFile,l=e.clearData,s=U((0,n.useState)(""),2),d=s[0],_=s[1],m=U((0,n.useState)(""),2),u=m[0],p=m[1],f=(0,c.useTranslation)().t,h=U((0,n.useState)(!1),2),g=h[0],v=h[1];(0,n.useEffect)((function(){_(t.fileName),p(t.fileDescription)}),[t]);var b=(0,n.useCallback)((function(e){var a,n;e.preventDefault(),null==o||o((a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){Z(e,t,a[t])}))}return e}({},t),n=null!=(n={fileName:d,fileDescription:u})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(n)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(n,e))})),a))}),[o,d,u,t]),y=(0,n.useCallback)((function(e){e.preventDefault(),null==l||l()}),[l]),w=(0,n.useCallback)((function(e){e.preventDefault(),""===e.target.value?v(!0):g&&v(!1),_(e.target.value)}),[v,_,g]),S=(0,n.useCallback)((function(e){e.preventDefault(),p(e.target.value)}),[p]);return i().createElement("form",{onSubmit:b},i().createElement(k.fef,{className:N.overview},"image"===t.fileType?i().createElement("img",{src:t.base64Content,alt:"placeholder"}):"pdf"===t.fileType?i().createElement("div",{className:N.filePlaceholder},i().createElement(D.Lk,{size:16})):i().createElement("div",{className:N.filePlaceholder},i().createElement(D.Qf,{size:16})),i().createElement("div",{className:N.imageDetails},i().createElement("div",{className:N.captionFrame},i().createElement(k.oil,{id:"caption",labelText:"".concat("image"===t.fileType?f("image","Image"):f("file","File")," ").concat(f("name","name")),autoComplete:"off",placeholder:f("attachmentCaptionInstruction","Enter caption"),onChange:w,required:!0,value:d,invalid:g,autoFocus:!0,invalidText:g&&f("fieldRequired","This field is required")})),a&&i().createElement(k.Kx8,{id:"description",labelText:f("imageDescription","Image description"),autoComplete:"off",placeholder:f("attachmentCaptionInstruction","Enter caption"),value:u,onChange:S}))),i().createElement(k.mzw,null,i().createElement(r.UserHasAccess,{privilege:"Create Attachment"},i().createElement(k.zxk,{kind:"secondary",size:"lg",onClick:y},f("cancel","Cancel")),i().createElement(k.zxk,{type:"submit",size:"lg",onClick:b,disabled:g},f("addAttachment","Add attachment")))))};const M=function(e){var t=e.onCompletion,a=(0,n.useContext)(o),r=a.filesToUpload,l=a.clearData,s=a.setFilesToUpload,d=a.collectDescription,_=(0,c.useTranslation)().t,m=U((0,n.useState)(1),2),u=m[0],p=m[1],f=(0,n.useCallback)((function(){u<r.length?p(u+1):t()}),[p,u,r,t]),h=(0,n.useCallback)((function(e){s((function(t){return t.map((function(t,a){return a===u-1?e:t}))})),f()}),[f,s,u]);return i().createElement("div",{className:N.filePreviewContainer},i().createElement(k.xBx,{className:N.productiveHeading03},_("addAttachment","Add Attachment")," ",r.length>1&&"(".concat(u," of ").concat(r.length,")")),i().createElement(L,{uploadedFile:r[u-1],clearData:l,onSaveFile:h,moveToNextFile:f,collectDescription:"image"===r[u-1].fileType&&d}))};var B=a(883),V={};V.styleTagTransform=S(),V.setAttributes=v(),V.insert=h().bind(null,"head"),V.domAPI=p(),V.insertStyleElement=y(),m()(B.Z,V);const K=B.Z&&B.Z.locals?B.Z.locals:void 0;function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function R(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function W(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){R(e,t,a[t])}))}return e}function Y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}const Q=function(){var e,t,a=(0,c.useTranslation)().t,l=(0,n.useContext)(o),s=l.filesToUpload,d=l.saveFile,_=l.closeModal,m=l.clearData,u=l.onCompletion,p=(e=(0,n.useState)([]),t=2,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,c=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(r.push(n.value),!t||r.length!==t);o=!0);}catch(e){c=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(c)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?J(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=p[0],h=p[1];return(0,n.useEffect)((function(){s&&h(s.map((function(e){return Y(W({},e),{status:"uploading"})})))}),[s,h]),(0,n.useEffect)((function(){Promise.all(s.map((function(e,t){return d(e).then((function(){(0,r.showToast)({title:a("uploadComplete","Upload complete"),description:"".concat(e.fileName," ").concat(a("uploadedSuccessfully","uploaded successfully")),kind:"success"}),h((function(e){return e.map((function(e,a){return a===t?Y(W({},e),{status:"complete"}):e}))}))})).catch((function(t){(0,r.showToast)({title:"".concat(a("uploading","Uploading")," ").concat(e.fileName," ").concat(a("failed","failed")),description:t,kind:"error"})}))}))).then((function(){null==u||u()}))}),[u,d,s,a,h]),i().createElement("div",{className:K.cameraSection},i().createElement(k.xBx,{className:K.productiveHeading03},a("addAttachment","Add Attachment")),i().createElement(k.fef,null,i().createElement("p",{className:"cds--label-description"},a("uploadWillContinueInTheBackground","Files will be uploaded in the background. You can close this modal.")),i().createElement("div",{className:K.uploadingFilesSection},f.map((function(e,t){return i().createElement(k.Py3,{key:t,name:e.fileName,status:e.status,size:"lg"})})))),i().createElement(k.mzw,null,i().createElement(k.uVA,{className:K.buttonSet},i().createElement(k.zxk,{size:"lg",kind:"secondary",onClick:m},a("addMoreAttachments","Add more attachments")),i().createElement(k.zxk,{size:"lg",kind:"primary",onClick:_},a("closeModal","Close")))))};function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,c=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(r.push(n.value),!t||r.length!==t);o=!0);}catch(e){c=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(c)throw i}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?X(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var q=function(){var e=(0,c.useTranslation)().t,t=$((0,n.useState)("upload"),2),a=t[0],r=t[1],l=(0,n.useContext)(o).cameraOnly,s=(0,n.useRef)(),_=(0,n.useCallback)((function(){var e;null===(e=s.current)||void 0===e||e.getTracks().forEach((function(e){return e.stop()}))}),[s]);return(0,n.useEffect)((function(){return function(){_()}}),[_]),l?i().createElement(d,{mediaStream:s,stopCameraStream:_}):i().createElement("div",{className:C.cameraSection},i().createElement(k.xBx,null,e("addAttachment","Add Attachment")),i().createElement(k.fef,{className:C.modalBody},i().createElement(k.mQc,{className:C.tabs},i().createElement(k.tdY,{"aria-label":"Attachments-upload-section"},i().createElement(k.OK9,{onClick:function(){return r("upload")}},e("uploadMedia","Upload media")),i().createElement(k.OK9,{onClick:function(){return r("camera")}},e("webcam","Webcam"))),i().createElement(k.nPR,null,i().createElement(k.x45,null,i().createElement(A,null)),i().createElement(k.x45,null,"camera"===a&&i().createElement(d,{mediaStream:s,stopCameraStream:_}))))))};const G=function(e){var t=e.cameraOnly,a=e.multipleFiles,l=e.collectDescription,s=e.saveFile,d=e.closeModal,_=e.onCompletion,m=e.allowedExtensions,u=$((0,n.useState)(void 0),2),p=u[0],f=u[1],h=$((0,n.useState)([]),2),g=h[0],v=h[1],b=$((0,n.useState)(!1),2),y=b[0],w=b[1],S=(0,c.useTranslation)().t;(0,n.useEffect)((function(){p&&(0,r.showToast)({description:p.message,kind:"error",title:S("cameraError","Camera Error")})}),[p,S]);var E=(0,n.useCallback)((function(e){v([{base64Content:e,fileName:"Image taken from camera",fileType:"image",fileDescription:"",status:"uploading"}])}),[]),x=(0,n.useCallback)((function(){v([]),w(!1),f(void 0)}),[v,w]),C=(0,n.useCallback)((function(){w(!0)}),[w]),k=(0,n.useMemo)((function(){return y?i().createElement(Q,null):g.length?i().createElement(M,{onCompletion:C}):i().createElement(q,null)}),[y,g,C]);return i().createElement(o.Provider,{value:{multipleFiles:a,cameraOnly:t,collectDescription:l,saveFile:s,closeModal:d,onCompletion:_,filesToUpload:g,setFilesToUpload:v,uploadFilesToServer:y,setUploadFilesToServer:w,clearData:x,handleTakePhoto:E,error:p,setError:f,allowedExtensions:m}},k)}},7326:(e,t,a)=>{a.d(t,{H:()=>o,Z:()=>r});var n=a(2067),i=a(906);function r(e){return new Promise((function(t){if(e){var a=new FileReader;a.addEventListener("load",(function(){"string"==typeof a.result?t(a.result):t("")})),a.addEventListener("error",(function(){t("")})),a.readAsDataURL(e)}else t("")}))}function o(e){return{id:e.uuid,src:"".concat(window.openmrsBase).concat(n.eK,"/").concat(e.uuid,"/bytes"),title:e.comment,description:"",dateTime:(0,i.formatDate)(new Date(e.dateTime),{mode:"wide"}),bytesMimeType:e.bytesMimeType,bytesContentFamily:e.bytesContentFamily}}}}]);