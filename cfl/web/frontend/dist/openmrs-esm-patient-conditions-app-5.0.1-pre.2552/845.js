"use strict";(globalThis.webpackChunk_openmrs_esm_patient_conditions_app=globalThis.webpackChunk_openmrs_esm_patient_conditions_app||[]).push([[845,565],{8897:(e,n,t)=>{t.d(n,{Z:()=>l});var o=t(272),i=t.n(o),r=t(2609),a=t.n(r)()(i());a.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-conditions__conditions-form__condition___MtDNj{padding:1rem .75rem}.-esm-patient-conditions__conditions-form__conditionsList___vV61x{margin-top:.25rem;background-color:#fff;max-height:14rem;overflow-y:auto;border:1px solid #e0e0e0}.-esm-patient-conditions__conditions-form__conditionsList___vV61x li:hover{background-color:#e0e0e0}.-esm-patient-conditions__conditions-form__emptyResults___OM1Oc{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px);color:#525252;min-height:1rem}.-esm-patient-conditions__conditions-form__form___MGII0{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.-esm-patient-conditions__conditions-form__formContainer___l5mME{margin:1rem}.-esm-patient-conditions__conditions-form__button___KDl_0{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-conditions__conditions-form__tablet___HOE67{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-conditions__conditions-form__desktop___WGj2I{padding:0rem}.-esm-patient-conditions__conditions-form__loader___RRvjL{padding:1rem .5rem}.-esm-patient-conditions__conditions-form__conditionLabel___W2IX3{font-size:var(--cds-label-02-font-size, 0.875rem);font-weight:var(--cds-label-02-font-weight, 400);line-height:var(--cds-label-02-line-height, 1.28572);letter-spacing:var(--cds-label-02-letter-spacing, 0.16px)}.-esm-patient-conditions__conditions-form__errorContainer___cBeJ_{margin:1rem}.-esm-patient-conditions__conditions-form__conditionsError___NGIUW .cds--search-input:focus{outline:2.5px solid #da1e28}.-esm-patient-conditions__conditions-form__conditionsError___NGIUW .cds--search-magnifier svg{fill:#da1e28}.-esm-patient-conditions__conditions-form__errorMessage___VKE7C{font-size:var(--cds-label-02-font-size, 0.875rem);font-weight:var(--cds-label-02-font-weight, 400);line-height:var(--cds-label-02-line-height, 1.28572);letter-spacing:var(--cds-label-02-letter-spacing, 0.16px);color:#da1e28;margin-top:.5rem}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/conditions/conditions-form.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCpDF,6DACE,mBAAA,CAGF,kEACE,iBAAA,CACA,qBDRM,CCSN,gBAAA,CACA,eAAA,CACA,wBAAA,CAGF,2EACE,wBDdM,CCiBR,gECuzBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CDrzBF,aDhBQ,CCiBR,eAAA,CAGF,wDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA,CAGF,iEACE,WAAA,CAGF,0DACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,0DACE,mBAAA,CACA,qBD7CM,CCgDR,2DACE,YAAA,CAGF,0DACE,kBAAA,CAGF,kECixBI,iDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CD7wBJ,kEACE,WAAA,CAIA,4FACE,2BAAA,CAIA,8FACE,YDpDG,CCyDT,gEC6vBI,iDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CD3vBF,aD3DO,CC4DP,gBAAA",sourceRoot:""}]),a.locals={condition:"-esm-patient-conditions__conditions-form__condition___MtDNj",conditionsList:"-esm-patient-conditions__conditions-form__conditionsList___vV61x",emptyResults:"-esm-patient-conditions__conditions-form__emptyResults___OM1Oc",form:"-esm-patient-conditions__conditions-form__form___MGII0",formContainer:"-esm-patient-conditions__conditions-form__formContainer___l5mME",button:"-esm-patient-conditions__conditions-form__button___KDl_0",tablet:"-esm-patient-conditions__conditions-form__tablet___HOE67",desktop:"-esm-patient-conditions__conditions-form__desktop___WGj2I",loader:"-esm-patient-conditions__conditions-form__loader___RRvjL",conditionLabel:"-esm-patient-conditions__conditions-form__conditionLabel___W2IX3",errorContainer:"-esm-patient-conditions__conditions-form__errorContainer___cBeJ_",conditionsError:"-esm-patient-conditions__conditions-form__conditionsError___NGIUW",errorMessage:"-esm-patient-conditions__conditions-form__errorMessage___VKE7C"};const l=a},6753:(e,n,t)=>{t.d(n,{Z:()=>v});var o=t(1354),i=t.n(o),r=t(1583),a=t.n(r),l=t(7378),c=t.n(l),s=t(5993),d=t.n(s),u=t(4154),m=t.n(u),_=t(8141),p=t.n(_),A=t(8897),f={};f.styleTagTransform=p(),f.setAttributes=d(),f.insert=c().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=m(),i()(A.Z,f);const v=A.Z&&A.Z.locals?A.Z.locals:void 0},1845:(e,n,t)=>{t.r(n),t.d(n,{default:()=>g});var o=t(268),i=t.n(o),r=t(4924),a=t(3565),l=t.n(a),c=(t(264),t(1872)),s=t(781),d=t(2870),u=t(4548),m=t(6753),_=t(3955);function p(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function A(e,n,t,o,i,r,a){try{var l=e[r](a),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(o,i)}function f(e){return function(){var n=this,t=arguments;return new Promise((function(o,i){var r=e.apply(n,t);function a(e){A(r,o,i,a,l,"next",e)}function l(e){A(r,o,i,a,l,"throw",e)}a(void 0)}))}}function v(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,i,r=[],a=!0,l=!1;try{for(t=t.call(e);!(a=(o=t.next()).done)&&(r.push(o.value),!n||r.length!==n);a=!0);}catch(e){l=!0,i=e}finally{try{a||null==t.return||t.return()}finally{if(l)throw i}}return r}}(e,n)||function(e,n){if(e){if("string"==typeof e)return p(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?p(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,n){var t,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=n.call(e,a)}catch(e){r=[6,e],o=0}finally{t=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}}function C(e){var n=e.children;return e.isTablet?i().createElement(c.mh4,null,n," "):i().createElement(i().Fragment,null,n)}const g=function(e){var n,t,a,p,A,g=e.closeWorkspace,b=e.conditionToEdit,y=e.editing,D=e.patientUuid,E=e.isSubmittingForm,w=e.setIsSubmittingForm,T=e.setErrorCreating,S=e.setErrorUpdating,I=(0,r.useTranslation)().t,B=(0,u.l4)(D),k=B.conditions,x=B.mutate,F=(0,_.Gc)(),L=F.control,G=F.watch,M=F.getValues,j=F.formState,R="tablet"===(0,d.useLayoutType)(),N=(0,d.useSession)(),O=(0,o.useRef)(null),P=G("clinicalStatus"),U=null==k?void 0:k.find((function(e){return(null==e?void 0:e.id)===(null==b?void 0:b.id)})),Z=function(e,n){var t;return null==e||null===(t=e.find((function(e){var t;return(null==e||null===(t=e.info)||void 0===t?void 0:t.header)===n})))||void 0===t?void 0:t.value},W=Z(null==b?void 0:b.cells,"display"),V=Z(null==b?void 0:b.cells,"clinicalStatus"),z=v((0,o.useState)(null),2),Y=z[0],q=z[1],H=(0,u.sA)(G("search")),K=H.searchResults,Q=H.isSearching,J=(0,o.useCallback)((function(e){q(e)}),[]),X=(0,o.useCallback)(f((function(){var e,n,t,o,i;return h(this,(function(r){switch(r.label){case 0:if(!Y)return[2];o={clinicalStatus:M("clinicalStatus"),conceptId:null==Y||null===(e=Y.concept)||void 0===e?void 0:e.uuid,display:null==Y||null===(n=Y.concept)||void 0===n?void 0:n.display,endDate:M("endDate")?l()(M("endDate")).format():null,onsetDateTime:M("onsetDateTime")?l()(M("onsetDateTime")).format():null,patientId:D,userId:null==N||null===(t=N.user)||void 0===t?void 0:t.uuid},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,(0,u.CL)(o)];case 2:return 201===r.sent().status&&(x(),(0,d.showToast)({critical:!0,kind:"success",description:I("conditionNowVisible","It is now visible on the Conditions page"),title:I("conditionSaved","Condition saved")}),null==g||g()),[3,4];case 3:return i=r.sent(),w(!1),T(i),[3,4];case 4:return[2]}}))})),[g,M,x,D,Y,null==N||null===(n=N.user)||void 0===n?void 0:n.uuid,T,w,I]),$=(0,o.useCallback)(f((function(){var e,n,t;return h(this,(function(o){switch(o.label){case 0:n={clinicalStatus:y?M("clinicalStatus"):V,conceptId:null==U?void 0:U.conceptId,display:W,endDate:M("endDate")?l()(M("endDate")).format():null,onsetDateTime:M("onsetDateTime")?l()(M("onsetDateTime")).format():null,patientId:D,userId:null==N||null===(e=N.user)||void 0===e?void 0:e.uuid},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,u.r4)(null==b?void 0:b.id,n)];case 2:return 200===o.sent().status&&(x(),(0,d.showToast)({critical:!0,kind:"success",description:I("conditionNowVisible","It is now visible on the Conditions page"),title:I("conditionUpdated","Condition updated")}),g()),[3,4];case 3:return t=o.sent(),w(!1),S(t),[3,4];case 4:return[2]}}))})),[g,null==b?void 0:b.id,W,V,y,M,null==U?void 0:U.conceptId,x,D,null==N||null===(t=N.user)||void 0===t?void 0:t.uuid,S,w,I]);return(0,o.useEffect)((function(){var e;if((null==j||null===(e=j.errors)||void 0===e?void 0:e.search)&&O.current.focus(),E){if(Object.keys(j.errors).length>0)return w(!1),void Object.entries(j.errors).map((function(e,n){return console.error("".concat(e,": ").concat(n," "))}));y?$():X()}}),[$,y,X,E,j.errors,w]),i().createElement("div",{className:m.Z.formContainer},i().createElement(c.Kqy,{gap:7},i().createElement(c.cwH,{legendText:I("condition","Condition")},y?i().createElement(c.lXp,{className:m.Z.conditionLabel},W):i().createElement(i().Fragment,null,i().createElement(_.Qr,{name:"search",control:L,render:function(e){var n,t,o=e.field,r=o.onChange,a=o.value,l=o.onBlur;return i().createElement(C,{isTablet:R},i().createElement(c.olm,{ref:O,size:"md",id:"conditionsSearch",labelText:I("enterCondition","Enter condition"),placeholder:I("searchConditions","Search conditions"),className:(null==j||null===(n=j.errors)||void 0===n?void 0:n.search)&&m.Z.conditionsError,onChange:r,renderIcon:(null==j||null===(t=j.errors)||void 0===t?void 0:t.search)&&i().createElement(s.Rr,null),onBlur:l,onClear:function(){return q(null)},disabled:y,value:Y?Y.display:M("search")?a:void 0}))}}),(null==j||null===(a=j.errors)||void 0===a?void 0:a.search)&&i().createElement("p",{className:m.Z.errorMessage},null==j||null===(A=j.errors)||void 0===A||null===(p=A.search)||void 0===p?void 0:p.message),!M("search")||Y?null:Q?i().createElement(c.lSo,{className:m.Z.loader,description:I("searching","Searching")+"..."}):K&&K.length?i().createElement("ul",{className:m.Z.conditionsList},null==K?void 0:K.map((function(e,n){return i().createElement("li",{role:"menuitem",className:m.Z.condition,key:n,onClick:function(){return J(e)}},e.display)}))):i().createElement(c.mh4,null,i().createElement(c.n9L,{className:m.Z.emptyResults},i().createElement("span",null,I("noResultsFor","No results for")," ",i().createElement("strong",null,'"',M("search"),'"')))))),i().createElement(c.cwH,{legendText:""},i().createElement(_.Qr,{name:"onsetDateTime",control:L,render:function(e){var n=e.field,t=n.onChange,o=n.onBlur,r=n.value;return i().createElement(C,{isTablet:R},i().createElement(c.Mtg,{id:"onsetDate",datePickerType:"single",dateFormat:"d/m/Y",maxDate:l()().utc().format(),placeholder:"dd/mm/yyyy",onChange:function(e){var n=v(e,1)[0];return t(n)},onBlur:o,value:r},i().createElement(c.aj6,{id:"onsetDateInput",labelText:I("onsetDate","Onset date")})))}})),i().createElement(c.cwH,{legendText:I("currentStatus","Current status")},i().createElement(_.Qr,{name:"clinicalStatus",control:L,render:function(e){var n=e.field,t=n.onChange,o=n.value,r=n.onBlur;return i().createElement(c.SYO,{valueSelected:o.toLowerCase(),name:"clinicalStatus",orientation:"vertical",onChange:t,onBlur:r},i().createElement(c.EUY,{id:"active",labelText:"Active",value:"active"}),i().createElement(c.EUY,{id:"inactive",labelText:"Inactive",value:"inactive"}))}})),"inactive"===P&&i().createElement(_.Qr,{name:"endDate",control:L,render:function(e){var n=e.field,t=n.onBlur,o=n.onChange,r=n.value;return i().createElement(C,{isTablet:R},i().createElement(c.Mtg,{id:"endDate",datePickerType:"single",dateFormat:"d/m/Y",minDate:new Date(G("onsetDateTime")).toISOString(),maxDate:l()().utc().format(),placeholder:"dd/mm/yyyy",onChange:function(e){var n=v(e,1)[0];return o(n)},onBlur:t,value:r},i().createElement(c.aj6,{id:"endDateInput",labelText:I("endDate","End date")})))}})))}},4548:(e,n,t)=>{t.d(n,{B6:()=>A,CL:()=>u,l4:()=>c,r4:()=>_,sA:()=>s});var o=t(3255),i=t(2870);function r(e,n,t,o,i,r,a){try{var l=e[r](a),c=l.value}catch(e){return void t(e)}l.done?n(c):Promise.resolve(c).then(o,i)}function a(e){return function(){var n=this,t=arguments;return new Promise((function(o,i){var a=e.apply(n,t);function l(e){r(a,o,i,l,c,"next",e)}function c(e){r(a,o,i,l,c,"throw",e)}l(void 0)}))}}function l(e,n){var t,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=n.call(e,a)}catch(e){r=[6,e],o=0}finally{t=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}}function c(e){var n,t,r="".concat(i.fhirBaseUrl,"/Condition?patient=").concat(e,"&_count=100"),a=(0,o.ZP)(e?r:null,i.openmrsFetch),l=a.data,c=a.error,s=a.isLoading,u=a.isValidating,m=a.mutate,_=(null==l||null===(n=l.data)||void 0===n?void 0:n.total)>0?null==l||null===(t=l.data)||void 0===t?void 0:t.entry.map((function(e){var n;return null!==(n=e.resource)&&void 0!==n?n:[]})).map(d).sort((function(e,n){return n.onsetDateTime>e.onsetDateTime?1:-1})):null;return{conditions:l?_:null,isError:c,isLoading:s,isValidating:u,mutate:m}}function s(e){var n,t,r=(0,i.useConfig)(),a=null==r?void 0:r.conditionConceptClassUuid,l="/ws/rest/v1/conceptsearch?conceptClasses=".concat(a,"&q=").concat(e),c=(0,o.ZP)(e?l:null,i.openmrsFetch),s=c.data,d=c.error,u=c.isLoading;return{searchResults:null!==(t=null==s||null===(n=s.data)||void 0===n?void 0:n.results)&&void 0!==t?t:[],error:d,isSearching:u}}function d(e){var n,t,o,i,r,a,l=null==e||null===(t=e.clinicalStatus)||void 0===t||null===(n=t.coding[0])||void 0===n?void 0:n.code;return{clinicalStatus:l?l.charAt(0).toUpperCase()+l.slice(1).toLowerCase():"",conceptId:null==e||null===(i=e.code)||void 0===i||null===(o=i.coding[0])||void 0===o?void 0:o.code,display:null==e||null===(a=e.code)||void 0===a||null===(r=a.coding[0])||void 0===r?void 0:r.display,onsetDateTime:null==e?void 0:e.onsetDateTime,recordedDate:null==e?void 0:e.recordedDate,id:null==e?void 0:e.id}}function u(e){return m.apply(this,arguments)}function m(){return(m=a((function(e){var n,t,o;return l(this,(function(r){switch(r.label){case 0:return n=new AbortController,t="".concat(i.fhirBaseUrl,"/Condition"),o={clinicalStatus:{coding:[{system:"http://terminology.hl7.org/CodeSystem/condition-clinical",code:e.clinicalStatus}]},code:{coding:[{code:e.conceptId,display:e.display}]},endDate:e.endDate,onsetDateTime:e.onsetDateTime,recorder:{reference:"Practitioner/".concat(e.userId)},recordedDate:(new Date).toISOString(),resourceType:"Condition",subject:{reference:"Patient/".concat(e.patientId)}},[4,(0,i.openmrsFetch)(t,{headers:{"Content-Type":"application/json"},method:"POST",body:o,signal:n.signal})];case 1:return[2,r.sent()]}}))}))).apply(this,arguments)}function _(e,n){return p.apply(this,arguments)}function p(){return(p=a((function(e,n){var t,o,r;return l(this,(function(a){switch(a.label){case 0:return t=new AbortController,o="".concat(i.fhirBaseUrl,"/Condition/").concat(e),r={clinicalStatus:{coding:[{system:"http://terminology.hl7.org/CodeSystem/condition-clinical",code:n.clinicalStatus}]},code:{coding:[{code:n.conceptId,display:n.display}]},endDate:n.endDate,id:e,onsetDateTime:n.onsetDateTime,recorder:{reference:"Practitioner/".concat(n.userId)},recordedDate:(new Date).toISOString(),resourceType:"Condition",subject:{reference:"Patient/".concat(n.patientId)}},[4,(0,i.openmrsFetch)(o,{headers:{"Content-Type":"application/json"},method:"PUT",body:r,signal:t.signal})];case 1:return[2,a.sent()]}}))}))).apply(this,arguments)}function A(e){return f.apply(this,arguments)}function f(){return(f=a((function(e){var n,t;return l(this,(function(o){switch(o.label){case 0:return n=new AbortController,t="".concat(i.fhirBaseUrl,"/Condition/").concat(e),[4,(0,i.openmrsFetch)(t,{method:"DELETE",signal:n.signal})];case 1:return[2,o.sent()]}}))}))).apply(this,arguments)}}}]);