"use strict";(self.webpackChunk_openmrs_esm_form_entry_app=self.webpackChunk_openmrs_esm_form_entry_app||[]).push([[330],{330:(Pn,ye,m)=>{m.r(ye),m.d(ye,{bootstrap:()=>th,mount:()=>nh,unmount:()=>sh});var q=m(5566),c=m(3058),B=m(5);var K=m(4531);let ve=(()=>{class n extends K.Kj{constructor(){super(...arguments),this.skipNextPopState=!1,this.source="Window.addEventListener:popstate"}pushState(e,s,i){this.skipNextPopState=!0,super.pushState(e,s,i)}replaceState(e,s,i){this.skipNextPopState=!0,super.replaceState(e,s,i)}onPopState(e){return e=Zone.current.wrap(e,this.source),super.onPopState(r=>{this.skipNextPopState&&r.singleSpa?this.skipNextPopState=!1:e(r)})}}return n.\u0275fac=function(){let t;return function(s){return(t||(t=c.n5z(n)))(s||n)}}(),n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const _t={NgZone:null,bootstrapFunction:null,template:null,Router:void 0,domElementGetter:void 0,updateFunction:()=>Promise.resolve(),bootstrappedModule:null};function D(n,t){return(0,B.mG)(this,void 0,void 0,function*(){"noop"!==n.NgZone&&(n.zoneIdentifier=`single-spa-angular:${t.name||t.appName}`,n.NgZone.isInAngularZone=()=>!0===window.Zone.current._properties[n.zoneIdentifier],n.routingEventListener=()=>{n.bootstrappedNgZone.run(()=>{})})})}function _e(n,t){return(0,B.mG)(this,void 0,void 0,function*(){!function(n,t){const e=function(n,t){var e;return(t=null!==(e=null==t?void 0:t.customProps)&&void 0!==e?e:t).domElement?()=>t.domElement:t.domElementGetter?t.domElementGetter:n.domElementGetter?n.domElementGetter:function(n){return function(){const e=`single-spa-application:${n}`;let s=document.getElementById(e);return s||(s=document.createElement("div"),s.id=e,document.body.appendChild(s)),s}}(t.name)}(n,t);if(!e)throw Error(`Cannot mount angular application '${t.name||t.appName}' without a domElementGetter provided either as an opt or a prop`);const s=function(n){const t=n();if(!t)throw Error("domElementGetter did not return a valid dom element");return t}(e);s.innerHTML=n.template}(n,t);const e=n.bootstrapFunction(t);if(!(e instanceof Promise))throw Error(`single-spa-angular: the options.bootstrapFunction must return a promise, but instead returned a '${typeof e}' that is not a Promise`);const s=yield e;if(!s||"function"!=typeof s.destroy)throw Error("single-spa-angular: the options.bootstrapFunction returned a promise that did not resolve with a valid Angular module. Did you call platformBrowserDynamic().bootstrapModule() correctly?");const i=s.injector.get(ve,null),r="noop"!==n.NgZone;if(r&&n.Router&&null===i)throw new Error("\n      single-spa-angular: could not retrieve extra providers from the platform injector. Did you call platformBrowserDynamic(getSingleSpaExtraProviders()).bootstrapModule()?\n    ");const o=n;if(r){const a=s.injector.get(n.NgZone),l=o.zoneIdentifier;null!==i&&function(n,t){if(!t.NavigationStart)return;const e=n.injector.get(t.Router),s=e.events.subscribe(i=>{if(i instanceof t.NavigationStart){const r=e.getCurrentNavigation();"imperative"!==r.trigger&&(r.extras.skipLocationChange=!0,r.extras.replaceUrl=!1)}});n.onDestroy(()=>{s.unsubscribe()})}(s,n),o.bootstrappedNgZone=a,o.bootstrappedNgZone._inner._properties[l]=!0,window.addEventListener("single-spa:routing-event",o.routingEventListener)}return o.bootstrappedModule=s,s})}function Se(n){return Promise.resolve().then(()=>{n.routingEventListener&&window.removeEventListener("single-spa:routing-event",n.routingEventListener),n.bootstrappedModule.destroy(),n.bootstrappedModule=null})}var A=m(7629);function Tn(){return"undefined"!=typeof window&&void 0!==window.document}function bt(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function se(n){switch(n.length){case 0:return new A.ZN;case 1:return n[0];default:return new A.ZE(n)}}function An(n,t,e,s,i={},r={}){const o=[],a=[];let l=-1,u=null;if(s.forEach(h=>{const d=h.offset,f=d==l,_=f&&u||{};Object.keys(h).forEach(p=>{let g=p,v=h[p];if("offset"!==p)switch(g=t.normalizePropertyName(g,o),v){case A.k1:v=i[p];break;case A.l3:v=r[p];break;default:v=t.normalizeStyleValue(p,g,v,o)}_[g]=v}),f||a.push(_),u=_,l=d}),o.length){const h="\n - ";throw new Error(`Unable to animate due to the following errors:${h}${o.join(h)}`)}return a}function Et(n,t,e,s){switch(t){case"start":n.onStart(()=>s(e&&Pt(e,"start",n)));break;case"done":n.onDone(()=>s(e&&Pt(e,"done",n)));break;case"destroy":n.onDestroy(()=>s(e&&Pt(e,"destroy",n)))}}function Pt(n,t,e){const s=e.totalTime,r=Tt(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==s?n.totalTime:s,!!e.disabled),o=n._data;return null!=o&&(r._data=o),r}function Tt(n,t,e,s,i="",r=0,o){return{element:n,triggerName:t,fromState:e,toState:s,phaseName:i,totalTime:r,disabled:!!o}}function Z(n,t,e){let s;return n instanceof Map?(s=n.get(t),s||n.set(t,s=e)):(s=n[t],s||(s=n[t]=e)),s}function wn(n){const t=n.indexOf(":");return[n.substring(1,t),n.substr(t+1)]}let At=(n,t)=>!1,wt=(n,t)=>!1,Cn=(n,t,e)=>[];const On=bt();(On||"undefined"!=typeof Element)&&(At=Tn()?(n,t)=>{for(;t&&t!==document.documentElement;){if(t===n)return!0;t=t.parentNode||t.host}return!1}:(n,t)=>n.contains(t),wt=(()=>{if(On||Element.prototype.matches)return(n,t)=>n.matches(t);{const n=Element.prototype,t=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector;return t?(e,s)=>t.apply(e,[s]):wt}})(),Cn=(n,t,e)=>{let s=[];if(e){const i=n.querySelectorAll(t);for(let r=0;r<i.length;r++)s.push(i[r])}else{const i=n.querySelector(t);i&&s.push(i)}return s});let le=null,Fn=!1;function Ct(n){le||(le=("undefined"!=typeof document?document.body:null)||{},Fn=!!le.style&&"WebkitAppearance"in le.style);let t=!0;return le.style&&!function(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in le.style,!t&&Fn&&(t="Webkit"+n.charAt(0).toUpperCase()+n.substr(1)in le.style)),t}const Ot=wt,Ft=At,Nt=Cn;function Nn(n){const t={};return Object.keys(n).forEach(e=>{const s=e.replace(/([a-z])([A-Z])/g,"$1-$2");t[s]=n[e]}),t}let Mn=(()=>{class n{validateStyleProperty(e){return Ct(e)}matchesElement(e,s){return Ot(e,s)}containsElement(e,s){return Ft(e,s)}query(e,s,i){return Nt(e,s,i)}computeStyle(e,s,i){return i||""}animate(e,s,i,r,o,a=[],l){return new A.ZN(i,r)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Mt=(()=>{class n{}return n.NOOP=new Mn,n})();const Dt="ng-enter",Ue="ng-leave",Be="ng-trigger",Ze=".ng-trigger",Rn="ng-animating",Rt=".ng-animating";function ce(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:Lt(parseFloat(t[1]),t[2])}function Lt(n,t){return"s"===t?1e3*n:n}function je(n,t,e){return n.hasOwnProperty("duration")?n:function(n,t,e){let i,r=0,o="";if("string"==typeof n){const a=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return t.push(`The provided timing value "${n}" is invalid.`),{duration:0,delay:0,easing:""};i=Lt(parseFloat(a[1]),a[2]);const l=a[3];null!=l&&(r=Lt(parseFloat(l),a[4]));const u=a[5];u&&(o=u)}else i=n;if(!e){let a=!1,l=t.length;i<0&&(t.push("Duration values below 0 are not allowed for this animation step."),a=!0),r<0&&(t.push("Delay values below 0 are not allowed for this animation step."),a=!0),a&&t.splice(l,0,`The provided timing value "${n}" is invalid.`)}return{duration:i,delay:r,easing:o}}(n,t,e)}function be(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function ie(n,t,e={}){if(t)for(let s in n)e[s]=n[s];else be(n,e);return e}function In(n,t,e){return e?t+":"+e+";":""}function Un(n){let t="";for(let e=0;e<n.style.length;e++){const s=n.style.item(e);t+=In(0,s,n.style.getPropertyValue(s))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=In(0,Li(e),n.style[e]));n.setAttribute("style",t)}function V(n,t,e){n.style&&(Object.keys(t).forEach(s=>{const i=Ut(s);e&&!e.hasOwnProperty(s)&&(e[s]=n.style[i]),n.style[i]=t[s]}),bt()&&Un(n))}function ue(n,t){n.style&&(Object.keys(t).forEach(e=>{const s=Ut(e);n.style[s]=""}),bt()&&Un(n))}function Ce(n){return Array.isArray(n)?1==n.length?n[0]:(0,A.vP)(n):n}const It=new RegExp("{{\\s*(.+?)\\s*}}","g");function Bn(n){let t=[];if("string"==typeof n){let e;for(;e=It.exec(n);)t.push(e[1]);It.lastIndex=0}return t}function ke(n,t,e){const s=n.toString(),i=s.replace(It,(r,o)=>{let a=t[o];return t.hasOwnProperty(o)||(e.push(`Please provide a value for the animation param ${o}`),a=""),a.toString()});return i==s?n:i}function xe(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const Ri=/-+([a-z0-9])/g;function Ut(n){return n.replace(Ri,(...t)=>t[1].toUpperCase())}function Li(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Zn(n,t){return 0===n||0===t}function jn(n,t,e){const s=Object.keys(e);if(s.length&&t.length){let r=t[0],o=[];if(s.forEach(a=>{r.hasOwnProperty(a)||o.push(a),r[a]=e[a]}),o.length)for(var i=1;i<t.length;i++){let a=t[i];o.forEach(function(l){a[l]=Bt(n,l)})}}return t}function j(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function Bt(n,t){return window.getComputedStyle(n)[t]}function Ii(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(s=>function(n,t,e){if(":"==n[0]){const l=function(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,s)=>parseFloat(s)>parseFloat(e);case":decrement":return(e,s)=>parseFloat(s)<parseFloat(e);default:return t.push(`The transition alias value "${n}" is not supported`),"* => *"}}(n,e);if("function"==typeof l)return void t.push(l);n=l}const s=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==s||s.length<4)return e.push(`The provided transition expression "${n}" is not supported`),t;const i=s[1],r=s[2],o=s[3];t.push(kn(i,o));"<"==r[0]&&!("*"==i&&"*"==o)&&t.push(kn(o,i))}(s,e,t)):e.push(n),e}const $e=new Set(["true","1"]),Ge=new Set(["false","0"]);function kn(n,t){const e=$e.has(n)||Ge.has(n),s=$e.has(t)||Ge.has(t);return(i,r)=>{let o="*"==n||n==i,a="*"==t||t==r;return!o&&e&&"boolean"==typeof i&&(o=i?$e.has(n):Ge.has(n)),!a&&s&&"boolean"==typeof r&&(a=r?$e.has(t):Ge.has(t)),o&&a}}const Zi=new RegExp("s*:selfs*,?","g");function Zt(n,t,e){return new ji(n).build(t,e)}class ji{constructor(t){this._driver=t}build(t,e){const s=new Ki(e);return this._resetContextStyleTimingState(s),j(this,Ce(t),s)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles={},t.collectedStyles[""]={},t.currentTime=0}visitTrigger(t,e){let s=e.queryCount=0,i=e.depCount=0;const r=[],o=[];return"@"==t.name.charAt(0)&&e.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),t.definitions.forEach(a=>{if(this._resetContextStyleTimingState(e),0==a.type){const l=a,u=l.name;u.toString().split(/\s*,\s*/).forEach(h=>{l.name=h,r.push(this.visitState(l,e))}),l.name=u}else if(1==a.type){const l=this.visitTransition(a,e);s+=l.queryCount,i+=l.depCount,o.push(l)}else e.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:t.name,states:r,transitions:o,queryCount:s,depCount:i,options:null}}visitState(t,e){const s=this.visitStyle(t.styles,e),i=t.options&&t.options.params||null;if(s.containsDynamicStyles){const r=new Set,o=i||{};if(s.styles.forEach(a=>{if(ze(a)){const l=a;Object.keys(l).forEach(u=>{Bn(l[u]).forEach(h=>{o.hasOwnProperty(h)||r.add(h)})})}}),r.size){const a=xe(r.values());e.errors.push(`state("${t.name}", ...) must define default values for all the following style substitutions: ${a.join(", ")}`)}}return{type:0,name:t.name,style:s,options:i?{params:i}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const s=j(this,Ce(t.animation),e);return{type:1,matchers:Ii(t.expr,e.errors),animation:s,queryCount:e.queryCount,depCount:e.depCount,options:he(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(s=>j(this,s,e)),options:he(t.options)}}visitGroup(t,e){const s=e.currentTime;let i=0;const r=t.steps.map(o=>{e.currentTime=s;const a=j(this,o,e);return i=Math.max(i,e.currentTime),a});return e.currentTime=i,{type:3,steps:r,options:he(t.options)}}visitAnimate(t,e){const s=function(n,t){let e=null;if(n.hasOwnProperty("duration"))e=n;else if("number"==typeof n)return jt(je(n,t).duration,0,"");const s=n;if(s.split(/\s+/).some(r=>"{"==r.charAt(0)&&"{"==r.charAt(1))){const r=jt(0,0,"");return r.dynamic=!0,r.strValue=s,r}return e=e||je(s,t),jt(e.duration,e.delay,e.easing)}(t.timings,e.errors);e.currentAnimateTimings=s;let i,r=t.styles?t.styles:(0,A.oB)({});if(5==r.type)i=this.visitKeyframes(r,e);else{let o=t.styles,a=!1;if(!o){a=!0;const u={};s.easing&&(u.easing=s.easing),o=(0,A.oB)(u)}e.currentTime+=s.duration+s.delay;const l=this.visitStyle(o,e);l.isEmptyStep=a,i=l}return e.currentAnimateTimings=null,{type:4,timings:s,style:i,options:null}}visitStyle(t,e){const s=this._makeStyleAst(t,e);return this._validateStyleAst(s,e),s}_makeStyleAst(t,e){const s=[];Array.isArray(t.styles)?t.styles.forEach(o=>{"string"==typeof o?o==A.l3?s.push(o):e.errors.push(`The provided style string value ${o} is not allowed.`):s.push(o)}):s.push(t.styles);let i=!1,r=null;return s.forEach(o=>{if(ze(o)){const a=o,l=a.easing;if(l&&(r=l,delete a.easing),!i)for(let u in a)if(a[u].toString().indexOf("{{")>=0){i=!0;break}}}),{type:6,styles:s,easing:r,offset:t.offset,containsDynamicStyles:i,options:null}}_validateStyleAst(t,e){const s=e.currentAnimateTimings;let i=e.currentTime,r=e.currentTime;s&&r>0&&(r-=s.duration+s.delay),t.styles.forEach(o=>{"string"!=typeof o&&Object.keys(o).forEach(a=>{if(!this._driver.validateStyleProperty(a))return void e.errors.push(`The provided animation property "${a}" is not a supported CSS property for animations`);const l=e.collectedStyles[e.currentQuerySelector],u=l[a];let h=!0;u&&(r!=i&&r>=u.startTime&&i<=u.endTime&&(e.errors.push(`The CSS property "${a}" that exists between the times of "${u.startTime}ms" and "${u.endTime}ms" is also being animated in a parallel animation between the times of "${r}ms" and "${i}ms"`),h=!1),r=u.startTime),h&&(l[a]={startTime:r,endTime:i}),e.options&&function(n,t,e){const s=t.params||{},i=Bn(n);i.length&&i.forEach(r=>{s.hasOwnProperty(r)||e.push(`Unable to resolve the local animation param ${r} in the given list of values`)})}(o[a],e.options,e.errors)})})}visitKeyframes(t,e){const s={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push("keyframes() must be placed inside of a call to animate()"),s;let r=0;const o=[];let a=!1,l=!1,u=0;const h=t.steps.map(b=>{const T=this._makeStyleAst(b,e);let R=null!=T.offset?T.offset:function(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(ze(e)&&e.hasOwnProperty("offset")){const s=e;t=parseFloat(s.offset),delete s.offset}});else if(ze(n)&&n.hasOwnProperty("offset")){const e=n;t=parseFloat(e.offset),delete e.offset}return t}(T.styles),N=0;return null!=R&&(r++,N=T.offset=R),l=l||N<0||N>1,a=a||N<u,u=N,o.push(N),T});l&&e.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),a&&e.errors.push("Please ensure that all keyframe offsets are in order");const d=t.steps.length;let f=0;r>0&&r<d?e.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(f=1/(d-1));const _=d-1,p=e.currentTime,g=e.currentAnimateTimings,v=g.duration;return h.forEach((b,T)=>{const R=f>0?T==_?1:f*T:o[T],N=R*v;e.currentTime=p+g.delay+N,g.duration=N,this._validateStyleAst(b,e),b.offset=R,s.styles.push(b)}),s}visitReference(t,e){return{type:8,animation:j(this,Ce(t.animation),e),options:he(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:he(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:he(t.options)}}visitQuery(t,e){const s=e.currentQuerySelector,i=t.options||{};e.queryCount++,e.currentQuery=t;const[r,o]=function(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(Zi,"")),n=n.replace(/@\*/g,Ze).replace(/@\w+/g,e=>Ze+"-"+e.substr(1)).replace(/:animating/g,Rt),[n,t]}(t.selector);e.currentQuerySelector=s.length?s+" "+r:r,Z(e.collectedStyles,e.currentQuerySelector,{});const a=j(this,Ce(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=s,{type:11,selector:r,limit:i.limit||0,optional:!!i.optional,includeSelf:o,animation:a,originalSelector:t.selector,options:he(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push("stagger() can only be used inside of query()");const s="full"===t.timings?{duration:0,delay:0,easing:"full"}:je(t.timings,e.errors,!0);return{type:12,animation:j(this,Ce(t.animation),e),timings:s,options:null}}}class Ki{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function ze(n){return!Array.isArray(n)&&"object"==typeof n}function he(n){return n?(n=be(n)).params&&(n.params=function(n){return n?be(n):null}(n.params)):n={},n}function jt(n,t,e){return{duration:n,delay:t,easing:e}}function kt(n,t,e,s,i,r,o=null,a=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:s,duration:i,delay:r,totalTime:i+r,easing:o,subTimeline:a}}class qe{constructor(){this._map=new Map}consume(t){let e=this._map.get(t);return e?this._map.delete(t):e=[],e}append(t,e){let s=this._map.get(t);s||this._map.set(t,s=[]),s.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const Vi=new RegExp(":enter","g"),Wi=new RegExp(":leave","g");function xt(n,t,e,s,i,r={},o={},a,l,u=[]){return(new Yi).buildKeyframes(n,t,e,s,i,r,o,a,l,u)}class Yi{buildKeyframes(t,e,s,i,r,o,a,l,u,h=[]){u=u||new qe;const d=new Kt(t,e,u,i,r,h,[]);d.options=l,d.currentTimeline.setStyles([o],null,d.errors,l),j(this,s,d);const f=d.timelines.filter(_=>_.containsAnimation());if(f.length&&Object.keys(a).length){const _=f[f.length-1];_.allowOnlyTimelineStyles()||_.setStyles([a],null,d.errors,l)}return f.length?f.map(_=>_.buildKeyframes()):[kt(e,[],[],[],0,0,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const s=e.subInstructions.consume(e.element);if(s){const i=e.createSubContext(t.options),r=e.currentTimeline.currentTime,o=this._visitSubInstructions(s,i,i.options);r!=o&&e.transformIntoNewTimeline(o)}e.previousNode=t}visitAnimateRef(t,e){const s=e.createSubContext(t.options);s.transformIntoNewTimeline(),this.visitReference(t.animation,s),e.transformIntoNewTimeline(s.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,s){let r=e.currentTimeline.currentTime;const o=null!=s.duration?ce(s.duration):null,a=null!=s.delay?ce(s.delay):null;return 0!==o&&t.forEach(l=>{const u=e.appendInstructionToTimeline(l,o,a);r=Math.max(r,u.duration+u.delay)}),r}visitReference(t,e){e.updateOptions(t.options,!0),j(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const s=e.subContextCount;let i=e;const r=t.options;if(r&&(r.params||r.delay)&&(i=e.createSubContext(r),i.transformIntoNewTimeline(),null!=r.delay)){6==i.previousNode.type&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=Ve);const o=ce(r.delay);i.delayNextStep(o)}t.steps.length&&(t.steps.forEach(o=>j(this,o,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>s&&i.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const s=[];let i=e.currentTimeline.currentTime;const r=t.options&&t.options.delay?ce(t.options.delay):0;t.steps.forEach(o=>{const a=e.createSubContext(t.options);r&&a.delayNextStep(r),j(this,o,a),i=Math.max(i,a.currentTimeline.currentTime),s.push(a.currentTimeline)}),s.forEach(o=>e.currentTimeline.mergeTimelineCollectedStyles(o)),e.transformIntoNewTimeline(i),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const s=t.strValue;return je(e.params?ke(s,e.params,e.errors):s,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const s=e.currentAnimateTimings=this._visitTiming(t.timings,e),i=e.currentTimeline;s.delay&&(e.incrementTime(s.delay),i.snapshotCurrentStyles());const r=t.style;5==r.type?this.visitKeyframes(r,e):(e.incrementTime(s.duration),this.visitStyle(r,e),i.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const s=e.currentTimeline,i=e.currentAnimateTimings;!i&&s.getCurrentStyleProperties().length&&s.forwardFrame();const r=i&&i.easing||t.easing;t.isEmptyStep?s.applyEmptyStep(r):s.setStyles(t.styles,r,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const s=e.currentAnimateTimings,i=e.currentTimeline.duration,r=s.duration,a=e.createSubContext().currentTimeline;a.easing=s.easing,t.styles.forEach(l=>{a.forwardTime((l.offset||0)*r),a.setStyles(l.styles,l.easing,e.errors,e.options),a.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(a),e.transformIntoNewTimeline(i+r),e.previousNode=t}visitQuery(t,e){const s=e.currentTimeline.currentTime,i=t.options||{},r=i.delay?ce(i.delay):0;r&&(6===e.previousNode.type||0==s&&e.currentTimeline.getCurrentStyleProperties().length)&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=Ve);let o=s;const a=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!i.optional,e.errors);e.currentQueryTotal=a.length;let l=null;a.forEach((u,h)=>{e.currentQueryIndex=h;const d=e.createSubContext(t.options,u);r&&d.delayNextStep(r),u===e.element&&(l=d.currentTimeline),j(this,t.animation,d),d.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,d.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(o),l&&(e.currentTimeline.mergeTimelineCollectedStyles(l),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const s=e.parentContext,i=e.currentTimeline,r=t.timings,o=Math.abs(r.duration),a=o*(e.currentQueryTotal-1);let l=o*e.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":l=a-l;break;case"full":l=s.currentStaggerTime}const h=e.currentTimeline;l&&h.delayNextStep(l);const d=h.currentTime;j(this,t.animation,e),e.previousNode=t,s.currentStaggerTime=i.currentTime-d+(i.startTime-s.currentTimeline.startTime)}}const Ve={};class Kt{constructor(t,e,s,i,r,o,a,l){this._driver=t,this.element=e,this.subInstructions=s,this._enterClassName=i,this._leaveClassName=r,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Ve,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new Qe(this._driver,e,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const s=t;let i=this.options;null!=s.duration&&(i.duration=ce(s.duration)),null!=s.delay&&(i.delay=ce(s.delay));const r=s.params;if(r){let o=i.params;o||(o=this.options.params={}),Object.keys(r).forEach(a=>{(!e||!o.hasOwnProperty(a))&&(o[a]=ke(r[a],o,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const s=t.params={};Object.keys(e).forEach(i=>{s[i]=e[i]})}}return t}createSubContext(t=null,e,s){const i=e||this.element,r=new Kt(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,s||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(t),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(t){return this.previousNode=Ve,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,s){const i={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=s?s:0)+t.delay,easing:""},r=new Hi(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,i,t.stretchStartingKeyframe);return this.timelines.push(r),i}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,s,i,r,o){let a=[];if(i&&a.push(this.element),t.length>0){t=(t=t.replace(Vi,"."+this._enterClassName)).replace(Wi,"."+this._leaveClassName);let u=this._driver.query(this.element,t,1!=s);0!==s&&(u=s<0?u.slice(u.length+s,u.length):u.slice(0,s)),a.push(...u)}return!r&&0==a.length&&o.push(`\`query("${e}")\` returned zero elements. (Use \`query("${e}", { optional: true })\` if you wish to allow this.)`),a}}class Qe{constructor(t,e,s,i){this._driver=t,this.element=e,this.startTime=s,this._elementTimelineStylesLookup=i,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new Qe(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles[t]=e,this._globalTimelineStyles[t]=e,this._styleSummary[t]={time:this.currentTime,value:e}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&(this._previousKeyframe.easing=t),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||A.l3,this._currentKeyframe[e]=A.l3}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,s,i){e&&(this._previousKeyframe.easing=e);const r=i&&i.params||{},o=function(n,t){const e={};let s;return n.forEach(i=>{"*"===i?(s=s||Object.keys(t),s.forEach(r=>{e[r]=A.l3})):ie(i,!1,e)}),e}(t,this._globalTimelineStyles);Object.keys(o).forEach(a=>{const l=ke(o[a],r,s);this._pendingStyles[a]=l,this._localTimelineStyles.hasOwnProperty(a)||(this._backFill[a]=this._globalTimelineStyles.hasOwnProperty(a)?this._globalTimelineStyles[a]:A.l3),this._updateStyle(a,l)})}applyStylesToKeyframe(){const t=this._pendingStyles,e=Object.keys(t);0!=e.length&&(this._pendingStyles={},e.forEach(s=>{this._currentKeyframe[s]=t[s]}),Object.keys(this._localTimelineStyles).forEach(s=>{this._currentKeyframe.hasOwnProperty(s)||(this._currentKeyframe[s]=this._localTimelineStyles[s])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(t=>{const e=this._localTimelineStyles[t];this._pendingStyles[t]=e,this._updateStyle(t,e)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){Object.keys(t._styleSummary).forEach(e=>{const s=this._styleSummary[e],i=t._styleSummary[e];(!s||i.time>s.time)&&this._updateStyle(e,i.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,s=1===this._keyframes.size&&0===this.duration;let i=[];this._keyframes.forEach((a,l)=>{const u=ie(a,!0);Object.keys(u).forEach(h=>{const d=u[h];d==A.k1?t.add(h):d==A.l3&&e.add(h)}),s||(u.offset=l/this.duration),i.push(u)});const r=t.size?xe(t.values()):[],o=e.size?xe(e.values()):[];if(s){const a=i[0],l=be(a);a.offset=0,l.offset=1,i=[a,l]}return kt(this.element,i,r,o,this.duration,this.startTime,this.easing,!1)}}class Hi extends Qe{constructor(t,e,s,i,r,o,a=!1){super(t,e,o.delay),this.keyframes=s,this.preStyleProps=i,this.postStyleProps=r,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:s,easing:i}=this.timings;if(this._stretchStartingKeyframe&&e){const r=[],o=s+e,a=e/o,l=ie(t[0],!1);l.offset=0,r.push(l);const u=ie(t[0],!1);u.offset=$n(a),r.push(u);const h=t.length-1;for(let d=1;d<=h;d++){let f=ie(t[d],!1);f.offset=$n((e+f.offset*s)/o),r.push(f)}s=o,e=0,i="",t=r}return kt(this.element,t,this.preStyleProps,this.postStyleProps,s,e,i,!0)}}function $n(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class $t{}class Xi extends $t{normalizePropertyName(t,e){return Ut(t)}normalizeStyleValue(t,e,s,i){let r="";const o=s.toString().trim();if(er[e]&&0!==s&&"0"!==s)if("number"==typeof s)r="px";else{const a=s.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&i.push(`Please provide a CSS unit value for ${t}:${s}`)}return o+r}}const er=(()=>function(n){const t={};return n.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function Gn(n,t,e,s,i,r,o,a,l,u,h,d,f){return{type:0,element:n,triggerName:t,isRemovalTransition:i,fromState:e,fromStyles:r,toState:s,toStyles:o,timelines:a,queriedElements:l,preStyleProps:u,postStyleProps:h,totalTime:d,errors:f}}const Gt={};class zn{constructor(t,e,s){this._triggerName=t,this.ast=e,this._stateStyles=s}match(t,e,s,i){return function(n,t,e,s,i){return n.some(r=>r(t,e,s,i))}(this.ast.matchers,t,e,s,i)}buildStyles(t,e,s){const i=this._stateStyles["*"],r=this._stateStyles[t],o=i?i.buildStyles(e,s):{};return r?r.buildStyles(e,s):o}build(t,e,s,i,r,o,a,l,u,h){const d=[],f=this.ast.options&&this.ast.options.params||Gt,p=this.buildStyles(s,a&&a.params||Gt,d),g=l&&l.params||Gt,v=this.buildStyles(i,g,d),b=new Set,T=new Map,R=new Map,N="void"===i,z={params:Object.assign(Object.assign({},f),g)},Q=h?[]:xt(t,e,this.ast.animation,r,o,p,v,z,u,d);let U=0;if(Q.forEach(te=>{U=Math.max(te.duration+te.delay,U)}),d.length)return Gn(e,this._triggerName,s,i,N,p,v,[],[],T,R,U,d);Q.forEach(te=>{const ne=te.element,Ti=Z(T,ne,{});te.preStyleProps.forEach(me=>Ti[me]=!0);const De=Z(R,ne,{});te.postStyleProps.forEach(me=>De[me]=!0),ne!==e&&b.add(ne)});const ee=xe(b.values());return Gn(e,this._triggerName,s,i,N,p,v,Q,ee,T,R,U)}}class sr{constructor(t,e,s){this.styles=t,this.defaultParams=e,this.normalizer=s}buildStyles(t,e){const s={},i=be(this.defaultParams);return Object.keys(t).forEach(r=>{const o=t[r];null!=o&&(i[r]=o)}),this.styles.styles.forEach(r=>{if("string"!=typeof r){const o=r;Object.keys(o).forEach(a=>{let l=o[a];l.length>1&&(l=ke(l,i,e));const u=this.normalizer.normalizePropertyName(a,e);l=this.normalizer.normalizeStyleValue(a,u,l,e),s[u]=l})}}),s}}class rr{constructor(t,e,s){this.name=t,this.ast=e,this._normalizer=s,this.transitionFactories=[],this.states={},e.states.forEach(i=>{this.states[i.name]=new sr(i.style,i.options&&i.options.params||{},s)}),qn(this.states,"true","1"),qn(this.states,"false","0"),e.transitions.forEach(i=>{this.transitionFactories.push(new zn(t,i,this.states))}),this.fallbackTransition=function(n,t,e){return new zn(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(o,a)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,s,i){return this.transitionFactories.find(o=>o.match(t,e,s,i))||null}matchStyles(t,e,s){return this.fallbackTransition.buildStyles(t,e,s)}}function qn(n,t,e){n.hasOwnProperty(t)?n.hasOwnProperty(e)||(n[e]=n[t]):n.hasOwnProperty(e)&&(n[t]=n[e])}const ar=new qe;class lr{constructor(t,e,s){this.bodyNode=t,this._driver=e,this._normalizer=s,this._animations={},this._playersById={},this.players=[]}register(t,e){const s=[],i=Zt(this._driver,e,s);if(s.length)throw new Error(`Unable to build the animation due to the following errors: ${s.join("\n")}`);this._animations[t]=i}_buildPlayer(t,e,s){const i=t.element,r=An(0,this._normalizer,0,t.keyframes,e,s);return this._driver.animate(i,r,t.duration,t.delay,t.easing,[],!0)}create(t,e,s={}){const i=[],r=this._animations[t];let o;const a=new Map;if(r?(o=xt(this._driver,e,r,Dt,Ue,{},{},s,ar,i),o.forEach(h=>{const d=Z(a,h.element,{});h.postStyleProps.forEach(f=>d[f]=null)})):(i.push("The requested animation doesn't exist or has already been destroyed"),o=[]),i.length)throw new Error(`Unable to create the animation due to the following errors: ${i.join("\n")}`);a.forEach((h,d)=>{Object.keys(h).forEach(f=>{h[f]=this._driver.computeStyle(d,f,A.l3)})});const u=se(o.map(h=>{const d=a.get(h.element);return this._buildPlayer(h,{},d)}));return this._playersById[t]=u,u.onDestroy(()=>this.destroy(t)),this.players.push(u),u}destroy(t){const e=this._getPlayer(t);e.destroy(),delete this._playersById[t];const s=this.players.indexOf(e);s>=0&&this.players.splice(s,1)}_getPlayer(t){const e=this._playersById[t];if(!e)throw new Error(`Unable to find the timeline player referenced by ${t}`);return e}listen(t,e,s,i){const r=Tt(e,"","","");return Et(this._getPlayer(t),s,r,i),()=>{}}command(t,e,s,i){if("register"==s)return void this.register(t,i[0]);if("create"==s)return void this.create(t,e,i[0]||{});const r=this._getPlayer(t);switch(s){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(t)}}}const Vn="ng-animate-queued",Qn="ng-animate-disabled",Wn=".ng-animate-disabled",dr=[],Yn={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},fr={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},$="__ng_removed";class zt{constructor(t,e=""){this.namespaceId=e;const s=t&&t.hasOwnProperty("value");if(this.value=null!=(n=s?t.value:t)?n:null,s){const r=be(t);delete r.value,this.options=r}else this.options={};var n;this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const s=this.options.params;Object.keys(e).forEach(i=>{null==s[i]&&(s[i]=e[i])})}}}const Oe="void",qt=new zt(Oe);class pr{constructor(t,e,s){this.id=t,this.hostElement=e,this._engine=s,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,G(e,this._hostClassName)}listen(t,e,s,i){if(!this._triggers.hasOwnProperty(e))throw new Error(`Unable to listen on the animation trigger event "${s}" because the animation trigger "${e}" doesn't exist!`);if(null==s||0==s.length)throw new Error(`Unable to listen on the animation trigger "${e}" because the provided event is undefined!`);if("start"!=(n=s)&&"done"!=n)throw new Error(`The provided animation trigger event "${s}" for the animation trigger "${e}" is not supported!`);var n;const r=Z(this._elementListeners,t,[]),o={name:e,phase:s,callback:i};r.push(o);const a=Z(this._engine.statesByElement,t,{});return a.hasOwnProperty(e)||(G(t,Be),G(t,Be+"-"+e),a[e]=qt),()=>{this._engine.afterFlush(()=>{const l=r.indexOf(o);l>=0&&r.splice(l,1),this._triggers[e]||delete a[e]})}}register(t,e){return!this._triggers[t]&&(this._triggers[t]=e,!0)}_getTrigger(t){const e=this._triggers[t];if(!e)throw new Error(`The provided animation trigger "${t}" has not been registered!`);return e}trigger(t,e,s,i=!0){const r=this._getTrigger(e),o=new Vt(this.id,e,t);let a=this._engine.statesByElement.get(t);a||(G(t,Be),G(t,Be+"-"+e),this._engine.statesByElement.set(t,a={}));let l=a[e];const u=new zt(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&l&&u.absorbOptions(l.options),a[e]=u,l||(l=qt),u.value!==Oe&&l.value===u.value){if(!function(n,t){const e=Object.keys(n),s=Object.keys(t);if(e.length!=s.length)return!1;for(let i=0;i<e.length;i++){const r=e[i];if(!t.hasOwnProperty(r)||n[r]!==t[r])return!1}return!0}(l.params,u.params)){const g=[],v=r.matchStyles(l.value,l.params,g),b=r.matchStyles(u.value,u.params,g);g.length?this._engine.reportError(g):this._engine.afterFlush(()=>{ue(t,v),V(t,b)})}return}const f=Z(this._engine.playersByElement,t,[]);f.forEach(g=>{g.namespaceId==this.id&&g.triggerName==e&&g.queued&&g.destroy()});let _=r.matchTransition(l.value,u.value,t,u.params),p=!1;if(!_){if(!i)return;_=r.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:_,fromState:l,toState:u,player:o,isFallbackTransition:p}),p||(G(t,Vn),o.onStart(()=>{Ee(t,Vn)})),o.onDone(()=>{let g=this.players.indexOf(o);g>=0&&this.players.splice(g,1);const v=this._engine.playersByElement.get(t);if(v){let b=v.indexOf(o);b>=0&&v.splice(b,1)}}),this.players.push(o),f.push(o),o}deregister(t){delete this._triggers[t],this._engine.statesByElement.forEach((e,s)=>{delete e[t]}),this._elementListeners.forEach((e,s)=>{this._elementListeners.set(s,e.filter(i=>i.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(s=>s.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const s=this._engine.driver.query(t,Ze,!0);s.forEach(i=>{if(i[$])return;const r=this._engine.fetchNamespacesByElement(i);r.size?r.forEach(o=>o.triggerLeaveAnimation(i,e,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(t,e,s,i){const r=this._engine.statesByElement.get(t);if(r){const o=[];if(Object.keys(r).forEach(a=>{if(this._triggers[a]){const l=this.trigger(t,a,Oe,i);l&&o.push(l)}}),o.length)return this._engine.markElementAsRemoved(this.id,t,!0,e),s&&se(o).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),s=this._engine.statesByElement.get(t);if(e&&s){const i=new Set;e.forEach(r=>{const o=r.name;if(i.has(o))return;i.add(o);const l=this._triggers[o].fallbackTransition,u=s[o]||qt,h=new zt(Oe),d=new Vt(this.id,o,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:o,transition:l,fromState:u,toState:h,player:d,isFallbackTransition:!0})})}}removeNode(t,e){const s=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let i=!1;if(s.totalAnimations){const r=s.players.length?s.playersByQueriedElement.get(t):[];if(r&&r.length)i=!0;else{let o=t;for(;o=o.parentNode;)if(s.statesByElement.get(o)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(t),i)s.markElementAsRemoved(this.id,t,!1,e);else{const r=t[$];(!r||r===Yn)&&(s.afterFlush(()=>this.clearElementCache(t)),s.destroyInnerAnimations(t),s._onRemovalComplete(t,e))}}insertNode(t,e){G(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(s=>{const i=s.player;if(i.destroyed)return;const r=s.element,o=this._elementListeners.get(r);o&&o.forEach(a=>{if(a.name==s.triggerName){const l=Tt(r,s.triggerName,s.fromState.value,s.toState.value);l._data=t,Et(s.player,a.phase,l,a.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):e.push(s)}),this._queue=[],e.sort((s,i)=>{const r=s.transition.ast.depCount,o=i.transition.ast.depCount;return 0==r||0==o?r-o:this._engine.driver.containsElement(s.element,i.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(s=>s.element===t)||e,e}}class mr{constructor(t,e,s){this.bodyNode=t,this.driver=e,this._normalizer=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(i,r)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(s=>{s.queued&&t.push(s)})}),t}createNamespace(t,e){const s=new pr(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(s,e):(this.newHostElements.set(e,s),this.collectEnterElement(e)),this._namespaceLookup[t]=s}_balanceNamespaceList(t,e){const s=this._namespaceList.length-1;if(s>=0){let i=!1;for(let r=s;r>=0;r--)if(this.driver.containsElement(this._namespaceList[r].hostElement,e)){this._namespaceList.splice(r+1,0,t),i=!0;break}i||this._namespaceList.splice(0,0,t)}else this._namespaceList.push(t);return this.namespacesByHostElement.set(e,t),t}register(t,e){let s=this._namespaceLookup[t];return s||(s=this.createNamespace(t,e)),s}registerTrigger(t,e,s){let i=this._namespaceLookup[t];i&&i.register(e,s)&&this.totalAnimations++}destroy(t,e){if(!t)return;const s=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(s.hostElement),delete this._namespaceLookup[t];const i=this._namespaceList.indexOf(s);i>=0&&this._namespaceList.splice(i,1)}),this.afterFlushAnimationsDone(()=>s.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,s=this.statesByElement.get(t);if(s){const i=Object.keys(s);for(let r=0;r<i.length;r++){const o=s[i[r]].namespaceId;if(o){const a=this._fetchNamespace(o);a&&e.add(a)}}}return e}trigger(t,e,s,i){if(We(e)){const r=this._fetchNamespace(t);if(r)return r.trigger(e,s,i),!0}return!1}insertNode(t,e,s,i){if(!We(e))return;const r=e[$];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;const o=this.collectedLeaveElements.indexOf(e);o>=0&&this.collectedLeaveElements.splice(o,1)}if(t){const o=this._fetchNamespace(t);o&&o.insertNode(e,s)}i&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),G(t,Qn)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Ee(t,Qn))}removeNode(t,e,s,i){if(We(e)){const r=t?this._fetchNamespace(t):null;if(r?r.removeNode(e,i):this.markElementAsRemoved(t,e,!1,i),s){const o=this.namespacesByHostElement.get(e);o&&o.id!==t&&o.removeNode(e,i)}}else this._onRemovalComplete(e,i)}markElementAsRemoved(t,e,s,i){this.collectedLeaveElements.push(e),e[$]={namespaceId:t,setForRemoval:i,hasAnimation:s,removedBeforeQueried:!1}}listen(t,e,s,i,r){return We(e)?this._fetchNamespace(t).listen(e,s,i,r):()=>{}}_buildInstruction(t,e,s,i,r){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,s,i,t.fromState.options,t.toState.options,e,r)}destroyInnerAnimations(t){let e=this.driver.query(t,Ze,!0);e.forEach(s=>this.destroyActiveAnimationsForElement(s)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,Rt,!0),e.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return se(this.players).onDone(()=>t());t()})}processLeaveNode(t){const e=t[$];if(e&&e.setForRemoval){if(t[$]=Yn,e.namespaceId){this.destroyInnerAnimations(t);const s=this._fetchNamespace(e.namespaceId);s&&s.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}this.driver.matchesElement(t,Wn)&&this.markElementAsDisabled(t,!1),this.driver.query(t,Wn,!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,i)=>this._balanceNamespaceList(s,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++)G(this.collectedEnterElements[s],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const s=[];try{e=this._flushAnimations(s,t)}finally{for(let i=0;i<s.length;i++)s[i]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++)this.processLeaveNode(this.collectedLeaveElements[s]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){const s=this._whenQuietFns;this._whenQuietFns=[],e.length?se(e).onDone(()=>{s.forEach(i=>i())}):s.forEach(i=>i())}}reportError(t){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${t.join("\n")}`)}_flushAnimations(t,e){const s=new qe,i=[],r=new Map,o=[],a=new Map,l=new Map,u=new Map,h=new Set;this.disabledNodes.forEach(y=>{h.add(y);const S=this.driver.query(y,".ng-animate-queued",!0);for(let E=0;E<S.length;E++)h.add(S[E])});const d=this.bodyNode,f=Array.from(this.statesByElement.keys()),_=Xn(f,this.collectedEnterElements),p=new Map;let g=0;_.forEach((y,S)=>{const E=Dt+g++;p.set(S,E),y.forEach(P=>G(P,E))});const v=[],b=new Set,T=new Set;for(let y=0;y<this.collectedLeaveElements.length;y++){const S=this.collectedLeaveElements[y],E=S[$];E&&E.setForRemoval&&(v.push(S),b.add(S),E.hasAnimation?this.driver.query(S,".ng-star-inserted",!0).forEach(P=>b.add(P)):T.add(S))}const R=new Map,N=Xn(f,Array.from(b));N.forEach((y,S)=>{const E=Ue+g++;R.set(S,E),y.forEach(P=>G(P,E))}),t.push(()=>{_.forEach((y,S)=>{const E=p.get(S);y.forEach(P=>Ee(P,E))}),N.forEach((y,S)=>{const E=R.get(S);y.forEach(P=>Ee(P,E))}),v.forEach(y=>{this.processLeaveNode(y)})});const z=[],Q=[];for(let y=this._namespaceList.length-1;y>=0;y--)this._namespaceList[y].drainQueuedTransitions(e).forEach(E=>{const P=E.player,L=E.element;if(z.push(P),this.collectedEnterElements.length){const Y=L[$];if(Y&&Y.setForMove)return void P.destroy()}const W=!d||!this.driver.containsElement(d,L),x=R.get(L),oe=p.get(L),M=this._buildInstruction(E,s,oe,x,W);if(M.errors&&M.errors.length)Q.push(M);else{if(W)return P.onStart(()=>ue(L,M.fromStyles)),P.onDestroy(()=>V(L,M.toStyles)),void i.push(P);if(E.isFallbackTransition)return P.onStart(()=>ue(L,M.fromStyles)),P.onDestroy(()=>V(L,M.toStyles)),void i.push(P);M.timelines.forEach(Y=>Y.stretchStartingKeyframe=!0),s.append(L,M.timelines),o.push({instruction:M,player:P,element:L}),M.queriedElements.forEach(Y=>Z(a,Y,[]).push(P)),M.preStyleProps.forEach((Y,Re)=>{const yt=Object.keys(Y);if(yt.length){let ge=l.get(Re);ge||l.set(Re,ge=new Set),yt.forEach(En=>ge.add(En))}}),M.postStyleProps.forEach((Y,Re)=>{const yt=Object.keys(Y);let ge=u.get(Re);ge||u.set(Re,ge=new Set),yt.forEach(En=>ge.add(En))})}});if(Q.length){const y=[];Q.forEach(S=>{y.push(`@${S.triggerName} has failed due to:\n`),S.errors.forEach(E=>y.push(`- ${E}\n`))}),z.forEach(S=>S.destroy()),this.reportError(y)}const U=new Map,ee=new Map;o.forEach(y=>{const S=y.element;s.has(S)&&(ee.set(S,S),this._beforeAnimationBuild(y.player.namespaceId,y.instruction,U))}),i.forEach(y=>{const S=y.element;this._getPreviousPlayers(S,!1,y.namespaceId,y.triggerName,null).forEach(P=>{Z(U,S,[]).push(P),P.destroy()})});const te=v.filter(y=>ts(y,l,u)),ne=new Map;Jn(ne,this.driver,T,u,A.l3).forEach(y=>{ts(y,l,u)&&te.push(y)});const De=new Map;_.forEach((y,S)=>{Jn(De,this.driver,new Set(y),l,A.k1)}),te.forEach(y=>{const S=ne.get(y),E=De.get(y);ne.set(y,Object.assign(Object.assign({},S),E))});const me=[],Ai=[],wi={};o.forEach(y=>{const{element:S,player:E,instruction:P}=y;if(s.has(S)){if(h.has(S))return E.onDestroy(()=>V(S,P.toStyles)),E.disabled=!0,E.overrideTotalTime(P.totalTime),void i.push(E);let L=wi;if(ee.size>1){let x=S;const oe=[];for(;x=x.parentNode;){const M=ee.get(x);if(M){L=M;break}oe.push(x)}oe.forEach(M=>ee.set(M,L))}const W=this._buildAnimation(E.namespaceId,P,U,r,De,ne);if(E.setRealPlayer(W),L===wi)me.push(E);else{const x=this.playersByElement.get(L);x&&x.length&&(E.parentPlayer=se(x)),i.push(E)}}else ue(S,P.fromStyles),E.onDestroy(()=>V(S,P.toStyles)),Ai.push(E),h.has(S)&&i.push(E)}),Ai.forEach(y=>{const S=r.get(y.element);if(S&&S.length){const E=se(S);y.setRealPlayer(E)}}),i.forEach(y=>{y.parentPlayer?y.syncPlayerEvents(y.parentPlayer):y.destroy()});for(let y=0;y<v.length;y++){const S=v[y],E=S[$];if(Ee(S,Ue),E&&E.hasAnimation)continue;let P=[];if(a.size){let W=a.get(S);W&&W.length&&P.push(...W);let x=this.driver.query(S,Rt,!0);for(let oe=0;oe<x.length;oe++){let M=a.get(x[oe]);M&&M.length&&P.push(...M)}}const L=P.filter(W=>!W.destroyed);L.length?_r(this,S,L):this.processLeaveNode(S)}return v.length=0,me.forEach(y=>{this.players.push(y),y.onDone(()=>{y.destroy();const S=this.players.indexOf(y);this.players.splice(S,1)}),y.play()}),me}elementContainsData(t,e){let s=!1;const i=e[$];return i&&i.setForRemoval&&(s=!0),this.playersByElement.has(e)&&(s=!0),this.playersByQueriedElement.has(e)&&(s=!0),this.statesByElement.has(e)&&(s=!0),this._fetchNamespace(t).elementContainsData(e)||s}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,s,i,r){let o=[];if(e){const a=this.playersByQueriedElement.get(t);a&&(o=a)}else{const a=this.playersByElement.get(t);if(a){const l=!r||r==Oe;a.forEach(u=>{u.queued||!l&&u.triggerName!=i||o.push(u)})}}return(s||i)&&(o=o.filter(a=>!(s&&s!=a.namespaceId||i&&i!=a.triggerName))),o}_beforeAnimationBuild(t,e,s){const r=e.element,o=e.isRemovalTransition?void 0:t,a=e.isRemovalTransition?void 0:e.triggerName;for(const l of e.timelines){const u=l.element,h=u!==r,d=Z(s,u,[]);this._getPreviousPlayers(u,h,o,a,e.toState).forEach(_=>{const p=_.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),_.destroy(),d.push(_)})}ue(r,e.fromStyles)}_buildAnimation(t,e,s,i,r,o){const a=e.triggerName,l=e.element,u=[],h=new Set,d=new Set,f=e.timelines.map(p=>{const g=p.element;h.add(g);const v=g[$];if(v&&v.removedBeforeQueried)return new A.ZN(p.duration,p.delay);const b=g!==l,T=function(n){const t=[];return es(n,t),t}((s.get(g)||dr).map(U=>U.getRealPlayer())).filter(U=>!!U.element&&U.element===g),R=r.get(g),N=o.get(g),z=An(0,this._normalizer,0,p.keyframes,R,N),Q=this._buildPlayer(p,z,T);if(p.subTimeline&&i&&d.add(g),b){const U=new Vt(t,a,g);U.setRealPlayer(Q),u.push(U)}return Q});u.forEach(p=>{Z(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>function(n,t,e){let s;if(n instanceof Map){if(s=n.get(t),s){if(s.length){const i=s.indexOf(e);s.splice(i,1)}0==s.length&&n.delete(t)}}else if(s=n[t],s){if(s.length){const i=s.indexOf(e);s.splice(i,1)}0==s.length&&delete n[t]}return s}(this.playersByQueriedElement,p.element,p))}),h.forEach(p=>G(p,Rn));const _=se(f);return _.onDestroy(()=>{h.forEach(p=>Ee(p,Rn)),V(l,e.toStyles)}),d.forEach(p=>{Z(i,p,[]).push(_)}),_}_buildPlayer(t,e,s){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,s):new A.ZN(t.duration,t.delay)}}class Vt{constructor(t,e,s){this.namespaceId=t,this.triggerName=e,this.element=s,this._player=new A.ZN,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,Object.keys(this._queuedCallbacks).forEach(e=>{this._queuedCallbacks[e].forEach(s=>Et(t,e,void 0,s))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){Z(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function We(n){return n&&1===n.nodeType}function Hn(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function Jn(n,t,e,s,i){const r=[];e.forEach(l=>r.push(Hn(l)));const o=[];s.forEach((l,u)=>{const h={};l.forEach(d=>{const f=h[d]=t.computeStyle(u,d,i);(!f||0==f.length)&&(u[$]=fr,o.push(u))}),n.set(u,h)});let a=0;return e.forEach(l=>Hn(l,r[a++])),o}function Xn(n,t){const e=new Map;if(n.forEach(a=>e.set(a,[])),0==t.length)return e;const i=new Set(t),r=new Map;function o(a){if(!a)return 1;let l=r.get(a);if(l)return l;const u=a.parentNode;return l=e.has(u)?u:i.has(u)?1:o(u),r.set(a,l),l}return t.forEach(a=>{const l=o(a);1!==l&&e.get(l).push(a)}),e}const Ye="$$classes";function G(n,t){if(n.classList)n.classList.add(t);else{let e=n[Ye];e||(e=n[Ye]={}),e[t]=!0}}function Ee(n,t){if(n.classList)n.classList.remove(t);else{let e=n[Ye];e&&delete e[t]}}function _r(n,t,e){se(e).onDone(()=>n.processLeaveNode(t))}function es(n,t){for(let e=0;e<n.length;e++){const s=n[e];s instanceof A.ZE?es(s.players,t):t.push(s)}}function ts(n,t,e){const s=e.get(n);if(!s)return!1;let i=t.get(n);return i?s.forEach(r=>i.add(r)):t.set(n,s),e.delete(n),!0}class He{constructor(t,e,s){this.bodyNode=t,this._driver=e,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(i,r)=>{},this._transitionEngine=new mr(t,e,s),this._timelineEngine=new lr(t,e,s),this._transitionEngine.onRemovalComplete=(i,r)=>this.onRemovalComplete(i,r)}registerTrigger(t,e,s,i,r){const o=t+"-"+i;let a=this._triggerCache[o];if(!a){const l=[],u=Zt(this._driver,r,l);if(l.length)throw new Error(`The animation trigger "${i}" has failed to build due to the following errors:\n - ${l.join("\n - ")}`);a=function(n,t,e){return new rr(n,t,e)}(i,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(e,i,a)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,s,i){this._transitionEngine.insertNode(t,e,s,i)}onRemove(t,e,s,i){this._transitionEngine.removeNode(t,e,i||!1,s)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,s,i){if("@"==s.charAt(0)){const[r,o]=wn(s);this._timelineEngine.command(r,e,o,i)}else this._transitionEngine.trigger(t,e,s,i)}listen(t,e,s,i,r){if("@"==s.charAt(0)){const[o,a]=wn(s);return this._timelineEngine.listen(o,e,a,r)}return this._transitionEngine.listen(t,e,s,i,r)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function ns(n,t){let e=null,s=null;return Array.isArray(t)&&t.length?(e=Qt(t[0]),t.length>1&&(s=Qt(t[t.length-1]))):t&&(e=Qt(t)),e||s?new Er(n,e,s):null}let Er=(()=>{class n{constructor(e,s,i){this._element=e,this._startStyles=s,this._endStyles=i,this._state=0;let r=n.initialStylesByElement.get(e);r||n.initialStylesByElement.set(e,r={}),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&V(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(V(this._element,this._initialStyles),this._endStyles&&(V(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(ue(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ue(this._element,this._endStyles),this._endStyles=null),V(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function Qt(n){let t=null;const e=Object.keys(n);for(let s=0;s<e.length;s++){const i=e[s];Pr(i)&&(t=t||{},t[i]=n[i])}return t}function Pr(n){return"display"===n||"position"===n}const ss="animation",is="animationend";class wr{constructor(t,e,s,i,r,o,a){this._element=t,this._name=e,this._duration=s,this._delay=i,this._easing=r,this._fillMode=o,this._onDoneFn=a,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=l=>this._handleCallback(l)}apply(){(function(n,t){const e=Yt(n,"").trim();let s=0;e.length&&(function(n,t){let e=0;for(let s=0;s<n.length;s++)","===n.charAt(s)&&e++;return e}(e)+1,t=`${e}, ${t}`),Je(n,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),as(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){rs(this._element,this._name,"paused")}resume(){rs(this._element,this._name,"running")}setPosition(t){const e=os(this._element,this._name);this._position=t*this._duration,Je(this._element,"Delay",`-${this._position}ms`,e)}getPosition(){return this._position}_handleCallback(t){const e=t._ngTestManualTimestamp||Date.now(),s=1e3*parseFloat(t.elapsedTime.toFixed(3));t.animationName==this._name&&Math.max(e-this._startTime,0)>=this._delay&&s>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),as(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(n,t){const s=Yt(n,"").split(","),i=Wt(s,t);i>=0&&(s.splice(i,1),Je(n,"",s.join(",")))}(this._element,this._name))}}function rs(n,t,e){Je(n,"PlayState",e,os(n,t))}function os(n,t){const e=Yt(n,"");return e.indexOf(",")>0?Wt(e.split(","),t):Wt([e],t)}function Wt(n,t){for(let e=0;e<n.length;e++)if(n[e].indexOf(t)>=0)return e;return-1}function as(n,t,e){e?n.removeEventListener(is,t):n.addEventListener(is,t)}function Je(n,t,e,s){const i=ss+t;if(null!=s){const r=n.style[i];if(r.length){const o=r.split(",");o[s]=e,e=o.join(",")}}n.style[i]=e}function Yt(n,t){return n.style[ss+t]||""}class ls{constructor(t,e,s,i,r,o,a,l){this.element=t,this.keyframes=e,this.animationName=s,this._duration=i,this._delay=r,this._finalStyles=a,this._specialStyles=l,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=o||"linear",this.totalTime=i+r,this._buildStyler()}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(t=>t()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(t){this._styler.setPosition(t)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new wr(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(s=>s()),e.length=0}beforeDestroy(){this.init();const t={};if(this.hasStarted()){const e=this._state>=3;Object.keys(this._finalStyles).forEach(s=>{"offset"!=s&&(t[s]=e?this._finalStyles[s]:Bt(this.element,s))})}this.currentSnapshot=t}}class Dr extends A.ZN{constructor(t,e){super(),this.element=t,this._startingStyles={},this.__initialized=!1,this._styles=Nn(e)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(t=>{this._startingStyles[t]=this.element.style[t]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(t=>this.element.style.setProperty(t,this._styles[t])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(t=>{const e=this._startingStyles[t];e?this.element.style.setProperty(t,e):this.element.style.removeProperty(t)}),this._startingStyles=null,super.destroy())}}class us{constructor(){this._count=0}validateStyleProperty(t){return Ct(t)}matchesElement(t,e){return Ot(t,e)}containsElement(t,e){return Ft(t,e)}query(t,e,s){return Nt(t,e,s)}computeStyle(t,e,s){return window.getComputedStyle(t)[e]}buildKeyframeElement(t,e,s){s=s.map(a=>Nn(a));let i=`@keyframes ${e} {\n`,r="";s.forEach(a=>{r=" ";const l=parseFloat(a.offset);i+=`${r}${100*l}% {\n`,r+=" ",Object.keys(a).forEach(u=>{const h=a[u];switch(u){case"offset":return;case"easing":return void(h&&(i+=`${r}animation-timing-function: ${h};\n`));default:return void(i+=`${r}${u}: ${h};\n`)}}),i+=`${r}}\n`}),i+="}\n";const o=document.createElement("style");return o.textContent=i,o}animate(t,e,s,i,r,o=[],a){const l=o.filter(v=>v instanceof ls),u={};Zn(s,i)&&l.forEach(v=>{let b=v.currentSnapshot;Object.keys(b).forEach(T=>u[T]=b[T])});const h=function(n){let t={};return n&&(Array.isArray(n)?n:[n]).forEach(s=>{Object.keys(s).forEach(i=>{"offset"==i||"easing"==i||(t[i]=s[i])})}),t}(e=jn(t,e,u));if(0==s)return new Dr(t,h);const d="gen_css_kf_"+this._count++,f=this.buildKeyframeElement(t,d,e);(function(n){var t;const e=null===(t=n.getRootNode)||void 0===t?void 0:t.call(n);return"undefined"!=typeof ShadowRoot&&e instanceof ShadowRoot?e:document.head})(t).appendChild(f);const p=ns(t,e),g=new ls(t,e,d,s,i,r,h,p);return g.onDestroy(()=>{var n;(n=f).parentNode.removeChild(n)}),g}}class ds{constructor(t,e,s,i){this.element=t,this.keyframes=e,this.options=s,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(t,e,s){return t.animate(e,s)}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(e=>{"offset"!=e&&(t[e]=this._finished?this._finalKeyframe[e]:Bt(this.element,e))}),this.currentSnapshot=t}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(s=>s()),e.length=0}}class Br{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(fs().toString()),this._cssKeyframesDriver=new us}validateStyleProperty(t){return Ct(t)}matchesElement(t,e){return Ot(t,e)}containsElement(t,e){return Ft(t,e)}query(t,e,s){return Nt(t,e,s)}computeStyle(t,e,s){return window.getComputedStyle(t)[e]}overrideWebAnimationsSupport(t){this._isNativeImpl=t}animate(t,e,s,i,r,o=[],a){if(!a&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(t,e,s,i,r,o);const h={duration:s,delay:i,fill:0==i?"both":"forwards"};r&&(h.easing=r);const d={},f=o.filter(p=>p instanceof ds);Zn(s,i)&&f.forEach(p=>{let g=p.currentSnapshot;Object.keys(g).forEach(v=>d[v]=g[v])});const _=ns(t,e=jn(t,e=e.map(p=>ie(p,!1)),d));return new ds(t,e,h,_)}}function fs(){return Tn()&&Element.prototype.animate||{}}let jr=(()=>{class n extends A._j{constructor(e,s){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(s.body,{id:"0",encapsulation:c.ifc.None,styles:[],data:{animation:[]}})}build(e){const s=this._nextAnimationId.toString();this._nextAnimationId++;const i=Array.isArray(e)?(0,A.vP)(e):e;return ps(this._renderer,null,s,"register",[i]),new kr(s,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(c.FYo),c.LFG(K.K0))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class kr extends A.LC{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new xr(this._id,t,e||{},this._renderer)}}class xr{constructor(t,e,s,i){this.id=t,this.element=e,this._renderer=i,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",s)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return ps(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function ps(n,t,e,s,i){return n.setProperty(t,`@@${e}:${s}`,i)}const ms="@.disabled";let Kr=(()=>{class n{constructor(e,s,i){this.delegate=e,this.engine=s,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),s.onRemovalComplete=(r,o)=>{o&&o.parentNode(r)&&o.removeChild(r.parentNode,r)}}createRenderer(e,s){const r=this.delegate.createRenderer(e,s);if(!(e&&s&&s.data&&s.data.animation)){let h=this._rendererCache.get(r);return h||(h=new gs("",r,this.engine),this._rendererCache.set(r,h)),h}const o=s.id,a=s.id+"-"+this._currentId;this._currentId++,this.engine.register(a,e);const l=h=>{Array.isArray(h)?h.forEach(l):this.engine.registerTrigger(o,a,e,h.name,h)};return s.data.animation.forEach(l),new $r(this,a,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,s,i){e>=0&&e<this._microtaskId?this._zone.run(()=>s(i)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(r=>{const[o,a]=r;o(a)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([s,i]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(c.FYo),c.LFG(He),c.LFG(c.R0b))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();class gs{constructor(t,e,s){this.namespaceId=t,this.delegate=e,this.engine=s,this.destroyNode=this.delegate.destroyNode?i=>e.destroyNode(i):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,s,i=!0){this.delegate.insertBefore(t,e,s),this.engine.onInsert(this.namespaceId,e,t,i)}removeChild(t,e,s){this.engine.onRemove(this.namespaceId,e,this.delegate,s)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,s,i){this.delegate.setAttribute(t,e,s,i)}removeAttribute(t,e,s){this.delegate.removeAttribute(t,e,s)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,s,i){this.delegate.setStyle(t,e,s,i)}removeStyle(t,e,s){this.delegate.removeStyle(t,e,s)}setProperty(t,e,s){"@"==e.charAt(0)&&e==ms?this.disableAnimations(t,!!s):this.delegate.setProperty(t,e,s)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,s){return this.delegate.listen(t,e,s)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class $r extends gs{constructor(t,e,s,i){super(e,s,i),this.factory=t,this.namespaceId=e}setProperty(t,e,s){"@"==e.charAt(0)?"."==e.charAt(1)&&e==ms?this.disableAnimations(t,s=void 0===s||!!s):this.engine.process(this.namespaceId,t,e.substr(1),s):this.delegate.setProperty(t,e,s)}listen(t,e,s){if("@"==e.charAt(0)){const i=function(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let r=e.substr(1),o="";return"@"!=r.charAt(0)&&([r,o]=function(n){const t=n.indexOf(".");return[n.substring(0,t),n.substr(t+1)]}(r)),this.engine.listen(this.namespaceId,i,r,o,a=>{this.factory.scheduleListenerCallback(a._data||-1,s,a)})}return this.delegate.listen(t,e,s)}}let qr=(()=>{class n extends He{constructor(e,s,i){super(e.body,s,i)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(K.K0),c.LFG(Mt),c.LFG($t))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const ys=new c.OlP("AnimationModuleType"),vs=[{provide:A._j,useClass:jr},{provide:$t,useFactory:function(){return new Xi}},{provide:He,useClass:qr},{provide:c.FYo,useFactory:function(n,t,e){return new Kr(n,t,e)},deps:[q.se,He,c.R0b]}],_s=[{provide:Mt,useFactory:function(){return"function"==typeof fs()?new Br:new us}},{provide:ys,useValue:"BrowserAnimations"},...vs],Ss=[{provide:Mt,useClass:Mn},{provide:ys,useValue:"NoopAnimations"},...vs];let Yr=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?Ss:_s}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:_s,imports:[q.b2]}),n})();var C=m(6453);const Ht=new C.ReplaySubject(1);var H=m(7250),O=m(9745),Hr=m(408),et=m(6015),de=m(7128),Jt=m(2025),k=m(906);const Xt="patient-form";let bs=(()=>{class n{constructor(){}getCurrentSession(){return(0,k.getCurrentUser)()}openmrsFetch(e){return(0,k.openmrsObservableFetch)(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var F=m(5258),re=m(6191);let Fe=(()=>{class n{constructor(e,s){this.http=e,this.windoRef=s,this.v="custom:(uuid,encounterDatetime,patient:(uuid,uuid),form:(uuid,name),visit:(uuid,display,auditInfo,startDatetime,stopDatetime,location:(uuid,display),visitType:(uuid,name)),location:ref,encounterType:ref,encounterProviders:(uuid,display,provider:(uuid,display)))"}getUrl(){return this.windoRef.openmrsRestBase}getEncountersByPatientUuid(e,s=!1,i=null){if(!e)return null;const r=this.getUrl()+"encounter";let o=(new F.LE).set("patient",e).set("v",this.v);return this.http.get(r,{params:o}).pipe((0,et.VS)(a=>a.results.length>=500?(o=o.set("startIndex","500"),this.http.get(r,{params:o}).pipe((0,O.U)(l=>a.results.concat(l.results)))):(0,C.of)(a.results)))}getEncounterByUuid(e){if(!e)return null;const i=(new F.LE).set("v","custom:(uuid,encounterDatetime,patient:(uuid,uuid,person,identifiers:full),form:(uuid,name),visit:(uuid,visitType,display,startDatetime,stopDatetime),location:ref,encounterType:ref,encounterProviders:(uuid,display,provider:(uuid,display)),orders:full,obs:(uuid,obsDatetime,formFieldNamespace,formFieldPath,concept:(uuid,uuid,name:(display)),value:ref,groupMembers),diagnoses:(uuid,diagnosis,certainty,rank,voided,display))"),r=this.getUrl()+"encounter/"+e;return this.http.get(r,{params:i})}getEncounterTypes(e){if(!e)return null;const s=this.getUrl()+"encountertype";return this.http.get(s).pipe((0,O.U)(i=>i.results))}saveEncounter(e){if(!e)return null;const s=this.getUrl()+"encounter",i=new F.WM({"Content-Type":"application/json"});return this.http.post(s,JSON.stringify(e),{headers:i})}updateEncounter(e,s){if(!s||!e)return null;const i=this.getUrl()+"encounter/"+e,r=new F.WM({"Content-Type":"application/json"});return this.http.post(i,JSON.stringify(s),{headers:r})}voidEncounter(e){if(!e)return null;const s=this.getUrl()+"encounter/"+e+"?!purge",i=new F.WM({"Content-Type":"application/json"});return this.http.delete(s,{headers:i})}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var Es=m(724),Ps=m(9225);const no=(0,m(7632).Z)(Object.keys,Object);var io=Object.prototype.hasOwnProperty;const Ts=function(n){if(!(0,Ps.Z)(n))return no(n);var t=[];for(var e in Object(n))io.call(n,e)&&"constructor"!=e&&t.push(e);return t};var tt=m(8955),nt=m(3935);const en=(0,tt.Z)(nt.Z,"DataView");var tn=m(1347);const nn=(0,tt.Z)(nt.Z,"Promise"),sn=(0,tt.Z)(nt.Z,"Set"),rn=(0,tt.Z)(nt.Z,"WeakMap");var As=m(7890),Pe=m(8612),ws="[object Map]",Cs="[object Promise]",Os="[object Set]",Fs="[object WeakMap]",Ns="[object DataView]",ho=(0,Pe.Z)(en),fo=(0,Pe.Z)(tn.Z),po=(0,Pe.Z)(nn),mo=(0,Pe.Z)(sn),go=(0,Pe.Z)(rn),fe=As.Z;(en&&fe(new en(new ArrayBuffer(1)))!=Ns||tn.Z&&fe(new tn.Z)!=ws||nn&&fe(nn.resolve())!=Cs||sn&&fe(new sn)!=Os||rn&&fe(new rn)!=Fs)&&(fe=function(n){var t=(0,As.Z)(n),e="[object Object]"==t?n.constructor:void 0,s=e?(0,Pe.Z)(e):"";if(s)switch(s){case ho:return Ns;case fo:return ws;case po:return Cs;case mo:return Os;case go:return Fs}return t});const Te=fe;var Ms=m(5772),J=m(4897),on=m(4001),st=m(1936),Ds=m(937),So=Object.prototype.hasOwnProperty;const Rs=function(n){if(null==n)return!0;if((0,on.Z)(n)&&((0,J.Z)(n)||"string"==typeof n||"function"==typeof n.splice||(0,st.Z)(n)||(0,Ds.Z)(n)||(0,Ms.Z)(n)))return!n.length;var t=Te(n);if("[object Map]"==t||"[object Set]"==t)return!n.size;if((0,Ps.Z)(n))return!Ts(n).length;for(var e in n)if(So.call(n,e))return!1;return!0};var Ne=m(689);var To=m(30),it=m(7426),Ao=m(8260);const Me=function(n){return(0,on.Z)(n)?(0,Ao.Z)(n):Ts(n)};var an=m(514);var Mo=m(3135),Do=m(4873);const Ls=function(){return[]};var Bo=Object.prototype.propertyIsEnumerable,Is=Object.getOwnPropertySymbols;const ln=Is?function(n){return null==n?[]:(n=Object(n),function(n,t){for(var e=-1,s=null==n?0:n.length,i=0,r=[];++e<s;){var o=n[e];t(o,e,n)&&(r[i++]=o)}return r}(Is(n),function(t){return Bo.call(n,t)}))}:Ls,Us=function(n,t){for(var e=-1,s=t.length,i=n.length;++e<s;)n[i+e]=t[e];return n};var Ko=m(5763);const Bs=Object.getOwnPropertySymbols?function(n){for(var t=[];n;)Us(t,ln(n)),n=(0,Ko.Z)(n);return t}:Ls,Zs=function(n,t,e){var s=t(n);return(0,J.Z)(n)?s:Us(s,e(n))},cn=function(n){return Zs(n,Me,ln)},Yo=function(n){return Zs(n,an.Z,Bs)};var Jo=Object.prototype.hasOwnProperty;var js=m(8190);var sa=/\w*$/;var rt=m(7122),ks=rt.Z?rt.Z.prototype:void 0,xs=ks?ks.valueOf:void 0;var la=m(6038);const Fa=function(n,t,e){var s=n.constructor;switch(t){case"[object ArrayBuffer]":return(0,js.Z)(n);case"[object Boolean]":case"[object Date]":return new s(+n);case"[object DataView]":return function(n,t){var e=t?(0,js.Z)(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.byteLength)}(n,e);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return(0,la.Z)(n,e);case"[object Map]":case"[object Set]":return new s;case"[object Number]":case"[object String]":return new s(n);case"[object RegExp]":return function(n){var t=new n.constructor(n.source,sa.exec(n));return t.lastIndex=n.lastIndex,t}(n);case"[object Symbol]":return function(n){return xs?Object(xs.call(n)):{}}(n)}};var Na=m(9058),ot=m(4195);var Ks=m(4456),at=m(7495),$s=at.Z&&at.Z.isMap;const Ia=$s?(0,Ks.Z)($s):function(n){return(0,ot.Z)(n)&&"[object Map]"==Te(n)};var lt=m(7784);var Gs=at.Z&&at.Z.isSet;const ka=Gs?(0,Ks.Z)(Gs):function(n){return(0,ot.Z)(n)&&"[object Set]"==Te(n)};var zs="[object Arguments]",qs="[object Function]",Vs="[object Object]",w={};w[zs]=w["[object Array]"]=w["[object ArrayBuffer]"]=w["[object DataView]"]=w["[object Boolean]"]=w["[object Date]"]=w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Map]"]=w["[object Number]"]=w[Vs]=w["[object RegExp]"]=w["[object Set]"]=w["[object String]"]=w["[object Symbol]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w["[object Error]"]=w[qs]=w["[object WeakMap]"]=!1;const fl=function ct(n,t,e,s,i,r){var o,a=1&t,l=2&t,u=4&t;if(e&&(o=i?e(n,s,i,r):e(n)),void 0!==o)return o;if(!(0,lt.Z)(n))return n;var h=(0,J.Z)(n);if(h){if(o=function(n){var t=n.length,e=new n.constructor(t);return t&&"string"==typeof n[0]&&Jo.call(n,"index")&&(e.index=n.index,e.input=n.input),e}(n),!a)return(0,Do.Z)(n,o)}else{var d=Te(n),f=d==qs||"[object GeneratorFunction]"==d;if((0,st.Z)(n))return(0,Mo.Z)(n,a);if(d==Vs||d==zs||f&&!i){if(o=l||f?{}:(0,Na.Z)(n),!a)return l?function(n,t){return(0,it.Z)(n,Bs(n),t)}(n,function(n,t){return n&&(0,it.Z)(t,(0,an.Z)(t),n)}(o,n)):function(n,t){return(0,it.Z)(n,ln(n),t)}(n,function(n,t){return n&&(0,it.Z)(t,Me(t),n)}(o,n))}else{if(!w[d])return i?n:{};o=Fa(n,d,a)}}r||(r=new Ne.Z);var _=r.get(n);if(_)return _;r.set(n,o),ka(n)?n.forEach(function(v){o.add(ct(v,t,e,v,n,r))}):Ia(n)&&n.forEach(function(v,b){o.set(b,ct(v,t,e,b,n,r))});var g=h?void 0:(u?l?Yo:cn:l?an.Z:Me)(n);return function(n,t){for(var e=-1,s=null==n?0:n.length;++e<s&&!1!==t(n[e],e,n););}(g||n,function(v,b){g&&(v=n[b=v]),(0,To.Z)(o,b,ct(v,t,e,b,n,r))}),o},vl=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Qs=function(n){return"string"==typeof n&&vl.test(n)};function Sl(n){un(n);for(const t of["obs.concept"])hn(n,t);return n}function un(n){if("object"==typeof n)for(const[t,e]of Object.entries(n))"uuid"!==t&&"string"==typeof e&&Qs(e)?Ws(n,t):"object"==typeof e&&un(e);else if(Array.isArray(n))for(const t of n)un(t);return n}function hn(n,t){const[e,...s]=t.split(".");if(0===s.length)return void Ws(n,e);const i=null==n?void 0:n[e];if(Array.isArray(i))for(const r of i)hn(r,s.join("."));else"object"==typeof i&&hn(i,s.join("."))}function Ws(n,t){return"object"==typeof n&&"string"==typeof n[t]&&(n[t]={uuid:n[t]}),n}var ut,bl=new Uint8Array(16);function El(){if(!ut&&!(ut="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ut(bl)}for(var I=[],dn=0;dn<256;++dn)I.push((dn+256).toString(16).substr(1));const wl=function(n,t,e){var s=(n=n||{}).random||(n.rng||El)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){e=e||0;for(var i=0;i<16;++i)t[e+i]=s[i];return t}return function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=(I[n[t+0]]+I[n[t+1]]+I[n[t+2]]+I[n[t+3]]+"-"+I[n[t+4]]+I[n[t+5]]+"-"+I[n[t+6]]+I[n[t+7]]+"-"+I[n[t+8]]+I[n[t+9]]+"-"+I[n[t+10]]+I[n[t+11]]+I[n[t+12]]+I[n[t+13]]+I[n[t+14]]+I[n[t+15]]).toLowerCase();if(!Qs(e))throw TypeError("Stringified UUID is invalid");return e}(s)};var pe=m(6111);let fn=(()=>{class n{constructor(e,s){this.http=e,this.windowRef=s,this.v="full"}getUrl(){return this.windowRef.openmrsRestBase+"person"}getPersonByUuid(e,s=null){let i=this.getUrl();i+="/"+e;const r=(new F.LE).set("v",s&&s.length>0?s:this.v);return this.http.get(i,{params:r})}saveUpdatePerson(e,s){if(!s||!e)return null;const i=`${this.getUrl()}/${e}`,r=new F.WM({"Content-Type":"application/json"});return this.http.post(i,JSON.stringify(s),{headers:r}).pipe((0,O.U)(o=>o.person))}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var Cl=m(9899);let Ys=(()=>{class n{constructor(e,s,i){this.http=e,this.windowRef=s,this.personService=i}searchProvider(e){return this.getAllProviders().pipe((0,O.U)(s=>s.filter(i=>i.display.toLowerCase().includes(e.toLowerCase()))))}getProviderByUuid(e){return this.http.get(this.windowRef.openmrsRestBase+"provider/"+e+"?v="+n.v).pipe((0,de.K)(()=>this.getProviderByUuidFallback(e)))}getProviderByUuidFallback(e){return this.getAllProviders().pipe((0,O.U)(s=>s.find(i=>i.uuid===e)))}getAllProviders(){return this.http.get(this.windowRef.openmrsRestBase+"provider?q=&v="+n.v).pipe((0,O.U)(s=>s.results))}getUrl(e){return e?this.windowRef.openmrsRestBase+"provider/"+e+"?v="+n.v:this.windowRef.openmrsRestBase+"provider?q=&v="+n.v}}return n.v="custom:(uuid,display,person:(uuid))",n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X),c.LFG(fn))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Hs=(()=>{class n{constructor(e,s){this.http=e,this.windowRef=s}getLocationByUuid(e){const s=this.getUrl(e);return this.http.get(s).pipe((0,de.K)(()=>this.getLocationByUuidFallback(e)))}getLocationByUuidFallback(e){return this.getAllLocations().pipe((0,O.U)(s=>s.find(i=>i.uuid===e)))}searchLocation(e){return this.getAllLocations().pipe((0,O.U)(s=>s.filter(i=>i.display.toLowerCase().includes(e.toLowerCase()))))}getAllLocations(){const e=this.getUrl();return this.http.get(e).pipe((0,O.U)(s=>s.results))}getUrl(e){return e?this.windowRef.openmrsRestBase+"location/"+e+"?v="+n.v:this.windowRef.openmrsRestBase+"location?q=&v="+n.v}}return n.v="custom:(uuid,display)",n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Js=(()=>{class n{constructor(e,s){this.http=e,this.windowRef=s,this.v="custom:(uuid,name,conceptClass,setMembers)"}getUrl(){return this.windowRef.openmrsRestBase+"concept"}searchConcept(e,s=!1,i=null){const r=this.getUrl(),o=(new F.LE).set("q",e).set("v",i&&i.length>0?i:this.v);return this.http.get(r,{params:o}).pipe((0,O.U)(a=>a.results))}getConceptByUuid(e,s=!1,i=this.v){let r=this.getUrl();r+="/"+e;const o=(new F.LE).set("v",i&&i.length>0?i:this.v);return this.http.get(r,{params:o})}getConceptByConceptClassesUuid(e,s){let i=[];return this.searchConcept(e).pipe((0,H.q)(1)).subscribe(o=>{i=this.filterResultsByConceptClassesUuid(o,s)},o=>{}),i}filterResultsByConceptClassesUuid(e,s){return e.filter(r=>s.find(o=>r.conceptClass.uuid===o))}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var Xs=m(2115);let pn=(()=>{class n{constructor(e,s,i,r){this.providerResourceService=e,this.locationResourceService=s,this.conceptResourceService=i,this.localStorageService=r}getDataSources(e){return{location:{resolveSelectedValue:this.getLocationByUuid.bind(this),searchOptions:this.findLocation.bind(this)},provider:{resolveSelectedValue:this.getProviderByUuid.bind(this),searchOptions:this.findProvider.bind(this)},drug:{resolveSelectedValue:this.resolveConcept.bind(this),searchOptions:this.findDrug.bind(this)},problem:{resolveSelectedValue:this.resolveConcept.bind(this),searchOptions:this.findProblem.bind(this)},diagnoses:{resolveSelectedValue:this.resolveConcept.bind(this),searchOptions:this.findDiagnoses.bind(this)},conceptAnswers:this.getWhoStagingCriteriaDataSource(),recentObs:this.getMostRecentObsDataSource(e)}}getWhoStagingCriteriaDataSource(){const e=new C.Subject,s={cachedOptions:[],dataSourceOptions:{concept:void 0},resolveSelectedValue:void 0,searchOptions:void 0,dataFromSourceChanged:e.asObservable(),changeConcept:void 0},i=a=>{if(s.cachedOptions.length>0)return C.Observable.create(u=>{u.next(s.cachedOptions)});const l=this.getConceptSetMembers(s.dataSourceOptions.concept);return l.subscribe(u=>{s.cachedOptions=u}),l};return s.resolveSelectedValue=a=>this.resolveConcept(a),s.searchOptions=i,s.changeConcept=a=>{s.dataSourceOptions.concept=a,s.cachedOptions=[],e.next([]),i().subscribe(l=>{e.next(l)})},s}getMostRecentObsDataSource(e){const s=new Set;for(const i of e.pages)for(const r of i.sections)this.extractMostRecentObsConceptIds(r.questions,s);return i=>this.fetchMostRecentObsValue(i,[...s])}extractMostRecentObsConceptIds(e,s){var i,r,o;for(const a of e){const l=null!==(r=null===(i=a.questionOptions)||void 0===i?void 0:i.useMostRecentValue)&&void 0!==r&&r;if("true"===l||"boolean"==typeof l&&l){if("string"==typeof a.concept){s.add(a.concept);continue}if("string"==typeof(null===(o=a.questionOptions)||void 0===o?void 0:o.concept)){s.add(a.questionOptions.concept);continue}Array.isArray(a.questions)&&this.extractMostRecentObsConceptIds(a.questions,s)}}}findProvider(e){return this.providerResourceService.searchProvider(e).pipe((0,O.U)(s=>s.filter(i=>!!i.person).map(this.mapProvider)),(0,Cl.b)(s=>this.setCachedProviderSearchResults(s)))}getProviderByUuid(e){return this.providerResourceService.getProviderByUuid(e).pipe((0,O.U)(this.mapProvider))}mapProvider(e){return e&&{label:e.display,value:e.uuid,providerUuid:e.uuid}}findLocation(e){return this.locationResourceService.searchLocation(e).pipe((0,O.U)(s=>s.map(this.mapLocation)),(0,H.q)(10))}fetchMostRecentObsValue(e,s){if(!e)throw new Error("patient must be provided in call to fetchMostRecentObsValue");if(!s)throw new Error("at least one concept must be provided in call to fetchMostRecentObsValue");if("string"==typeof s&&(s=[s]),!Array.isArray(s))throw new Error(`concepts must be supplied to fetchMostRecentObsValue as either a string or array or strings. Instead, we got ${JSON.stringify(s)}`);const i=new URLSearchParams({patient:e,code:s.join(","),max:"1",_summary:"data"});return(0,k.openmrsFetch)(`${k.fhirBaseUrl}/Observation/$lastn?${i.toString()}`).then(r=>{var o;return r.ok?null===(o=r.data.entry)||void 0===o?void 0:o.reduce((a,l)=>{var u,h,d,f,_,p;if(l.resource&&"Observation"===l.resource.resourceType&&l.resource.code){const g=null===(u=l.resource.code.coding.find(b=>!Boolean(b.system)))||void 0===u?void 0:u.code;let v;if(null!=l.resource.valueString)v=l.resource.valueString;else if(void 0!==(null===(h=l.resource.valueQuantity)||void 0===h?void 0:h.value)&&null!==(null===(d=l.resource.valueQuantity)||void 0===d?void 0:d.value))v=l.resource.valueQuantity.value;else{const b=null===(p=null===(_=null===(f=l.resource.valueCodeableConcept)||void 0===f?void 0:f.coding)||void 0===_?void 0:_.find(T=>!Boolean(T.system)))||void 0===p?void 0:p.code;null!=b&&(v={uuid:b})}null!=g&&void 0!==v&&a.obs.push({concept:{uuid:g,display:null,conceptClass:null},value:v})}return a},{obs:[]}):{obs:[]}})}getLocationByUuid(e){return this.locationResourceService.getLocationByUuid(e).pipe((0,O.U)(this.mapLocation))}mapLocation(e){return e&&{label:e.display,value:e.uuid}}resolveConcept(e){return this.conceptResourceService.getConceptByUuid(e).pipe((0,O.U)(this.mapConcept))}getConceptAnswers(e){return this.conceptResourceService.getConceptByUuid(e).pipe((0,O.U)(s=>s.answers.map(this.mapConcept)))}getConceptSetMembers(e){return this.conceptResourceService.getConceptByUuid(e).pipe((0,O.U)(s=>s.setMembers.map(this.mapConcept).sort((i,r)=>i.label>r.label?1:0)))}findDrug(e){return this.conceptResourceService.searchConcept(e).pipe((0,O.U)(i=>i.filter(r=>r.conceptClass&&"8d490dfc-c2cc-11de-8d13-0010c6dffd0f"===r.conceptClass.uuid).map(this.mapConcept)))}findProblem(e){const s=["8d4918b0-c2cc-11de-8d13-0010c6dffd0f","8d492b2a-c2cc-11de-8d13-0010c6dffd0f","8d492954-c2cc-11de-8d13-0010c6dffd0f","8d491a9a-c2cc-11de-8d13-0010c6dffd0f"];return this.conceptResourceService.searchConcept(e).pipe((0,O.U)(i=>i.filter(r=>r.conceptClass&&s.includes(r.conceptClass.uuid)).map(this.mapConcept)))}findDiagnoses(e){const s=["8d4918b0-c2cc-11de-8d13-0010c6dffd0f"];return this.conceptResourceService.searchConcept(e).pipe((0,O.U)(i=>i.filter(r=>r.conceptClass&&s.includes(r.conceptClass.uuid)).map(this.mapConcept)))}mapConcept(e){return e&&{value:e.uuid,label:e.name.display}}getCachedProviderSearchResults(){return this.localStorageService.getObject("cachedproviders")}setCachedProviderSearchResults(e){this.localStorageService.setObject("cachedproviders",e)}getGender(e){switch(e){case"male":return"M";case"female":return"F";case"other":return"O";default:return"U"}}getPatientObject(e){const s={};return s.sex=this.getGender(null==e?void 0:e.gender),s.birthdate=new Date(null==e?void 0:e.birthDate),s.age=this.calculateAge(null==e?void 0:e.birthDate),"female"===(null==e?void 0:e.gender)&&(s.gendercreatconstant=.85),"male"===(null==e?void 0:e.gender)&&(s.gendercreatconstant=1),s}calculateAge(e){const s=Date.now()-new Date(e).getTime(),i=new Date(s);return Math.abs(i.getUTCFullYear()-1970)}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(Ys),c.LFG(Hs),c.LFG(Js),c.LFG(Xs.n))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),ht=(()=>{class n{constructor(){this.lastProps=void 0,this.lastPropsSubscription=Ht.subscribe(e=>this.lastProps=e)}ngOnDestroy(){var e;null===(e=this.lastPropsSubscription)||void 0===e||e.unsubscribe()}getPropOrThrow(e){const s=this.getProp(e);if(void 0===s){const i=new Error(`The module is missing the required Single SPA property "${e}". This is a development error likely caused by another microfrontend module. See the associated console log for details.`);throw console.error(i,this.lastProps),i}return s}getProp(e,s){var i,r;return null!==(r=null===(i=this.lastProps)||void 0===i?void 0:i[e])&&void 0!==r?r:s}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),ei=(()=>{class n{constructor(e,s){this.http=e,this.windowRef=s,this.v="full"}getUrl(){return this.windowRef.openmrsRestBase+"visit"}getVisitStartStopTime(e,s=null){let i=this.getUrl();i+="/"+e+"?v=custom:(uuid,startDatetime,stopDatetime)&includeInactive=false";const r=(new F.LE).set("v",s&&s.length>0?s:this.v);return this.http.get(i,{params:r})}updateVisit(e,s){if(!s)return null;let i=this.getUrl();i+="/"+e;const r=new F.WM({"Content-Type":"application/json"});return this.http.post(i,JSON.stringify(s),{headers:r})}updateVisitDates(e,s,i){if(!s&&!i)return null;let r=this.getUrl();r+="/"+e;const o=new F.WM({"Content-Type":"application/json"});return this.http.post(r,JSON.stringify({uuid:e,startDatetime:s,stopDatetime:i}),{headers:o})}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),ti=(()=>{class n{constructor(e,s,i,r,o,a,l){this.encounterAdapter=e,this.personAttributeAdapter=s,this.encounterResourceService=i,this.personResourceService=r,this.formDataSourceService=o,this.singleSpaPropsService=a,this.visitResourceService=l}submitPayload(e){const s=this.singleSpaPropsService.getProp("isOffline",!1),i=this.singleSpaPropsService.getProp("encounterUuid");return(0,C.from)(function(n){return(0,B.mG)(this,void 0,void 0,function*(){return(yield(0,k.getFullSynchronizationItems)(Xt)).find(e=>e.content._id===n)})}(i)).pipe((0,et.zg)(o=>{const a=s||!!o;a&&this.deepClearInitialNodeValues(e.rootNode);const l=this.onEncounterCreate(this.buildEncounterPayload(e)),u=this.buildPersonUpdatePayload(e);return a?this.submitPayloadOffline(e,l,u,null==o?void 0:o.content._id):this.submitPayloadOnline(l,u)}))}deepClearInitialNodeValues(e){if(e.initialValue=void 0,e.children&&"object"==typeof e.children)for(const s of Object.values(e.children))this.deepClearInitialNodeValues(s)}onEncounterCreate(e){const s=this.singleSpaPropsService.getProp("handleEncounterCreate");return s&&"function"==typeof s&&s(e),e}submitPayloadOffline(e,s,i,r){const o=Sl(function(n){return fl(n,5)}(s)),a={encounter:o},l={_id:null!=r?r:wl(),formSchemaUuid:e.schema.uuid,encounter:o,_payloads:{encounterCreate:s,personUpdate:i}};return(0,C.from)(function(n){var t,e;return(0,B.mG)(this,void 0,void 0,function*(){yield(0,k.queueSynchronizationItem)(Xt,n,{id:n._id,displayName:"Patient form",patientUuid:null===(t=n._payloads.encounterCreate)||void 0===t?void 0:t.patient,dependencies:[{type:"visit",id:null===(e=n._payloads.encounterCreate)||void 0===e?void 0:e.visit}]})})}(l).then(()=>a))}submitPayloadOnline(e,s){return(0,C.forkJoin)({encounter:this.submitEncounter(e),person:this.submitPersonUpdate(s)})}updateOrSaveEncounter(e){return e.uuid?this.encounterResourceService.updateEncounter(e.uuid,e).pipe((0,de.K)(s=>this.throwUserFriendlyError(s))):this.encounterResourceService.saveEncounter(e).pipe((0,de.K)(s=>this.throwUserFriendlyError(s)))}confirmVisitDateAdjustment(){return confirm("The encounter date falls outside the designated visit date range. Would you like to modify the visit date to accommodate the new encounter date?")}submitEncounter(e){if(!e)return(0,C.of)(void 0);const s=this.singleSpaPropsService.getPropOrThrow("visitUuid"),i=this.singleSpaPropsService.getProp("visitStartDatetime"),r=this.singleSpaPropsService.getProp("visitStopDatetime");if(e.uuid){if(i&&new Date(e.encounterDatetime)<new Date(i)&&this.confirmVisitDateAdjustment())return this.visitResourceService.updateVisitDates(s,e.encounterDatetime,r).pipe((0,Es.w)(()=>this.updateOrSaveEncounter(e)));if(r&&new Date(e.encounterDatetime)>new Date(r)&&this.confirmVisitDateAdjustment())return this.visitResourceService.updateVisitDates(s,i,e.encounterDatetime).pipe((0,Es.w)(()=>this.updateOrSaveEncounter(e)))}return this.updateOrSaveEncounter(e)}submitPersonUpdate(e){return e?this.personResourceService.saveUpdatePerson(e.uuid,e).pipe((0,de.K)(s=>this.throwUserFriendlyError(s))):(0,C.of)(void 0)}buildEncounterPayload(e){var s,i;const r=this.formDataSourceService.getCachedProviderSearchResults();if((null==r?void 0:r.length)&&!e.valueProcessingInfo.providerUuid){const a=this.findProviderUuidFormForm(r,e);e.valueProcessingInfo.providerUuid=a}const o=this.encounterAdapter.generateFormPayload(e);return!o.hasOwnProperty("location")&&(null===(i=null===(s=e.dataSourcesContainer.dataSources)||void 0===s?void 0:s.userLocation)||void 0===i?void 0:i.uuid)&&(o.location=e.dataSourcesContainer.dataSources.userLocation.uuid),Rs(o)?void 0:o}findProviderUuidFormForm(e,s){var i,r;const a=null===(i=s.searchNodeByQuestionId("provider")[0])||void 0===i?void 0:i.control.value,l=null===(r=e.find(u=>u.id===a))||void 0===r?void 0:r.providerUuid;return null!=l?l:a}buildPersonUpdatePayload(e){if(!e.valueProcessingInfo.personUuid)throw new Error("The form is missing a required value for submitting person updates: form.valueProcessingInfo.personUuid");const s=this.personAttributeAdapter.generateFormPayload(e);if(!Rs(s))return{uuid:e.valueProcessingInfo.personUuid,attributes:s}}throwUserFriendlyError(e){var s,i,r;if("object"==typeof e){const a=Object.values(null!==(r=null===(i=null===(s=e.error)||void 0===s?void 0:s.error)||void 0===i?void 0:i.fieldErrors)&&void 0!==r?r:{}).flatMap(u=>u).map(u=>u.message),l=a.length>0?a.join(" "):e.message;throw new Error(l)}throw"string"==typeof e?new Error(e):new Error(`An unknown error occured: ${e}.`)}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(pe.uN),c.LFG(pe.Cr),c.LFG(Fe),c.LFG(fn),c.LFG(pn),c.LFG(ht),c.LFG(ei))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var mn=m(2654);function dt(n){var t=-1,e=null==n?0:n.length;for(this.__data__=new mn.Z;++t<e;)this.add(n[t])}dt.prototype.add=dt.prototype.push=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this},dt.prototype.has=function(n){return this.__data__.has(n)};const Rl=dt,Il=function(n,t){for(var e=-1,s=null==n?0:n.length;++e<s;)if(t(n[e],e,n))return!0;return!1},Bl=function(n,t){return n.has(t)},ni=function(n,t,e,s,i,r){var o=1&e,a=n.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var u=r.get(n),h=r.get(t);if(u&&h)return u==t&&h==n;var d=-1,f=!0,_=2&e?new Rl:void 0;for(r.set(n,t),r.set(t,n);++d<a;){var p=n[d],g=t[d];if(s)var v=o?s(g,p,d,t,n,r):s(p,g,d,n,t,r);if(void 0!==v){if(v)continue;f=!1;break}if(_){if(!Il(t,function(b,T){if(!Bl(_,T)&&(p===b||i(p,b,e,s,r)))return _.push(T)})){f=!1;break}}else if(p!==g&&!i(p,g,e,s,r)){f=!1;break}}return r.delete(n),r.delete(t),f};var si=m(9822),xl=m(5326);const $l=function(n){var t=-1,e=Array(n.size);return n.forEach(function(s,i){e[++t]=[i,s]}),e},zl=function(n){var t=-1,e=Array(n.size);return n.forEach(function(s){e[++t]=s}),e};var ii=rt.Z?rt.Z.prototype:void 0,gn=ii?ii.valueOf:void 0;var cc=Object.prototype.hasOwnProperty;var ri="[object Arguments]",oi="[object Array]",ft="[object Object]",ai=Object.prototype.hasOwnProperty;const mc=function(n,t,e,s,i,r){var o=(0,J.Z)(n),a=(0,J.Z)(t),l=o?oi:Te(n),u=a?oi:Te(t),h=(l=l==ri?ft:l)==ft,d=(u=u==ri?ft:u)==ft,f=l==u;if(f&&(0,st.Z)(n)){if(!(0,st.Z)(t))return!1;o=!0,h=!1}if(f&&!h)return r||(r=new Ne.Z),o||(0,Ds.Z)(n)?ni(n,t,e,s,i,r):function(n,t,e,s,i,r,o){switch(e){case"[object DataView]":if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=t.byteLength||!r(new si.Z(n),new si.Z(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return(0,xl.Z)(+n,+t);case"[object Error]":return n.name==t.name&&n.message==t.message;case"[object RegExp]":case"[object String]":return n==t+"";case"[object Map]":var a=$l;case"[object Set]":if(a||(a=zl),n.size!=t.size&&!(1&s))return!1;var u=o.get(n);if(u)return u==t;s|=2,o.set(n,t);var h=ni(a(n),a(t),s,i,r,o);return o.delete(n),h;case"[object Symbol]":if(gn)return gn.call(n)==gn.call(t)}return!1}(n,t,l,e,s,i,r);if(!(1&e)){var _=h&&ai.call(n,"__wrapped__"),p=d&&ai.call(t,"__wrapped__");if(_||p){var g=_?n.value():n,v=p?t.value():t;return r||(r=new Ne.Z),i(g,v,e,s,r)}}return!!f&&(r||(r=new Ne.Z),function(n,t,e,s,i,r){var o=1&e,a=cn(n),l=a.length;if(l!=cn(t).length&&!o)return!1;for(var d=l;d--;){var f=a[d];if(!(o?f in t:cc.call(t,f)))return!1}var _=r.get(n),p=r.get(t);if(_&&p)return _==t&&p==n;var g=!0;r.set(n,t),r.set(t,n);for(var v=o;++d<l;){var b=n[f=a[d]],T=t[f];if(s)var R=o?s(T,b,f,t,n,r):s(b,T,f,n,t,r);if(!(void 0===R?b===T||i(b,T,e,s,r):R)){g=!1;break}v||(v="constructor"==f)}if(g&&!v){var N=n.constructor,z=t.constructor;N!=z&&"constructor"in n&&"constructor"in t&&!("function"==typeof N&&N instanceof N&&"function"==typeof z&&z instanceof z)&&(g=!1)}return r.delete(n),r.delete(t),g}(n,t,e,s,i,r))},ci=function li(n,t,e,s,i){return n===t||(null==n||null==t||!(0,ot.Z)(n)&&!(0,ot.Z)(t)?n!=n&&t!=t:mc(n,t,e,s,li,i))},ui=function(n){return n==n&&!(0,lt.Z)(n)},hi=function(n,t){return function(e){return null!=e&&e[n]===t&&(void 0!==t||n in Object(e))}},Ac=function(n){var t=function(n){for(var t=Me(n),e=t.length;e--;){var s=t[e],i=n[s];t[e]=[s,i,ui(i)]}return t}(n);return 1==t.length&&t[0][2]?hi(t[0][0],t[0][1]):function(e){return e===n||function(n,t,e,s){var i=e.length,r=i,o=!s;if(null==n)return!r;for(n=Object(n);i--;){var a=e[i];if(o&&a[2]?a[1]!==n[a[0]]:!(a[0]in n))return!1}for(;++i<r;){var l=(a=e[i])[0],u=n[l],h=a[1];if(o&&a[2]){if(void 0===u&&!(l in n))return!1}else{var d=new Ne.Z;if(s)var f=s(u,h,l,n,t,d);if(!(void 0===f?ci(h,u,3,s,d):f))return!1}}return!0}(e,n,t)}};var yn=m(1742),wc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cc=/^\w*$/;const vn=function(n,t){if((0,J.Z)(n))return!1;var e=typeof n;return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=n&&!(0,yn.Z)(n))||Cc.test(n)||!wc.test(n)||null!=t&&n in Object(t)};function _n(n,t){if("function"!=typeof n||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var e=function(){var s=arguments,i=t?t.apply(this,s):s[0],r=e.cache;if(r.has(i))return r.get(i);var o=n.apply(this,s);return e.cache=r.set(i,o)||r,o};return e.cache=new(_n.Cache||mn.Z),e}_n.Cache=mn.Z;var Lc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ic=/\\(\\)?/g;const Bc=(t=_n(function(n){var t=[];return 46===n.charCodeAt(0)&&t.push(""),n.replace(Lc,function(e,s,i,r){t.push(i?r.replace(Ic,"$1"):s||e)}),t},function(s){return 500===e.size&&e.clear(),s}),e=t.cache,t);var t,e,Zc=m(9665);const di=function(n,t){return(0,J.Z)(n)?n:vn(n,t)?[n]:Bc((0,Zc.Z)(n))},pt=function(n){if("string"==typeof n||(0,yn.Z)(n))return n;var t=n+"";return"0"==t&&1/n==-1/0?"-0":t},fi=function(n,t){for(var e=0,s=(t=di(t,n)).length;null!=n&&e<s;)n=n[pt(t[e++])];return e&&e==s?n:void 0},qc=function(n,t){return null!=n&&t in Object(n)};var Vc=m(2683),Qc=m(6509);const Jc=function(n,t){return null!=n&&function(n,t,e){for(var s=-1,i=(t=di(t,n)).length,r=!1;++s<i;){var o=pt(t[s]);if(!(r=null!=n&&e(n,o)))break;n=n[o]}return r||++s!=i?r:!!(i=null==n?0:n.length)&&(0,Qc.Z)(i)&&(0,Vc.Z)(o,i)&&((0,J.Z)(n)||(0,Ms.Z)(n))}(n,t,qc)},nu=function(n,t){return vn(n)&&ui(t)?hi(pt(n),t):function(e){var s=function(n,t,e){var s=null==n?void 0:fi(n,t);return void 0===s?e:s}(e,n);return void 0===s&&s===t?Jc(e,n):ci(t,s,3)}};var su=m(6168);const cu=function(n){return vn(n)?function(n){return function(t){return null==t?void 0:t[n]}}(pt(n)):function(n){return function(t){return fi(t,n)}}(n)},pi=function(n){return"function"==typeof n?n:null==n?su.Z:"object"==typeof n?(0,J.Z)(n)?nu(n[0],n[1]):Ac(n):cu(n)};var mu=/\s/;var vu=/^\s+/;const Su=function(n){return n&&n.slice(0,function(n){for(var t=n.length;t--&&mu.test(n.charAt(t)););return t}(n)+1).replace(vu,"")};var bu=/^[-+]0x[0-9a-f]+$/i,Eu=/^0b[01]+$/i,Pu=/^0o[0-7]+$/i,Tu=parseInt;const Fu=function(n){return n?1/0===(n=function(n){if("number"==typeof n)return n;if((0,yn.Z)(n))return NaN;if((0,lt.Z)(n)){var t="function"==typeof n.valueOf?n.valueOf():n;n=(0,lt.Z)(t)?t+"":t}if("string"!=typeof n)return 0===n?n:+n;n=Su(n);var e=Eu.test(n);return e||Pu.test(n)?Tu(n.slice(2),e?2:8):bu.test(n)?NaN:+n}(n))||-1/0===n?17976931348623157e292*(n<0?-1:1):n==n?n:0:0===n?n:0};var Du=Math.max;const Iu=function(t,e,s){var i=Object(t);if(!(0,on.Z)(t)){var r=pi(e);t=Me(t),e=function(a){return r(i[a],a,i)}}var o=function(n,t,e){var s=null==n?0:n.length;if(!s)return-1;var i=null==e?0:function(n){var t=Fu(n),e=t%1;return t==t?e?t-e:t:0}(e);return i<0&&(i=Du(s+i,0)),function(n,t,e,s){for(var i=n.length,r=e+(s?1:-1);s?r--:++r<i;)if(t(n[r],r,n))return r;return-1}(n,pi(t),i)}(t,e,s);return o>-1?i[r?t[o]:o]:void 0};let yi=(()=>{class n{constructor(e){this.encounterResource=e}getPreviousEncounter(e,s){return new Promise((i,r)=>{this.encounterResource.getEncountersByPatientUuid(s).subscribe(o=>{if(o){const a=o.sort((u,h)=>new Date(h.encounterDatetime).getTime()-new Date(u.encounterDatetime).getTime()),l=Iu(a,u=>u.encounterType.uuid===e);l?this.encounterResource.getEncounterByUuid(l.uuid).pipe((0,H.q)(1)).subscribe(u=>{i(u)},u=>{r(u)}):i(Object.create({}))}},o=>{console.error("Previous encounter",o)})})}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(Fe))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var Uu=m(7953),vi=m(6415);let Sn=(()=>{class n{getConfig(){var e;let s=null===(e=(0,k.getConfigStore)("@openmrs/esm-form-entry-app").getState())||void 0===e?void 0:e.config;return(0,k.getConfigStore)("@openmrs/esm-form-entry-app").subscribe(i=>{i.loaded&&i&&(s=i.config)}),s}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),_i=(()=>{class n{constructor(e,s,i){this.http=e,this.windowRef=s,this.configResource=i}getMonthlySchedule(e){const s=`${this.configResource.getConfig().appointmentsResourceUrl}?startDate=${e.startDate}&endDate=${e.endDate}&locationUuids=${e.locationUuids}&limit=${e.limit}&programType=${e.programType}&groupBy=groupByPerson,groupByAttendedDate,groupByRtcDate`;return this.http.get(`${this.windowRef.nativeWindow.openmrsBase}${s}`)}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X),c.LFG(Sn))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();const X={};let Si=(()=>{class n{constructor(e,s,i,r,o,a,l){this.formFactory=e,this.dataSources=s,this.formDataSourceService=i,this.monthlyScheduleResourceService=r,this.encounterAdapter=o,this.configResourceService=a,this.singleSpaPropsService=l}initAndCreateForm(e){return(0,B.mG)(this,void 0,void 0,function*(){const{formSchema:s,encounter:i}=e;yield this.wireDataSources(e,s);const r=this.formFactory.createForm(s,this.dataSources.dataSources);if(this.setUpWHOCascading(r),i){const o=i.uuid;this.populateEncounterForEditing(r,e),r.valueProcessingInfo.encounterUuid=o}else{const o=this.singleSpaPropsService.getPropOrThrow("patientUuid");this.setDefaultValues(r,e),r.valueProcessingInfo.patientUuid=o}return this.setUpPayloadProcessingInformation(r,e),r})}wireDataSources(e,s){return(0,B.mG)(this,void 0,void 0,function*(){const i=this.singleSpaPropsService.getPropOrThrow("visitTypeUuid"),r=this.singleSpaPropsService.getPropOrThrow("patient");for(const h of Object.keys(this.dataSources.dataSources))this.dataSources.clearDataSource(h);const o=this.formDataSourceService.getDataSources(s);this.dataSources.registerDataSource("location",o.location),this.dataSources.registerDataSource("provider",o.provider),this.dataSources.registerDataSource("drug",o.drug),this.dataSources.registerDataSource("problem",o.problem),this.dataSources.registerDataSource("personAttribute",o.location),this.dataSources.registerDataSource("conceptAnswers",o.conceptAnswers),this.dataSources.registerDataSource("diagnoses",o.diagnoses),this.dataSources.registerDataSource("patient",{visitTypeUuid:i},!0);const a=this.formDataSourceService.getPatientObject(r);this.dataSources.registerDataSource("patient",a,!0),this.dataSources.registerDataSource("rawPrevEnc",e.previousEncounter,!1);const l=yield o.recentObs(r.id);this.dataSources.registerDataSource("rawPrevObs",l,!1),this.dataSources.registerDataSource("userLocation",e.session.sessionLocation);const u=this.configResourceService.getConfig();return u.dataSources.monthlySchedule&&this.dataSources.registerDataSource("monthlyScheduleResourceService",this.monthlyScheduleResourceService),Promise.all([u.customDataSources.map(({name:h,moduleName:d,moduleExport:f})=>(0,B.mG)(this,void 0,void 0,function*(){let _=!1;if(X.hasOwnProperty(h)){if(X[h])return this.dataSources.registerDataSource(h,X[h]),Promise.resolve();_=!0}if(""===d)return _||console.warn(`A custom data source ${h} has a blank module name. A module name must be provided to register a data source correctly.`),X[h]=void 0,Promise.resolve();const p=function(n){return n.replace(/[\/\-@]/g,"_")}(d);if(!window.hasOwnProperty(p))return _||console.error(`esm-form-entry-app is configured to use the datasource ${h}, but the corresponding module ${d} has not been loaded. Most likely, this means that ${d} is not in your importmap or was not loaded prior to ending up here.`),X[h]=void 0,Promise.resolve();{const g=window[p];if(!("object"==typeof g&&g.hasOwnProperty("init")&&(0,vi.Z)(g.init)&&g.hasOwnProperty("get")&&(0,vi.Z)(g.get)))return _||console.error(`esm-form-app is configured to use the datasource ${h} from the module ${d}, but the version of ${d} loaded is not in the expected format. Please ensure that the version of ${d} you are loading is built as a Webpack module.`),X[h]=void 0,Promise.resolve();try{const b=(yield g.get("./start"))();return"object"==typeof b&&b.hasOwnProperty(f)?(X[h]=b[f],this.dataSources.registerDataSource(h,b[f]),Promise.resolve()):(_||console.error(`esm-form-entry-app could not load the module ${d} for the datasource ${h} because the module did not have the expected ${"default"==f?"default export":`export ${f}`}.`),X[h]=void 0,Promise.resolve())}catch(v){return _||console.error(`esm-form-entry-app could not load the datasource ${h} because ${d} did not export the expected entry "./start". Please check the Webpack configuration for ${d}.`,v),X[h]=void 0,Promise.resolve()}}}))])})}setUpWHOCascading(e){try{let s=e.searchNodeByQuestionId("adultWhoStage");0===s.length&&(s=e.searchNodeByQuestionId("pedWhoStage"));const i=s[0];null==i||i.control.valueChanges.subscribe(r=>{var o;if(r){const a=e.dataSourcesContainer.dataSources.conceptAnswers;null===(o=a.changeConcept)||void 0===o||o.call(a,r)}})}catch(s){console.error(`Error setting up WHO Staging Cascading. Error: ${JSON.stringify(s)}.`)}}setDefaultValues(e,s){const{session:i}=s,r=Uu().format(),o=e.searchNodeByQuestionId("encDate");o.length>0&&o[0].control.setValue(r);const a=e.searchNodeByQuestionId("location","encounterLocation");a.length>0&&(null==i?void 0:i.sessionLocation)&&a[0].control.setValue(i.sessionLocation.uuid);const l=e.searchNodeByQuestionId("provider","encounterProvider");l.length>0&&(null==i?void 0:i.currentProvider)&&l[0].control.setValue(i.currentProvider.uuid)}setUpPayloadProcessingInformation(e,s){var i;const{session:r,formSchema:o,encounter:a}=s,l=this.singleSpaPropsService.getPropOrThrow("patientUuid"),u=this.singleSpaPropsService.getPropOrThrow("visitUuid");try{if(r){if(e.valueProcessingInfo.personUuid=l,e.valueProcessingInfo.patientUuid=l,e.valueProcessingInfo.formUuid=o.uuid,e.valueProcessingInfo.providerUuid=null===(i=r.currentProvider)||void 0===i?void 0:i.uuid,!o.encounterType)throw new Error("Please associate the form with an encounter type.");e.valueProcessingInfo.encounterTypeUuid=o.encounterType.uuid,a&&(e.valueProcessingInfo.encounterUuid=a.uuid),a||(e.valueProcessingInfo.visitUuid=u)}}catch(h){console.error(h)}}populateEncounterForEditing(e,s){const{encounter:i}=s;i&&this.encounterAdapter.populateForm(e,i)}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(pe.b8),c.LFG(pe.NA),c.LFG(pn),c.LFG(_i),c.LFG(pe.uN),c.LFG(Sn),c.LFG(ht))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})();var bi=m(1422),mt=m(9984),gt=m(9599);let Zu=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=c.Xpm({type:n,selectors:[["loader"]],inputs:{loadingMessage:"loadingMessage"},decls:12,vars:1,consts:[["aria-live","assertive",1,"cds--inline-loading",2,"width","fit-content"],[1,"cds--inline-loading__animation"],["aria-atomic","true","aria-labelledby","loading-id-5","aria-live","assertive",1,"cds--loading","cds--loading--small"],["id","loading-id-5",1,"cds--visually-hidden"],["viewBox","0 0 100 100",1,"cds--loading__svg"],["cx","50%","cy","50%","r","44",1,"cds--loading__background"],["cx","50%","cy","50%","r","44",1,"cds--loading__stroke"],[1,"cds--inline-loading__text"]],template:function(e,s){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"label",3),c._uU(4," Active loading indicator "),c.qZA(),c.O4$(),c.TgZ(5,"svg",4),c.TgZ(6,"title"),c._uU(7,"Active loading indicator"),c.qZA(),c._UZ(8,"circle",5),c._UZ(9,"circle",6),c.qZA(),c.qZA(),c.qZA(),c.kcU(),c.TgZ(10,"div",7),c._uU(11),c.qZA(),c.qZA()),2&e&&(c.xp6(11),c.Oqu(s.loadingMessage))},encapsulation:2}),n})();function ju(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"div",2),c.TgZ(1,"div",3),c.TgZ(2,"h4",4),c._uU(3,"There was an error with this form"),c.qZA(),c.TgZ(4,"p",5),c._uU(5," Try opening another form "),c.qZA(),c.TgZ(6,"p",6),c._uU(7,"or"),c.qZA(),c.TgZ(8,"button",7),c.NdJ("click",function(){return c.CHM(e),c.oxw().closeForm()}),c._uU(9," Close this panel "),c.qZA(),c.qZA(),c.qZA()}}function ku(n,t){if(1&n&&(c.TgZ(0,"form",13),c._UZ(1,"ofe-form-renderer",14),c.qZA()),2&n){const e=c.oxw(3);c.Q6J("formGroup",e.form.rootNode.control),c.xp6(1),c.Q6J("labelMap",e.labelMap)("node",e.form.rootNode)}}function xu(n,t){1&n&&(c.TgZ(0,"span"),c._uU(1,"Save and close"),c.qZA())}function Ku(n,t){1&n&&c._UZ(0,"loader",20)}function $u(n,t){if(1&n){const e=c.EpF();c.TgZ(0,"div",15),c.TgZ(1,"button",16),c.NdJ("click",function(){return c.CHM(e),c.oxw(3).closeForm()}),c._uU(2,"Discard"),c.qZA(),c.TgZ(3,"button",17),c.NdJ("click",function(){return c.CHM(e),c.oxw(3).onSubmit()}),c.YNc(4,xu,2,0,"span",18),c.YNc(5,Ku,1,0,"loader",19),c.qZA(),c.qZA()}if(2&n){const e=c.oxw(3);c.xp6(3),c.Q6J("disabled","submitting"===e.formState),c.xp6(1),c.Q6J("ngIf","submitting"!==e.formState),c.xp6(1),c.Q6J("ngIf","submitting"===e.formState)}}function Gu(n,t){if(1&n&&(c.TgZ(0,"div",2),c.TgZ(1,"div"),c.YNc(2,ku,2,3,"form",11),c.qZA(),c.YNc(3,$u,6,3,"div",12),c.qZA()),2&n){const e=c.oxw(2);c.xp6(2),c.Q6J("ngIf",e.form),c.xp6(1),c.Q6J("ngIf",e.showDiscardSubmitButtons)}}function zu(n,t){1&n&&(c.TgZ(0,"div",21),c._UZ(1,"loader",22),c.qZA())}const qu=function(n){return{error:n}};function Vu(n,t){if(1&n&&(c.TgZ(0,"div",8),c.TgZ(1,"div",9),c.YNc(2,Gu,4,2,"div",0),c.qZA(),c.YNc(3,zu,2,0,"div",10),c.qZA()),2&n){const e=c.oxw();c.Q6J("ngClass",c.VKq(3,qu,"readyWithValidationErrors"===e.formState)),c.xp6(2),c.Q6J("ngIf","ready"===e.formState||"readyWithValidationErrors"===e.formState||"submitting"===e.formState||"submissionError"===e.formState),c.xp6(1),c.Q6J("ngIf","loading"===e.formState)}}const Ei=(0,k.createGlobalStore)("ampath-form-state",{});let Qu=(()=>{class n{constructor(e,s,i,r,o,a,l,u,h,d){this.openmrsApi=e,this.formSchemaService=s,this.encounterResourceService=i,this.formSubmissionService=r,this.patientPreviousEncounter=o,this.formCreationService=a,this.singleSpaPropsService=l,this.conceptService=u,this.translateService=h,this.ngZone=d,this.labelMap={},this.formState="initial",this.showDiscardSubmitButtons=!0,this.language=window.i18next.language.substring(0,2).toLowerCase()}ngOnInit(){this.unsubscribeStore=Ei.subscribe(e=>{this.formState=e[this.formUuid]}),this.changeState("initial"),this.launchForm()}ngOnDestroy(){var e;this.unsubscribeStore&&this.unsubscribeStore(),null===(e=this.launchFormSubscription)||void 0===e||e.unsubscribe()}launchForm(){var e,s;this.changeState("loading"),this.showDiscardSubmitButtons=null===(e=this.singleSpaPropsService.getProp("showDiscardSubmitButtons"))||void 0===e||e,null===(s=this.launchFormSubscription)||void 0===s||s.unsubscribe(),this.launchFormSubscription=this.loadAllFormDependencies().pipe((0,H.q)(1),(0,O.U)(i=>(0,C.from)(this.formCreationService.initAndCreateForm(i))),(0,Hr.u)(),(0,et.zg)(i=>(0,B.mG)(this,void 0,void 0,function*(){const r=Jt.f.getUnlabeledConceptIdentifiersFromSchema(i.schema);return{form:i,concepts:yield this.conceptService.searchConceptsByIdentifiers(r).toPromise()}}))).subscribe(({form:i,concepts:r})=>{this.form=i,r&&(this.labelMap=r.reduce((o,a)=>(Boolean(a)&&(o[a.identifier]=a.display),o),{})),this.changeState("ready")},i=>{this.loadingError="Error loading form",console.error("Error rendering form",i),this.changeState("loadingError")})}loadAllFormDependencies(){var e,s,i;this.formUuid=this.singleSpaPropsService.getPropOrThrow("formUuid");const r=this.singleSpaPropsService.getPropOrThrow("encounterUuid"),o=null!==(i=null===(s=null===(e=window.i18next)||void 0===e?void 0:e.language)||void 0===s?void 0:s.substring(0,2))&&void 0!==i?i:"";return this.translateService.addLangs([o]),this.translateService.use(o),(0,C.forkJoin)({formSchema:this.fetchCompiledFormSchema(this.formUuid,o).pipe((0,H.q)(1)),session:this.openmrsApi.getCurrentSession().pipe((0,H.q)(1)),encounter:r?this.getEncounterToEdit(r).pipe((0,H.q)(1)):(0,C.of)(null)}).pipe((0,et.zg)(a=>this.loadPatientPreviousEncounters(a.formSchema).pipe((0,O.U)(l=>Object.assign(Object.assign({},a),{previousEncounter:l})))),(0,de.K)(a=>(0,C.throwError)(new Error("There was an error fetching form data. Details: "+JSON.stringify(a)))))}fetchCompiledFormSchema(e,s){return this.formSchemaService.getFormSchemaByUuid(e,s).pipe((0,H.q)(1))}getEncounterToEdit(e){return this.singleSpaPropsService.getProp("isOffline",!1)?(0,C.from)(this.getOfflineEncounterToEdit(e)):this.encounterResourceService.getEncounterByUuid(e).pipe((0,de.K)(()=>(0,C.from)(this.getOfflineEncounterToEdit(e))))}getOfflineEncounterToEdit(e){return(0,B.mG)(this,void 0,void 0,function*(){return(yield(0,k.getSynchronizationItems)(Xt)).find(r=>r._id===e).encounter})}loadPatientPreviousEncounters(e){var s;const i=this.singleSpaPropsService.getProp("patientUuid");return this.singleSpaPropsService.getProp("isOffline",!1)?(0,C.of)(void 0):(0,C.from)(this.patientPreviousEncounter.getPreviousEncounter(null===(s=e.encounterType)||void 0===s?void 0:s.uuid,i))}onSubmit(){!this.validateForm()||(this.changeState("submitting"),this.formSubmissionService.submitPayload(this.form).subscribe(({encounter:e})=>{this.onPostResponse(e);const s=this.singleSpaPropsService.getProp("isOffline",!1);this.changeState("submitted"),!s&&(null==e?void 0:e.uuid)&&this.encounterResourceService.getEncounterByUuid(e.uuid).pipe((0,H.q)(1)).subscribe(i=>{if(Array.isArray(null==i?void 0:i.orders)){const r=i.orders.filter(({auditInfo:o})=>!o.dateVoided);this.showLabOrdersNotification(r)}}),(0,k.showToast)({critical:!0,kind:"success",description:"The form has been submitted successfully.",title:this.form.schema.name}),this.closeForm()},e=>{this.changeState("submissionError"),(0,k.showToast)({critical:!0,kind:"error",description:`An error has occurred while submitting the form. Error: ${JSON.stringify(null==e?void 0:e.message,null,2)}.`,title:this.form.schema.name})}))}validateForm(){return this.form.valid||(this.form.markInvalidControls(this.form.rootNode),this.form.showErrors=!0,this.changeState("readyWithValidationErrors")),this.onValidate(this.form.valid),this.form.valid}showLabOrdersNotification(e=[]){var s;const i=null!==(s=e.map((r,o)=>` ${o+1} : ${r.display} : ${r.orderNumber}`).join())&&void 0!==s?s:"";i.length&&(0,k.showNotification)({title:"Lab order(s) generated",kind:"success",critical:!0,description:i})}closeForm(){this.singleSpaPropsService.getPropOrThrow("closeWorkspace")()}onPostResponse(e){const s=this.singleSpaPropsService.getProp("handlePostResponse");s&&"function"==typeof s&&s(e)}onValidate(e){const s=this.singleSpaPropsService.getProp("handleOnValidate");s&&"function"==typeof s&&s(e)}onFormAction(e){this.ngZone.run(()=>{var s,i,r;const o=this.singleSpaPropsService.getPropOrThrow("formUuid"),a=this.singleSpaPropsService.getPropOrThrow("patientUuid");if((null===(s=e.detail)||void 0===s?void 0:s.formUuid)===o&&(null===(i=e.detail)||void 0===i?void 0:i.patientUuid)===a)switch(null===(r=e.detail)||void 0===r?void 0:r.action){case"onSubmit":this.onSubmit();break;case"validateForm":this.validateForm()}})}changeState(e){if(e!=this.formState){const s={};s[this.formUuid]=e,Ei.setState(s)}}}return n.\u0275fac=function(e){return new(e||n)(c.Y36(bs),c.Y36(Jt.f),c.Y36(Fe),c.Y36(ti),c.Y36(yi),c.Y36(Si),c.Y36(ht),c.Y36(bi.F),c.Y36(mt.sK),c.Y36(c.R0b))},n.\u0275cmp=c.Xpm({type:n,selectors:[["my-app-fe-wrapper"]],hostBindings:function(e,s){1&e&&c.NdJ("ampath-form-action",function(r){return s.onFormAction(r)},!1,c.Jf7)},decls:2,vars:2,consts:[["class","form-container",4,"ngIf"],[3,"ngClass",4,"ngIf"],[1,"form-container"],[1,"cds--tile","error-tile"],[1,"heading"],[1,"helperText"],[1,"separator"],[1,"cds--btn","cds--btn--sm","cds--btn--ghost",3,"click"],[3,"ngClass"],[1,"content"],["class","loader-container",4,"ngIf"],["class","cds--form no-padding",3,"formGroup",4,"ngIf"],["class","cds-btn--set button-set",4,"ngIf"],[1,"cds--form","no-padding",3,"formGroup"],[3,"labelMap","node"],[1,"cds-btn--set","button-set"],["type","button",1,"cds--btn","cds--btn--secondary",3,"click"],["type","submit",1,"cds--btn","cds--btn--primary",3,"disabled","click"],[4,"ngIf"],["loadingMessage","Submitting",4,"ngIf"],["loadingMessage","Submitting"],[1,"loader-container"],["loadingMessage","Loading...",1,"loader"]],template:function(e,s){1&e&&(c.YNc(0,ju,10,0,"div",0),c.YNc(1,Vu,4,5,"div",1)),2&e&&(c.Q6J("ngIf",s.loadingError),c.xp6(1),c.Q6J("ngIf","submitted"!==s.formState))},directives:[K.O5,K.mk,gt._Y,gt.JL,gt.sg,pe.YC,Zu],styles:['[_ngcontent-%COMP%]:root {\n  --brand-01: #005d5d;\n  --brand-02: #004144;\n  --brand-03: #007d79;\n}\n\n.error-tile[_ngcontent-%COMP%] {\n  width: 60%;\n  margin: 1.25rem auto;\n  display: flex;\n  flex-flow: column wrap;\n  align-items: center;\n  justify-content: center;\n  padding: 1.5rem 0 1.75rem;\n}\n\n.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .error-tile[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .error-tile[_ngcontent-%COMP%] {\n  background-color: #ffffff;\n}\n.heading[_ngcontent-%COMP%] {\n  font-size: var(--cds-productive-heading-02-font-size, 1rem);\n  font-weight: var(--cds-productive-heading-02-font-weight, 600);\n  line-height: var(--cds-productive-heading-02-line-height, 1.375);\n  letter-spacing: var(--cds-productive-heading-02-letter-spacing, 0);\n  color: #161616;\n}\n.helperText[_ngcontent-%COMP%] {\n  margin-top: 0.5rem;\n  font-size: var(--cds-body-01-font-size, 0.875rem);\n  font-weight: var(--cds-body-01-font-weight, 400);\n  line-height: var(--cds-body-01-line-height, 1.42857);\n  letter-spacing: var(--cds-body-01-letter-spacing, 0.16px);\n  color: #262626;\n}\n.separator[_ngcontent-%COMP%] {\n  font-size: var(--cds-body-01-font-size, 0.875rem);\n  font-weight: var(--cds-body-01-font-weight, 400);\n  line-height: var(--cds-body-01-line-height, 1.42857);\n  letter-spacing: var(--cds-body-01-letter-spacing, 0.16px);\n  color: #262626;\n  width: 12rem;\n  margin: 1.375rem auto;\n  overflow: hidden;\n  text-align: center;\n}\n.separator[_ngcontent-%COMP%]::before, .separator[_ngcontent-%COMP%]::after {\n  background-color: #a8a8a8;\n  content: "";\n  display: inline-block;\n  height: 1px;\n  position: relative;\n  vertical-align: middle;\n  width: 50%;\n}\n.separator[_ngcontent-%COMP%]::before {\n  right: 1rem;\n  margin-left: -50%;\n}\n.separator[_ngcontent-%COMP%]::after {\n  left: 1rem;\n  margin-right: -50%;\n}\n.title-icon-size[_ngcontent-%COMP%] {\n  height: 0.8rem;\n  width: 0.8rem;\n}\n.no-errors[_ngcontent-%COMP%] {\n  display: none;\n}\n.sidebar[_ngcontent-%COMP%]   .open[_ngcontent-%COMP%] {\n  margin-top: -1px;\n  width: 55%;\n  height: 80%;\n  padding: 4px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n}\n.sidebar[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%] {\n  height: 80px;\n  width: 28px;\n  margin-top: -1px;\n}\n.error-content[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%] {\n  display: none;\n}\n.error-content[_ngcontent-%COMP%] {\n  border-top: 1px solid #e0e0e0;\n  margin: -4px;\n  padding: 4px;\n}\n.error-title[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%] {\n  transform: rotate(90deg);\n  margin-top: 14px;\n}\n.no-padding[_ngcontent-%COMP%] {\n  margin-left: -2rem;\n  margin-right: -2rem;\n}\n.center[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  height: 100vh;\n}\n.form-container[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.button-set[_ngcontent-%COMP%] {\n  margin: 0 -2rem;\n}\n.button-set[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\n  height: 4rem;\n  align-items: baseline;\n  min-width: 50%;\n}\n\n.omrs-breakpoint-gt-tablet[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%], .omrs-breakpoint-gt-tablet   [_nghost-%COMP%]   .form-container[_ngcontent-%COMP%] {\n  height: calc(100vh - 6rem);\n  margin: 0 2rem;\n}\n.omrs-breakpoint-gt-tablet[_nghost-%COMP%]   .button-set[_ngcontent-%COMP%], .omrs-breakpoint-gt-tablet   [_nghost-%COMP%]   .button-set[_ngcontent-%COMP%] {\n  padding: 0rem;\n}\n\n.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .form-container[_ngcontent-%COMP%] {\n  height: calc(100vh - 6rem);\n  margin: 0 2rem;\n}\n.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .button-set[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .button-set[_ngcontent-%COMP%] {\n  padding: 1.5rem 1rem;\n  background-color: #ffffff;\n}\n.loader-container[_ngcontent-%COMP%] {\n  height: 100vh;\n}\n.loader[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 50%;\n}\n.encounterHeader[_ngcontent-%COMP%] {\n  font-family: "IBM Plex Sans", sans-serif;\n  font-size: 14px;\n  line-height: 22px;\n  font-weight: 600;\n  letter-spacing: 0.16px;\n  border-bottom: 1px solid var(--brand-03);\n  padding: 0.625rem;\n}']}),n})();function Wu(n,t){1&n&&c._UZ(0,"my-app-fe-wrapper")}let Yu=(()=>{class n{constructor(){this.title="ampath-esm-angular-form-entry"}ngOnInit(){this.sub=Ht.subscribe(e=>{this.view=e.view},e=>{})}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=c.Xpm({type:n,selectors:[["my-app-root"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,s){1&e&&c.YNc(0,Wu,1,0,"my-app-fe-wrapper",0),2&e&&c.Q6J("ngIf","form"===s.view)},directives:[K.O5,Qu],styles:[""]}),n})();var Hu=m(6086);let Pi=(()=>{class n{constructor(e,s){this.http=e,this.windowRef=s,this.v="custom:(uuid,display,identifiers:(identifier,uuid,preferred,location:(uuid,name),identifierType:(uuid,name,format,formatDescription,validator)),person:(uuid,display,gender,birthdate,dead,age,deathDate,birthdateEstimated,causeOfDeath,preferredName:(uuid,preferred,givenName,middleName,familyName),attributes:(uuid,display,value,attributeType,dateCreated,dateChanged),preferredAddress:(uuid,preferred,address1,address2,cityVillage,longitude,stateProvince,latitude,country,postalCode,countyDistrict,address3,address4,address5,address6,address7)))"}getUrl(){return this.windowRef.openmrsRestBase+"patient"}searchPatient(e,s=!1,i=null){const r=this.getUrl(),o=(new F.LE).set("q",e).set("includeDead","true").set("v",i&&i.length>0?i:this.v);return this.http.get(r,{params:o}).pipe((0,O.U)(a=>a.results))}getPatientByUuid(e,s=!1,i=null){let r=this.getUrl();r+="/"+e;const o=(new F.LE).set("v",i&&i.length>0?i:this.v);return this.http.get(r,{params:o})}saveUpdatePatientIdentifier(e,s,i){if(!i||!e)return null;const r=this.getUrl()+"/"+e+"/identifier/"+s,o=new F.WM({"Content-Type":"application/json"});return this.http.post(r,JSON.stringify(i),{headers:o}).pipe((0,O.U)(a=>a.patient))}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(F.eN),c.LFG(re.X))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Ju=(()=>{class n{constructor(e,s){this.patientResourceService=e,this.encounterResource=s,this.currentlyLoadedPatient=new C.BehaviorSubject(null),this.currentlyLoadedPatientUuid=new C.BehaviorSubject(null),this.isBusy=new C.BehaviorSubject(!1)}setCurrentlyLoadedPatientByUuid(e){return null!==this.currentlyLoadedPatient.value?this.currentlyLoadedPatient.value.uuid!==e&&this.fetchPatientByUuid(e):this.fetchPatientByUuid(e),this.currentlyLoadedPatient}fetchPatientByUuid(e){return this.currentlyLoadedPatient.next(null),this.currentlyLoadedPatientUuid.next(null),this.isBusy.next(!0),(0,C.forkJoin)(this.patientResourceService.getPatientByUuid(e,!1),this.encounterResource.getEncountersByPatientUuid(e)).subscribe(s=>{const i=s[0];i.encounters=s[1],this.currentlyLoadedPatient.next(i),this.currentlyLoadedPatientUuid.next(e),this.isBusy.next(!1)},s=>{console.error(s),this.isBusy.next(!1)})}reloadCurrentPatient(){null!==this.currentlyLoadedPatient.value&&this.fetchPatientByUuid(this.currentlyLoadedPatient.value.uuid)}resetPatientService(){this.currentlyLoadedPatient=new C.BehaviorSubject(null),this.currentlyLoadedPatientUuid=new C.BehaviorSubject(null),this.isBusy=new C.BehaviorSubject(!1)}}return n.\u0275fac=function(e){return new(e||n)(c.LFG(Pi),c.LFG(Fe))},n.\u0275prov=c.Yz7({token:n,factory:n.\u0275fac}),n})(),Xu=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n}),n.\u0275inj=c.cJS({providers:[Hu.Y,bs,fn,Ys,Hs,Js,Fe,ei,Ju,Pi,yi,bi.F],imports:[[K.ez,F.JF]]}),n})(),eh=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=c.oAB({type:n,bootstrap:[Yu]}),n.\u0275inj=c.cJS({providers:[Jt.f,Xs.n,pn,ti,Si,_i,Sn,ht,mt.sK,mt.gM],imports:[[q.b2,mt.aw.forRoot({isolate:!1}),pe.GH,gt.UX,Yr,Xu]]}),n})();(0,c.G48)();const bn=function(n){if("object"!=typeof n)throw Error("single-spa-angular requires a configuration object");const t=Object.assign(Object.assign({},_t),n);if("function"!=typeof t.bootstrapFunction)throw Error("single-spa-angular must be passed an options.bootstrapFunction");if("string"!=typeof t.template)throw Error("single-spa-angular must be passed options.template string");if(!t.NgZone)throw Error("single-spa-angular must be passed the NgZone option");return t.Router&&!t.NavigationStart&&console.warn("single-spa-angular must be passed the NavigationStart option"),{bootstrap:D.bind(null,t),mount:_e.bind(null,t),unmount:Se.bind(null,t),update:t.updateFunction}}({bootstrapFunction:n=>(Ht.next(n),q.q6([{provide:ve,deps:[[new c.tBr(K.K0)]]},{provide:K.lw,useExisting:ve}]).bootstrapModule(eh)),template:"<my-app-root />",NgZone:c.R0b}),th=bn.bootstrap,nh=bn.mount,sh=bn.unmount},1742:(Pn,ye,m)=>{m.d(ye,{Z:()=>we});var q=m(7890),c=m(4195);const we=function(ae){return"symbol"==typeof ae||(0,c.Z)(ae)&&"[object Symbol]"==(0,q.Z)(ae)}},9665:(Pn,ye,m)=>{m.d(ye,{Z:()=>St});var q=m(7122);var Ae=m(4897),we=m(1742),Le=q.Z?q.Z.prototype:void 0,K=Le?Le.toString:void 0;const vt=function ve(D){if("string"==typeof D)return D;if((0,Ae.Z)(D))return function(D,_e){for(var Se=-1,Ie=null==D?0:D.length,A=Array(Ie);++Se<Ie;)A[Se]=_e(D[Se],Se,D);return A}(D,ve)+"";if((0,we.Z)(D))return K?K.call(D):"";var _e=D+"";return"0"==_e&&1/D==-1/0?"-0":_e},St=function(D){return null==D?"":vt(D)}}}]);