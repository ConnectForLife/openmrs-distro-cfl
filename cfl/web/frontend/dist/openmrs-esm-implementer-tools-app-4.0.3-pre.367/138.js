"use strict";(self.webpackChunk_openmrs_esm_implementer_tools_app=self.webpackChunk_openmrs_esm_implementer_tools_app||[]).push([[138],{5138:(n,e,r)=>{r.r(e),r.d(e,{default:()=>O});var t,o=r(5776),u=r.n(o),i=r(6304),a=r(4610),c=r(1004),l=r(1602),s=r.n(l),f=r(3114);function d(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function p(n,e,r,t,o,u,i){try{var a=n[u](i),c=a.value}catch(n){return void r(n)}a.done?e(c):Promise.resolve(c).then(t,o)}function m(n){return function(){var e=this,r=arguments;return new Promise((function(t,o){var u=n.apply(e,r);function i(n){p(u,t,o,i,a,"next",n)}function a(n){p(u,t,o,i,a,"throw",n)}i(void 0)}))}}function v(n){return function(n){if(Array.isArray(n))return d(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,e){if(n){if("string"==typeof n)return d(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(n,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(){return b.apply(this,arguments)}function b(){return(b=m(s().mark((function n(){var e;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,w();case 3:return e=n.sent,n.abrupt("return",e.data.results);case 7:n.prev=7,n.t0=n.catch(0),console.error(n.t0);case 10:return n.abrupt("return",[]);case 11:case"end":return n.stop()}}),n,null,[[0,7]])})))).apply(this,arguments)}function h(n,e){var r,t=[],o=function(n,e){var r=Object.keys(n),t=e.map((function(n){return n.uuid}));return(0,f.Z)(r,t).map((function(e){return{uuid:e,version:n[e]}}))}(n.backendDependencies,e),u=function(n,e){return Object.keys(n).map((function(e){return{uuid:e,version:n[e]}})).filter((function(n){return e.find((function(e){return n.uuid===e.uuid}))}))}(n.backendDependencies,e);return(r=t).push.apply(r,v(o.map((function(n){return{name:n.uuid,requiredVersion:n.version,type:"missing"}}))).concat(v(u.map((function(n){var r=n.version,t=function(n,e){var r,t,o=n.uuid;return null!==(t=null===(r=e.find((function(n){return n.uuid==o})))||void 0===r?void 0:r.version)&&void 0!==t?t:""}(n,e);return{name:n.uuid,requiredVersion:r,installedVersion:t,type:A(r,t)}}))))),{name:n.moduleName,dependencies:t}}function w(){return(0,a.openmrsFetch)("/ws/rest/v1/module?v=custom:(uuid,version)",{method:"GET"})}function A(n,e){return(0,a.isVersionSatisfied)(n,e)?"okay":"version-mismatch"}function g(){return(g=m(s().mark((function n(){var e,r,o;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=7;break}return r=(null!==(e=window.installedModules)&&void 0!==e?e:[]).filter((function(n){return n[1].backendDependencies})).map((function(n){return{backendDependencies:n[1].backendDependencies,moduleName:n[0]}})),n.next=5,y();case 5:o=n.sent,t=r.map((function(n){return h(n,o)}));case 7:return n.abrupt("return",t);case 8:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function k(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}function S(){var n,e,r=(n=(0,o.useState)([]),e=2,function(n){if(Array.isArray(n))return n}(n)||function(n,e){var r=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=r){var t,o,u=[],i=!0,a=!1;try{for(r=r.call(n);!(i=(t=r.next()).done)&&(u.push(t.value),!e||u.length!==e);i=!0);}catch(n){a=!0,o=n}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return u}}(n,e)||function(n,e){if(n){if("string"==typeof n)return k(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(n,e):void 0}}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),t=r[0],u=r[1];return(0,o.useEffect)((function(){(function(){return g.apply(this,arguments)})().then(u)}),[]),t}var E=r(2680);function I(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=new Array(e);r<e;r++)t[r]=n[r];return t}var j=u().lazy((function(){return Promise.all([r.e(326),r.e(895),r.e(478),r.e(406)]).then(r.bind(r,8406))})),x=u().lazy((function(){return Promise.all([r.e(478),r.e(280)]).then(r.bind(r,8280))}));function _(){var n,e,r=(0,o.useMemo)((function(){var n;return(null!==(n=window.installedModules)&&void 0!==n?n:[]).filter((function(n){return Boolean(n)&&Boolean(n[1])})).map((function(n){return{version:n[1].version,name:n[0]}}))}),[window.installedModules]),t=S(),l=(n=(0,o.useState)(!1),e=2,function(n){if(Array.isArray(n))return n}(n)||function(n,e){var r=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=r){var t,o,u=[],i=!0,a=!1;try{for(r=r.call(n);!(i=(t=r.next()).done)&&(u.push(t.value),!e||u.length!==e);i=!0);}catch(n){a=!0,o=n}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return u}}(n,e)||function(n,e){if(n){if("string"==typeof n)return I(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(n,e):void 0}}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=l[0],f=l[1],d=(0,E.useTranslation)().t;(0,o.useEffect)((function(){f((function(n){return n||function(n){return n.some((function(n){return n.dependencies.some((function(n){return"okay"!==n.type}))}))}(t)}))}),[t]),(0,o.useEffect)((function(){s&&(0,a.showNotification)({description:"Found modules with unresolved backend dependencies.",action:u().createElement(i.xho,{onClick:c.XE},d("view","View")),kind:"error"})}),[d,s]);var p=(0,a.useStore)(c.wT),m=p.isOpen,v=p.isUIEditorEnabled,y=p.openTabIndex;return u().createElement(u().Fragment,null,m?u().createElement(j,{close:c.zI,frontendModules:r,backendDependencies:t,visibleTabIndex:y}):null,v?u().createElement(x,null):null)}function O(){return u().createElement(a.UserHasAccess,{privilege:"coreapps.systemAdministration"},u().createElement(_,null))}}}]);