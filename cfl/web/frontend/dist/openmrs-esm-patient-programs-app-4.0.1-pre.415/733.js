"use strict";(self.webpackChunk_openmrs_esm_patient_programs_app=self.webpackChunk_openmrs_esm_patient_programs_app||[]).push([[733],{1951:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(9601),a=r.n(n),o=r(2609),l=r.n(o)()(a());l.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-programs__programs-form__loading___KGmNP{margin-left:1rem;width:2rem;min-height:2.5rem}.-esm-patient-programs__programs-form__button___KPSt9{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-programs__programs-form__tablet___yw5Wr{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-programs__programs-form__desktop___RnK8C{padding:0rem}.-esm-patient-programs__programs-form__formContainer___lqbdm{margin:1rem}.-esm-patient-programs__programs-form__form___BLqPA{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}",""]),l.locals={loading:"-esm-patient-programs__programs-form__loading___KGmNP",button:"-esm-patient-programs__programs-form__button___KPSt9",tablet:"-esm-patient-programs__programs-form__tablet___yw5Wr",desktop:"-esm-patient-programs__programs-form__desktop___RnK8C",formContainer:"-esm-patient-programs__programs-form__formContainer___lqbdm",form:"-esm-patient-programs__programs-form__form___BLqPA"};const i=l},5733:(e,t,r)=>{r.r(t),r.d(t,{default:()=>F});var n=r(268),a=r.n(n),o=r(4924),l=r(9857),i=r(3565),u=r.n(i),s=r(3863),c=r(8827),m=r(819),d=r(5922),p=r(906),g=r(4076),f=r(6062),v=r.n(f),b=r(4036),y=r.n(b),_=r(6793),h=r.n(_),E=r(7892),w=r.n(E),P=r(1173),O=r.n(P),C=r(2464),x=r.n(C),Z=r(1951),S={};S.styleTagTransform=x(),S.setAttributes=w(),S.insert=h().bind(null,"head"),S.domAPI=y(),S.insertStyleElement=O(),v()(Z.Z,S);const k=Z.Z&&Z.Z.locals?Z.Z.locals:void 0;function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const F=function(e){var t,r,n,i,f=e.closeWorkspace,v=e.patientUuid,b=e.programEnrollmentId,y=(0,o.useTranslation)().t,_="tablet"===(0,p.useLayoutType)(),h=(0,p.useSession)(),E=(0,p.useLocations)(),w=(0,l.kY)().mutate,P=(0,g.oI)().data,O=(0,g.Bw)(v).data,C=b&&O.filter((function(e){return e.uuid==b}))[0],x=C?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){D(e,t,r[t])}))}return e}({display:C.program.name},C.program):null,Z=x?[x]:(0,s.Z)(P,(function(e){return!(0,c.Z)((0,m.Z)(O,"program.uuid"),e.uuid)})),S=T(a().useState((null==C?void 0:C.dateCompleted)?(0,p.parseDate)(C.dateCompleted):null),2),j=S[0],F=S[1],I=T(a().useState((null==C?void 0:C.dateEnrolled)?(0,p.parseDate)(C.dateEnrolled):new Date),2),N=I[0],L=I[1],A=T(a().useState(null!==(r=null==C?void 0:C.program.uuid)&&void 0!==r?r:""),2),q=A[0],K=A[1],Q=T(a().useState(null!==(n=null==C?void 0:C.location.uuid)&&void 0!==n?n:""),2),V=Q[0],W=Q[1];!V&&(null==h||null===(t=h.sessionLocation)||void 0===t?void 0:t.uuid)&&W(null==h||null===(i=h.sessionLocation)||void 0===i?void 0:i.uuid);var Y=a().useCallback((function(e){if(e.preventDefault(),q){var t={patient:v,program:q,dateEnrolled:N?u()(N).format():null,dateCompleted:j?u()(j).format():null,location:V},r=new AbortController,n=C?(0,g.YX)(C.uuid,t,r).subscribe((function(e){200===e.status&&(f(),(0,p.showToast)({critical:!0,kind:"success",description:y("enrollmentUpdatesNowVisible","Changes to the program are now visible in the Programs table"),title:y("enrollmentUpdated","Program enrollment updated")}),w("/ws/rest/v1/programenrollment?patient=".concat(v,"&v=").concat(g.o9)))}),(function(e){(0,p.createErrorHandler)(),(0,p.showNotification)({title:y("programEnrollmentSaveError","Error saving program enrollment"),kind:"error",critical:!0,description:null==e?void 0:e.message})})):(0,g.df)(t,r).subscribe((function(e){201===e.status&&(f(),(0,p.showToast)({critical:!0,kind:"success",description:y("enrollmentNowVisible","It is now visible in the Programs table"),title:y("enrollmentSaved","Program enrollment saved")}),w("/ws/rest/v1/programenrollment?patient=".concat(v,"&v=").concat(g.o9)))}),(function(e){(0,p.createErrorHandler)(),(0,p.showNotification)({title:y("programEnrollmentSaveError","Error saving program enrollment"),kind:"error",critical:!0,description:null==e?void 0:e.message})}));return function(){n.unsubscribe()}}}),[f,j,N,w,v,q,y,V,C]);return a().createElement(d.l09,{className:k.form,onSubmit:Y},a().createElement(d.Kqy,{className:k.formContainer,gap:7},Z.length?null:a().createElement(d.K0D,{style:{minWidth:"100%",margin:"0rem",padding:"0rem"},kind:"error",lowContrast:!0,subtitle:y("configurePrograms","Please configure programs to continue."),title:y("noProgramsConfigured","No programs configured")}),a().createElement(d.cwH,{style:{maxWidth:"50%"},legendText:y("programName","Program name")},a().createElement("div",{className:k.selectContainer},_?a().createElement(d.mh4,null,a().createElement(d.PhF,{id:"program",invalidText:y("required","Required"),labelText:"",onChange:function(e){return K(e.target.value)}},q?null:a().createElement(d.QlF,{text:y("chooseProgram","Choose a program"),value:""}),(null==Z?void 0:Z.length)>0&&Z.map((function(e){return a().createElement(d.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))):a().createElement(d.PhF,{id:"program",invalidText:y("required","Required"),labelText:"",onChange:function(e){return K(e.target.value)}},q?null:a().createElement(d.QlF,{text:y("chooseProgram","Choose a program"),value:""}),(null==Z?void 0:Z.length)>0&&Z.map((function(e){return a().createElement(d.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)}))))),a().createElement(d.cwH,{style:{maxWidth:"50%"},legendText:y("dateEnrolled","Date enrolled")},_?a().createElement(d.mh4,null,a().createElement(d.Mtg,{id:"enrollmentDate",datePickerType:"single",dateFormat:"d/m/Y",maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=T(e,1)[0];return L(t)},value:N},a().createElement(d.aj6,{id:"enrollmentDateInput",labelText:""}))):a().createElement(d.Mtg,{id:"enrollmentDate",datePickerType:"single",dateFormat:"d/m/Y",maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=T(e,1)[0];return L(t)},value:N},a().createElement(d.aj6,{id:"enrollmentDateInput",labelText:""}))),a().createElement(d.cwH,{style:{width:"50%"},legendText:y("dateCompleted","Date completed")},_?a().createElement(d.mh4,null,a().createElement(d.Mtg,{id:"completionDate",datePickerType:"single",dateFormat:"d/m/Y",minDate:new Date(N).toISOString(),maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=T(e,1)[0];return F(t)},value:j},a().createElement(d.aj6,{id:"completionDateInput",labelText:""}))):a().createElement(d.Mtg,{id:"completionDate",datePickerType:"single",dateFormat:"d/m/Y",minDate:new Date(N).toISOString(),maxDate:(new Date).toISOString(),placeholder:"dd/mm/yyyy",onChange:function(e){var t=T(e,1)[0];return F(t)},value:j},a().createElement(d.aj6,{id:"completionDateInput",labelText:""}))),a().createElement(d.cwH,{style:{width:"50%"},legendText:y("enrollmentLocation","Enrollment location")},_?a().createElement(d.mh4,null,a().createElement(d.PhF,{id:"location",invalidText:"Required",labelText:"",onChange:function(e){return W(e.target.value)},value:V},V?null:a().createElement(d.QlF,{text:y("chooseLocation","Choose a location"),value:""}),(null==E?void 0:E.length)>0&&E.map((function(e){return a().createElement(d.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))):a().createElement(d.PhF,{id:"location",invalidText:"Required",labelText:"",onChange:function(e){return W(e.target.value)},value:V},V?null:a().createElement(d.QlF,{text:y("chooseLocation","Choose a location"),value:""}),(null==E?void 0:E.length)>0&&E.map((function(e){return a().createElement(d.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)}))))),a().createElement(d.uVA,{className:_?k.tablet:k.desktop},a().createElement(d.zxk,{className:k.button,kind:"secondary",onClick:function(){return f()}},y("cancel","Cancel")),a().createElement(d.zxk,{className:k.button,kind:"primary",disabled:!q,type:"submit"},y("saveAndClose","Save and close"))))}},4076:(e,t,r)=>{r.d(t,{Bw:()=>m,YX:()=>g,b$:()=>f,df:()=>p,o9:()=>c,oI:()=>d});var n=r(9857),a=r(906),o=r(4200),l=r(3863),i=r(8827),u=r(819);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c="custom:(uuid,display,program,dateEnrolled,dateCompleted,location:(uuid,display))";function m(e){var t,r=(0,n.ZP)("/ws/rest/v1/programenrollment?patient=".concat(e,"&v=").concat(c),a.openmrsFetch),l=r.data,i=r.error,u=r.isValidating,s=(null==l||null===(t=l.data)||void 0===t?void 0:t.results.length)>0?null==l?void 0:l.data.results.sort((function(e,t){return t.dateEnrolled>e.dateEnrolled?1:-1})):null,m=null==s?void 0:s.filter((function(e){return!e.dateCompleted}));return{data:l?(0,o.Z)(s,(function(e){var t;return null==e||null===(t=e.program)||void 0===t?void 0:t.uuid})):null,isError:i,isLoading:!l&&!i,isValidating:u,activeEnrollments:m}}function d(e){var t,r,o=(0,n.ZP)("/ws/rest/v1/program?v=custom:(uuid,display,allWorkflows,concept:(uuid,display))",a.openmrsFetch),s=o.data,c=o.error,m=null!==(r=null==s||null===(t=s.data)||void 0===t?void 0:t.results)&&void 0!==r?r:null;return{data:m,isError:c,isLoading:!s&&!c,eligiblePrograms:(0,l.Z)(m,(function(t){return!(0,i.Z)((0,u.Z)(e,"program.uuid"),t.uuid)}))}}function p(e,t){if(!e)return null;var r=e.program,n=e.patient,o=e.dateEnrolled,l=e.dateCompleted,i=e.location;return(0,a.openmrsObservableFetch)("/ws/rest/v1/programenrollment",{method:"POST",headers:{"Content-Type":"application/json"},body:{program:r,patient:n,dateEnrolled:o,dateCompleted:l,location:i},signal:t.signal})}function g(e,t,r){if(!t&&!t.program)return null;t.program;var n=t.dateEnrolled,o=t.dateCompleted,l=t.location;return(0,a.openmrsObservableFetch)("/ws/rest/v1/programenrollment/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:{dateEnrolled:n,dateCompleted:o,location:l},signal:r.signal})}var f=function(e){var t,r,o=(0,a.useConfig)().customUrl,l=m(e),i=l.data,u=l.isError,c=l.isLoading,p=l.isValidating,g=l.activeEnrollments,f=d(i),v=f.data,b=f.eligiblePrograms,y=function(e){var t,r=(0,a.useConfig)().customUrl,o=(0,n.ZP)(r?"".concat(r).concat(e):null,a.openmrsFetch),l=o.data,i=o.error;return{configurablePrograms:null!==(t=null==l?void 0:l.data)&&void 0!==t?t:[],isLoading:!l&&!i,error:i}}(e),_=y.configurablePrograms,h=y.isLoading,E=y.error;return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){s(e,t,r[t])}))}return e}({enrollments:i},o?{isLoading:h,isError:E}:{isLoading:c,isError:u}),r=null!=(r={isValidating:p,activeEnrollments:g,availablePrograms:v,eligiblePrograms:b,configurablePrograms:_})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t}},1154:(e,t,r)=>{r.d(t,{Z:()=>l});const n=function(e,t,r){for(var n=-1,a=Object(e),o=r(e),l=o.length;l--;){var i=o[++n];if(!1===t(a[i],i,a))break}return e};var a=r(6892);var o=r(3282);const l=(i=function(e,t){return e&&n(e,t,a.Z)},function(e,t){if(null==e)return e;if(!(0,o.Z)(e))return i(e,t);for(var r=e.length,n=-1,a=Object(e);++n<r&&!1!==t(a[n],n,a););return e});var i},3863:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(2300),a=r(1154);const o=function(e,t){var r=[];return(0,a.Z)(e,(function(e,n,a){t(e,n,a)&&r.push(e)})),r};var l=r(7954),i=r(7885);const u=function(e,t){return((0,i.Z)(e)?n.Z:o)(e,(0,l.Z)(t,3))}},8827:(e,t,r)=>{r.d(t,{Z:()=>w});var n=r(1266),a=r(3282),o=r(9001),l=r(7885),i=r(3391);var u=/\s/;var s=/^\s+/;const c=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&u.test(e.charAt(t)););return t}(e)+1).replace(s,""):e};var m=r(3122),d=r(2758),p=/^[-+]0x[0-9a-f]+$/i,g=/^0b[01]+$/i,f=/^0o[0-7]+$/i,v=parseInt;const b=function(e){return e?Infinity===(e=function(e){if("number"==typeof e)return e;if((0,d.Z)(e))return NaN;if((0,m.Z)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=(0,m.Z)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=c(e);var r=g.test(e);return r||f.test(e)?v(e.slice(2),r?2:8):p.test(e)?NaN:+e}(e))||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};var y=r(5598);var _=r(6892);const h=function(e){return null==e?[]:function(e,t){return(0,y.Z)(t,(function(t){return e[t]}))}(e,(0,_.Z)(e))};var E=Math.max;const w=function(e,t,r,u){e=(0,a.Z)(e)?e:h(e),r=r&&!u?function(e){var t=b(e),r=t%1;return t==t?r?t-r:t:0}(r):0;var s=e.length;return r<0&&(r=E(s+r,0)),function(e){return"string"==typeof e||!(0,l.Z)(e)&&(0,i.Z)(e)&&"[object String]"==(0,o.Z)(e)}(e)?r<=s&&e.indexOf(t,r)>-1:!!s&&(0,n.Z)(e,t,r)>-1}},819:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(5598),a=r(7954),o=r(1154),l=r(3282);const i=function(e,t){var r=-1,n=(0,l.Z)(e)?Array(e.length):[];return(0,o.Z)(e,(function(e,a,o){n[++r]=t(e,a,o)})),n};var u=r(7885);const s=function(e,t){return((0,u.Z)(e)?n.Z:i)(e,(0,a.Z)(t,3))}}}]);