(window["webpackJsonpopenmrs-esm-form-entry"]=window["webpackJsonpopenmrs-esm-form-entry"]||[]).push([[2],{qIrM:function(e,t,n){"use strict";n.r(t),n.d(t,"bootstrap",function(){return be}),n.d(t,"mount",function(){return Se}),n.d(t,"unmount",function(){return ye});var r=n("e4iD"),i=n("EM62"),o=n("Jxrt"),s=n("axyU"),a=n("5lCh"),c=n("Vgaj");const u=new c.ReplaySubject(1);var d=n("2kYt"),l=n("D57K"),p=n("J+dc"),h=n("YtkY"),f=n("mawV"),g=n("cJ9h"),m=n("4e/d"),v=n("NAh8"),b=n("rgMP");const S="patient-form";let y=(()=>{class e{constructor(){}getCurrentUser(){return Object(b.getCurrentUser)()}openmrsFetch(e){return Object(b.openmrsObservableFetch)(e)}getCurrentUserLocation(){return this.openmrsFetch("/ws/rest/v1/session").pipe(Object(h.a)(e=>e.data))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var P=n("vobO"),O=n("lSOl");let w=(()=>{class e{constructor(e,t){this.http=e,this.windoRef=t,this.v="custom:(uuid,encounterDatetime,patient:(uuid,uuid),form:(uuid,name),visit:(uuid,display,auditInfo,startDatetime,stopDatetime,location:(uuid,display),visitType:(uuid,name)),location:ref,encounterType:ref,encounterProviders:(uuid,display,provider:(uuid,display)))"}getUrl(){return this.windoRef.openmrsRestBase}getEncountersByPatientUuid(e,t=!1,n=null){if(!e)return null;const r=this.getUrl()+"encounter";let i=(new P.d).set("patient",e).set("v",this.v);return this.http.get(r,{params:i}).pipe(Object(g.a)(e=>e.results.length>=500?(i=i.set("startIndex","500"),this.http.get(r,{params:i}).pipe(Object(h.a)(t=>e.results.concat(t.results)))):Object(c.of)(e.results)))}getEncounterByUuid(e){if(!e)return null;const t=(new P.d).set("v","custom:(uuid,encounterDatetime,patient:(uuid,uuid,person,identifiers:full),form:(uuid,name),visit:(uuid,visitType,display,startDatetime,stopDatetime),location:ref,encounterType:ref,encounterProviders:(uuid,display,provider:(uuid,display)),orders:full,obs:(uuid,obsDatetime,concept:(uuid,uuid,name:(display)),value:ref,groupMembers))"),n=this.getUrl()+"encounter/"+e;return this.http.get(n,{params:t})}getEncounterTypes(e){if(!e)return null;const t=this.getUrl()+"encountertype";return this.http.get(t).pipe(Object(h.a)(e=>e.results))}saveEncounter(e){if(!e)return null;const t=this.getUrl()+"encounter",n=new P.c({"Content-Type":"application/json"});return this.http.post(t,JSON.stringify(e),{headers:n})}updateEncounter(e,t){if(!t||!e)return null;const n=this.getUrl()+"encounter/"+e,r=new P.c({"Content-Type":"application/json"});return this.http.post(n,JSON.stringify(t),{headers:r})}voidEncounter(e){if(!e)return null;const t=this.getUrl()+"encounter/"+e+"?!purge",n=new P.c({"Content-Type":"application/json"});return this.http.delete(t,{headers:n})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](P.a),i["\u0275\u0275inject"](O.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var j=n("hqLi"),C=n("9RHM"),U=n("PkBB");function E(e){I(e);for(const t of["obs.concept"])D(e,t);return e}function I(e){if("object"==typeof e)for(const[t,n]of Object.entries(e))"uuid"!==t&&"string"==typeof n&&Object(U.a)(n)?M(e,t):"object"==typeof n&&I(n);else if(Array.isArray(e))for(const t of e)I(t);return e}function D(e,t){const[n,...r]=t.split(".");if(0===r.length)return void M(e,n);const i=null==e?void 0:e[n];if(Array.isArray(i))for(const o of i)D(o,r.join("."));else"object"==typeof i&&D(i,r.join("."))}function M(e,t){return"object"==typeof e&&"string"==typeof e[t]&&(e[t]={uuid:e[t]}),e}var x=n("IVkz"),B=n("D5+T");let R=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t,this.v="full"}getUrl(){return this.windowRef.openmrsRestBase+"person"}getPersonByUuid(e,t=null){let n=this.getUrl();n+="/"+e;const r=(new P.d).set("v",t&&t.length>0?t:this.v);return this.http.get(n,{params:r})}saveUpdatePerson(e,t){if(!t||!e)return null;const n=`${this.getUrl()}/${e}`,r=new P.c({"Content-Type":"application/json"});return this.http.post(n,JSON.stringify(t),{headers:r}).pipe(Object(h.a)(e=>e.person))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](P.a),i["\u0275\u0275inject"](O.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var k=n("8j5Y");let _=(()=>{class e{constructor(e,t,n){this.http=e,this.windowRef=t,this.personService=n}searchProvider(e){return this.getAllProviders().pipe(Object(h.a)(t=>t.filter(t=>t.display.toLowerCase().includes(e.toLowerCase()))))}getProviderByUuid(t){return this.http.get(this.windowRef.openmrsRestBase+"provider/"+t+"?v="+e.v).pipe(Object(m.a)(()=>this.getProviderByUuidFallback(t)))}getProviderByUuidFallback(e){return this.getAllProviders().pipe(Object(h.a)(t=>t.find(t=>t.uuid===e)))}getAllProviders(){return this.http.get(this.windowRef.openmrsRestBase+"provider?q=&v="+e.v).pipe(Object(h.a)(e=>e.results))}getUrl(t){return t?this.windowRef.openmrsRestBase+"provider/"+t+"?v="+e.v:this.windowRef.openmrsRestBase+"provider?q=&v="+e.v}}return e.v="custom:(uuid,display,person:(uuid))",e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](P.a),i["\u0275\u0275inject"](O.a),i["\u0275\u0275inject"](R))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),T=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t}getLocationByUuid(e){const t=this.getUrl(e);return this.http.get(t).pipe(Object(m.a)(()=>this.getLocationByUuidFallback(e)))}getLocationByUuidFallback(e){return this.getAllLocations().pipe(Object(h.a)(t=>t.find(t=>t.uuid===e)))}searchLocation(e){return this.getAllLocations().pipe(Object(h.a)(t=>t.filter(t=>t.display.toLowerCase().includes(e.toLowerCase()))))}getAllLocations(){const e=this.getUrl();return this.http.get(e).pipe(Object(h.a)(e=>e.results))}getUrl(t){return t?this.windowRef.openmrsRestBase+"location/"+t+"?v="+e.v:this.windowRef.openmrsRestBase+"location?q=&v="+e.v}}return e.v="custom:(uuid,display)",e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](P.a),i["\u0275\u0275inject"](O.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),F=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t,this.v="custom:(uuid,name,conceptClass,setMembers)"}getUrl(){return this.windowRef.openmrsRestBase+"concept"}searchConcept(e,t=!1,n=null){const r=this.getUrl(),i=(new P.d).set("q",e).set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:i}).pipe(Object(h.a)(e=>e.results))}getConceptByUuid(e,t=!1,n=this.v){let r=this.getUrl();r+="/"+e;const i=(new P.d).set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:i})}getConceptByConceptClassesUuid(e,t){let n=[];return this.searchConcept(e).pipe(Object(p.a)(1)).subscribe(e=>{n=this.filterResultsByConceptClassesUuid(e,t)},e=>{}),n}filterResultsByConceptClassesUuid(e,t){return e.filter(e=>t.find(t=>e.conceptClass.uuid===t))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](P.a),i["\u0275\u0275inject"](O.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var L=n("Ip0r");let A=(()=>{class e{constructor(e,t,n,r){this.providerResourceService=e,this.locationResourceService=t,this.conceptResourceService=n,this.localStorageService=r}getDataSources(){return{location:{resolveSelectedValue:this.getLocationByUuid.bind(this),searchOptions:this.findLocation.bind(this)},provider:{resolveSelectedValue:this.getProviderByUuid.bind(this),searchOptions:this.findProvider.bind(this)},drug:{resolveSelectedValue:this.resolveConcept.bind(this),searchOptions:this.findDrug.bind(this)},problem:{resolveSelectedValue:this.resolveConcept.bind(this),searchOptions:this.findProblem.bind(this)},conceptAnswers:this.getWhoStagingCriteriaDataSource()}}getWhoStagingCriteriaDataSource(){const e=new c.Subject,t={cachedOptions:[],dataSourceOptions:{concept:void 0},resolveSelectedValue:void 0,searchOptions:void 0,dataFromSourceChanged:e.asObservable(),changeConcept:void 0},n=e=>{if(t.cachedOptions.length>0)return c.Observable.create(e=>{e.next(t.cachedOptions)});const n=this.getConceptSetMembers(t.dataSourceOptions.concept);return n.subscribe(e=>{t.cachedOptions=e}),n};return t.resolveSelectedValue=e=>this.resolveConcept(e),t.searchOptions=n,t.changeConcept=r=>{t.dataSourceOptions.concept=r,t.cachedOptions=[],e.next([]),n().subscribe(t=>{e.next(t)})},t}findProvider(e){return this.providerResourceService.searchProvider(e).pipe(Object(h.a)(e=>e.filter(e=>!!e.person).map(this.mapProvider)),Object(k.a)(e=>this.setCachedProviderSearchResults(e)))}getProviderByUuid(e){return this.providerResourceService.getProviderByUuid(e).pipe(Object(h.a)(this.mapProvider))}mapProvider(e){return e&&{label:e.display,value:e.uuid,providerUuid:e.uuid}}findLocation(e){return this.locationResourceService.searchLocation(e).pipe(Object(h.a)(e=>e.map(this.mapLocation)),Object(p.a)(10))}getLocationByUuid(e){return this.locationResourceService.getLocationByUuid(e).pipe(Object(h.a)(this.mapLocation))}mapLocation(e){return e&&{label:e.display,value:e.uuid}}resolveConcept(e){return this.conceptResourceService.getConceptByUuid(e).pipe(Object(h.a)(this.mapConcept))}getConceptAnswers(e){return this.conceptResourceService.getConceptByUuid(e).pipe(Object(h.a)(e=>e.answers.map(this.mapConcept)))}getConceptSetMembers(e){return this.conceptResourceService.getConceptByUuid(e).pipe(Object(h.a)(e=>e.setMembers.map(this.mapConcept).sort((e,t)=>e.label>t.label?1:0)))}findDrug(e){return this.conceptResourceService.searchConcept(e).pipe(Object(h.a)(e=>e.filter(e=>e.conceptClass&&"8d490dfc-c2cc-11de-8d13-0010c6dffd0f"===e.conceptClass.uuid).map(this.mapConcept)))}findProblem(e){const t=["8d4918b0-c2cc-11de-8d13-0010c6dffd0f","8d492b2a-c2cc-11de-8d13-0010c6dffd0f","8d492954-c2cc-11de-8d13-0010c6dffd0f","8d491a9a-c2cc-11de-8d13-0010c6dffd0f"];return this.conceptResourceService.searchConcept(e).pipe(Object(h.a)(e=>e.filter(e=>e.conceptClass&&t.includes(e.conceptClass.uuid)).map(this.mapConcept)))}mapConcept(e){return e&&{value:e.uuid,label:e.name.display}}getCachedProviderSearchResults(){return this.localStorageService.getObject("cachedproviders")}setCachedProviderSearchResults(e){this.localStorageService.setObject("cachedproviders",e)}getPatientObject(e){const t={};return t.sex="male"===(null==e?void 0:e.gender)?"M":"F",t.birthdate=new Date(null==e?void 0:e.birthDate),t.age=this.calculateAge(null==e?void 0:e.birthDate),"female"===(null==e?void 0:e.gender)&&(t.gendercreatconstant=.85),"male"===(null==e?void 0:e.gender)&&(t.gendercreatconstant=1),t}calculateAge(e){const t=Date.now()-new Date(e).getTime(),n=new Date(t);return Math.abs(n.getUTCFullYear()-1970)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](_),i["\u0275\u0275inject"](T),i["\u0275\u0275inject"](F),i["\u0275\u0275inject"](L.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),N=(()=>{class e{constructor(){this.lastProps=void 0,this.lastPropsSubscription=u.subscribe(e=>this.lastProps=e)}ngOnDestroy(){var e;null===(e=this.lastPropsSubscription)||void 0===e||e.unsubscribe()}getPropOrThrow(e){const t=this.getProp(e);if(void 0===t){const t=new Error(`The module is missing the required Single SPA property "${e}". This is a development error likely caused by another microfrontend module. See the associated console log for details.`);throw console.error(t,this.lastProps),t}return t}getProp(e,t){var n,r;return null!==(r=null===(n=this.lastProps)||void 0===n?void 0:n[e])&&void 0!==r?r:t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),V=(()=>{class e{constructor(e,t,n,r,i,o){this.encounterAdapter=e,this.personAttributeAdapter=t,this.encounterResourceService=n,this.personResourceService=r,this.formDataSourceService=i,this.singleSpaPropsService=o}submitPayload(e){const t=this.singleSpaPropsService.getProp("isOffline",!1),n=this.singleSpaPropsService.getProp("encounterUuid");return Object(c.from)(function(e){return Object(l.a)(this,void 0,void 0,function*(){return(yield Object(b.getFullSynchronizationItems)(S)).find(t=>t.content._id===e)})}(n)).pipe(Object(g.b)(n=>{const r=t||!!n;r&&this.deepClearInitialNodeValues(e.rootNode);const i=this.onEncounterCreate(this.buildEncounterPayload(e)),o=this.buildPersonUpdatePayload(e);return r?this.submitPayloadOffline(e,i,o,null==n?void 0:n.content._id):this.submitPayloadOnline(i,o)}))}deepClearInitialNodeValues(e){if(e.initialValue=void 0,e.children&&"object"==typeof e.children)for(const t of Object.values(e.children))this.deepClearInitialNodeValues(t)}onEncounterCreate(e){const t=this.singleSpaPropsService.getProp("handleEncounterCreate");return t&&"function"==typeof t&&t(e),e}submitPayloadOffline(e,t,n,r){const i=E(Object(C.a)(t)),o={encounter:i},s={_id:null!=r?r:Object(x.a)(),formSchemaUuid:e.schema.uuid,encounter:i,_payloads:{encounterCreate:t,personUpdate:n}};return Object(c.from)(function(e){var t,n;return Object(l.a)(this,void 0,void 0,function*(){yield Object(b.queueSynchronizationItem)(S,e,{id:e._id,displayName:"Patient form",patientUuid:null===(t=e._payloads.encounterCreate)||void 0===t?void 0:t.patient,dependencies:[{type:"visit",id:null===(n=e._payloads.encounterCreate)||void 0===n?void 0:n.visit}]})})}(s).then(()=>o))}submitPayloadOnline(e,t){return Object(c.forkJoin)({encounter:this.submitEncounter(e),person:this.submitPersonUpdate(t)})}submitEncounter(e){return e?e.uuid?this.encounterResourceService.updateEncounter(e.uuid,e).pipe(Object(m.a)(e=>this.throwUserFriendlyError(e))):this.encounterResourceService.saveEncounter(e).pipe(Object(m.a)(e=>this.throwUserFriendlyError(e))):Object(c.of)(void 0)}submitPersonUpdate(e){return e?this.personResourceService.saveUpdatePerson(e.uuid,e).pipe(Object(m.a)(e=>this.throwUserFriendlyError(e))):Object(c.of)(void 0)}buildEncounterPayload(e){const t=this.formDataSourceService.getCachedProviderSearchResults();if((null==t?void 0:t.length)&&!e.valueProcessingInfo.providerUuid){const n=this.findProviderUuidFormForm(t,e);e.valueProcessingInfo.providerUuid=n}const n=this.encounterAdapter.generateFormPayload(e);return Object(j.a)(n)?void 0:n}findProviderUuidFormForm(e,t){var n,r;const i=null===(n=t.searchNodeByQuestionId("provider")[0])||void 0===n?void 0:n.control.value,o=null===(r=e.find(e=>e.id===i))||void 0===r?void 0:r.providerUuid;return null!=o?o:i}buildPersonUpdatePayload(e){if(!e.valueProcessingInfo.personUuid)throw new Error("The form is missing a required value for submitting person updates: form.valueProcessingInfo.personUuid");const t=this.personAttributeAdapter.generateFormPayload(e);if(!Object(j.a)(t))return{uuid:e.valueProcessingInfo.personUuid,attributes:t}}throwUserFriendlyError(e){var t,n,r;if("object"==typeof e){const i=Object.values(null!==(r=null===(n=null===(t=e.error)||void 0===t?void 0:t.error)||void 0===n?void 0:n.fieldErrors)&&void 0!==r?r:{}).flatMap(e=>e).map(e=>e.message),o=i.length>0?i.join(" "):e.message;throw new Error(o)}throw"string"==typeof e?new Error(e):new Error(`An unknown error occured: ${e}.`)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](B.b),i["\u0275\u0275inject"](B.f),i["\u0275\u0275inject"](w),i["\u0275\u0275inject"](R),i["\u0275\u0275inject"](A),i["\u0275\u0275inject"](N))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var $=n("W6XZ");let W=(()=>{class e{constructor(e){this.encounterResource=e}getPreviousEncounter(e,t){return new Promise((n,r)=>{this.encounterResource.getEncountersByPatientUuid(t).subscribe(t=>{if(t){const i=t.sort((e,t)=>new Date(t.encounterDatetime).getTime()-new Date(e.encounterDatetime).getTime()),o=Object($.a)(i,t=>t.encounterType.uuid===e);o?this.encounterResource.getEncounterByUuid(o.uuid).pipe(Object(p.a)(1)).subscribe(e=>{n(e)},e=>{r(e)}):n(Object.create({}))}},e=>{console.error("Previous encounter",e)})})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](w))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var J=n("wgY5"),z=n("LB+V");let q=(()=>{class e{getConfig(){var e;let t=null===(e=Object(b.getConfigStore)("@openmrs/esm-form-entry-app").getState())||void 0===e?void 0:e.config;return Object(b.getConfigStore)("@openmrs/esm-form-entry-app").subscribe(e=>{e.loaded&&e&&(t=e.config)}),t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),H=(()=>{class e{constructor(e,t,n){this.http=e,this.windowRef=t,this.configResource=n}getMonthlySchedule(e){const t=`${this.configResource.getConfig().appointmentsResourceUrl}?startDate=${e.startDate}&endDate=${e.endDate}&locationUuids=${e.locationUuids}&limit=${e.limit}&programType=${e.programType}&groupBy=groupByPerson,groupByAttendedDate,groupByRtcDate`;return this.http.get(`${this.windowRef.nativeWindow.openmrsBase}${t}`)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](P.a),i["\u0275\u0275inject"](O.a),i["\u0275\u0275inject"](q))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();const Q={};let Y=(()=>{class e{constructor(e,t,n,r,i,o,s){this.formFactory=e,this.dataSources=t,this.formDataSourceService=n,this.monthlyScheduleResourceService=r,this.encounterAdapter=i,this.configResourceService=o,this.singleSpaPropsService=s}initAndCreateForm(e){return Object(l.a)(this,void 0,void 0,function*(){const{formSchema:t,encounter:n}=e;yield this.wireDataSources(e);const r=this.formFactory.createForm(t,this.dataSources.dataSources);if(this.setUpWHOCascading(r),n){const t=n.uuid;this.populateEncounterForEditing(r,e),r.valueProcessingInfo.encounterUuid=t}else{const t=this.singleSpaPropsService.getPropOrThrow("patientUuid");this.setDefaultValues(r,e),r.valueProcessingInfo.patientUuid=t}return this.setUpPayloadProcessingInformation(r,e),r})}wireDataSources(e){const t=this.singleSpaPropsService.getPropOrThrow("visitTypeUuid"),n=this.singleSpaPropsService.getPropOrThrow("patient");for(const i of Object.keys(this.dataSources.dataSources))this.dataSources.clearDataSource(i);this.dataSources.registerDataSource("location",this.formDataSourceService.getDataSources().location),this.dataSources.registerDataSource("provider",this.formDataSourceService.getDataSources().provider),this.dataSources.registerDataSource("drug",this.formDataSourceService.getDataSources().drug),this.dataSources.registerDataSource("problem",this.formDataSourceService.getDataSources().problem),this.dataSources.registerDataSource("personAttribute",this.formDataSourceService.getDataSources().location),this.dataSources.registerDataSource("conceptAnswers",this.formDataSourceService.getDataSources().conceptAnswers),this.dataSources.registerDataSource("patient",{visitTypeUuid:t},!0),this.dataSources.registerDataSource("patient",this.formDataSourceService.getPatientObject(n),!0),this.dataSources.registerDataSource("rawPrevEnc",e.previousEncounter,!1),this.dataSources.registerDataSource("userLocation",e.user.sessionLocation);const r=this.configResourceService.getConfig();return r.dataSources.monthlySchedule&&this.dataSources.registerDataSource("monthlyScheduleResourceService",this.monthlyScheduleResourceService),Promise.all([r.customDataSources.map(({name:e,moduleName:t,moduleExport:n})=>Object(l.a)(this,void 0,void 0,function*(){let r=!1;if(Q.hasOwnProperty(e)){if(Q[e])return this.dataSources.registerDataSource(e,Q[e]),Promise.resolve();r=!0}if(""===t)return r||console.warn(`A custom data source ${e} has a blank module name. A module name must be provided to register a data source correctly.`),Q[e]=void 0,Promise.resolve();const i=function(e){return e.replace(/[\/\-@]/g,"_")}(t);if(!window.hasOwnProperty(i))return r||console.error(`esm-form-entry-app is configured to use the datasource ${e}, but the corresponding module ${t} has not been loaded. Most likely, this means that ${t} is not in your importmap or was not loaded prior to ending up here.`),Q[e]=void 0,Promise.resolve();{const s=window[i];if(!("object"==typeof s&&s.hasOwnProperty("init")&&Object(z.a)(s.init)&&s.hasOwnProperty("get")&&Object(z.a)(s.get)))return r||console.error(`esm-form-app is configured to use the datasource ${e} from the module ${t}, but the version of ${t} loaded is not in the expected format. Please ensure that the version of ${t} you are loading is built as a Webpack module.`),Q[e]=void 0,Promise.resolve();try{const i=(yield s.get("./start"))();return"object"==typeof i&&i.hasOwnProperty(n)?(Q[e]=i[n],this.dataSources.registerDataSource(e,i[n]),Promise.resolve()):(r||console.error(`esm-form-entry-app could not load the module ${t} for the datasource ${e} because the module did not have the expected ${"default"==n?"default export":`export ${n}`}.`),Q[e]=void 0,Promise.resolve())}catch(o){return r||console.error(`esm-form-entry-app could not load the datasource ${e} because ${t} did not export the expected entry "./start". Please check the Webpack configuration for ${t}.`,o),Q[e]=void 0,Promise.resolve()}}}))])}setUpWHOCascading(e){try{let t=e.searchNodeByQuestionId("adultWhoStage");0===t.length&&(t=e.searchNodeByQuestionId("pedWhoStage"));const n=t[0];null==n||n.control.valueChanges.subscribe(t=>{var n;if(t){const r=e.dataSourcesContainer.dataSources.conceptAnswers;null===(n=r.changeConcept)||void 0===n||n.call(r,t)}})}catch(t){console.error(`Error setting up WHO Staging Cascading. Error: ${JSON.stringify(t)}.`)}}setDefaultValues(e,t){const{user:n}=t,r=J().format(),i=e.searchNodeByQuestionId("encDate");i.length>0&&i[0].control.setValue(r);const o=e.searchNodeByQuestionId("location","encounterLocation");o.length>0&&(null==n?void 0:n.sessionLocation)&&o[0].control.setValue(n.sessionLocation.uuid);const s=e.searchNodeByQuestionId("provider","encounterProvider");s.length>0&&(null==n?void 0:n.currentProvider)&&s[0].control.setValue(n.currentProvider.uuid)}setUpPayloadProcessingInformation(e,t){var n;const{user:r,formSchema:i,encounter:o}=t,s=this.singleSpaPropsService.getPropOrThrow("patientUuid"),a=this.singleSpaPropsService.getPropOrThrow("visitUuid");try{if(r){if(e.valueProcessingInfo.personUuid=s,e.valueProcessingInfo.patientUuid=s,e.valueProcessingInfo.formUuid=i.uuid,e.valueProcessingInfo.providerUuid=null===(n=r.currentProvider)||void 0===n?void 0:n.uuid,!i.encounterType)throw new Error("Please associate the form with an encounter type.");e.valueProcessingInfo.encounterTypeUuid=i.encounterType.uuid,o&&(e.valueProcessingInfo.encounterUuid=o.uuid),o||(e.valueProcessingInfo.visitUuid=a)}}catch(c){console.error(c)}}populateEncounterForEditing(e,t){const{encounter:n}=t;n&&this.encounterAdapter.populateForm(e,n)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](B.d),i["\u0275\u0275inject"](B.a),i["\u0275\u0275inject"](A),i["\u0275\u0275inject"](H),i["\u0275\u0275inject"](B.b),i["\u0275\u0275inject"](q),i["\u0275\u0275inject"](N))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})();var G=n("yWDJ"),Z=n("nIj0");let K=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["loader"]],inputs:{loadingMessage:"loadingMessage"},decls:12,vars:1,consts:[["aria-live","assertive",1,"cds--inline-loading",2,"width","fit-content"],[1,"cds--inline-loading__animation"],["aria-atomic","true","aria-labelledby","loading-id-5","aria-live","assertive",1,"cds--loading","cds--loading--small"],["id","loading-id-5",1,"cds--visually-hidden"],["viewBox","0 0 100 100",1,"cds--loading__svg"],["cx","50%","cy","50%","r","44",1,"cds--loading__background"],["cx","50%","cy","50%","r","44",1,"cds--loading__stroke"],[1,"cds--inline-loading__text"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275elementStart"](1,"div",1),i["\u0275\u0275elementStart"](2,"div",2),i["\u0275\u0275elementStart"](3,"label",3),i["\u0275\u0275text"](4," Active loading indicator "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275namespaceSVG"](),i["\u0275\u0275elementStart"](5,"svg",4),i["\u0275\u0275elementStart"](6,"title"),i["\u0275\u0275text"](7,"Active loading indicator"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](8,"circle",5),i["\u0275\u0275element"](9,"circle",6),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275namespaceHTML"](),i["\u0275\u0275elementStart"](10,"div",7),i["\u0275\u0275text"](11),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](11),i["\u0275\u0275textInterpolate"](t.loadingMessage))},encapsulation:2}),e})();function X(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275elementStart"](1,"div",3),i["\u0275\u0275elementStart"](2,"h4",4),i["\u0275\u0275text"](3,"There was an error with this form"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](4,"p",5),i["\u0275\u0275text"](5," Try opening another form "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](6,"p",6),i["\u0275\u0275text"](7,"or"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](8,"button",7),i["\u0275\u0275listener"]("click",function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().closeForm()}),i["\u0275\u0275text"](9," Close this panel "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}}function ee(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"form",13),i["\u0275\u0275element"](1,"form-renderer",14),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](3);i["\u0275\u0275property"]("formGroup",e.form.rootNode.control),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("labelMap",e.labelMap)("node",e.form.rootNode)}}function te(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"span"),i["\u0275\u0275text"](1,"Save and close"),i["\u0275\u0275elementEnd"]())}function ne(e,t){1&e&&i["\u0275\u0275element"](0,"loader",20)}function re(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"div",15),i["\u0275\u0275elementStart"](1,"button",16),i["\u0275\u0275listener"]("click",function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](3).closeForm()}),i["\u0275\u0275text"](2,"Discard"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](3,"button",17),i["\u0275\u0275listener"]("click",function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"](3).onSubmit()}),i["\u0275\u0275template"](4,te,2,0,"span",18),i["\u0275\u0275template"](5,ne,1,0,"loader",19),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"](3);i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("disabled","submitting"===e.formState),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf","submitting"!==e.formState),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf","submitting"===e.formState)}}function ie(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",2),i["\u0275\u0275elementStart"](1,"div"),i["\u0275\u0275template"](2,ee,2,3,"form",11),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](3,re,6,3,"div",12),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"](2);i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",e.form),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.showDiscardSubmitButtons)}}function oe(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",21),i["\u0275\u0275element"](1,"loader",22),i["\u0275\u0275elementEnd"]())}const se=function(e){return{error:e}};function ae(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",8),i["\u0275\u0275elementStart"](1,"div",9),i["\u0275\u0275template"](2,ie,4,2,"div",0),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](3,oe,2,0,"div",10),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](3,se,"readyWithValidationErrors"===e.formState)),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf","ready"===e.formState||"readyWithValidationErrors"===e.formState||"submitting"===e.formState||"submissionError"===e.formState),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf","loading"===e.formState)}}const ce=Object(b.createGlobalStore)("ampath-form-state",{});let ue=(()=>{class e{constructor(e,t,n,r,i,o,s,a){this.openmrsApi=e,this.formSchemaService=t,this.encounterResourceService=n,this.formSubmissionService=r,this.patientPreviousEncounter=i,this.formCreationService=o,this.singleSpaPropsService=s,this.conceptService=a,this.labelMap={},this.formState="initial",this.showDiscardSubmitButtons=!0,this.language=window.i18next.language.substring(0,2).toLowerCase()}ngOnInit(){this.unsubscribeStore=ce.subscribe(e=>{this.formState=e[this.formUuid]}),this.changeState("initial"),this.launchForm()}ngOnDestroy(){var e;this.unsubscribeStore&&this.unsubscribeStore(),null===(e=this.launchFormSubscription)||void 0===e||e.unsubscribe()}launchForm(){var e,t;this.changeState("loading"),this.showDiscardSubmitButtons=null===(e=this.singleSpaPropsService.getProp("showDiscardSubmitButtons"))||void 0===e||e,null===(t=this.launchFormSubscription)||void 0===t||t.unsubscribe(),this.launchFormSubscription=this.loadAllFormDependencies().pipe(Object(p.a)(1),Object(h.a)(e=>Object(c.from)(this.formCreationService.initAndCreateForm(e))),Object(f.a)(),Object(g.b)(e=>{const t=v.a.getUnlabeledConceptIdentifiersFromSchema(e.schema);return this.conceptService.searchBulkConceptsByUUID(t,this.language).pipe(Object(h.a)(t=>({form:e,concepts:t})))})).subscribe(({form:e,concepts:t})=>{this.form=e,this.labelMap=t.reduce((e,t)=>(e[t.uuid]=t.display,e),{}),this.changeState("ready")},e=>{this.loadingError="Error loading form",console.error("Error rendering form",e),this.changeState("loadingError")})}loadAllFormDependencies(){this.formUuid=this.singleSpaPropsService.getPropOrThrow("formUuid");const e=this.singleSpaPropsService.getPropOrThrow("encounterUuid");return Object(c.forkJoin)({formSchema:this.fetchCompiledFormSchema(this.formUuid).pipe(Object(p.a)(1)),user:this.openmrsApi.getCurrentUserLocation().pipe(Object(p.a)(1)),encounter:e?this.getEncounterToEdit(e).pipe(Object(p.a)(1)):Object(c.of)(null)}).pipe(Object(g.b)(e=>this.loadPatientPreviousEncounters(e.formSchema).pipe(Object(h.a)(t=>Object.assign(Object.assign({},e),{previousEncounter:t})))),Object(m.a)(e=>Object(c.throwError)(new Error("There was an error fetching form data. Details: "+JSON.stringify(e)))))}fetchCompiledFormSchema(e){return this.formSchemaService.getFormSchemaByUuid(e,!0).pipe(Object(p.a)(1))}getEncounterToEdit(e){return this.singleSpaPropsService.getProp("isOffline",!1)?Object(c.from)(this.getOfflineEncounterToEdit(e)):this.encounterResourceService.getEncounterByUuid(e).pipe(Object(m.a)(()=>Object(c.from)(this.getOfflineEncounterToEdit(e))))}getOfflineEncounterToEdit(e){return Object(l.a)(this,void 0,void 0,function*(){return(yield Object(b.getSynchronizationItems)(S)).find(t=>t._id===e).encounter})}loadPatientPreviousEncounters(e){var t;const n=this.singleSpaPropsService.getProp("patientUuid");return this.singleSpaPropsService.getProp("isOffline",!1)?Object(c.of)(void 0):Object(c.from)(this.patientPreviousEncounter.getPreviousEncounter(null===(t=e.encounterType)||void 0===t?void 0:t.uuid,n))}onSubmit(){this.validateForm()&&(this.changeState("submitting"),this.formSubmissionService.submitPayload(this.form).subscribe(({encounter:e})=>{this.onPostResponse(e);const t=this.singleSpaPropsService.getProp("isOffline",!1);this.changeState("submitted"),!t&&(null==e?void 0:e.uuid)&&this.encounterResourceService.getEncounterByUuid(e.uuid).pipe(Object(p.a)(1)).subscribe(e=>{if(Array.isArray(null==e?void 0:e.orders)){const t=e.orders.filter(({auditInfo:e})=>!e.dateVoided);this.showLabOrdersNotification(t)}}),Object(b.showToast)({critical:!0,kind:"success",description:"The form has been submitted successfully.",title:this.form.schema.name}),this.closeForm()},e=>{this.changeState("submissionError"),Object(b.showToast)({critical:!0,kind:"error",description:`An error has occurred while submitting the form. Error: ${JSON.stringify(null==e?void 0:e.message,null,2)}.`,title:this.form.schema.name})}))}validateForm(){return this.form.valid||(this.form.markInvalidControls(this.form.rootNode),this.form.showErrors=!0,this.changeState("readyWithValidationErrors")),this.onValidate(this.form.valid),this.form.valid}showLabOrdersNotification(e=[]){var t;const n=null!==(t=e.map((e,t)=>` ${t+1} : ${e.display} : ${e.orderNumber}`).join())&&void 0!==t?t:"";n.length&&Object(b.showNotification)({title:"Lab order(s) generated",kind:"success",critical:!0,description:n})}closeForm(){this.singleSpaPropsService.getPropOrThrow("closeWorkspace")()}onPostResponse(e){const t=this.singleSpaPropsService.getProp("handlePostResponse");t&&"function"==typeof t&&t(e)}onValidate(e){const t=this.singleSpaPropsService.getProp("handleOnValidate");t&&"function"==typeof t&&t(e)}onFormAction(e){var t,n,r;const i=this.singleSpaPropsService.getPropOrThrow("formUuid"),o=this.singleSpaPropsService.getPropOrThrow("patientUuid");if((null===(t=e.detail)||void 0===t?void 0:t.formUuid)===i&&(null===(n=e.detail)||void 0===n?void 0:n.patientUuid)===o)switch(null===(r=e.detail)||void 0===r?void 0:r.action){case"onSubmit":this.onSubmit();break;case"validateForm":this.validateForm()}}changeState(e){if(e!=this.formState){const t={};t[this.formUuid]=e,ce.setState(t)}}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](y),i["\u0275\u0275directiveInject"](v.a),i["\u0275\u0275directiveInject"](w),i["\u0275\u0275directiveInject"](V),i["\u0275\u0275directiveInject"](W),i["\u0275\u0275directiveInject"](Y),i["\u0275\u0275directiveInject"](N),i["\u0275\u0275directiveInject"](G.a))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["my-app-fe-wrapper"]],hostBindings:function(e,t){1&e&&i["\u0275\u0275listener"]("ampath-form-action",function(e){return t.onFormAction(e)},!1,i["\u0275\u0275resolveWindow"])},decls:2,vars:2,consts:[["class","form-container",4,"ngIf"],[3,"ngClass",4,"ngIf"],[1,"form-container"],[1,"cds--tile","error-tile"],[1,"heading"],[1,"helperText"],[1,"separator"],[1,"cds--btn","cds--btn--sm","cds--btn--ghost",3,"click"],[3,"ngClass"],[1,"content"],["class","loader-container",4,"ngIf"],["class","cds--form no-padding",3,"formGroup",4,"ngIf"],["class","cds-btn--set button-set",4,"ngIf"],[1,"cds--form","no-padding",3,"formGroup"],[3,"labelMap","node"],[1,"cds-btn--set","button-set"],["type","button",1,"cds--btn","cds--btn--secondary",3,"click"],["type","submit",1,"cds--btn","cds--btn--primary",3,"disabled","click"],[4,"ngIf"],["loadingMessage","Submitting",4,"ngIf"],["loadingMessage","Submitting"],[1,"loader-container"],["loadingMessage","Loading...",1,"loader"]],template:function(e,t){1&e&&(i["\u0275\u0275template"](0,X,10,0,"div",0),i["\u0275\u0275template"](1,ae,4,5,"div",1)),2&e&&(i["\u0275\u0275property"]("ngIf",t.loadingError),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf","submitted"!==t.formState))},directives:[d.i,d.g,Z.s,Z.m,Z.h,B.g,K],styles:['[_ngcontent-%COMP%]:root {\n  --brand-01: #005d5d;\n  --brand-02: #004144;\n  --brand-03: #007d79;\n}\n\n.error-tile[_ngcontent-%COMP%] {\n  width: 60%;\n  margin: 1.25rem auto;\n  display: flex;\n  flex-flow: column wrap;\n  align-items: center;\n  justify-content: center;\n  padding: 1.5rem 0 1.75rem;\n}\n\n.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .error-tile[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .error-tile[_ngcontent-%COMP%] {\n  background-color: #ffffff;\n}\n.heading[_ngcontent-%COMP%] {\n  font-size: var(--cds-productive-heading-02-font-size, 1rem);\n  font-weight: var(--cds-productive-heading-02-font-weight, 600);\n  line-height: var(--cds-productive-heading-02-line-height, 1.375);\n  letter-spacing: var(--cds-productive-heading-02-letter-spacing, 0);\n  color: #161616;\n}\n.helperText[_ngcontent-%COMP%] {\n  margin-top: 0.5rem;\n  font-size: var(--cds-body-01-font-size, 0.875rem);\n  font-weight: var(--cds-body-01-font-weight, 400);\n  line-height: var(--cds-body-01-line-height, 1.42857);\n  letter-spacing: var(--cds-body-01-letter-spacing, 0.16px);\n  color: #262626;\n}\n.separator[_ngcontent-%COMP%] {\n  font-size: var(--cds-body-01-font-size, 0.875rem);\n  font-weight: var(--cds-body-01-font-weight, 400);\n  line-height: var(--cds-body-01-line-height, 1.42857);\n  letter-spacing: var(--cds-body-01-letter-spacing, 0.16px);\n  color: #262626;\n  width: 12rem;\n  margin: 1.375rem auto;\n  overflow: hidden;\n  text-align: center;\n}\n.separator[_ngcontent-%COMP%]::before, .separator[_ngcontent-%COMP%]::after {\n  background-color: #a8a8a8;\n  content: "";\n  display: inline-block;\n  height: 1px;\n  position: relative;\n  vertical-align: middle;\n  width: 50%;\n}\n.separator[_ngcontent-%COMP%]::before {\n  right: 1rem;\n  margin-left: -50%;\n}\n.separator[_ngcontent-%COMP%]::after {\n  left: 1rem;\n  margin-right: -50%;\n}\n.title-icon-size[_ngcontent-%COMP%] {\n  height: 0.8rem;\n  width: 0.8rem;\n}\n.no-errors[_ngcontent-%COMP%] {\n  display: none;\n}\n.sidebar[_ngcontent-%COMP%]   .open[_ngcontent-%COMP%] {\n  margin-top: -1px;\n  width: 55%;\n  height: 80%;\n  padding: 4px;\n  overflow-y: scroll;\n  overflow-x: hidden;\n}\n.sidebar[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%] {\n  height: 80px;\n  width: 28px;\n  margin-top: -1px;\n}\n.error-content[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%] {\n  display: none;\n}\n.error-content[_ngcontent-%COMP%] {\n  border-top: 1px solid #e0e0e0;\n  margin: -4px;\n  padding: 4px;\n}\n.error-title[_ngcontent-%COMP%]   .closed[_ngcontent-%COMP%] {\n  transform: rotate(90deg);\n  margin-top: 14px;\n}\n.no-padding[_ngcontent-%COMP%] {\n  margin-left: -2rem;\n  margin-right: -2rem;\n}\n.center[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  height: 100vh;\n}\n.form-container[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n}\n.button-set[_ngcontent-%COMP%] {\n  margin: 0 -2rem;\n}\n.button-set[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\n  height: 4rem;\n  align-items: baseline;\n  min-width: 50%;\n}\n\n.omrs-breakpoint-gt-tablet[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%], .omrs-breakpoint-gt-tablet   [_nghost-%COMP%]   .form-container[_ngcontent-%COMP%] {\n  height: calc(100vh - 6rem);\n  margin: 0 2rem;\n}\n.omrs-breakpoint-gt-tablet[_nghost-%COMP%]   .button-set[_ngcontent-%COMP%], .omrs-breakpoint-gt-tablet   [_nghost-%COMP%]   .button-set[_ngcontent-%COMP%] {\n  padding: 0rem;\n}\n\n.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .form-container[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .form-container[_ngcontent-%COMP%] {\n  height: calc(100vh - 6rem);\n  margin: 0 2rem;\n}\n.omrs-breakpoint-lt-desktop[_nghost-%COMP%]   .button-set[_ngcontent-%COMP%], .omrs-breakpoint-lt-desktop   [_nghost-%COMP%]   .button-set[_ngcontent-%COMP%] {\n  padding: 1.5rem 1rem;\n  background-color: #ffffff;\n}\n.loader-container[_ngcontent-%COMP%] {\n  height: 100vh;\n}\n.loader[_ngcontent-%COMP%] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 50%;\n}\n.encounterHeader[_ngcontent-%COMP%] {\n  font-family: "IBM Plex Sans", sans-serif;\n  font-size: 14px;\n  line-height: 22px;\n  font-weight: 600;\n  letter-spacing: 0.16px;\n  border-bottom: 1px solid var(--brand-03);\n  padding: 0.625rem;\n}']}),e})();function de(e,t){1&e&&i["\u0275\u0275element"](0,"my-app-fe-wrapper")}let le=(()=>{class e{constructor(){this.title="ampath-esm-angular-form-entry"}ngOnInit(){this.sub=u.subscribe(e=>{this.view=e.view},e=>{})}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["my-app-root"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&i["\u0275\u0275template"](0,de,1,0,"my-app-fe-wrapper",0),2&e&&i["\u0275\u0275property"]("ngIf","form"===t.view)},directives:[d.i,ue],styles:[""]}),e})();var pe=n("ISRS");let he=(()=>{class e{constructor(e,t){this.http=e,this.windowRef=t,this.v="custom:(uuid,display,identifiers:(identifier,uuid,preferred,location:(uuid,name),identifierType:(uuid,name,format,formatDescription,validator)),person:(uuid,display,gender,birthdate,dead,age,deathDate,birthdateEstimated,causeOfDeath,preferredName:(uuid,preferred,givenName,middleName,familyName),attributes:(uuid,display,value,attributeType,dateCreated,dateChanged),preferredAddress:(uuid,preferred,address1,address2,cityVillage,longitude,stateProvince,latitude,country,postalCode,countyDistrict,address3,address4,address5,address6,address7)))"}getUrl(){return this.windowRef.openmrsRestBase+"patient"}searchPatient(e,t=!1,n=null){const r=this.getUrl(),i=(new P.d).set("q",e).set("includeDead","true").set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:i}).pipe(Object(h.a)(e=>e.results))}getPatientByUuid(e,t=!1,n=null){let r=this.getUrl();r+="/"+e;const i=(new P.d).set("v",n&&n.length>0?n:this.v);return this.http.get(r,{params:i})}saveUpdatePatientIdentifier(e,t,n){if(!n||!e)return null;const r=this.getUrl()+"/"+e+"/identifier/"+t,i=new P.c({"Content-Type":"application/json"});return this.http.post(r,JSON.stringify(n),{headers:i}).pipe(Object(h.a)(e=>e.patient))}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](P.a),i["\u0275\u0275inject"](O.a))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),fe=(()=>{class e{constructor(e,t){this.patientResourceService=e,this.encounterResource=t,this.currentlyLoadedPatient=new c.BehaviorSubject(null),this.currentlyLoadedPatientUuid=new c.BehaviorSubject(null),this.isBusy=new c.BehaviorSubject(!1)}setCurrentlyLoadedPatientByUuid(e){return null!==this.currentlyLoadedPatient.value?this.currentlyLoadedPatient.value.uuid!==e&&this.fetchPatientByUuid(e):this.fetchPatientByUuid(e),this.currentlyLoadedPatient}fetchPatientByUuid(e){return this.currentlyLoadedPatient.next(null),this.currentlyLoadedPatientUuid.next(null),this.isBusy.next(!0),Object(c.forkJoin)(this.patientResourceService.getPatientByUuid(e,!1),this.encounterResource.getEncountersByPatientUuid(e)).subscribe(t=>{const n=t[0];n.encounters=t[1],this.currentlyLoadedPatient.next(n),this.currentlyLoadedPatientUuid.next(e),this.isBusy.next(!1)},e=>{console.error(e),this.isBusy.next(!1)})}reloadCurrentPatient(){null!==this.currentlyLoadedPatient.value&&this.fetchPatientByUuid(this.currentlyLoadedPatient.value.uuid)}resetPatientService(){this.currentlyLoadedPatient=new c.BehaviorSubject(null),this.currentlyLoadedPatientUuid=new c.BehaviorSubject(null),this.isBusy=new c.BehaviorSubject(!1)}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275inject"](he),i["\u0275\u0275inject"](w))},e.\u0275prov=i["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e})(),ge=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({providers:[pe.a,y,R,_,T,F,w,fe,he,W,G.a],imports:[[d.b,P.b]]}),e})(),me=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e,bootstrap:[le]}),e.\u0275inj=i["\u0275\u0275defineInjector"]({providers:[v.a,L.a,A,V,Y,H,q,N],imports:[[r.a,B.c,Z.q,a.a,ge]]}),e})();Object(i.enableProdMode)();const ve=Object(s.b)({bootstrapFunction:e=>(u.next(e),r.c(Object(s.a)()).bootstrapModule(me)),template:"<my-app-root />",NgZone:i.NgZone,AnimationEngine:o.b}),be=ve.bootstrap,Se=ve.mount,ye=ve.unmount}}]);