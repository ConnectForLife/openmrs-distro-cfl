(globalThis.webpackChunk_openmrs_esm_patient_appointments_app=globalThis.webpackChunk_openmrs_esm_patient_appointments_app||[]).push([[323],{6824:function(t){t.exports=function(){"use strict";return function(t,n,e){n.prototype.isToday=function(){var t="YYYY-MM-DD",n=e();return this.format(t)===n.format(t)}}}()},3323:(t,n,e)=>{"use strict";e.r(n),e.d(n,{default:()=>p});var r=e(7900),o=e.n(r),a=e(4924),i=e(2892),l=e(2870),u=e(9318);function s(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function c(t,n,e,r,o,a,i){try{var l=t[a](i),u=l.value}catch(t){return void e(t)}l.done?n(u):Promise.resolve(u).then(r,o)}const p=function(t){var n,e,p,f,d=t.closeCancelModal,m=t.appointmentUuid,h=t.patientUuid,v=(0,a.useTranslation)().t,y=(0,u.zt)(h,(new Date).toUTCString(),new AbortController).mutate,b=(p=(0,r.useState)(!1),f=2,function(t){if(Array.isArray(t))return t}(p)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var r,o,a=[],i=!0,l=!1;try{for(e=e.call(t);!(i=(r=e.next()).done)&&(a.push(r.value),!n||a.length!==n);i=!0);}catch(t){l=!0,o=t}finally{try{i||null==e.return||e.return()}finally{if(l)throw o}}return a}}(p,f)||function(t,n){if(t){if("string"==typeof t)return s(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,n):void 0}}(p,f)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),w=b[0],g=b[1],T=(n=function(){var t;return function(t,n){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(a){return function(l){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(t,i)}catch(t){a=[6,t],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(n){return t=new AbortController,g(!0),(0,u.v1)("Cancelled",m,t).then((function(t){200===t.status&&(y(),d(),(0,l.showToast)({critical:!0,kind:"success",description:v("appointmentCancelledSuccessfully","Appointment cancelled successfully"),title:v("appointmentCancelled","Appointment cancelled")}))})).catch((function(t){(0,l.showNotification)({title:v("appointmentCancelError","Error cancelling appointment"),kind:"error",critical:!0,description:null==t?void 0:t.message})})),[2]}))},e=function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function i(t){c(a,r,o,i,l,"next",t)}function l(t){c(a,r,o,i,l,"throw",t)}i(void 0)}))},function(){return e.apply(this,arguments)});return o().createElement("div",null,o().createElement(i.xBx,{closeModal:d,title:v("cancelAppointment","Cancel appointment")}),o().createElement(i.fef,null,o().createElement("p",null,v("cancelAppointmentModalConfirmationText","Are you sure you want to cancel this appointment?"))),o().createElement(i.mzw,null,o().createElement(i.zxk,{kind:"secondary",onClick:d},v("discard","Discard")),o().createElement(i.zxk,{kind:"danger",onClick:T,disabled:w},v("cancelAppointment","Cancel appointment"))))}},9318:(t,n,e)=>{"use strict";e.d(n,{Ae:()=>m,GB:()=>d,l9:()=>f,v1:()=>y,zt:()=>p});var r=e(3565),o=e.n(r),a=e(3255),i=e(2870),l=e(6824),u=e.n(l);function s(t,n,e,r,o,a,i){try{var l=t[a](i),u=l.value}catch(t){return void e(t)}l.done?n(u):Promise.resolve(u).then(r,o)}o().extend(u());var c="/ws/rest/v1/appointments/search";function p(t,n,e){var r,l,u,s,p,f,d,m=(0,a.ZP)(c,(function(){return(0,i.openmrsFetch)(c,{method:"POST",signal:e.signal,headers:{"Content-Type":"application/json"},body:{patientUuid:t,startDate:n}})})),h=m.data,v=m.error,y=m.isLoading,b=m.isValidating,w=m.mutate,g=(null==h||null===(r=h.data)||void 0===r?void 0:r.length)?h.data:null,T=null==g||null===(u=g.sort((function(t,n){return n.startDateTime>t.startDateTime?1:-1})))||void 0===u||null===(l=u.filter((function(t){return"Cancelled"!==t.status})))||void 0===l?void 0:l.filter((function(t){var n=t.startDateTime;return o()(new Date(n).toISOString()).isBefore((new Date).setHours(0,0,0,0))})),S=null==g||null===(p=g.sort((function(t,n){return t.startDateTime>n.startDateTime?1:-1})))||void 0===p||null===(s=p.filter((function(t){return"Cancelled"!==t.status})))||void 0===s?void 0:s.filter((function(t){var n=t.startDateTime;return o()(new Date(n).toISOString()).isAfter(new Date)})),D=null==g||null===(d=g.sort((function(t,n){return t.startDateTime>n.startDateTime?1:-1})))||void 0===d||null===(f=d.filter((function(t){return"Cancelled"!==t.status})))||void 0===f?void 0:f.filter((function(t){var n=t.startDateTime;return o()(new Date(n).toISOString()).isToday()}));return{data:h?{pastAppointments:T,upcomingAppointments:S,todaysAppointments:D}:null,isError:v,isLoading:y,isValidating:b,mutate:w}}function f(){var t=(0,a.ZP)("/ws/rest/v1/appointmentService/all/full",i.openmrsFetch),n=t.data,e=t.error,r=t.isLoading;return{data:n?n.data:null,isError:e,isLoading:r}}function d(t,n){return(0,i.openmrsFetch)("/ws/rest/v1/appointment",{method:"POST",signal:n.signal,headers:{"Content-Type":"application/json"},body:t})}function m(t,n){return(0,i.openmrsFetch)("/ws/rest/v1/recurring-appointments",{method:"POST",signal:n.signal,headers:{"Content-Type":"application/json"},body:t})}var h,v,y=(h=function(t,n,e){var r,a,l;return function(t,n){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(a){return function(l){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(t,i)}catch(t){a=[6,t],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(e){switch(e.label){case 0:return r=Intl.DateTimeFormat().resolvedOptions().timeZone,a=o()(new Date).format("YYYY-MM-DDTHH:mm:ss.SSSZZ"),l="/ws/rest/v1/appointments/".concat(n,"/status-change"),[4,(0,i.openmrsFetch)(l,{body:{toStatus:t,onDate:a,timeZone:r},method:"POST",headers:{"Content-Type":"application/json"}})];case 1:return[2,e.sent()]}}))},v=function(){var t=this,n=arguments;return new Promise((function(e,r){var o=h.apply(t,n);function a(t){s(o,e,r,a,i,"next",t)}function i(t){s(o,e,r,a,i,"throw",t)}a(void 0)}))},function(t,n,e){return v.apply(this,arguments)})}}]);